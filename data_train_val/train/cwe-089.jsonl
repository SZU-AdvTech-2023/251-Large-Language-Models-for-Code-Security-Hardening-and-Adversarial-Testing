{"func_name": "build_board", "func_src_before": "def build_board(conn, game,size):\n    # we'll build the empty board, and then fill in with the move list that\n    # we get from the DB.\n    board = []\n    for i in range(size):\n        board.append([\"\"]*size)\n\n\n    # search for all moves that have happenend during this game.\n    cursor = conn.cursor()\n    cursor.execute(\"SELECT x,y,letter FROM moves WHERE gameID = %d;\" % game)\n\n    counts = {\"X\":0, \"O\":0}\n    for move in cursor.fetchall():\n        (x,y,letter) = move\n\n        x = int(x)\n        y = int(y)\n        assert x >= 0 and x < size\n        assert y >= 0 and y < size\n\n        assert letter in \"XO\"\n\n        assert board[x][y] == \"\"\n        board[x][y] = letter\n\n        counts[letter] += 1\n\n    cursor.close()\n\n    assert counts[\"X\"] >= counts[\"O\"]\n    assert counts[\"X\"] <= counts[\"O\"]+1\n\n    if counts[\"X\"] == counts[\"O\"]:\n        nextPlayer = 0\n    else:\n        nextPlayer = 1\n    letter = \"XO\"[nextPlayer]\n\n    return (board,nextPlayer,letter)", "func_src_after": "def build_board(conn, game,size):\n    # we'll build the empty board, and then fill in with the move list that\n    # we get from the DB.\n    board = []\n    for i in range(size):\n        board.append([\"\"]*size)\n\n\n    # search for all moves that have happenend during this game.\n    cursor = conn.cursor()\n    cursor.execute(\"SELECT x,y,letter FROM moves WHERE gameID = %d;\", (game,))\n\n    counts = {\"X\":0, \"O\":0}\n    for move in cursor.fetchall():\n        (x,y,letter) = move\n\n        x = int(x)\n        y = int(y)\n        assert x >= 0 and x < size\n        assert y >= 0 and y < size\n\n        assert letter in \"XO\"\n\n        assert board[x][y] == \"\"\n        board[x][y] = letter\n\n        counts[letter] += 1\n\n    cursor.close()\n\n    assert counts[\"X\"] >= counts[\"O\"]\n    assert counts[\"X\"] <= counts[\"O\"]+1\n\n    if counts[\"X\"] == counts[\"O\"]:\n        nextPlayer = 0\n    else:\n        nextPlayer = 1\n    letter = \"XO\"[nextPlayer]\n\n    return (board,nextPlayer,letter)", "commit_link": "github.com/russ-lewis/ttt_-_python_cgi/commit/6096f43fd4b2d91211eec4614b7960c0816900da", "file_name": "cgi/common.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 11, "char_start": 303, "char_end": 380, "line": "    cursor.execute(\"SELECT x,y,letter FROM moves WHERE gameID = %d;\" % game)\n"}], "added": [{"line_no": 11, "char_start": 303, "char_end": 382, "line": "    cursor.execute(\"SELECT x,y,letter FROM moves WHERE gameID = %d;\", (game,))\n"}]}, "char_changes": {"deleted": [{"char_start": 371, "char_end": 373, "chars": " %"}], "added": [{"char_start": 371, "char_end": 372, "chars": ","}, {"char_start": 373, "char_end": 374, "chars": "("}, {"char_start": 378, "char_end": 380, "chars": ",)"}]}}
{"func_name": "check_and_update_ranks", "func_src_before": "    def check_and_update_ranks(self, scene):\n        # There are 2 cases here:\n        #   1) Ranks have never been calculated for this scene before\n        #       - This means we need to calculate what the ranks were every month of this scenes history\n        #       - We should only do this if ranks don't already exist for this scene\n        #   2) Ranks have been calculated for this scene before\n        #       - We already have bulk ranks. We should check if it has been more than 1 month since we last\n        #           calculated ranks. If so, calculate again with the brackets that have come out this month\n\n        LOG.info('About to check if ranks need updating for {}'.format(scene))\n        # First, do we have any ranks for this scene already?\n        sql = 'select count(*) from ranks where scene=\"{}\";'.format(scene)\n        res = self.db.exec(sql)\n        count = res[0][0]\n\n        n = 5 if (scene == 'pro' or scene == 'pro_wiiu') else constants.TOURNAMENTS_PER_RANK\n        if count == 0:\n            LOG.info('Detected that we need to bulk update ranks for {}'.format(scene))\n            # Alright, we have nothing. Bulk update ranks\n            first_month = bracket_utils.get_first_month(self.db, scene)\n            last_month = bracket_utils.get_last_month(self.db, scene)\n            \n            # Iterate through all tournaments going month by month, and calculate ranks\n            months = bracket_utils.iter_months(first_month, last_month, include_first=False, include_last=True)\n            for month in months:\n                urls, _ = bracket_utils.get_n_tournaments_before_date(self.db, scene, month, n)\n                self.process_ranks(scene, urls, month)\n        else:\n\n            # Get the date of the last time we calculated ranks\n            sql = \"select date from ranks where scene='{}' order by date desc limit 1;\".format(scene)\n            res = self.db.exec(sql)\n            last_rankings_date = res[0][0]\n\n            # Check to see if it's been more than 1 month since we last calculated ranks\n            more_than_one_month = bracket_utils.has_month_passed(last_rankings_date)\n            if more_than_one_month:\n                # Get only the last n tournaments, so it doesn't take too long to process\n                today = datetime.datetime.today().strftime('%Y-%m-%d')\n                msg = 'Detected that we need up update monthly ranks for {}, on {}'.format(scene, today)\n                LOG.info(msg)\n\n                # We should only ever calculate ranks on the 1st. If today is not the first, log error\n                if not today.split('-')[-1] == '1':\n                    LOG.exc('We are calculating ranks today, {}, but it isnt the first'.format(today))\n\n                months = bracket_utils.iter_months(last_rankings_date, today, include_first=False, include_last=True)\n                for month in months:\n                    # Make sure that we actually have matches during this month\n                    # Say we are trying to calculate ranks for 2018-05-01, the player would need to have matches during 2018-04-01, 2018-04-30\n                    prev_date = bracket_utils.get_previous_month(month)\n                    brackets_during_month = bracket_utils.get_tournaments_during_month(self.db, scene, prev_date)\n\n                    if len(brackets_during_month) > 0:\n                        tweet('Calculating {} ranks for {}'.format(month, scene))\n                        urls, _ = bracket_utils.get_n_tournaments_before_date(self.db, scene, month, n)\n                        self.process_ranks(scene, urls, month)\n\n            else:\n                LOG.info('It has not yet been 1 month since we calculated ranks for {}. Skipping'.format(scene))", "func_src_after": "    def check_and_update_ranks(self, scene):\n        # There are 2 cases here:\n        #   1) Ranks have never been calculated for this scene before\n        #       - This means we need to calculate what the ranks were every month of this scenes history\n        #       - We should only do this if ranks don't already exist for this scene\n        #   2) Ranks have been calculated for this scene before\n        #       - We already have bulk ranks. We should check if it has been more than 1 month since we last\n        #           calculated ranks. If so, calculate again with the brackets that have come out this month\n\n        LOG.info('About to check if ranks need updating for {}'.format(scene))\n        # First, do we have any ranks for this scene already?\n        sql = 'select count(*) from ranks where scene=\"{scene}\";'\n        args = {'scene': scene}\n        res = self.db.exec(sql, args)\n        count = res[0][0]\n\n        n = 5 if (scene == 'pro' or scene == 'pro_wiiu') else constants.TOURNAMENTS_PER_RANK\n        if count == 0:\n            LOG.info('Detected that we need to bulk update ranks for {}'.format(scene))\n            # Alright, we have nothing. Bulk update ranks\n            first_month = bracket_utils.get_first_month(self.db, scene)\n            last_month = bracket_utils.get_last_month(self.db, scene)\n            \n            # Iterate through all tournaments going month by month, and calculate ranks\n            months = bracket_utils.iter_months(first_month, last_month, include_first=False, include_last=True)\n            for month in months:\n                urls, _ = bracket_utils.get_n_tournaments_before_date(self.db, scene, month, n)\n                self.process_ranks(scene, urls, month)\n        else:\n\n            # Get the date of the last time we calculated ranks\n            sql = \"select date from ranks where scene='{scene}' order by date desc limit 1;\"\n            args = {'scene': scene}\n            res = self.db.exec(sql, args)\n            last_rankings_date = res[0][0]\n\n            # Check to see if it's been more than 1 month since we last calculated ranks\n            more_than_one_month = bracket_utils.has_month_passed(last_rankings_date)\n            if more_than_one_month:\n                # Get only the last n tournaments, so it doesn't take too long to process\n                today = datetime.datetime.today().strftime('%Y-%m-%d')\n                msg = 'Detected that we need up update monthly ranks for {}, on {}'.format(scene, today)\n                LOG.info(msg)\n\n                # We should only ever calculate ranks on the 1st. If today is not the first, log error\n                if not today.split('-')[-1] == '1':\n                    LOG.exc('We are calculating ranks today, {}, but it isnt the first'.format(today))\n\n                months = bracket_utils.iter_months(last_rankings_date, today, include_first=False, include_last=True)\n                for month in months:\n                    # Make sure that we actually have matches during this month\n                    # Say we are trying to calculate ranks for 2018-05-01, the player would need to have matches during 2018-04-01, 2018-04-30\n                    prev_date = bracket_utils.get_previous_month(month)\n                    brackets_during_month = bracket_utils.get_tournaments_during_month(self.db, scene, prev_date)\n\n                    if len(brackets_during_month) > 0:\n                        tweet('Calculating {} ranks for {}'.format(month, scene))\n                        urls, _ = bracket_utils.get_n_tournaments_before_date(self.db, scene, month, n)\n                        self.process_ranks(scene, urls, month)\n\n            else:\n                LOG.info('It has not yet been 1 month since we calculated ranks for {}. Skipping'.format(scene))", "commit_link": "github.com/DKelle/Smash_stats/commit/4bb83f3f6ce7d6bebbeb512cd015f9e72cf36d63", "file_name": "process_data.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 12, "char_start": 763, "char_end": 838, "line": "        sql = 'select count(*) from ranks where scene=\"{}\";'.format(scene)\n"}, {"line_no": 13, "char_start": 838, "char_end": 870, "line": "        res = self.db.exec(sql)\n"}, {"line_no": 31, "char_start": 1777, "char_end": 1879, "line": "            sql = \"select date from ranks where scene='{}' order by date desc limit 1;\".format(scene)\n"}, {"line_no": 32, "char_start": 1879, "char_end": 1915, "line": "            res = self.db.exec(sql)\n"}], "added": [{"line_no": 12, "char_start": 763, "char_end": 829, "line": "        sql = 'select count(*) from ranks where scene=\"{scene}\";'\n"}, {"line_no": 13, "char_start": 829, "char_end": 861, "line": "        args = {'scene': scene}\n"}, {"line_no": 14, "char_start": 861, "char_end": 899, "line": "        res = self.db.exec(sql, args)\n"}, {"line_no": 32, "char_start": 1806, "char_end": 1899, "line": "            sql = \"select date from ranks where scene='{scene}' order by date desc limit 1;\"\n"}, {"line_no": 33, "char_start": 1899, "char_end": 1935, "line": "            args = {'scene': scene}\n"}, {"line_no": 34, "char_start": 1935, "char_end": 1977, "line": "            res = self.db.exec(sql, args)\n"}]}, "char_changes": {"deleted": [{"char_start": 823, "char_end": 826, "chars": ".fo"}, {"char_start": 827, "char_end": 831, "chars": "mat("}, {"char_start": 836, "char_end": 837, "chars": ")"}, {"char_start": 1864, "char_end": 1867, "chars": ".fo"}, {"char_start": 1868, "char_end": 1872, "chars": "mat("}, {"char_start": 1877, "char_end": 1878, "chars": ")"}], "added": [{"char_start": 819, "char_end": 824, "chars": "scene"}, {"char_start": 828, "char_end": 837, "chars": "\n        "}, {"char_start": 838, "char_end": 846, "chars": "rgs = {'"}, {"char_start": 851, "char_end": 860, "chars": "': scene}"}, {"char_start": 891, "char_end": 897, "chars": ", args"}, {"char_start": 1862, "char_end": 1867, "chars": "scene"}, {"char_start": 1898, "char_end": 1911, "chars": "\n            "}, {"char_start": 1912, "char_end": 1920, "chars": "rgs = {'"}, {"char_start": 1925, "char_end": 1934, "chars": "': scene}"}, {"char_start": 1969, "char_end": 1975, "chars": ", args"}]}}
{"func_name": "tag_num_to_tag", "func_src_before": "    def tag_num_to_tag(self, tag_num):\n        ''' Returns tag given tag_num. '''\n\n        q = \"SELECT tag FROM tags WHERE rowid = '\" + str(tag_num) + \"'\"\n        self.query(q)\n        return self.c.fetchone()[0]", "func_src_after": "    def tag_num_to_tag(self, tag_num):\n        ''' Returns tag given tag_num. '''\n\n        q = \"SELECT tag FROM tags WHERE rowid = ?\"\n        self.query(q, tag_num)\n        return self.c.fetchone()[0]", "commit_link": "github.com/pukkapies/urop2019/commit/3ca2e2c291d2d5fe262d20a8e0520bdfb622432b", "file_name": "modules/query_lastfm.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 4, "char_start": 83, "char_end": 155, "line": "        q = \"SELECT tag FROM tags WHERE rowid = '\" + str(tag_num) + \"'\"\n"}, {"line_no": 5, "char_start": 155, "char_end": 177, "line": "        self.query(q)\n"}], "added": [{"line_no": 4, "char_start": 83, "char_end": 134, "line": "        q = \"SELECT tag FROM tags WHERE rowid = ?\"\n"}, {"line_no": 5, "char_start": 134, "char_end": 165, "line": "        self.query(q, tag_num)\n"}]}, "char_changes": {"deleted": [{"char_start": 131, "char_end": 153, "chars": "'\" + str(tag_num) + \"'"}], "added": [{"char_start": 131, "char_end": 132, "chars": "?"}, {"char_start": 154, "char_end": 163, "chars": ", tag_num"}]}}
{"func_name": "get_item", "func_src_before": "@api.route('/items/<int:item_id>', methods=['GET'])\ndef get_item(item_id):\n    sql = '''SELECT id, name_enus FROM tblDBCItem WHERE id = {} AND auctionable = true;'''.format(item_id)\n    cursor = mysql.connection.cursor()\n    cursor.execute(sql)\n    data = cursor.fetchone()\n\n    if data:\n        item = {}\n        for tup in zip([column[0] for column in cursor.description], data):\n            item[tup[0]] = tup[1]\n    else:\n        return jsonify({\"error\": \"item not found\"}), 404\n\n    return jsonify(item)", "func_src_after": "@api.route('/items/<int:item_id>', methods=['GET'])\ndef get_item(item_id):\n    sql = '''SELECT id, name_enus FROM tblDBCItem WHERE id = %s AND auctionable = true;'''\n    cursor = mysql.connection.cursor()\n    cursor.execute(sql, [item_id])\n    data = cursor.fetchone()\n\n    if data:\n        item = {}\n        for tup in zip([column[0] for column in cursor.description], data):\n            item[tup[0]] = tup[1]\n    else:\n        return jsonify({\"error\": \"item not found\"}), 404\n\n    return jsonify(item)", "commit_link": "github.com/cosileone/TimeIsMoneyFriend-API/commit/3d3b5defd26ef7d205915bf643b6b1df90a15e44", "file_name": "timf/api/views.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 3, "char_start": 75, "char_end": 182, "line": "    sql = '''SELECT id, name_enus FROM tblDBCItem WHERE id = {} AND auctionable = true;'''.format(item_id)\n"}, {"line_no": 5, "char_start": 221, "char_end": 245, "line": "    cursor.execute(sql)\n"}], "added": [{"line_no": 3, "char_start": 75, "char_end": 166, "line": "    sql = '''SELECT id, name_enus FROM tblDBCItem WHERE id = %s AND auctionable = true;'''\n"}, {"line_no": 5, "char_start": 205, "char_end": 240, "line": "    cursor.execute(sql, [item_id])\n"}]}, "char_changes": {"deleted": [{"char_start": 136, "char_end": 138, "chars": "{}"}, {"char_start": 165, "char_end": 181, "chars": ".format(item_id)"}], "added": [{"char_start": 136, "char_end": 138, "chars": "%s"}, {"char_start": 227, "char_end": 238, "chars": ", [item_id]"}]}}
{"func_name": "getPostsByPostid", "func_src_before": "    def getPostsByPostid(self,postid):\n        sqlText=\"select users.name,post.comment from users,post where \\\n                users.userid=post.userid and post.postid=%d\"%(postid)\n        result=sql.queryDB(self.conn,sqlText)\n        return result;", "func_src_after": "    def getPostsByPostid(self,postid):\n        sqlText=\"select users.name,post.comment from users,post where \\\n                users.userid=post.userid and post.postid=%s\"\n        params=[postid]\n        result=sql.queryDB(self.conn,sqlText,params)\n        return result;", "commit_link": "github.com/ShaominLi/Twitter_project/commit/5329d91f9e569c95184053c8e7ef596949c33ce9", "file_name": "modules/post.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 3, "char_start": 111, "char_end": 181, "line": "                users.userid=post.userid and post.postid=%d\"%(postid)\n"}, {"line_no": 4, "char_start": 181, "char_end": 227, "line": "        result=sql.queryDB(self.conn,sqlText)\n"}], "added": [{"line_no": 3, "char_start": 111, "char_end": 172, "line": "                users.userid=post.userid and post.postid=%s\"\n"}, {"line_no": 4, "char_start": 172, "char_end": 196, "line": "        params=[postid]\n"}, {"line_no": 5, "char_start": 196, "char_end": 249, "line": "        result=sql.queryDB(self.conn,sqlText,params)\n"}]}, "char_changes": {"deleted": [{"char_start": 169, "char_end": 170, "chars": "d"}, {"char_start": 171, "char_end": 173, "chars": "%("}, {"char_start": 179, "char_end": 180, "chars": ")"}], "added": [{"char_start": 169, "char_end": 170, "chars": "s"}, {"char_start": 171, "char_end": 188, "chars": "\n        params=["}, {"char_start": 194, "char_end": 195, "chars": "]"}, {"char_start": 240, "char_end": 247, "chars": ",params"}]}}
{"func_name": "getFileCacheID", "func_src_before": "\tdef getFileCacheID(self, pth):\n\t\t\"\"\"\n\t\tReturns ID of a cached file on Telegram from DB. None if file doesn't exist or has no cached ID.\n\t\t:param pth:\n\t\t:return:\n\t\t\"\"\"\n\t\tcommand = \"SELECT file_id FROM {0} WHERE path='{1}'\".format(TABLE_NAME, pth)\n\t\tdata = self._run_command(command)\n\n\t\ttry:\n\t\t\tdata = data[0][0]\n\t\texcept IndexError:\n\t\t\tdata = None\n\n\t\treturn data", "func_src_after": "\tdef getFileCacheID(self, pth):\n\t\t\"\"\"\n\t\tReturns ID of a cached file on Telegram from DB. None if file doesn't exist or has no cached ID.\n\t\t:param pth:\n\t\t:return:\n\t\t\"\"\"\n\t\tcommand = \"SELECT file_id FROM {0} WHERE path=?;\".format(TABLE_NAME)\n\t\tparams = (pth,)\n\t\tdata = self._run_command(command, params)\n\n\t\ttry:\n\t\t\tdata = data[0][0]\n\t\texcept IndexError:\n\t\t\tdata = None\n\n\t\treturn data", "commit_link": "github.com/Highstaker/Picture-sender-telegram-bot/commit/db4bc6adb41e086418761426ff4958a81c30adca", "file_name": "file_db.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 7, "char_start": 168, "char_end": 247, "line": "\t\tcommand = \"SELECT file_id FROM {0} WHERE path='{1}'\".format(TABLE_NAME, pth)\n"}, {"line_no": 8, "char_start": 247, "char_end": 283, "line": "\t\tdata = self._run_command(command)\n"}], "added": [{"line_no": 7, "char_start": 168, "char_end": 239, "line": "\t\tcommand = \"SELECT file_id FROM {0} WHERE path=?;\".format(TABLE_NAME)\n"}, {"line_no": 8, "char_start": 239, "char_end": 257, "line": "\t\tparams = (pth,)\n"}, {"line_no": 9, "char_start": 257, "char_end": 301, "line": "\t\tdata = self._run_command(command, params)\n"}]}, "char_changes": {"deleted": [{"char_start": 216, "char_end": 221, "chars": "'{1}'"}, {"char_start": 240, "char_end": 241, "chars": ","}], "added": [{"char_start": 216, "char_end": 218, "chars": "?;"}, {"char_start": 237, "char_end": 247, "chars": ")\n\t\tparams"}, {"char_start": 248, "char_end": 251, "chars": "= ("}, {"char_start": 254, "char_end": 255, "chars": ","}, {"char_start": 291, "char_end": 299, "chars": ", params"}]}}
{"func_name": "add_post", "func_src_before": "def add_post(content):\n  \"\"\"Add a post to the 'database' with the current timestamp.\"\"\"\n  db = psycopg2.connect(database=DBNAME)\n  c = db.cursor()\n  c.execute(\"insert into posts values('%s')\" % content)\n  db.commit()\n  db.close()", "func_src_after": "def add_post(content):\n  \"\"\"Add a post to the 'database' with the current timestamp.\"\"\"\n  db = psycopg2.connect(database=DBNAME)\n  c = db.cursor()\n  c.execute(\"insert into posts values(%s)\",(content,))\n  db.commit()\n  db.close()", "commit_link": "github.com/tfalbo/SuzyMakeup/commit/1a5d6ccf02bec303d454f87a6bb39baed30c205f", "file_name": "vagrant/forum/forumdb.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 5, "char_start": 147, "char_end": 203, "line": "  c.execute(\"insert into posts values('%s')\" % content)\n"}], "added": [{"line_no": 5, "char_start": 147, "char_end": 202, "line": "  c.execute(\"insert into posts values(%s)\",(content,))\n"}]}, "char_changes": {"deleted": [{"char_start": 185, "char_end": 186, "chars": "'"}, {"char_start": 188, "char_end": 189, "chars": "'"}, {"char_start": 191, "char_end": 194, "chars": " % "}], "added": [{"char_start": 189, "char_end": 191, "chars": ",("}, {"char_start": 198, "char_end": 200, "chars": ",)"}]}}
{"func_name": "getSubmissionDateFromDatabase", "func_src_before": "def getSubmissionDateFromDatabase(submission):\n    database = sqlite3.connect('database.db')\n    cursor = database.cursor()\n    return cursor.execute(\"SELECT Date FROM ChallengeRankings WHERE SubmissionID = '\" + str(submission.id) + \"'\").fetchone()[0]\n    database.close()", "func_src_after": "def getSubmissionDateFromDatabase(submission):\n    database = sqlite3.connect('database.db')\n    cursor = database.cursor()\n    return cursor.execute(\"SELECT Date FROM ChallengeRankings WHERE SubmissionID = ?\", [str(submission.id)]).fetchone()[0]\n    database.close()", "commit_link": "github.com/LiquidFun/Reddit-GeoGuessr-Tracking-Bot/commit/0cad2d52e24b05da32789fbc8face7a9999a71f9", "file_name": "CheckAndPostForSeriesSubmissions.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 4, "char_start": 124, "char_end": 252, "line": "    return cursor.execute(\"SELECT Date FROM ChallengeRankings WHERE SubmissionID = '\" + str(submission.id) + \"'\").fetchone()[0]\n"}], "added": [{"line_no": 4, "char_start": 124, "char_end": 247, "line": "    return cursor.execute(\"SELECT Date FROM ChallengeRankings WHERE SubmissionID = ?\", [str(submission.id)]).fetchone()[0]\n"}]}, "char_changes": {"deleted": [{"char_start": 207, "char_end": 208, "chars": "'"}, {"char_start": 209, "char_end": 211, "chars": " +"}, {"char_start": 230, "char_end": 236, "chars": " + \"'\""}], "added": [{"char_start": 207, "char_end": 208, "chars": "?"}, {"char_start": 209, "char_end": 210, "chars": ","}, {"char_start": 211, "char_end": 212, "chars": "["}, {"char_start": 230, "char_end": 231, "chars": "]"}]}}
{"func_name": "ranks", "func_src_before": "@endpoints.route(\"/ranks\")\ndef ranks():\n    if db == None:\n        init()\n\n    scene = request.args.get('scene', default='austin')\n    date = request.args.get('date')\n \n    # If no date was provided, pick the date of the latest tournament\n    if date == None:\n        sql = \"SELECT distinct date FROM ranks WHERE scene='{}' ORDER BY date DESC LIMIT 1;\".format(scene)\n        res = db.exec(sql)\n        date = res[0][0]\n\n    # Get all the urls that this player has participated in\n    sql = \"SELECT * FROM ranks WHERE scene = '{}' and date='{}'\".format(scene, date)\n    res = db.exec(sql)\n\n    # Make a dict out of this data\n    # eg {'christmasmike': 50}\n    cur_ranks = {}\n    for r in res:\n        tag = r[1]\n        rank = r[2]\n\n        cur_ranks[tag] = rank\n\n    # Now get the ranks from last month, so we know if these players went up or down\n    y, m, d = date.split('-')\n    prev_date = bracket_utils.get_previous_month(date)\n\n    # Get all the urls that this player has participated in\n    sql = \"SELECT * FROM ranks WHERE scene = '{}' and date='{}'\".format(scene, prev_date)\n    res = db.exec(sql)\n\n    # Make a dict out of this data\n    # eg {'christmasmike': 50}\n    prev_ranks = {}\n    for r in res:\n        tag = r[1]\n        rank = r[2]\n\n        prev_ranks[tag] = rank\n\n    return render_template('libraries/html/ranks.html', cur_ranks=cur_ranks, prev_ranks=prev_ranks, scene=scene, date=date)", "func_src_after": "@endpoints.route(\"/ranks\")\ndef ranks():\n    if db == None:\n        init()\n\n    scene = request.args.get('scene', default='austin')\n    date = request.args.get('date')\n \n    # If no date was provided, pick the date of the latest tournament\n    if date == None:\n        sql = \"SELECT distinct date FROM ranks WHERE scene='{scene}' ORDER BY date DESC LIMIT 1;\"\n        args = {'scene': scene}\n        res = db.exec(sql, args)\n        date = res[0][0]\n\n    # Get all the urls that this player has participated in\n    sql = \"SELECT * FROM ranks WHERE scene = '{scene}' and date='{date}'\"\n    args = {'scene': scene, 'date': date}\n    res = db.exec(sql, args)\n\n    # Make a dict out of this data\n    # eg {'christmasmike': 50}\n    cur_ranks = {}\n    for r in res:\n        tag = r[1]\n        rank = r[2]\n\n        cur_ranks[tag] = rank\n\n    # Now get the ranks from last month, so we know if these players went up or down\n    y, m, d = date.split('-')\n    prev_date = bracket_utils.get_previous_month(date)\n\n    # Get all the urls that this player has participated in\n    sql = \"SELECT * FROM ranks WHERE scene = '{scene}' and date='{date}'\"\n    args = {'scene': scene, 'date': prev_date}\n    res = db.exec(sql, args)\n\n    # Make a dict out of this data\n    # eg {'christmasmike': 50}\n    prev_ranks = {}\n    for r in res:\n        tag = r[1]\n        rank = r[2]\n\n        prev_ranks[tag] = rank\n\n    return render_template('libraries/html/ranks.html', cur_ranks=cur_ranks, prev_ranks=prev_ranks, scene=scene, date=date)", "commit_link": "github.com/DKelle/Smash_stats/commit/4bb83f3f6ce7d6bebbeb512cd015f9e72cf36d63", "file_name": "endpoints.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 11, "char_start": 260, "char_end": 367, "line": "        sql = \"SELECT distinct date FROM ranks WHERE scene='{}' ORDER BY date DESC LIMIT 1;\".format(scene)\n"}, {"line_no": 12, "char_start": 367, "char_end": 394, "line": "        res = db.exec(sql)\n"}, {"line_no": 16, "char_start": 480, "char_end": 565, "line": "    sql = \"SELECT * FROM ranks WHERE scene = '{}' and date='{}'\".format(scene, date)\n"}, {"line_no": 17, "char_start": 565, "char_end": 588, "line": "    res = db.exec(sql)\n"}, {"line_no": 33, "char_start": 994, "char_end": 1084, "line": "    sql = \"SELECT * FROM ranks WHERE scene = '{}' and date='{}'\".format(scene, prev_date)\n"}, {"line_no": 34, "char_start": 1084, "char_end": 1107, "line": "    res = db.exec(sql)\n"}], "added": [{"line_no": 11, "char_start": 260, "char_end": 358, "line": "        sql = \"SELECT distinct date FROM ranks WHERE scene='{scene}' ORDER BY date DESC LIMIT 1;\"\n"}, {"line_no": 12, "char_start": 358, "char_end": 390, "line": "        args = {'scene': scene}\n"}, {"line_no": 13, "char_start": 390, "char_end": 423, "line": "        res = db.exec(sql, args)\n"}, {"line_no": 17, "char_start": 509, "char_end": 583, "line": "    sql = \"SELECT * FROM ranks WHERE scene = '{scene}' and date='{date}'\"\n"}, {"line_no": 18, "char_start": 583, "char_end": 625, "line": "    args = {'scene': scene, 'date': date}\n"}, {"line_no": 19, "char_start": 625, "char_end": 654, "line": "    res = db.exec(sql, args)\n"}, {"line_no": 35, "char_start": 1060, "char_end": 1134, "line": "    sql = \"SELECT * FROM ranks WHERE scene = '{scene}' and date='{date}'\"\n"}, {"line_no": 36, "char_start": 1134, "char_end": 1181, "line": "    args = {'scene': scene, 'date': prev_date}\n"}, {"line_no": 37, "char_start": 1181, "char_end": 1210, "line": "    res = db.exec(sql, args)\n"}]}, "char_changes": {"deleted": [{"char_start": 352, "char_end": 355, "chars": ".fo"}, {"char_start": 356, "char_end": 360, "chars": "mat("}, {"char_start": 365, "char_end": 366, "chars": ")"}, {"char_start": 544, "char_end": 547, "chars": ".fo"}, {"char_start": 548, "char_end": 552, "chars": "mat("}, {"char_start": 563, "char_end": 564, "chars": ")"}, {"char_start": 1058, "char_end": 1061, "chars": ".fo"}, {"char_start": 1062, "char_end": 1066, "chars": "mat("}, {"char_start": 1082, "char_end": 1083, "chars": ")"}], "added": [{"char_start": 321, "char_end": 326, "chars": "scene"}, {"char_start": 357, "char_end": 366, "chars": "\n        "}, {"char_start": 367, "char_end": 375, "chars": "rgs = {'"}, {"char_start": 380, "char_end": 389, "chars": "': scene}"}, {"char_start": 415, "char_end": 421, "chars": ", args"}, {"char_start": 556, "char_end": 561, "chars": "scene"}, {"char_start": 575, "char_end": 579, "chars": "date"}, {"char_start": 582, "char_end": 587, "chars": "\n    "}, {"char_start": 588, "char_end": 604, "chars": "rgs = {'scene': "}, {"char_start": 611, "char_end": 612, "chars": "'"}, {"char_start": 616, "char_end": 624, "chars": "': date}"}, {"char_start": 646, "char_end": 652, "chars": ", args"}, {"char_start": 1107, "char_end": 1112, "chars": "scene"}, {"char_start": 1126, "char_end": 1130, "chars": "date"}, {"char_start": 1133, "char_end": 1138, "chars": "\n    "}, {"char_start": 1139, "char_end": 1155, "chars": "rgs = {'scene': "}, {"char_start": 1162, "char_end": 1170, "chars": "'date': "}, {"char_start": 1179, "char_end": 1180, "chars": "}"}, {"char_start": 1202, "char_end": 1208, "chars": ", args"}]}}
{"func_name": "set_language", "func_src_before": "    def set_language(self, lang):\n        \"\"\"\n        Update language of user in the User object and in the database\n        :param lang: string with language tag like \"en-US\"\n        :return: None\n        \"\"\"\n        log.debug('Updating info about user %s language '\n                  'in memory & database...', self)\n\n        self.language = lang\n\n        query = (\"UPDATE users \"\n                 f\"SET language='{self.language}' \"\n                 f\"WHERE chat_id='{self.chat_id}'\")\n\n        try:\n            db.add(query)\n        except DatabaseError:\n            log.error(\"Can't add new language of %s to the database\", self)\n        else:\n            log.debug('Language updated.')", "func_src_after": "    def set_language(self, lang):\n        \"\"\"\n        Update language of user in the User object and in the database\n        :param lang: string with language tag like \"en-US\"\n        :return: None\n        \"\"\"\n        log.debug('Updating info about user %s language '\n                  'in memory & database...', self)\n\n        self.language = lang\n\n        query = (\"UPDATE users \"\n                 f\"SET language=%s \"\n                 f\"WHERE chat_id=%s\")\n\n        parameters = self.language, self.chat_id\n        try:\n            db.add(query, parameters)\n        except DatabaseError:\n            log.error(\"Can't add new language of %s to the database\", self)\n        else:\n            log.debug('Language updated.')", "commit_link": "github.com/RandyRomero/photoGPSbot/commit/0e9f57f13e61863b3672f5730e27f149da00786a", "file_name": "photogpsbot/users.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 13, "char_start": 383, "char_end": 435, "line": "                 f\"SET language='{self.language}' \"\n"}, {"line_no": 14, "char_start": 435, "char_end": 487, "line": "                 f\"WHERE chat_id='{self.chat_id}'\")\n"}, {"line_no": 17, "char_start": 501, "char_end": 527, "line": "            db.add(query)\n"}], "added": [{"line_no": 13, "char_start": 383, "char_end": 420, "line": "                 f\"SET language=%s \"\n"}, {"line_no": 14, "char_start": 420, "char_end": 458, "line": "                 f\"WHERE chat_id=%s\")\n"}, {"line_no": 16, "char_start": 459, "char_end": 508, "line": "        parameters = self.language, self.chat_id\n"}, {"line_no": 18, "char_start": 521, "char_end": 559, "line": "            db.add(query, parameters)\n"}]}, "char_changes": {"deleted": [{"char_start": 415, "char_end": 417, "chars": "'{"}, {"char_start": 418, "char_end": 432, "chars": "elf.language}'"}, {"char_start": 468, "char_end": 470, "chars": "'{"}, {"char_start": 482, "char_end": 487, "chars": "}'\")\n"}], "added": [{"char_start": 415, "char_end": 416, "chars": "%"}, {"char_start": 453, "char_end": 495, "chars": "%s\")\n\n        parameters = self.language, "}, {"char_start": 545, "char_end": 557, "chars": ", parameters"}]}}
{"func_name": "tid_num_to_tag_nums", "func_src_before": "    def tid_num_to_tag_nums(self, tid_num):\n        ''' Returns list of the associated tag_nums to the given tid_num. '''\n\n        q = \"SELECT tag FROM tid_tag WHERE tid = '\" + str(tid_num) + \"'\"\n        self.query(q)\n        return [i[0] for i in self.c.fetchall()]", "func_src_after": "    def tid_num_to_tag_nums(self, tid_num):\n        ''' Returns list of the associated tag_nums to the given tid_num. '''\n\n        q = \"SELECT tag FROM tid_tag WHERE tid = ?\"\n        self.query(q, tid_num)\n        return [i[0] for i in self.c.fetchall()]", "commit_link": "github.com/pukkapies/urop2019/commit/3ca2e2c291d2d5fe262d20a8e0520bdfb622432b", "file_name": "modules/query_lastfm.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 4, "char_start": 123, "char_end": 196, "line": "        q = \"SELECT tag FROM tid_tag WHERE tid = '\" + str(tid_num) + \"'\"\n"}, {"line_no": 5, "char_start": 196, "char_end": 218, "line": "        self.query(q)\n"}], "added": [{"line_no": 4, "char_start": 123, "char_end": 175, "line": "        q = \"SELECT tag FROM tid_tag WHERE tid = ?\"\n"}, {"line_no": 5, "char_start": 175, "char_end": 206, "line": "        self.query(q, tid_num)\n"}]}, "char_changes": {"deleted": [{"char_start": 172, "char_end": 194, "chars": "'\" + str(tid_num) + \"'"}], "added": [{"char_start": 172, "char_end": 173, "chars": "?"}, {"char_start": 195, "char_end": 204, "chars": ", tid_num"}]}}
{"func_name": "summary", "func_src_before": "@app.route('/summary', methods=['GET'])\ndef summary():\n\tif 'username' in session:\n\n\t\tconn = mysql.connect()\n\t\tcursor = conn.cursor()\n\n\t\t#select the maximum score from the results table\n\t\tcursor.execute(\"SELECT courseConcentration FROM results WHERE total = (SELECT MAX(total) FROM (SELECT * FROM results WHERE courseId > 4) Temp) and courseId > 4 and emailAccount='\" + session['username'] + \"'\");\n\t\tcourseConcentration = cursor.fetchone()\n\n\t\treturn render_template('summary.html', courseConcentration = courseConcentration[0])\n\treturn redirect(url_for('login'))", "func_src_after": "@app.route('/summary', methods=['GET'])\ndef summary():\n\tif 'username' in session:\n\n\t\tconn = mysql.connect()\n\t\tcursor = conn.cursor()\n\n\t\t#select the maximum score from the results table\n\t\tcursor.execute(\"SELECT courseConcentration FROM results WHERE total = (SELECT MAX(total) FROM (SELECT * FROM results WHERE courseId > 4) Temp) and courseId > 4 and emailAccount=%s\", (session['username']));\n\t\tcourseConcentration = cursor.fetchone()\n\n\t\treturn render_template('summary.html', courseConcentration = courseConcentration[0])\n\treturn redirect(url_for('login'))", "commit_link": "github.com/CaitlinKennedy/Tech-Track/commit/20ef2d4010f9497b8221524edd0c706e2c6a4147", "file_name": "src/tech_track.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 9, "char_start": 185, "char_end": 397, "line": "\t\tcursor.execute(\"SELECT courseConcentration FROM results WHERE total = (SELECT MAX(total) FROM (SELECT * FROM results WHERE courseId > 4) Temp) and courseId > 4 and emailAccount='\" + session['username'] + \"'\");\n"}], "added": [{"line_no": 9, "char_start": 185, "char_end": 393, "line": "\t\tcursor.execute(\"SELECT courseConcentration FROM results WHERE total = (SELECT MAX(total) FROM (SELECT * FROM results WHERE courseId > 4) Temp) and courseId > 4 and emailAccount=%s\", (session['username']));\n"}]}, "char_changes": {"deleted": [{"char_start": 364, "char_end": 365, "chars": "'"}, {"char_start": 367, "char_end": 369, "chars": "+ "}, {"char_start": 388, "char_end": 394, "chars": " + \"'\""}], "added": [{"char_start": 364, "char_end": 366, "chars": "%s"}, {"char_start": 367, "char_end": 368, "chars": ","}, {"char_start": 369, "char_end": 370, "chars": "("}, {"char_start": 389, "char_end": 390, "chars": ")"}]}}
{"func_name": "add_post", "func_src_before": "def add_post(content):\n  \"\"\"Add a post to the 'database' with the current timestamp.\"\"\"\n  conn = psycopg2.connect(\"dbname=forum\")\n  cursor = conn.cursor()\n  cursor.execute(\"insert into posts values ('%s')\" % content)\n  conn.commit()\n  conn.close()", "func_src_after": "def add_post(content):\n  \"\"\"Add a post to the 'database' with the current timestamp.\"\"\"\n  conn = psycopg2.connect(\"dbname=forum\")\n  cursor = conn.cursor()\n  one_post = content\n  cursor.execute(\"insert into posts values (%s)\", (one_post,))\n  conn.commit()\n  conn.close()", "commit_link": "github.com/paulc1600/DB-API-Forum/commit/069700fb4beec79182fff3c556e9cccce3230d6f", "file_name": "forumdb.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 5, "char_start": 155, "char_end": 217, "line": "  cursor.execute(\"insert into posts values ('%s')\" % content)\n"}], "added": [{"line_no": 5, "char_start": 155, "char_end": 176, "line": "  one_post = content\n"}, {"line_no": 6, "char_start": 176, "char_end": 239, "line": "  cursor.execute(\"insert into posts values (%s)\", (one_post,))\n"}]}, "char_changes": {"deleted": [{"char_start": 199, "char_end": 200, "chars": "'"}, {"char_start": 202, "char_end": 203, "chars": "'"}, {"char_start": 205, "char_end": 207, "chars": " %"}, {"char_start": 208, "char_end": 209, "chars": "c"}, {"char_start": 211, "char_end": 212, "chars": "t"}, {"char_start": 213, "char_end": 214, "chars": "n"}], "added": [{"char_start": 157, "char_end": 178, "chars": "one_post = content\n  "}, {"char_start": 224, "char_end": 225, "chars": ","}, {"char_start": 226, "char_end": 227, "chars": "("}, {"char_start": 230, "char_end": 234, "chars": "_pos"}, {"char_start": 235, "char_end": 237, "chars": ",)"}]}}
{"func_name": "delete_playlist", "func_src_before": "def delete_playlist(id, db):\n    db.execute(\"DELETE FROM playlist where id={id};\".format(id=id))", "func_src_after": "def delete_playlist(id, db):\n    db.execute(\"DELETE FROM playlist where id=%s;\", (id,))", "commit_link": "github.com/Madmous/playlist/commit/666e52c5f0b8c1f4296e84471637033d9542a7a6", "file_name": "playlist/playlist_repository.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 2, "char_start": 29, "char_end": 96, "line": "    db.execute(\"DELETE FROM playlist where id={id};\".format(id=id))\n"}], "added": [{"line_no": 2, "char_start": 29, "char_end": 87, "line": "    db.execute(\"DELETE FROM playlist where id=%s;\", (id,))\n"}]}, "char_changes": {"deleted": [{"char_start": 75, "char_end": 79, "chars": "{id}"}, {"char_start": 81, "char_end": 88, "chars": ".format"}, {"char_start": 91, "char_end": 94, "chars": "=id"}], "added": [{"char_start": 75, "char_end": 77, "chars": "%s"}, {"char_start": 79, "char_end": 81, "chars": ", "}, {"char_start": 84, "char_end": 85, "chars": ","}]}}
{"func_name": "writeToDb", "func_src_before": "    def writeToDb(self, url):\n        try:\n            self.cursor.execute(\"INSERT INTO queue (url, visited) VALUES ('{}', '0');\".format(url))\n            self.db.commit()\n        except Exception as e:\n            print(e)", "func_src_after": "    def writeToDb(self, url):\n        try:\n            self.cursor.execute(\"INSERT INTO queue (url, visited) VALUES (?, '0');\", url)\n            self.db.commit()\n        except Exception as e:\n            print(e)", "commit_link": "github.com/jappe999/WebScraper/commit/46a4e0843aa44d903293637afad53dfcbc37b480", "file_name": "beta/database.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 3, "char_start": 43, "char_end": 143, "line": "            self.cursor.execute(\"INSERT INTO queue (url, visited) VALUES ('{}', '0');\".format(url))\n"}], "added": [{"line_no": 3, "char_start": 43, "char_end": 133, "line": "            self.cursor.execute(\"INSERT INTO queue (url, visited) VALUES (?, '0');\", url)\n"}]}, "char_changes": {"deleted": [{"char_start": 117, "char_end": 121, "chars": "'{}'"}, {"char_start": 129, "char_end": 137, "chars": ".format("}, {"char_start": 140, "char_end": 141, "chars": ")"}], "added": [{"char_start": 117, "char_end": 118, "chars": "?"}, {"char_start": 126, "char_end": 128, "chars": ", "}]}}
{"func_name": "send_message", "func_src_before": "@frappe.whitelist(allow_guest=True)\ndef send_message(subject=\"Website Query\", message=\"\", sender=\"\", status=\"Open\"):\n\tfrom frappe.www.contact import send_message as website_send_message\n\tlead = customer = None\n\n\twebsite_send_message(subject, message, sender)\n\n\tcustomer = frappe.db.sql(\"\"\"select distinct dl.link_name from `tabDynamic Link` dl\n\t\tleft join `tabContact` c on dl.parent=c.name where dl.link_doctype='Customer'\n\t\tand c.email_id='{email_id}'\"\"\".format(email_id=sender))\n\n\tif not customer:\n\t\tlead = frappe.db.get_value('Lead', dict(email_id=sender))\n\t\tif not lead:\n\t\t\tnew_lead = frappe.get_doc(dict(\n\t\t\t\tdoctype='Lead',\n\t\t\t\temail_id = sender,\n\t\t\t\tlead_name = sender.split('@')[0].title()\n\t\t\t)).insert(ignore_permissions=True)\n\n\topportunity = frappe.get_doc(dict(\n\t\tdoctype ='Opportunity',\n\t\tenquiry_from = 'Customer' if customer else 'Lead',\n\t\tstatus = 'Open',\n\t\ttitle = subject,\n\t\tcontact_email = sender,\n\t\tto_discuss = message\n\t))\n\n\tif customer:\n\t\topportunity.customer = customer[0][0]\n\telif lead:\n\t\topportunity.lead = lead\n\telse:\n\t\topportunity.lead = new_lead.name\n\n\topportunity.insert(ignore_permissions=True)\n\n\tcomm = frappe.get_doc({\n\t\t\"doctype\":\"Communication\",\n\t\t\"subject\": subject,\n\t\t\"content\": message,\n\t\t\"sender\": sender,\n\t\t\"sent_or_received\": \"Received\",\n\t\t'reference_doctype': 'Opportunity',\n\t\t'reference_name': opportunity.name\n\t})\n\tcomm.insert(ignore_permissions=True)\n\n\treturn \"okay\"", "func_src_after": "@frappe.whitelist(allow_guest=True)\ndef send_message(subject=\"Website Query\", message=\"\", sender=\"\", status=\"Open\"):\n\tfrom frappe.www.contact import send_message as website_send_message\n\tlead = customer = None\n\n\twebsite_send_message(subject, message, sender)\n\n\tcustomer = frappe.db.sql(\"\"\"select distinct dl.link_name from `tabDynamic Link` dl\n\t\tleft join `tabContact` c on dl.parent=c.name where dl.link_doctype='Customer'\n\t\tand c.email_id = %s\"\"\", sender)\n\n\tif not customer:\n\t\tlead = frappe.db.get_value('Lead', dict(email_id=sender))\n\t\tif not lead:\n\t\t\tnew_lead = frappe.get_doc(dict(\n\t\t\t\tdoctype='Lead',\n\t\t\t\temail_id = sender,\n\t\t\t\tlead_name = sender.split('@')[0].title()\n\t\t\t)).insert(ignore_permissions=True)\n\n\topportunity = frappe.get_doc(dict(\n\t\tdoctype ='Opportunity',\n\t\tenquiry_from = 'Customer' if customer else 'Lead',\n\t\tstatus = 'Open',\n\t\ttitle = subject,\n\t\tcontact_email = sender,\n\t\tto_discuss = message\n\t))\n\n\tif customer:\n\t\topportunity.customer = customer[0][0]\n\telif lead:\n\t\topportunity.lead = lead\n\telse:\n\t\topportunity.lead = new_lead.name\n\n\topportunity.insert(ignore_permissions=True)\n\n\tcomm = frappe.get_doc({\n\t\t\"doctype\":\"Communication\",\n\t\t\"subject\": subject,\n\t\t\"content\": message,\n\t\t\"sender\": sender,\n\t\t\"sent_or_received\": \"Received\",\n\t\t'reference_doctype': 'Opportunity',\n\t\t'reference_name': opportunity.name\n\t})\n\tcomm.insert(ignore_permissions=True)\n\n\treturn \"okay\"", "commit_link": "github.com/libracore/erpnext/commit/9acb885e60f77cd4e9ea8c98bdc39c18abcac731", "file_name": "erpnext/templates/utils.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 10, "char_start": 424, "char_end": 482, "line": "\t\tand c.email_id='{email_id}'\"\"\".format(email_id=sender))\n"}], "added": [{"line_no": 10, "char_start": 424, "char_end": 458, "line": "\t\tand c.email_id = %s\"\"\", sender)\n"}]}, "char_changes": {"deleted": [{"char_start": 441, "char_end": 453, "chars": "'{email_id}'"}, {"char_start": 456, "char_end": 473, "chars": ".format(email_id="}, {"char_start": 479, "char_end": 480, "chars": ")"}], "added": [{"char_start": 440, "char_end": 441, "chars": " "}, {"char_start": 442, "char_end": 445, "chars": " %s"}, {"char_start": 448, "char_end": 450, "chars": ", "}]}}
{"func_name": "delete", "func_src_before": "    @jwt_required\n    def delete(self, email):\n        \"\"\" Deletes admin with the corresponding email \"\"\"\n        return database_utilities.execute_query(f\"\"\"delete from admins where email = '{email}'\"\"\")", "func_src_after": "    @jwt_required\n    def delete(self, email):\n        \"\"\" Deletes admin with the corresponding email \"\"\"\n        return database_utilities.execute_query(f\"\"\"delete from admins where email = %s\"\"\", (email, ))", "commit_link": "github.com/sgosal2/tiger-boards-backend/commit/4670109dd613df2f2fe7e8403ebd149df2b55485", "file_name": "apis/admins.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 4, "char_start": 106, "char_end": 204, "line": "        return database_utilities.execute_query(f\"\"\"delete from admins where email = '{email}'\"\"\")\n"}], "added": [{"line_no": 4, "char_start": 106, "char_end": 208, "line": "        return database_utilities.execute_query(f\"\"\"delete from admins where email = %s\"\"\", (email, ))"}]}, "char_changes": {"deleted": [{"char_start": 191, "char_end": 193, "chars": "'{"}, {"char_start": 198, "char_end": 203, "chars": "}'\"\"\""}], "added": [{"char_start": 191, "char_end": 199, "chars": "%s\"\"\", ("}, {"char_start": 204, "char_end": 207, "chars": ", )"}]}}
{"func_name": "delete_playlists_videos", "func_src_before": "def delete_playlists_videos(playlist_id, db):\n    db.execute(\"DELETE FROM video where playlist_id={playlist_id};\".format(\n        playlist_id=playlist_id))", "func_src_after": "def delete_playlists_videos(playlist_id, db):\n    db.execute(\"DELETE FROM video where playlist_id=%s;\", (playlist_id,))", "commit_link": "github.com/Madmous/playlist/commit/666e52c5f0b8c1f4296e84471637033d9542a7a6", "file_name": "video/video_repository.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 2, "char_start": 46, "char_end": 122, "line": "    db.execute(\"DELETE FROM video where playlist_id={playlist_id};\".format(\n"}, {"line_no": 3, "char_start": 122, "char_end": 155, "line": "        playlist_id=playlist_id))\n"}], "added": [{"line_no": 2, "char_start": 46, "char_end": 119, "line": "    db.execute(\"DELETE FROM video where playlist_id=%s;\", (playlist_id,))\n"}]}, "char_changes": {"deleted": [{"char_start": 98, "char_end": 105, "chars": "{playli"}, {"char_start": 106, "char_end": 111, "chars": "t_id}"}, {"char_start": 113, "char_end": 127, "chars": ".format(\n     "}, {"char_start": 128, "char_end": 142, "chars": "  playlist_id="}], "added": [{"char_start": 98, "char_end": 99, "chars": "%"}, {"char_start": 102, "char_end": 104, "chars": ", "}, {"char_start": 116, "char_end": 117, "chars": ","}]}}
{"func_name": "upsert_mapped_projects", "func_src_before": "    @staticmethod\n    def upsert_mapped_projects(user_id: int, project_id: int):\n        \"\"\" Adds projects to mapped_projects if it doesn't exist \"\"\"\n        sql = \"select * from users where id = {0} and projects_mapped @> '{{{1}}}'\".format(user_id, project_id)\n        result = db.engine.execute(sql)\n\n        if result.rowcount > 0:\n            return  # User has previously mapped this project so return\n\n        sql = '''update users\n                    set projects_mapped = array_append(projects_mapped, {0})\n                  where id = {1}'''.format(project_id, user_id)\n\n        db.engine.execute(sql)", "func_src_after": "    @staticmethod\n    def upsert_mapped_projects(user_id: int, project_id: int):\n        \"\"\" Adds projects to mapped_projects if it doesn't exist \"\"\"\n        sql = \"select * from users where id = :user_id and projects_mapped @> '{{:project_id}}'\"\n        result = db.engine.execute(text(sql), user_id=user_id, project_id=project_id)\n\n        if result.rowcount > 0:\n            return  # User has previously mapped this project so return\n\n        sql = '''update users\n                    set projects_mapped = array_append(projects_mapped, :project_id)\n                  where id = :user_id'''\n\n        db.engine.execute(text(sql), project_id=project_id, user_id=user_id)", "commit_link": "github.com/hotosm/tasking-manager/commit/dee040a2d22b3c4d5e38e2dbf8c6b651ad4c241a", "file_name": "server/models/postgis/user.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 4, "char_start": 150, "char_end": 262, "line": "        sql = \"select * from users where id = {0} and projects_mapped @> '{{{1}}}'\".format(user_id, project_id)\n"}, {"line_no": 5, "char_start": 262, "char_end": 302, "line": "        result = db.engine.execute(sql)\n"}, {"line_no": 11, "char_start": 438, "char_end": 515, "line": "                    set projects_mapped = array_append(projects_mapped, {0})\n"}, {"line_no": 12, "char_start": 515, "char_end": 579, "line": "                  where id = {1}'''.format(project_id, user_id)\n"}, {"line_no": 14, "char_start": 580, "char_end": 610, "line": "        db.engine.execute(sql)\n"}], "added": [{"line_no": 4, "char_start": 150, "char_end": 247, "line": "        sql = \"select * from users where id = :user_id and projects_mapped @> '{{:project_id}}'\"\n"}, {"line_no": 5, "char_start": 247, "char_end": 333, "line": "        result = db.engine.execute(text(sql), user_id=user_id, project_id=project_id)\n"}, {"line_no": 11, "char_start": 469, "char_end": 554, "line": "                    set projects_mapped = array_append(projects_mapped, :project_id)\n"}, {"line_no": 12, "char_start": 554, "char_end": 595, "line": "                  where id = :user_id'''\n"}, {"line_no": 14, "char_start": 596, "char_end": 672, "line": "        db.engine.execute(text(sql), project_id=project_id, user_id=user_id)\n"}]}, "char_changes": {"deleted": [{"char_start": 196, "char_end": 199, "chars": "{0}"}, {"char_start": 226, "char_end": 250, "chars": "{1}}}'\".format(user_id, "}, {"char_start": 260, "char_end": 261, "chars": ")"}, {"char_start": 510, "char_end": 513, "chars": "{0}"}, {"char_start": 544, "char_end": 570, "chars": "{1}'''.format(project_id, "}, {"char_start": 577, "char_end": 578, "chars": ")"}], "added": [{"char_start": 196, "char_end": 204, "chars": ":user_id"}, {"char_start": 231, "char_end": 232, "chars": ":"}, {"char_start": 242, "char_end": 246, "chars": "}}'\""}, {"char_start": 282, "char_end": 287, "chars": "text("}, {"char_start": 290, "char_end": 331, "chars": "), user_id=user_id, project_id=project_id"}, {"char_start": 541, "char_end": 552, "chars": ":project_id"}, {"char_start": 583, "char_end": 584, "chars": ":"}, {"char_start": 591, "char_end": 594, "chars": "'''"}, {"char_start": 622, "char_end": 627, "chars": "text("}, {"char_start": 631, "char_end": 672, "chars": ", project_id=project_id, user_id=user_id)"}]}}
{"func_name": "get_first_ranked_month", "func_src_before": "def get_first_ranked_month(db, scene, player):\n    sql = \"select date from ranks where scene='{}' and player='{}' order by date limit 1;\".format(scene, player)\n    res = db.exec(sql)\n    date = res[0][0]\n    return date", "func_src_after": "def get_first_ranked_month(db, scene, player):\n    sql = \"select date from ranks where scene='{scene}' and player='{player}' order by date limit 1;\"\n    args = {'scene': scene, 'player': player}\n    res = db.exec(sql, args)\n    date = res[0][0]\n    return date", "commit_link": "github.com/DKelle/Smash_stats/commit/4bb83f3f6ce7d6bebbeb512cd015f9e72cf36d63", "file_name": "bracket_utils.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 2, "char_start": 47, "char_end": 160, "line": "    sql = \"select date from ranks where scene='{}' and player='{}' order by date limit 1;\".format(scene, player)\n"}, {"line_no": 3, "char_start": 160, "char_end": 183, "line": "    res = db.exec(sql)\n"}], "added": [{"line_no": 2, "char_start": 47, "char_end": 149, "line": "    sql = \"select date from ranks where scene='{scene}' and player='{player}' order by date limit 1;\"\n"}, {"line_no": 3, "char_start": 149, "char_end": 195, "line": "    args = {'scene': scene, 'player': player}\n"}, {"line_no": 4, "char_start": 195, "char_end": 224, "line": "    res = db.exec(sql, args)\n"}]}, "char_changes": {"deleted": [{"char_start": 137, "char_end": 140, "chars": ".fo"}, {"char_start": 141, "char_end": 145, "chars": "mat("}, {"char_start": 158, "char_end": 159, "chars": ")"}], "added": [{"char_start": 95, "char_end": 100, "chars": "scene"}, {"char_start": 116, "char_end": 122, "chars": "player"}, {"char_start": 148, "char_end": 153, "chars": "\n    "}, {"char_start": 154, "char_end": 170, "chars": "rgs = {'scene': "}, {"char_start": 177, "char_end": 178, "chars": "'"}, {"char_start": 184, "char_end": 194, "chars": "': player}"}, {"char_start": 216, "char_end": 222, "chars": ", args"}]}}
{"func_name": "openPoll", "func_src_before": "@hook.command(adminonly=True)\ndef openPoll(question, reply=None, db=None):\n    \"\"\"Creates a new poll.\"\"\"\n    if not db_ready: db_init(db)\n    try:\n        active = db.execute(\"SELECT pollID FROM polls WHERE active = 1\").fetchone()[0]\n        if active: \n            reply(\"There already is an open poll.\")\n            return\n    except:\n        db.execute(\"INSERT INTO polls (question, active) VALUES ('{}', 1)\".format(question))\n        reply(\"Opened new poll: {}\".format(question))\n        #reply(\"Poll opened!\")\n    return", "func_src_after": "@hook.command(adminonly=True)\ndef openPoll(question, reply=None, db=None):\n    \"\"\"Creates a new poll.\"\"\"\n    if not db_ready: db_init(db)\n    try:\n        active = db.execute(\"SELECT pollID FROM polls WHERE active = 1\").fetchone()[0]\n        if active: \n            reply(\"There already is an open poll.\")\n            return\n    except:\n        db.execute(\"INSERT INTO polls (question, active) VALUES (?, 1)\", (question,))\n        reply(\"Opened new poll: {}\".format(question))\n        #reply(\"Poll opened!\")\n    return", "commit_link": "github.com/FrozenPigs/Taigabot/commit/ea9b83a66ae1f0f38a1895f3e8dfa2833d77e3a6", "file_name": "plugins/poll.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 11, "char_start": 337, "char_end": 430, "line": "        db.execute(\"INSERT INTO polls (question, active) VALUES ('{}', 1)\".format(question))\n"}], "added": [{"line_no": 11, "char_start": 337, "char_end": 423, "line": "        db.execute(\"INSERT INTO polls (question, active) VALUES (?, 1)\", (question,))\n"}]}, "char_changes": {"deleted": [{"char_start": 402, "char_end": 406, "chars": "'{}'"}, {"char_start": 411, "char_end": 418, "chars": ".format"}], "added": [{"char_start": 402, "char_end": 403, "chars": "?"}, {"char_start": 408, "char_end": 410, "chars": ", "}, {"char_start": 419, "char_end": 420, "chars": ","}]}}
{"func_name": "__init__.view_grocery_list", "func_src_before": "        def view_grocery_list():\n            print(\"grocery== list\")\n            groceryListFrame = Frame(self)\n            groceryListFrame.rowconfigure(0, weight=1)\n            groceryListFrame.columnconfigure(0, weight=1)\n            groceryListFrame.rowconfigure(1, weight=3)\n            groceryListFrame.columnconfigure(1, weight=3)\n            groceryListFrame.pack()\n\n            menu.pack_forget()\n            groceryButton.pack_forget()\n            label.configure(text=\"Grocery List\")\n\n            i = 0\n            database_file = \"meal_planner.db\"\n            item_array = []\n            with sqlite3.connect(database_file) as conn:\n                cursor = conn.cursor()\n                tableName = \"ingredients_\" + str(weekNumber)\n                selection = cursor.execute(\"\"\"SELECT * FROM \"\"\" + tableName)\n                for result in [selection]:\n                    for row in result.fetchall():\n                        print(row)\n                        for ingredient in row:\n                            print(ingredient)\n                            item_array.append(str(ingredient).split())\n                        i = i +1\n                        Label(groceryListFrame, text=ingredient, font=MEDIUM_FONT, justify=LEFT).grid(row=i, column=0, sticky=\"w\")\n            \n\n            j = 0\n            for item in item_array:\n                print(item)\n\n\n            returnButton = Button(menuFrame, text = \"Return to Menu\", highlightbackground=\"#e7e7e7\", command=lambda: [groceryListFrame.pack_forget(),\n                                                                                     menu.pack(), returnButton.pack_forget(), label.configure(text=\"Meal Planer\"),\n                                                                                    groceryButton.pack(side=RIGHT)])\n            returnButton.pack(side=RIGHT)", "func_src_after": "        def view_grocery_list():\n            print(\"grocery== list\")\n            groceryListFrame = Frame(self)\n            groceryListFrame.rowconfigure(0, weight=1)\n            groceryListFrame.columnconfigure(0, weight=1)\n            groceryListFrame.rowconfigure(1, weight=3)\n            groceryListFrame.columnconfigure(1, weight=3)\n            groceryListFrame.pack()\n\n            menu.pack_forget()\n            groceryButton.pack_forget()\n            label.configure(text=\"Grocery List\")\n\n            i = 0\n            database_file = \"meal_planner.db\"\n            item_array = []\n            with sqlite3.connect(database_file) as conn:\n                cursor = conn.cursor()\n                tableName = \"ingredients_\" + str(weekNumber)\n                selection = cursor.execute(\"\"\"SELECT * FROM ?;\"\"\", (tableName, ))\n                for result in [selection]:\n                    for row in result.fetchall():\n                        print(row)\n                        for ingredient in row:\n                            print(ingredient)\n                            item_array.append(str(ingredient).split())\n                        i = i +1\n                        Label(groceryListFrame, text=ingredient, font=MEDIUM_FONT, justify=LEFT).grid(row=i, column=0, sticky=\"w\")\n            \n\n            j = 0\n            for item in item_array:\n                print(item)\n\n\n            returnButton = Button(menuFrame, text = \"Return to Menu\", highlightbackground=\"#e7e7e7\", command=lambda: [groceryListFrame.pack_forget(),\n                                                                                     menu.pack(), returnButton.pack_forget(), label.configure(text=\"Meal Planer\"),\n                                                                                    groceryButton.pack(side=RIGHT)])\n            returnButton.pack(side=RIGHT)", "commit_link": "github.com/trishamoyer/RecipePlanner-Python/commit/44d2ce370715d9344fad34b3b749322ab095a925", "file_name": "mealPlan.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 20, "char_start": 745, "char_end": 822, "line": "                selection = cursor.execute(\"\"\"SELECT * FROM \"\"\" + tableName)\n"}], "added": [{"line_no": 20, "char_start": 745, "char_end": 827, "line": "                selection = cursor.execute(\"\"\"SELECT * FROM ?;\"\"\", (tableName, ))\n"}]}, "char_changes": {"deleted": [{"char_start": 809, "char_end": 811, "chars": "+ "}], "added": [{"char_start": 805, "char_end": 807, "chars": "?;"}, {"char_start": 810, "char_end": 811, "chars": ","}, {"char_start": 812, "char_end": 813, "chars": "("}, {"char_start": 822, "char_end": 825, "chars": ", )"}]}}
{"func_name": "view_page_record", "func_src_before": "@app.route('/<page_name>/history/record')\ndef view_page_record(page_name):\n    content_id = request.args.get('id')\n    query = db.query(\"select page_content.content, page_content.timestamp from page, page_content where page.id = page_content.page_id and page_content.id = '%s'\" % content_id)\n    page_record = query.namedresult()[0]\n\n    return render_template(\n        'page_record.html',\n        page_name = page_name,\n        page_record = page_record\n    )", "func_src_after": "@app.route('/<page_name>/history/record')\ndef view_page_record(page_name):\n    content_id = request.args.get('id')\n    query = db.query(\"select page_content.content, page_content.timestamp from page, page_content where page.id = page_content.page_id and page_content.id = $1\", content_id)\n    page_record = query.namedresult()[0]\n\n    return render_template(\n        'page_record.html',\n        page_name = page_name,\n        page_record = page_record\n    )", "commit_link": "github.com/Pumala/python_wiki_app_redo/commit/65d60747cd8efb05970304234d3bd949d2088e8b", "file_name": "server.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 4, "char_start": 115, "char_end": 292, "line": "    query = db.query(\"select page_content.content, page_content.timestamp from page, page_content where page.id = page_content.page_id and page_content.id = '%s'\" % content_id)\n"}], "added": [{"line_no": 4, "char_start": 115, "char_end": 289, "line": "    query = db.query(\"select page_content.content, page_content.timestamp from page, page_content where page.id = page_content.page_id and page_content.id = $1\", content_id)\n"}]}, "char_changes": {"deleted": [{"char_start": 272, "char_end": 276, "chars": "'%s'"}, {"char_start": 277, "char_end": 279, "chars": " %"}], "added": [{"char_start": 272, "char_end": 274, "chars": "$1"}, {"char_start": 275, "char_end": 276, "chars": ","}]}}
{"func_name": "update_inverter", "func_src_before": "    def update_inverter(self, inverter_serial, ts, status, etoday, etotal):\n        query = '''\n            UPDATE Inverters\n            SET     \n                TimeStamp='%s', \n                Status='%s', \n                eToday='%s',\n                eTotal='%s'\n            WHERE Serial='%s';\n        ''' % (ts, status, etoday, etotal, inverter_serial)\n        self.c.execute(query)", "func_src_after": "    def update_inverter(self, inverter_serial, ts, status, etoday, etotal):\n        query = '''\n            UPDATE Inverters\n            SET     \n                TimeStamp=?, \n                Status=?, \n                eToday=?,\n                eTotal=?\n            WHERE Serial=?;\n        '''\n        self.c.execute(query, (ts, status, etoday, etotal, inverter_serial))", "commit_link": "github.com/philipptrenz/s0-bridge/commit/269b48caa05377b7c58c3e6d1622a4429cb5ba65", "file_name": "util/database.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 5, "char_start": 146, "char_end": 179, "line": "                TimeStamp='%s', \n"}, {"line_no": 6, "char_start": 179, "char_end": 209, "line": "                Status='%s', \n"}, {"line_no": 7, "char_start": 209, "char_end": 238, "line": "                eToday='%s',\n"}, {"line_no": 8, "char_start": 238, "char_end": 266, "line": "                eTotal='%s'\n"}, {"line_no": 9, "char_start": 266, "char_end": 297, "line": "            WHERE Serial='%s';\n"}, {"line_no": 10, "char_start": 297, "char_end": 357, "line": "        ''' % (ts, status, etoday, etotal, inverter_serial)\n"}, {"line_no": 11, "char_start": 357, "char_end": 386, "line": "        self.c.execute(query)\n"}], "added": [{"line_no": 5, "char_start": 146, "char_end": 176, "line": "                TimeStamp=?, \n"}, {"line_no": 6, "char_start": 176, "char_end": 203, "line": "                Status=?, \n"}, {"line_no": 7, "char_start": 203, "char_end": 229, "line": "                eToday=?,\n"}, {"line_no": 8, "char_start": 229, "char_end": 254, "line": "                eTotal=?\n"}, {"line_no": 9, "char_start": 254, "char_end": 282, "line": "            WHERE Serial=?;\n"}, {"line_no": 10, "char_start": 282, "char_end": 294, "line": "        '''\n"}, {"line_no": 11, "char_start": 294, "char_end": 370, "line": "        self.c.execute(query, (ts, status, etoday, etotal, inverter_serial))\n"}]}, "char_changes": {"deleted": [{"char_start": 172, "char_end": 176, "chars": "'%s'"}, {"char_start": 202, "char_end": 206, "chars": "'%s'"}, {"char_start": 232, "char_end": 236, "chars": "'%s'"}, {"char_start": 261, "char_end": 265, "chars": "'%s'"}, {"char_start": 291, "char_end": 295, "chars": "'%s'"}, {"char_start": 309, "char_end": 310, "chars": "%"}, {"char_start": 356, "char_end": 385, "chars": "\n        self.c.execute(query"}], "added": [{"char_start": 172, "char_end": 173, "chars": "?"}, {"char_start": 199, "char_end": 200, "chars": "?"}, {"char_start": 226, "char_end": 227, "chars": "?"}, {"char_start": 252, "char_end": 253, "chars": "?"}, {"char_start": 279, "char_end": 280, "chars": "?"}, {"char_start": 293, "char_end": 300, "chars": "\n      "}, {"char_start": 301, "char_end": 323, "chars": " self.c.execute(query,"}]}}
{"func_name": "insert", "func_src_before": "def insert(key, value):\n    connection = psycopg2.connect(host=config['HOST'], port=config['PORT'], database=config['NAME'], user=config['USER'], password=config['PASSWORD'])\n    cur = connection.cursor()\n    try:\n        cur.execute(\"insert into reply_map values('{}', '{}')\".format(key, value))\n        connection.commit()\n    except:\n        pass", "func_src_after": "def insert(key, value):\n    connection = psycopg2.connect(host=config['HOST'], port=config['PORT'], database=config['NAME'], user=config['USER'], password=config['PASSWORD'])\n    cur = connection.cursor()\n    try:\n        cur.execute(\"insert into reply_map values(?, ?)\", (key, value))\n        connection.commit()\n    except:\n        pass", "commit_link": "github.com/tadaren/reply_bot/commit/5aeafa7e9597a766992af9ff8189e1f050b6579b", "file_name": "db.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 5, "char_start": 214, "char_end": 297, "line": "        cur.execute(\"insert into reply_map values('{}', '{}')\".format(key, value))\n"}], "added": [{"line_no": 5, "char_start": 214, "char_end": 286, "line": "        cur.execute(\"insert into reply_map values(?, ?)\", (key, value))\n"}]}, "char_changes": {"deleted": [{"char_start": 264, "char_end": 268, "chars": "'{}'"}, {"char_start": 270, "char_end": 274, "chars": "'{}'"}, {"char_start": 276, "char_end": 283, "chars": ".format"}], "added": [{"char_start": 264, "char_end": 265, "chars": "?"}, {"char_start": 267, "char_end": 268, "chars": "?"}, {"char_start": 270, "char_end": 272, "chars": ", "}]}}
{"func_name": "save_failure_transaction", "func_src_before": "    def save_failure_transaction(self, user_id, project_id, money):\n        self.cursor.execute(\"insert into transactions (project_id,user_id, money, timestamp, state) values (%s, %s, %s, now(), 'failed' )\" % (project_id, user_id, money))\n        self.db.commit()", "func_src_after": "    def save_failure_transaction(self, user_id, project_id, money):\n        self.cursor.execute(\"insert into transactions (project_id,user_id, money, timestamp, state) values (%s, %s, \"\n                            \"%s, now(), 'failed' )\", (project_id, user_id, money))\n        self.db.commit()", "commit_link": "github.com/JLucka/kickstarter-dev/commit/e2ffa062697e060fdfbd2eccbb89a8c53a569e0b", "file_name": "backend/transactions/TransactionConnector.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 2, "char_start": 68, "char_end": 239, "line": "        self.cursor.execute(\"insert into transactions (project_id,user_id, money, timestamp, state) values (%s, %s, %s, now(), 'failed' )\" % (project_id, user_id, money))\n"}], "added": [{"line_no": 2, "char_start": 68, "char_end": 186, "line": "        self.cursor.execute(\"insert into transactions (project_id,user_id, money, timestamp, state) values (%s, %s, \"\n"}, {"line_no": 3, "char_start": 186, "char_end": 269, "line": "                            \"%s, now(), 'failed' )\", (project_id, user_id, money))\n"}]}, "char_changes": {"deleted": [{"char_start": 206, "char_end": 208, "chars": " %"}], "added": [{"char_start": 184, "char_end": 215, "chars": "\"\n                            \""}, {"char_start": 237, "char_end": 238, "chars": ","}]}}
{"func_name": "test_process_as_form", "func_src_before": "    @unpack\n    def test_process_as_form(self, job_number, dcn_key, was_prev_matched,\n            was_prev_closed, was_prev_tracked):\n        email_obj = {\n            'sender' : \"Alex Roy <Alex.Roy@dilfo.com>\",\n            'subject' : \"DO NOT MODIFY MESSAGE BELOW - JUST HIT `SEND`\",\n            'date' : \"Tue, 7 May 2019 17:34:17 +0000\",\n            'content' : (\n                f\"job_number={job_number}&title=TEST_ENTRY&city=Ottawa&\"\n                f\"address=2562+Del+Zotto+Ave.%2C+Ottawa%2C+Ontario&\"\n                f\"contractor=GCN&engineer=Goodkey&owner=Douglas+Stalker&\"\n                f\"quality=2&cc_email=&link_to_cert={dcn_key}\\r\\n\"\n            )\n        }\n        # set-up new entries in db, if necessary\n        fake_dilfo_insert = \"\"\"\n            INSERT INTO df_dilfo (job_number, receiver_email, closed)\n            VALUES ({}, 'alex.roy616@gmail.com', {})\n        \"\"\"\n        fake_match_insert = \"\"\"\n            INSERT INTO df_matched (job_number, verifier, ground_truth)\n            VALUES ({}, 'alex.roy616@gmail.com', {})\n        \"\"\"\n        with create_connection() as conn:\n            if was_prev_closed or was_prev_tracked:\n                conn.cursor().execute(fake_dilfo_insert.format(job_number, was_prev_closed))\n            if was_prev_matched:\n                if was_prev_closed:\n                    conn.cursor().execute(fake_match_insert.format(job_number, 1))\n                else:\n                    conn.cursor().execute(fake_match_insert.format(job_number, 0))\n        with create_connection() as conn:\n            df_dilfo_pre = pd.read_sql(f\"SELECT * FROM df_dilfo WHERE job_number={job_number}\", conn)\n            df_matched_pre = pd.read_sql(f\"SELECT * FROM df_matched WHERE job_number={job_number}\", conn)\n        process_as_form(email_obj)\n        # make assertions about db now that reply has been processed\n        with create_connection() as conn:\n            df_dilfo_post = pd.read_sql(f\"SELECT * FROM df_dilfo WHERE job_number={job_number}\", conn)\n            df_matched_post = pd.read_sql(f\"SELECT * FROM df_matched WHERE job_number={job_number}\", conn)\n        self.assertEqual(len(df_dilfo_post), 1)\n        self.assertEqual(bool(df_dilfo_post.iloc[0].closed), bool(was_prev_closed or dcn_key))\n        self.assertEqual(any(df_matched_post.ground_truth), bool(was_prev_closed or dcn_key))\n        self.assertEqual(len(df_matched_pre) + bool(dcn_key and not(was_prev_closed)), len(df_matched_post))\n        self.assertEqual(list(df_matched_pre.columns), list(df_matched_post.columns))\n        self.assertEqual(list(df_dilfo_pre.columns), list(df_dilfo_post.columns))", "func_src_after": "    @unpack\n    def test_process_as_form(self, job_number, dcn_key, was_prev_matched,\n            was_prev_closed, was_prev_tracked):\n        email_obj = {\n            'sender' : \"Alex Roy <Alex.Roy@dilfo.com>\",\n            'subject' : \"DO NOT MODIFY MESSAGE BELOW - JUST HIT `SEND`\",\n            'date' : \"Tue, 7 May 2019 17:34:17 +0000\",\n            'content' : (\n                f\"job_number={job_number}&title=TEST_ENTRY&city=Ottawa&\"\n                f\"address=2562+Del+Zotto+Ave.%2C+Ottawa%2C+Ontario&\"\n                f\"contractor=GCN&engineer=Goodkey&owner=Douglas+Stalker&\"\n                f\"quality=2&cc_email=&link_to_cert={dcn_key}\\r\\n\"\n            )\n        }\n        # set-up new entries in db, if necessary\n        fake_dilfo_insert = \"\"\"\n            INSERT INTO df_dilfo (job_number, receiver_email, closed)\n            VALUES (?, 'alex.roy616@gmail.com', ?)\n        \"\"\"\n        fake_match_insert = \"\"\"\n            INSERT INTO df_matched (job_number, verifier, ground_truth)\n            VALUES (?, 'alex.roy616@gmail.com', ?)\n        \"\"\"\n        with create_connection() as conn:\n            if was_prev_closed or was_prev_tracked:\n                conn.cursor().execute(fake_dilfo_insert, [job_number, was_prev_closed])\n            if was_prev_matched:\n                if was_prev_closed:\n                    conn.cursor().execute(fake_match_insert, [job_number, 1])\n                else:\n                    conn.cursor().execute(fake_match_insert, [job_number, 0])\n        with create_connection() as conn:\n            df_dilfo_pre = pd.read_sql(\"SELECT * FROM df_dilfo WHERE job_number=?\", conn, params=[job_number])\n            df_matched_pre = pd.read_sql(\"SELECT * FROM df_matched WHERE job_number=?\", conn, params=[job_number])\n        process_as_form(email_obj)\n        # make assertions about db now that reply has been processed\n        with create_connection() as conn:\n            df_dilfo_post = pd.read_sql(\"SELECT * FROM df_dilfo WHERE job_number=?\", conn, params=[job_number])\n            df_matched_post = pd.read_sql(\"SELECT * FROM df_matched WHERE job_number=?\", conn, params=[job_number])\n        self.assertEqual(len(df_dilfo_post), 1)\n        self.assertEqual(bool(df_dilfo_post.iloc[0].closed), bool(was_prev_closed or dcn_key))\n        self.assertEqual(any(df_matched_post.ground_truth), bool(was_prev_closed or dcn_key))\n        self.assertEqual(len(df_matched_pre) + bool(dcn_key and not(was_prev_closed)), len(df_matched_post))\n        self.assertEqual(list(df_matched_pre.columns), list(df_matched_post.columns))\n        self.assertEqual(list(df_dilfo_pre.columns), list(df_dilfo_post.columns))", "commit_link": "github.com/confirmationbias616/certificate_checker/commit/9e890b9613b627e3a5995d0e4a594c8e0831e2ce", "file_name": "tests.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 18, "char_start": 823, "char_end": 876, "line": "            VALUES ({}, 'alex.roy616@gmail.com', {})\n"}, {"line_no": 22, "char_start": 992, "char_end": 1045, "line": "            VALUES ({}, 'alex.roy616@gmail.com', {})\n"}, {"line_no": 26, "char_start": 1151, "char_end": 1244, "line": "                conn.cursor().execute(fake_dilfo_insert.format(job_number, was_prev_closed))\n"}, {"line_no": 29, "char_start": 1313, "char_end": 1396, "line": "                    conn.cursor().execute(fake_match_insert.format(job_number, 1))\n"}, {"line_no": 31, "char_start": 1418, "char_end": 1501, "line": "                    conn.cursor().execute(fake_match_insert.format(job_number, 0))\n"}, {"line_no": 33, "char_start": 1543, "char_end": 1645, "line": "            df_dilfo_pre = pd.read_sql(f\"SELECT * FROM df_dilfo WHERE job_number={job_number}\", conn)\n"}, {"line_no": 34, "char_start": 1645, "char_end": 1751, "line": "            df_matched_pre = pd.read_sql(f\"SELECT * FROM df_matched WHERE job_number={job_number}\", conn)\n"}, {"line_no": 38, "char_start": 1897, "char_end": 2000, "line": "            df_dilfo_post = pd.read_sql(f\"SELECT * FROM df_dilfo WHERE job_number={job_number}\", conn)\n"}, {"line_no": 39, "char_start": 2000, "char_end": 2107, "line": "            df_matched_post = pd.read_sql(f\"SELECT * FROM df_matched WHERE job_number={job_number}\", conn)\n"}], "added": [{"line_no": 18, "char_start": 823, "char_end": 874, "line": "            VALUES (?, 'alex.roy616@gmail.com', ?)\n"}, {"line_no": 22, "char_start": 990, "char_end": 1041, "line": "            VALUES (?, 'alex.roy616@gmail.com', ?)\n"}, {"line_no": 26, "char_start": 1147, "char_end": 1235, "line": "                conn.cursor().execute(fake_dilfo_insert, [job_number, was_prev_closed])\n"}, {"line_no": 29, "char_start": 1304, "char_end": 1382, "line": "                    conn.cursor().execute(fake_match_insert, [job_number, 1])\n"}, {"line_no": 31, "char_start": 1404, "char_end": 1482, "line": "                    conn.cursor().execute(fake_match_insert, [job_number, 0])\n"}, {"line_no": 33, "char_start": 1524, "char_end": 1635, "line": "            df_dilfo_pre = pd.read_sql(\"SELECT * FROM df_dilfo WHERE job_number=?\", conn, params=[job_number])\n"}, {"line_no": 34, "char_start": 1635, "char_end": 1750, "line": "            df_matched_pre = pd.read_sql(\"SELECT * FROM df_matched WHERE job_number=?\", conn, params=[job_number])\n"}, {"line_no": 38, "char_start": 1896, "char_end": 2008, "line": "            df_dilfo_post = pd.read_sql(\"SELECT * FROM df_dilfo WHERE job_number=?\", conn, params=[job_number])\n"}, {"line_no": 39, "char_start": 2008, "char_end": 2124, "line": "            df_matched_post = pd.read_sql(\"SELECT * FROM df_matched WHERE job_number=?\", conn, params=[job_number])\n"}]}, "char_changes": {"deleted": [{"char_start": 843, "char_end": 845, "chars": "{}"}, {"char_start": 872, "char_end": 874, "chars": "{}"}, {"char_start": 1012, "char_end": 1014, "chars": "{}"}, {"char_start": 1041, "char_end": 1043, "chars": "{}"}, {"char_start": 1206, "char_end": 1214, "chars": ".format("}, {"char_start": 1241, "char_end": 1242, "chars": ")"}, {"char_start": 1372, "char_end": 1380, "chars": ".format("}, {"char_start": 1393, "char_end": 1394, "chars": ")"}, {"char_start": 1477, "char_end": 1485, "chars": ".format("}, {"char_start": 1498, "char_end": 1499, "chars": ")"}, {"char_start": 1582, "char_end": 1583, "chars": "f"}, {"char_start": 1624, "char_end": 1625, "chars": "{"}, {"char_start": 1635, "char_end": 1643, "chars": "}\", conn"}, {"char_start": 1686, "char_end": 1687, "chars": "f"}, {"char_start": 1730, "char_end": 1731, "chars": "{"}, {"char_start": 1741, "char_end": 1749, "chars": "}\", conn"}, {"char_start": 1937, "char_end": 1938, "chars": "f"}, {"char_start": 1979, "char_end": 1980, "chars": "{"}, {"char_start": 1990, "char_end": 1998, "chars": "}\", conn"}, {"char_start": 2042, "char_end": 2043, "chars": "f"}, {"char_start": 2086, "char_end": 2087, "chars": "{"}, {"char_start": 2097, "char_end": 2105, "chars": "}\", conn"}], "added": [{"char_start": 843, "char_end": 844, "chars": "?"}, {"char_start": 871, "char_end": 872, "chars": "?"}, {"char_start": 1010, "char_end": 1011, "chars": "?"}, {"char_start": 1038, "char_end": 1039, "chars": "?"}, {"char_start": 1202, "char_end": 1205, "chars": ", ["}, {"char_start": 1232, "char_end": 1233, "chars": "]"}, {"char_start": 1363, "char_end": 1366, "chars": ", ["}, {"char_start": 1379, "char_end": 1380, "chars": "]"}, {"char_start": 1463, "char_end": 1466, "chars": ", ["}, {"char_start": 1479, "char_end": 1480, "chars": "]"}, {"char_start": 1604, "char_end": 1622, "chars": "?\", conn, params=["}, {"char_start": 1632, "char_end": 1633, "chars": "]"}, {"char_start": 1719, "char_end": 1737, "chars": "?\", conn, params=["}, {"char_start": 1747, "char_end": 1748, "chars": "]"}, {"char_start": 1977, "char_end": 1995, "chars": "?\", conn, params=["}, {"char_start": 2005, "char_end": 2006, "chars": "]"}, {"char_start": 2093, "char_end": 2111, "chars": "?\", conn, params=["}, {"char_start": 2121, "char_end": 2122, "chars": "]"}]}}
{"func_name": "render_page_name", "func_src_before": "@app.route('/<page_name>')\ndef render_page_name(page_name):\n    query = db.query(\"select page_content.content, page.id as page_id, page_content.id as content_id from page, page_content where page.id = page_content.page_id and page.page_name = '%s' order by page_content.id desc limit 1\" % page_name)\n    wiki_page = query.namedresult()\n    has_content = False\n    page_is_taken = False\n    if len(wiki_page) < 1:\n        content = \"\"\n    else:\n        page_is_taken = True\n        content = wiki_page[0].content\n    if len(content) > 0:\n        has_content = True\n    else:\n        pass\n    content = markdown.markdown(wiki_linkify(content))\n    return render_template(\n        'pageholder.html',\n        page_is_taken = page_is_taken,\n        page_name = page_name,\n        markdown = markdown,\n        wiki_linkify = wiki_linkify,\n        has_content = has_content,\n        content = content\n    )", "func_src_after": "@app.route('/<page_name>')\ndef render_page_name(page_name):\n    query = db.query(\"select page_content.content, page.id as page_id, page_content.id as content_id from page, page_content where page.id = page_content.page_id and page.page_name = $1 order by page_content.id desc limit 1\", page_name)\n    wiki_page = query.namedresult()\n    has_content = False\n    page_is_taken = False\n    if len(wiki_page) < 1:\n        content = \"\"\n    else:\n        page_is_taken = True\n        content = wiki_page[0].content\n    if len(content) > 0:\n        has_content = True\n    else:\n        pass\n    content = markdown.markdown(wiki_linkify(content))\n    return render_template(\n        'pageholder.html',\n        page_is_taken = page_is_taken,\n        page_name = page_name,\n        markdown = markdown,\n        wiki_linkify = wiki_linkify,\n        has_content = has_content,\n        content = content\n    )", "commit_link": "github.com/Pumala/python_wiki_app_redo/commit/65d60747cd8efb05970304234d3bd949d2088e8b", "file_name": "server.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 3, "char_start": 60, "char_end": 300, "line": "    query = db.query(\"select page_content.content, page.id as page_id, page_content.id as content_id from page, page_content where page.id = page_content.page_id and page.page_name = '%s' order by page_content.id desc limit 1\" % page_name)\n"}], "added": [{"line_no": 3, "char_start": 60, "char_end": 297, "line": "    query = db.query(\"select page_content.content, page.id as page_id, page_content.id as content_id from page, page_content where page.id = page_content.page_id and page.page_name = $1 order by page_content.id desc limit 1\", page_name)\n"}]}, "char_changes": {"deleted": [{"char_start": 243, "char_end": 247, "chars": "'%s'"}, {"char_start": 286, "char_end": 288, "chars": " %"}], "added": [{"char_start": 243, "char_end": 245, "chars": "$1"}, {"char_start": 284, "char_end": 285, "chars": ","}]}}
{"func_name": "tid_to_tid_num", "func_src_before": "    def tid_to_tid_num(self, tid):\n        ''' Returns tid_num, given tid. '''\n\n        q = \"SELECT rowid FROM tids WHERE tid = '\" + tid + \"'\"\n        self.query(q)\n        return self.c.fetchone()[0]", "func_src_after": "    def tid_to_tid_num(self, tid):\n        ''' Returns tid_num, given tid. '''\n\n        q = \"SELECT rowid FROM tids WHERE tid = ?\"\n        self.query(q, tid)\n        return self.c.fetchone()[0]", "commit_link": "github.com/pukkapies/urop2019/commit/3ca2e2c291d2d5fe262d20a8e0520bdfb622432b", "file_name": "modules/query_lastfm.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 4, "char_start": 80, "char_end": 143, "line": "        q = \"SELECT rowid FROM tids WHERE tid = '\" + tid + \"'\"\n"}, {"line_no": 5, "char_start": 143, "char_end": 165, "line": "        self.query(q)\n"}], "added": [{"line_no": 4, "char_start": 80, "char_end": 131, "line": "        q = \"SELECT rowid FROM tids WHERE tid = ?\"\n"}, {"line_no": 5, "char_start": 131, "char_end": 158, "line": "        self.query(q, tid)\n"}]}, "char_changes": {"deleted": [{"char_start": 128, "char_end": 141, "chars": "'\" + tid + \"'"}], "added": [{"char_start": 128, "char_end": 129, "chars": "?"}, {"char_start": 151, "char_end": 156, "chars": ", tid"}]}}
{"func_name": "get_old_sourcebyinstitution_number", "func_src_before": "def get_old_sourcebyinstitution_number(conn, sqlite, sourcebyinstitution):\n    \"\"\"\n    Get all the old sourcebyinstitution number from the SQLite database.\n    \"\"\"\n    query = \"\"\"\n        SELECT\n            titles\n        FROM\n            history\n        WHERE\n            sourcebyinstitution = \"%s\"\n        ORDER BY\n            titles DESC\n        LIMIT 1\n    \"\"\" % sourcebyinstitution\n\n    sqlite.execute(query)\n    for record in sqlite:\n        old_sourcebyinstitution_number = record[0]\n        return old_sourcebyinstitution_number", "func_src_after": "def get_old_sourcebyinstitution_number(conn, sqlite, sourcebyinstitution):\n    \"\"\"\n    Get all the old sourcebyinstitution number from the SQLite database.\n    \"\"\"\n    query = \"\"\"\n        SELECT\n            titles\n        FROM\n            history\n        WHERE\n            sourcebyinstitution = ?\n        ORDER BY\n            titles DESC\n        LIMIT 1\n    \"\"\"\n\n    sqlite.execute(query, (sourcebyinstitution,))\n    for record in sqlite:\n        old_sourcebyinstitution_number = record[0]\n        return old_sourcebyinstitution_number", "commit_link": "github.com/miku/siskin/commit/7fa398d2fea72bf2e8b4808f75df4b3d35ae959a", "file_name": "bin/solrcheckup.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 11, "char_start": 261, "char_end": 300, "line": "            sourcebyinstitution = \"%s\"\n"}, {"line_no": 15, "char_start": 357, "char_end": 387, "line": "    \"\"\" % sourcebyinstitution\n"}, {"line_no": 17, "char_start": 388, "char_end": 414, "line": "    sqlite.execute(query)\n"}], "added": [{"line_no": 11, "char_start": 261, "char_end": 297, "line": "            sourcebyinstitution = ?\n"}, {"line_no": 15, "char_start": 354, "char_end": 362, "line": "    \"\"\"\n"}, {"line_no": 17, "char_start": 363, "char_end": 413, "line": "    sqlite.execute(query, (sourcebyinstitution,))\n"}]}, "char_changes": {"deleted": [{"char_start": 295, "char_end": 299, "chars": "\"%s\""}, {"char_start": 364, "char_end": 386, "chars": " % sourcebyinstitution"}], "added": [{"char_start": 295, "char_end": 296, "chars": "?"}, {"char_start": 387, "char_end": 411, "chars": ", (sourcebyinstitution,)"}]}}
{"func_name": "top_karma", "func_src_before": "def top_karma(bot, trigger):\n    \"\"\"\n    Show karma status for the top n number of IRC users.\n    \"\"\"\n    try:\n        top_limit = int(trigger.group(2).strip())\n    except ValueError:\n        top_limit = 5\n\n    query = \"SELECT slug, value FROM nick_values NATURAL JOIN nicknames \\\n        WHERE key = 'karma' ORDER BY value DESC LIMIT %d\"\n    karmalist = bot.db.execute(query % top_limit).fetchall()\n    for user in karmalist:\n        bot.say(\"%s == %s\" % (user[0], user[1]))", "func_src_after": "def top_karma(bot, trigger):\n    \"\"\"\n    Show karma status for the top n number of IRC users.\n    \"\"\"\n    try:\n        top_limit = int(trigger.group(2).strip())\n    except ValueError:\n        top_limit = 5\n\n    query = \"SELECT slug, value FROM nick_values NATURAL JOIN nicknames \\\n        WHERE key = 'karma' ORDER BY value DESC LIMIT ?\"\n    karmalist = bot.db.execute(query, str(top_limit)).fetchall()\n    for user in karmalist:\n        bot.say(\"%s == %s\" % (user[0], user[1]))", "commit_link": "github.com/OpCode1300/sopel-karma/commit/e4d49f7b3d88f8874c7862392f3f4c2065a25695", "file_name": "sopel_modules/karma/karma.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 11, "char_start": 281, "char_end": 339, "line": "        WHERE key = 'karma' ORDER BY value DESC LIMIT %d\"\n"}, {"line_no": 12, "char_start": 339, "char_end": 400, "line": "    karmalist = bot.db.execute(query % top_limit).fetchall()\n"}], "added": [{"line_no": 11, "char_start": 281, "char_end": 338, "line": "        WHERE key = 'karma' ORDER BY value DESC LIMIT ?\"\n"}, {"line_no": 12, "char_start": 338, "char_end": 403, "line": "    karmalist = bot.db.execute(query, str(top_limit)).fetchall()\n"}]}, "char_changes": {"deleted": [{"char_start": 335, "char_end": 337, "chars": "%d"}, {"char_start": 376, "char_end": 378, "chars": "% "}], "added": [{"char_start": 335, "char_end": 336, "chars": "?"}, {"char_start": 374, "char_end": 375, "chars": ","}, {"char_start": 376, "char_end": 380, "chars": "str("}, {"char_start": 389, "char_end": 390, "chars": ")"}]}}
{"func_name": "retrieve_playlist_by_id", "func_src_before": "def retrieve_playlist_by_id(id, db):\n    db.execute(\n        \"SELECT id, name, video_position from playlist WHERE id={id};\".format(id=id))\n    row = db.fetchone()\n    return row", "func_src_after": "def retrieve_playlist_by_id(id, db):\n    db.execute(\n        \"SELECT id, name, video_position from playlist WHERE id=%s;\", (id,))\n    row = db.fetchone()\n    return row", "commit_link": "github.com/Madmous/playlist/commit/666e52c5f0b8c1f4296e84471637033d9542a7a6", "file_name": "playlist/playlist_repository.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 3, "char_start": 53, "char_end": 139, "line": "        \"SELECT id, name, video_position from playlist WHERE id={id};\".format(id=id))\n"}], "added": [{"line_no": 3, "char_start": 53, "char_end": 130, "line": "        \"SELECT id, name, video_position from playlist WHERE id=%s;\", (id,))\n"}]}, "char_changes": {"deleted": [{"char_start": 117, "char_end": 121, "chars": "{id}"}, {"char_start": 123, "char_end": 130, "chars": ".format"}, {"char_start": 133, "char_end": 136, "chars": "=id"}], "added": [{"char_start": 117, "char_end": 119, "chars": "%s"}, {"char_start": 121, "char_end": 123, "chars": ", "}, {"char_start": 126, "char_end": 127, "chars": ","}]}}
{"func_name": "get_task", "func_src_before": "@bot.message_handler(func = lambda message: get_current_state(message.chat.id) == config.States.S_GET_TASK.value)\ndef get_task(message):\n    settings = sqlite3.connect(os.path.abspath(os.path.dirname(__file__)) + \"\\\\bases\\\\settings.db\")\n    conn = settings.cursor()\n    conn.execute(\"select * from users where chat_id = '\" + str(message.chat.id) + \"'\")\n    name = conn.fetchone()\n    settings.close()\n    if name == None:\n        bot.send_message(message.chat.id, \"You should login before get tasks.\")\n    else:\n        bases.update.update_user(name[1], name[0], name[2])\n        bot.send_message(message.chat.id, bases.problem.get_unsolved_problem(message.text, name[1]))\n    set_state(message.chat.id, config.States.S_START.value)", "func_src_after": "@bot.message_handler(func = lambda message: get_current_state(message.chat.id) == config.States.S_GET_TASK.value)\ndef get_task(message):\n    settings = sqlite3.connect(os.path.abspath(os.path.dirname(__file__)) + \"\\\\bases\\\\settings.db\")\n    conn = settings.cursor()\n    conn.execute(\"select * from users where chat_id = ?\", (str(message.chat.id),))\n    name = conn.fetchone()\n    settings.close()\n    if name == None:\n        bot.send_message(message.chat.id, \"You should login before get tasks.\")\n    else:\n        bases.update.update_user(name[1], name[0], name[2])\n        bot.send_message(message.chat.id, bases.problem.get_unsolved_problem(message.text, name[1]))\n    set_state(message.chat.id, config.States.S_START.value)", "commit_link": "github.com/lissrbay/codeforces_bot/commit/cc7f5143445a0030b1149ac60a65b1b1b9c92a90", "file_name": "bot.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 5, "char_start": 266, "char_end": 353, "line": "    conn.execute(\"select * from users where chat_id = '\" + str(message.chat.id) + \"'\")\n"}], "added": [{"line_no": 5, "char_start": 266, "char_end": 349, "line": "    conn.execute(\"select * from users where chat_id = ?\", (str(message.chat.id),))\n"}]}, "char_changes": {"deleted": [{"char_start": 320, "char_end": 321, "chars": "'"}, {"char_start": 322, "char_end": 324, "chars": " +"}, {"char_start": 345, "char_end": 351, "chars": " + \"'\""}], "added": [{"char_start": 320, "char_end": 321, "chars": "?"}, {"char_start": 322, "char_end": 323, "chars": ","}, {"char_start": 324, "char_end": 325, "chars": "("}, {"char_start": 345, "char_end": 347, "chars": ",)"}]}}
{"func_name": "stats", "func_src_before": "@bot.message_handler(commands=['stats'])\ndef stats(message):\n    settings = sqlite3.connect(os.path.abspath(os.path.dirname(__file__)) + \"\\\\bases\\\\settings.db\")\n    conn = settings.cursor()\n    conn.execute(\"select * from users where chat_id = '\" + str(message.chat.id) + \"'\")\n    name = conn.fetchone()\n    settings.close()\n    if name != None:\n        bases.update.update_user(name[1], name[0], name[2])\n        bases.problem.create_text_stats(name[1])\n        img = open(os.path.abspath(os.path.dirname(__file__)) + \"\\\\bases\\\\users\\\\\" + name[1] + \".png\", \"rb\")\n        bot.send_photo(message.chat.id, img)\n        img.close()\n        if bases.problem.create_stats_picture(name[1]):\n            bot.send_message(message.chat.id, \"Sorry, you haven't solved tasks.\")\n            return 0\n        img = open(os.path.abspath(os.path.dirname(__file__)) + \"\\\\bases\\\\users\\\\\" + name[1] + \".png\", \"rb\")\n        bot.send_photo(message.chat.id, img)\n        img.close()\n    else:\n        bot.send_message(message.chat.id, \"You should login before getting statistic.\")", "func_src_after": "@bot.message_handler(commands=['stats'])\ndef stats(message):\n    settings = sqlite3.connect(os.path.abspath(os.path.dirname(__file__)) + \"\\\\bases\\\\settings.db\")\n    conn = settings.cursor()\n    conn.execute(\"select * from users where chat_id = ?\", (str(message.chat.id),))\n    name = conn.fetchone()\n    settings.close()\n    if name != None:\n        bases.update.update_user(name[1], name[0], name[2])\n        bases.problem.create_text_stats(name[1])\n        img = open(os.path.abspath(os.path.dirname(__file__)) + \"\\\\bases\\\\users\\\\\" + name[1] + \".png\", \"rb\")\n        bot.send_photo(message.chat.id, img)\n        img.close()\n        if bases.problem.create_stats_picture(name[1]):\n            bot.send_message(message.chat.id, \"Sorry, you haven't solved tasks.\")\n            return 0\n        img = open(os.path.abspath(os.path.dirname(__file__)) + \"\\\\bases\\\\users\\\\\" + name[1] + \".png\", \"rb\")\n        bot.send_photo(message.chat.id, img)\n        img.close()\n    else:\n        bot.send_message(message.chat.id, \"You should login before getting statistic.\")", "commit_link": "github.com/lissrbay/codeforces_bot/commit/cc7f5143445a0030b1149ac60a65b1b1b9c92a90", "file_name": "bot.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 5, "char_start": 190, "char_end": 277, "line": "    conn.execute(\"select * from users where chat_id = '\" + str(message.chat.id) + \"'\")\n"}], "added": [{"line_no": 5, "char_start": 190, "char_end": 273, "line": "    conn.execute(\"select * from users where chat_id = ?\", (str(message.chat.id),))\n"}]}, "char_changes": {"deleted": [{"char_start": 244, "char_end": 245, "chars": "'"}, {"char_start": 246, "char_end": 248, "chars": " +"}, {"char_start": 269, "char_end": 275, "chars": " + \"'\""}], "added": [{"char_start": 244, "char_end": 245, "chars": "?"}, {"char_start": 246, "char_end": 247, "chars": ","}, {"char_start": 248, "char_end": 249, "chars": "("}, {"char_start": 269, "char_end": 271, "chars": ",)"}]}}
{"func_name": "delete", "func_src_before": "    @jwt_required\n    def delete(self, user_id):\n        \"\"\" Deletes user with the corresponding user_id \"\"\"\n        return database_utilities.execute_query(f\"\"\"delete from users where user_id = '{user_id}'\"\"\")", "func_src_after": "    @jwt_required\n    def delete(self, user_id):\n        \"\"\" Deletes user with the corresponding user_id \"\"\"\n        return database_utilities.execute_query(f\"\"\"delete from users where user_id = %s\"\"\", (user_id, ))", "commit_link": "github.com/sgosal2/tiger-boards-backend/commit/4670109dd613df2f2fe7e8403ebd149df2b55485", "file_name": "apis/users.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 4, "char_start": 109, "char_end": 210, "line": "        return database_utilities.execute_query(f\"\"\"delete from users where user_id = '{user_id}'\"\"\")\n"}], "added": [{"line_no": 4, "char_start": 109, "char_end": 214, "line": "        return database_utilities.execute_query(f\"\"\"delete from users where user_id = %s\"\"\", (user_id, ))\n"}]}, "char_changes": {"deleted": [{"char_start": 195, "char_end": 197, "chars": "'{"}, {"char_start": 204, "char_end": 209, "chars": "}'\"\"\""}], "added": [{"char_start": 195, "char_end": 203, "chars": "%s\"\"\", ("}, {"char_start": 210, "char_end": 213, "chars": ", )"}]}}
{"func_name": "verify_rno", "func_src_before": "    def verify_rno(self, rno):\n        query = \"SELECT COUNT(rno) FROM rides WHERE rno = {rno}\".format(rno = rno)\n        self.cursor.execute(query)\n        result = self.cursor.fetchone()\n        if (int(result[0]) > 0):\n            return True \n        else:\n            return False", "func_src_after": "    def verify_rno(self, rno):\n        self.cursor.execute(\"SELECT COUNT(rno) FROM rides WHERE rno = :rno\", {'rno': rno})\n        result = self.cursor.fetchone()\n        if (int(result[0]) > 0):\n            return True \n        else:\n            return False", "commit_link": "github.com/kenboo98/291-Mini-Project-I/commit/3080ccb687c79c83954ce703faee8fcceec8c9eb", "file_name": "book_rides/book_rides.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 2, "char_start": 31, "char_end": 114, "line": "        query = \"SELECT COUNT(rno) FROM rides WHERE rno = {rno}\".format(rno = rno)\n"}, {"line_no": 3, "char_start": 114, "char_end": 149, "line": "        self.cursor.execute(query)\n"}], "added": [{"line_no": 2, "char_start": 31, "char_end": 122, "line": "        self.cursor.execute(\"SELECT COUNT(rno) FROM rides WHERE rno = :rno\", {'rno': rno})\n"}]}, "char_changes": {"deleted": [{"char_start": 39, "char_end": 41, "chars": "qu"}, {"char_start": 43, "char_end": 47, "chars": "y = "}, {"char_start": 89, "char_end": 90, "chars": "{"}, {"char_start": 93, "char_end": 94, "chars": "}"}, {"char_start": 95, "char_end": 103, "chars": ".format("}, {"char_start": 106, "char_end": 108, "chars": " ="}, {"char_start": 112, "char_end": 147, "chars": ")\n        self.cursor.execute(query"}], "added": [{"char_start": 39, "char_end": 55, "chars": "self.cursor.exec"}, {"char_start": 56, "char_end": 57, "chars": "t"}, {"char_start": 58, "char_end": 59, "chars": "("}, {"char_start": 101, "char_end": 102, "chars": ":"}, {"char_start": 106, "char_end": 107, "chars": ","}, {"char_start": 108, "char_end": 110, "chars": "{'"}, {"char_start": 113, "char_end": 115, "chars": "':"}, {"char_start": 117, "char_end": 118, "chars": "n"}, {"char_start": 119, "char_end": 120, "chars": "}"}]}}
{"func_name": "get_requested_day", "func_src_before": "    def get_requested_day(self, date):\n\n        data = dict()\n\n        day_start, day_end = self.get_epoch_day(date)\n        data['interval'] = {'from': self.convert_local_ts_to_utc(day_start, self.local_timezone), 'to': self.convert_local_ts_to_utc(day_end, self.local_timezone)}\n\n        query = '''\n            SELECT TimeStamp, SUM(Power) AS Power \n            FROM DayData \n            WHERE TimeStamp BETWEEN %s AND %s \n            GROUP BY TimeStamp;\n        '''\n\n        data['data'] = list()\n        for row in self.c.execute(query % (day_start, day_end)):\n            data['data'].append({ 'time': row[0], 'power': row[1] })\n\n\n        if self.get_datetime(date).date() == datetime.today().date():\n            query = '''\n                SELECT SUM(EToday) as EToday\n                FROM Inverters;\n                '''\n        else:\n            query = '''\n                SELECT SUM(DayYield) AS Power \n                FROM MonthData \n                WHERE TimeStamp BETWEEN %s AND %s\n                GROUP BY TimeStamp\n                ''' % (day_start, day_end)\n        self.c.execute(query)\n        row = self.c.fetchone()\n        if row and row[0]: data['total'] = row[0]\n        else: data['total'] = 0\n\n\n        query = '''\n            SELECT MIN(TimeStamp) as Min, MAX(TimeStamp) as Max \n            FROM ( SELECT TimeStamp FROM DayData GROUP BY TimeStamp );\n            '''\n\n        self.c.execute(query)\n        first_data, last_data = self.c.fetchone()\n\n        if (first_data):  data['hasPrevious'] = (first_data < day_start)\n        else: data['hasPrevious'] = False\n\n        if (last_data): data['hasNext'] = (last_data > day_end)\n        else: data['hasNext'] = False\n\n        #print(json.dumps(data, indent=4))\n        return data", "func_src_after": "    def get_requested_day(self, date):\n\n        data = dict()\n\n        day_start, day_end = self.get_epoch_day(date)\n        data['interval'] = {'from': self.convert_local_ts_to_utc(day_start, self.local_timezone), 'to': self.convert_local_ts_to_utc(day_end, self.local_timezone)}\n\n        query = '''\n            SELECT TimeStamp, SUM(Power) AS Power \n            FROM DayData \n            WHERE TimeStamp BETWEEN ? AND ?\n            GROUP BY TimeStamp;\n        '''\n\n        data['data'] = list()\n        for row in self.c.execute(query, (day_start, day_end)):\n            data['data'].append({ 'time': row[0], 'power': row[1] })\n\n\n        if self.get_datetime(date).date() == datetime.today().date():\n            query = '''\n                SELECT SUM(EToday) as EToday\n                FROM Inverters;\n                '''\n            self.c.execute(query)\n        else:\n            query = '''\n                SELECT SUM(DayYield) AS Power \n                FROM MonthData \n                WHERE TimeStamp BETWEEN ? AND ?\n                GROUP BY TimeStamp;\n                '''\n            self.c.execute(query, (day_start, day_end))\n\n        row = self.c.fetchone()\n        if row and row[0]: data['total'] = row[0]\n        else: data['total'] = 0\n\n\n        query = '''\n            SELECT MIN(TimeStamp) as Min, MAX(TimeStamp) as Max \n            FROM ( SELECT TimeStamp FROM DayData GROUP BY TimeStamp );\n            '''\n\n        self.c.execute(query)\n        first_data, last_data = self.c.fetchone()\n\n        if (first_data):  data['hasPrevious'] = (first_data < day_start)\n        else: data['hasPrevious'] = False\n\n        if (last_data): data['hasNext'] = (last_data > day_end)\n        else: data['hasNext'] = False\n\n        #print(json.dumps(data, indent=4))\n        return data", "commit_link": "github.com/philipptrenz/sunportal/commit/7eef493a168ed4e6731ff800713bfb8aee99a506", "file_name": "util/database.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 11, "char_start": 379, "char_end": 426, "line": "            WHERE TimeStamp BETWEEN %s AND %s \n"}, {"line_no": 16, "char_start": 501, "char_end": 566, "line": "        for row in self.c.execute(query % (day_start, day_end)):\n"}, {"line_no": 29, "char_start": 945, "char_end": 995, "line": "                WHERE TimeStamp BETWEEN %s AND %s\n"}, {"line_no": 30, "char_start": 995, "char_end": 1030, "line": "                GROUP BY TimeStamp\n"}, {"line_no": 31, "char_start": 1030, "char_end": 1073, "line": "                ''' % (day_start, day_end)\n"}, {"line_no": 32, "char_start": 1073, "char_end": 1103, "line": "        self.c.execute(query)\n"}], "added": [{"line_no": 11, "char_start": 379, "char_end": 423, "line": "            WHERE TimeStamp BETWEEN ? AND ?\n"}, {"line_no": 16, "char_start": 498, "char_end": 562, "line": "        for row in self.c.execute(query, (day_start, day_end)):\n"}, {"line_no": 25, "char_start": 824, "char_end": 858, "line": "            self.c.execute(query)\n"}, {"line_no": 30, "char_start": 975, "char_end": 1023, "line": "                WHERE TimeStamp BETWEEN ? AND ?\n"}, {"line_no": 31, "char_start": 1023, "char_end": 1059, "line": "                GROUP BY TimeStamp;\n"}, {"line_no": 32, "char_start": 1059, "char_end": 1079, "line": "                '''\n"}, {"line_no": 33, "char_start": 1079, "char_end": 1135, "line": "            self.c.execute(query, (day_start, day_end))\n"}, {"line_no": 34, "char_start": 1135, "char_end": 1136, "line": "\n"}]}, "char_changes": {"deleted": [{"char_start": 415, "char_end": 417, "chars": "%s"}, {"char_start": 422, "char_end": 425, "chars": "%s "}, {"char_start": 540, "char_end": 542, "chars": " %"}, {"char_start": 985, "char_end": 987, "chars": "%s"}, {"char_start": 992, "char_end": 994, "chars": "%s"}, {"char_start": 1050, "char_end": 1051, "chars": "%"}, {"char_start": 1052, "char_end": 1063, "chars": "(day_start,"}, {"char_start": 1064, "char_end": 1073, "chars": "day_end)\n"}], "added": [{"char_start": 415, "char_end": 416, "chars": "?"}, {"char_start": 421, "char_end": 422, "chars": "?"}, {"char_start": 537, "char_end": 538, "chars": ","}, {"char_start": 824, "char_end": 858, "chars": "            self.c.execute(query)\n"}, {"char_start": 1015, "char_end": 1016, "chars": "?"}, {"char_start": 1021, "char_end": 1022, "chars": "?"}, {"char_start": 1057, "char_end": 1058, "chars": ";"}, {"char_start": 1078, "char_end": 1079, "chars": "\n"}, {"char_start": 1082, "char_end": 1083, "chars": " "}, {"char_start": 1111, "char_end": 1132, "chars": ", (day_start, day_end"}, {"char_start": 1133, "char_end": 1135, "chars": ")\n"}]}}
{"func_name": "add_language", "func_src_before": "def add_language(lang):\n    try:\n        cur.execute(f\"INSERT INTO language (name) VALUES ('{lang}')\")\n    except Exception as e:\n        pass\n    cur.execute(f\"SELECT language_id FROM language where name='{lang}'\")\n    lang_id = cur.fetchone()[0]\n    if conn.commit():\n        return lang_id\n    return lang_id", "func_src_after": "def add_language(lang):\n    try:\n        cur.execute(\"INSERT INTO language (name) VALUES (%s)\", (lang, ))\n    except Exception as e:\n        pass\n    cur.execute(\"SELECT language_id FROM language where name=%s\", (lang, ))\n    lang_id = cur.fetchone()[0]\n    if conn.commit():\n        return lang_id\n    return lang_id", "commit_link": "github.com/Elbertbiggs360/dvdrental/commit/ad144ae2a08a332498d0831bc255170d57ba754b", "file_name": "app.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 3, "char_start": 33, "char_end": 103, "line": "        cur.execute(f\"INSERT INTO language (name) VALUES ('{lang}')\")\n"}, {"line_no": 6, "char_start": 143, "char_end": 216, "line": "    cur.execute(f\"SELECT language_id FROM language where name='{lang}'\")\n"}], "added": [{"line_no": 3, "char_start": 33, "char_end": 106, "line": "        cur.execute(\"INSERT INTO language (name) VALUES (%s)\", (lang, ))\n"}, {"line_no": 6, "char_start": 146, "char_end": 222, "line": "    cur.execute(\"SELECT language_id FROM language where name=%s\", (lang, ))\n"}]}, "char_changes": {"deleted": [{"char_start": 53, "char_end": 54, "chars": "f"}, {"char_start": 91, "char_end": 93, "chars": "'{"}, {"char_start": 97, "char_end": 99, "chars": "}'"}, {"char_start": 100, "char_end": 101, "chars": "\""}, {"char_start": 159, "char_end": 160, "chars": "f"}, {"char_start": 205, "char_end": 207, "chars": "'{"}, {"char_start": 211, "char_end": 214, "chars": "}'\""}], "added": [{"char_start": 90, "char_end": 97, "chars": "%s)\", ("}, {"char_start": 101, "char_end": 103, "chars": ", "}, {"char_start": 207, "char_end": 213, "chars": "%s\", ("}, {"char_start": 217, "char_end": 220, "chars": ", )"}]}}
{"func_name": "makeJudge", "func_src_before": "def makeJudge(judge):\n\tdb.execute(\"UPDATE players SET Judge = 1 WHERE Name = '%s' COLLATE NOCASE\" % (judge)) \n\tdatabase.commit()", "func_src_after": "def makeJudge(judge):\n\tdb.execute(\"UPDATE players SET Judge = 1 WHERE Name = ? COLLATE NOCASE\", judge) \n\tdatabase.commit()", "commit_link": "github.com/iScrE4m/XLeague/commit/59cab6e5fd8bd5e47f2418a7c71cb1d4e3cad0d2", "file_name": "plugins/database.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 2, "char_start": 22, "char_end": 110, "line": "\tdb.execute(\"UPDATE players SET Judge = 1 WHERE Name = '%s' COLLATE NOCASE\" % (judge)) \n"}], "added": [{"line_no": 2, "char_start": 22, "char_end": 104, "line": "\tdb.execute(\"UPDATE players SET Judge = 1 WHERE Name = ? COLLATE NOCASE\", judge) \n"}]}, "char_changes": {"deleted": [{"char_start": 77, "char_end": 81, "chars": "'%s'"}, {"char_start": 97, "char_end": 99, "chars": " %"}, {"char_start": 100, "char_end": 101, "chars": "("}, {"char_start": 106, "char_end": 107, "chars": ")"}], "added": [{"char_start": 77, "char_end": 78, "chars": "?"}, {"char_start": 94, "char_end": 95, "chars": ","}]}}
{"func_name": "isValidAdmToken", "func_src_before": "def isValidAdmToken(adm_token):\n    conn, c = connectDB()\n    req = \"SELECT *  from {} where adm_token='{}'\".format(CFG(\"admintoken_table_name\"), adm_token)\n    answer = bool(queryOne(c, req))\n    closeDB(conn)\n    return answer", "func_src_after": "def isValidAdmToken(adm_token):\n    conn, c = connectDB()\n    req = \"SELECT *  from {} where adm_token=?\".format(CFG(\"admintoken_table_name\"))\n    answer = bool(queryOne(c, req, (adm_token,)))\n    closeDB(conn)\n    return answer", "commit_link": "github.com/FAUSheppy/simple-python-poll/commit/186c5ff5cdf58272e253a1bb432419ee50d93109", "file_name": "database.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 3, "char_start": 58, "char_end": 157, "line": "    req = \"SELECT *  from {} where adm_token='{}'\".format(CFG(\"admintoken_table_name\"), adm_token)\n"}, {"line_no": 4, "char_start": 157, "char_end": 193, "line": "    answer = bool(queryOne(c, req))\n"}], "added": [{"line_no": 3, "char_start": 58, "char_end": 143, "line": "    req = \"SELECT *  from {} where adm_token=?\".format(CFG(\"admintoken_table_name\"))\n"}, {"line_no": 4, "char_start": 143, "char_end": 193, "line": "    answer = bool(queryOne(c, req, (adm_token,)))\n"}]}, "char_changes": {"deleted": [{"char_start": 103, "char_end": 107, "chars": "'{}'"}, {"char_start": 144, "char_end": 155, "chars": ", adm_token"}], "added": [{"char_start": 103, "char_end": 104, "chars": "?"}, {"char_start": 176, "char_end": 190, "chars": ", (adm_token,)"}]}}
{"func_name": "get_mapped_projects", "func_src_before": "    @staticmethod\n    def get_mapped_projects(user_id: int, preferred_locale: str) -> UserMappedProjectsDTO:\n        \"\"\" Get all projects a user has mapped on \"\"\"\n\n        # This query looks scary, but we're really just creating an outer join between the query that gets the\n        # counts of all mapped tasks and the query that gets counts of all validated tasks.  This is necessary to\n        # handle cases where users have only validated tasks on a project, or only mapped on a project.\n        sql = '''SELECT p.id,\n                        p.status,\n                        p.default_locale,\n                        c.mapped,\n                        c.validated,\n                        st_asgeojson(p.centroid)\n                   FROM projects p,\n                        (SELECT coalesce(v.project_id, m.project_id) project_id,\n                                coalesce(v.validated, 0) validated,\n                                coalesce(m.mapped, 0) mapped\n                          FROM (SELECT t.project_id,\n                                       count (t.validated_by) validated\n                                  FROM tasks t\n                                 WHERE t.project_id IN (SELECT unnest(projects_mapped) FROM users WHERE id = {0})\n                                   AND t.validated_by = {0}\n                                 GROUP BY t.project_id, t.validated_by) v\n                         FULL OUTER JOIN\n                        (SELECT t.project_id,\n                                count(t.mapped_by) mapped\n                           FROM tasks t\n                          WHERE t.project_id IN (SELECT unnest(projects_mapped) FROM users WHERE id = {0})\n                            AND t.mapped_by = {0}\n                          GROUP BY t.project_id, t.mapped_by) m\n                         ON v.project_id = m.project_id) c\n                   WHERE p.id = c.project_id ORDER BY p.id DESC'''.format(user_id)\n\n        results = db.engine.execute(sql)\n\n        if results.rowcount == 0:\n            raise NotFound()\n\n        mapped_projects_dto = UserMappedProjectsDTO()\n        for row in results:\n            mapped_project = MappedProject()\n            mapped_project.project_id = row[0]\n            mapped_project.status = ProjectStatus(row[1]).name\n            mapped_project.tasks_mapped = row[3]\n            mapped_project.tasks_validated = row[4]\n            mapped_project.centroid = geojson.loads(row[5])\n\n            project_info = ProjectInfo.get_dto_for_locale(row[0], preferred_locale, row[2])\n            mapped_project.name = project_info.name\n\n            mapped_projects_dto.mapped_projects.append(mapped_project)\n\n        return mapped_projects_dto", "func_src_after": "    @staticmethod\n    def get_mapped_projects(user_id: int, preferred_locale: str) -> UserMappedProjectsDTO:\n        \"\"\" Get all projects a user has mapped on \"\"\"\n\n        # This query looks scary, but we're really just creating an outer join between the query that gets the\n        # counts of all mapped tasks and the query that gets counts of all validated tasks.  This is necessary to\n        # handle cases where users have only validated tasks on a project, or only mapped on a project.\n        sql = '''SELECT p.id,\n                        p.status,\n                        p.default_locale,\n                        c.mapped,\n                        c.validated,\n                        st_asgeojson(p.centroid)\n                   FROM projects p,\n                        (SELECT coalesce(v.project_id, m.project_id) project_id,\n                                coalesce(v.validated, 0) validated,\n                                coalesce(m.mapped, 0) mapped\n                          FROM (SELECT t.project_id,\n                                       count (t.validated_by) validated\n                                  FROM tasks t\n                                 WHERE t.project_id IN (SELECT unnest(projects_mapped) FROM users WHERE id = :user_id)\n                                   AND t.validated_by = :user_id\n                                 GROUP BY t.project_id, t.validated_by) v\n                         FULL OUTER JOIN\n                        (SELECT t.project_id,\n                                count(t.mapped_by) mapped\n                           FROM tasks t\n                          WHERE t.project_id IN (SELECT unnest(projects_mapped) FROM users WHERE id = :user_id)\n                            AND t.mapped_by = :user_id\n                          GROUP BY t.project_id, t.mapped_by) m\n                         ON v.project_id = m.project_id) c\n                   WHERE p.id = c.project_id ORDER BY p.id DESC'''\n\n        results = db.engine.execute(text(sql), user_id=user_id)\n\n        if results.rowcount == 0:\n            raise NotFound()\n\n        mapped_projects_dto = UserMappedProjectsDTO()\n        for row in results:\n            mapped_project = MappedProject()\n            mapped_project.project_id = row[0]\n            mapped_project.status = ProjectStatus(row[1]).name\n            mapped_project.tasks_mapped = row[3]\n            mapped_project.tasks_validated = row[4]\n            mapped_project.centroid = geojson.loads(row[5])\n\n            project_info = ProjectInfo.get_dto_for_locale(row[0], preferred_locale, row[2])\n            mapped_project.name = project_info.name\n\n            mapped_projects_dto.mapped_projects.append(mapped_project)\n\n        return mapped_projects_dto", "commit_link": "github.com/hotosm/tasking-manager/commit/dee040a2d22b3c4d5e38e2dbf8c6b651ad4c241a", "file_name": "server/models/postgis/user.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 21, "char_start": 1137, "char_end": 1251, "line": "                                 WHERE t.project_id IN (SELECT unnest(projects_mapped) FROM users WHERE id = {0})\n"}, {"line_no": 22, "char_start": 1251, "char_end": 1311, "line": "                                   AND t.validated_by = {0}\n"}, {"line_no": 28, "char_start": 1570, "char_end": 1677, "line": "                          WHERE t.project_id IN (SELECT unnest(projects_mapped) FROM users WHERE id = {0})\n"}, {"line_no": 29, "char_start": 1677, "char_end": 1727, "line": "                            AND t.mapped_by = {0}\n"}, {"line_no": 32, "char_start": 1850, "char_end": 1933, "line": "                   WHERE p.id = c.project_id ORDER BY p.id DESC'''.format(user_id)\n"}, {"line_no": 34, "char_start": 1934, "char_end": 1975, "line": "        results = db.engine.execute(sql)\n"}], "added": [{"line_no": 21, "char_start": 1137, "char_end": 1256, "line": "                                 WHERE t.project_id IN (SELECT unnest(projects_mapped) FROM users WHERE id = :user_id)\n"}, {"line_no": 22, "char_start": 1256, "char_end": 1321, "line": "                                   AND t.validated_by = :user_id\n"}, {"line_no": 28, "char_start": 1580, "char_end": 1692, "line": "                          WHERE t.project_id IN (SELECT unnest(projects_mapped) FROM users WHERE id = :user_id)\n"}, {"line_no": 29, "char_start": 1692, "char_end": 1747, "line": "                            AND t.mapped_by = :user_id\n"}, {"line_no": 32, "char_start": 1870, "char_end": 1937, "line": "                   WHERE p.id = c.project_id ORDER BY p.id DESC'''\n"}, {"line_no": 34, "char_start": 1938, "char_end": 2002, "line": "        results = db.engine.execute(text(sql), user_id=user_id)\n"}]}, "char_changes": {"deleted": [{"char_start": 1246, "char_end": 1249, "chars": "{0}"}, {"char_start": 1307, "char_end": 1310, "chars": "{0}"}, {"char_start": 1672, "char_end": 1675, "chars": "{0}"}, {"char_start": 1723, "char_end": 1726, "chars": "{0}"}, {"char_start": 1916, "char_end": 1932, "chars": ".format(user_id)"}], "added": [{"char_start": 1246, "char_end": 1254, "chars": ":user_id"}, {"char_start": 1312, "char_end": 1320, "chars": ":user_id"}, {"char_start": 1682, "char_end": 1690, "chars": ":user_id"}, {"char_start": 1738, "char_end": 1746, "chars": ":user_id"}, {"char_start": 1974, "char_end": 1979, "chars": "text("}, {"char_start": 1982, "char_end": 2000, "chars": "), user_id=user_id"}]}}
{"func_name": "delete_data", "func_src_before": "    def delete_data(self, session, id):\n        self._openContainer(session)\n        sid = str(id)\n        if (self.idNormalizer is not None):\n            sid = self.idNormalizer.process_string(session, str(id))\n        query = \"DELETE FROM %s WHERE identifier = '%s';\" % (self.table, sid)\n        self._query(query)\n        return None", "func_src_after": "    def delete_data(self, session, id):\n        self._openContainer(session)\n        sid = str(id)\n        if (self.idNormalizer is not None):\n            sid = self.idNormalizer.process_string(session, str(id))\n        query = \"DELETE FROM %s WHERE identifier = $1;\" % (self.table)\n        self._query(query, sid)\n        return None", "commit_link": "github.com/cheshire3/cheshire3/commit/d350363b4ea10f102c24c8f26d7b76b006323e8e", "file_name": "cheshire3/sql/postgresStore.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 6, "char_start": 212, "char_end": 290, "line": "        query = \"DELETE FROM %s WHERE identifier = '%s';\" % (self.table, sid)\n"}, {"line_no": 7, "char_start": 290, "char_end": 317, "line": "        self._query(query)\n"}], "added": [{"line_no": 6, "char_start": 212, "char_end": 283, "line": "        query = \"DELETE FROM %s WHERE identifier = $1;\" % (self.table)\n"}, {"line_no": 7, "char_start": 283, "char_end": 315, "line": "        self._query(query, sid)\n"}]}, "char_changes": {"deleted": [{"char_start": 263, "char_end": 267, "chars": "'%s'"}, {"char_start": 283, "char_end": 288, "chars": ", sid"}], "added": [{"char_start": 263, "char_end": 265, "chars": "$1"}, {"char_start": 308, "char_end": 313, "chars": ", sid"}]}}
{"func_name": "user_verify", "func_src_before": "    def user_verify(self):\n        eid = self.email\n        code = self.password\n        if eid.strip() == '':\n            return\n        if code.strip() == '':\n            return\n        query = '''select * from usr where email like\\''''+eid+'\\''\n        cursor = g.conn.execute(query)\n        for row in cursor:\n            key = str(row.password)\n            if key.strip() == code.strip():\n                self.name = str(row.name)\n                self.email = eid\n                self.id = eid\n                self.valid = True\n            break", "func_src_after": "    def user_verify(self):\n        eid = self.email\n        code = self.password\n        if eid.strip() == '':\n            return\n        if code.strip() == '':\n            return\n        query = 'select * from usr where email like %s'\n        cursor = g.conn.execute(query, (eid, ))\n        for row in cursor:\n            key = str(row.password)\n            if key.strip() == code.strip():\n                self.name = str(row.name)\n                self.email = eid\n                self.id = eid\n                self.valid = True\n            break", "commit_link": "github.com/Daniel-Bu/w4111-project1/commit/fe04bedc72e62fd4c4ee046a9af29fd81e9b3340", "file_name": "Web-app/User.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 8, "char_start": 180, "char_end": 248, "line": "        query = '''select * from usr where email like\\''''+eid+'\\''\n"}, {"line_no": 9, "char_start": 248, "char_end": 287, "line": "        cursor = g.conn.execute(query)\n"}], "added": [{"line_no": 8, "char_start": 180, "char_end": 236, "line": "        query = 'select * from usr where email like %s'\n"}, {"line_no": 9, "char_start": 236, "char_end": 284, "line": "        cursor = g.conn.execute(query, (eid, ))\n"}]}, "char_changes": {"deleted": [{"char_start": 197, "char_end": 199, "chars": "''"}, {"char_start": 233, "char_end": 246, "chars": "\\''''+eid+'\\'"}], "added": [{"char_start": 231, "char_end": 234, "chars": " %s"}, {"char_start": 273, "char_end": 282, "chars": ", (eid, )"}]}}
{"func_name": "search_films", "func_src_before": "@app.route('/movies/search', methods=['GET', 'POST'])\ndef search_films():\n    form = SearchForm()\n    if not form.validate_on_submit():\n        return render_template('search.html', title='Search for films', form=form)\n    search_terms = form.data['term'].split(' ')\n    search_string = ' & '.join(search_terms)\n    cur.execute(f\"SELECT * FROM film where fulltext @@ to_tsquery('{search_string}')\")\n    res = cur.fetchall()\n    return render_template('search_results.html', title='Home', res=len(res))", "func_src_after": "@app.route('/movies/search', methods=['GET', 'POST'])\ndef search_films():\n    form = SearchForm()\n    if not form.validate_on_submit():\n        return render_template('search.html', title='Search for films', form=form)\n    search_terms = form.data['term'].split(' ')\n    search_string = ' & '.join(search_terms)\n    cur.execute(\"SELECT * FROM film where fulltext @@ to_tsquery(%s)\", (search_string, ))\n    res = cur.fetchall()\n    return render_template('search_results.html', title='Home', res=len(res))", "commit_link": "github.com/Elbertbiggs360/dvdrental/commit/ad144ae2a08a332498d0831bc255170d57ba754b", "file_name": "app.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 8, "char_start": 312, "char_end": 399, "line": "    cur.execute(f\"SELECT * FROM film where fulltext @@ to_tsquery('{search_string}')\")\n"}], "added": [{"line_no": 8, "char_start": 312, "char_end": 402, "line": "    cur.execute(\"SELECT * FROM film where fulltext @@ to_tsquery(%s)\", (search_string, ))\n"}]}, "char_changes": {"deleted": [{"char_start": 328, "char_end": 329, "chars": "f"}, {"char_start": 378, "char_end": 380, "chars": "'{"}, {"char_start": 393, "char_end": 395, "chars": "}'"}, {"char_start": 396, "char_end": 397, "chars": "\""}], "added": [{"char_start": 377, "char_end": 384, "chars": "%s)\", ("}, {"char_start": 397, "char_end": 399, "chars": ", "}]}}
{"func_name": "getGameCountInSeriesSoFar", "func_src_before": "def getGameCountInSeriesSoFar(submission):\n    database = sqlite3.connect('database.db')\n    cursor = database.cursor()\n    return cursor.execute(\"SELECT COUNT(*) FROM ChallengeRankings WHERE SeriesTitle = '\" + getTitle(submission) + \"' AND Date <= '\" + getSubmissionDateFromDatabase(submission) + \"'\").fetchone()[0]\n    database.close()", "func_src_after": "def getGameCountInSeriesSoFar(submission):\n    database = sqlite3.connect('database.db')\n    cursor = database.cursor()\n    return cursor.execute(\"SELECT COUNT(*) FROM ChallengeRankings WHERE SeriesTitle = ? AND Date <= ?\", [getTitle(submission), getSubmissionDateFromDatabase(submission)]).fetchone()[0]\n    database.close()", "commit_link": "github.com/LiquidFun/Reddit-GeoGuessr-Tracking-Bot/commit/0cad2d52e24b05da32789fbc8face7a9999a71f9", "file_name": "CheckAndPostForSeriesSubmissions.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 4, "char_start": 120, "char_end": 317, "line": "    return cursor.execute(\"SELECT COUNT(*) FROM ChallengeRankings WHERE SeriesTitle = '\" + getTitle(submission) + \"' AND Date <= '\" + getSubmissionDateFromDatabase(submission) + \"'\").fetchone()[0]\n"}], "added": [{"line_no": 4, "char_start": 120, "char_end": 305, "line": "    return cursor.execute(\"SELECT COUNT(*) FROM ChallengeRankings WHERE SeriesTitle = ? AND Date <= ?\", [getTitle(submission), getSubmissionDateFromDatabase(submission)]).fetchone()[0]\n"}]}, "char_changes": {"deleted": [{"char_start": 206, "char_end": 208, "chars": "'\""}, {"char_start": 209, "char_end": 210, "chars": "+"}, {"char_start": 231, "char_end": 253, "chars": " + \"' AND Date <= '\" +"}, {"char_start": 295, "char_end": 301, "chars": " + \"'\""}], "added": [{"char_start": 206, "char_end": 207, "chars": "?"}, {"char_start": 208, "char_end": 211, "chars": "AND"}, {"char_start": 212, "char_end": 225, "chars": "Date <= ?\", ["}, {"char_start": 245, "char_end": 246, "chars": ","}, {"char_start": 288, "char_end": 289, "chars": "]"}]}}
{"func_name": "add", "func_src_before": "@mod.route('/add', methods=['GET', 'POST'])\ndef add():\n    if request.method == 'POST':\n        msg_id = int(request.form['msg_id'])\n        user_id = session['logged_id']\n        content = request.form['content']\n        c_time = datetime.now().strftime('%Y-%m-%d %H:%M:%S')\n        sql = \"INSERT INTO comment(msg_id,user_id,content,c_time) \" + \\\n                \"VALUES(%d,%d,'%s','%s');\" % (msg_id, user_id, content, c_time)\n        cursor.execute(sql)\n        conn.commit()\n    return redirect(url_for('comment.show', msg_id=msg_id))", "func_src_after": "@mod.route('/add', methods=['GET', 'POST'])\ndef add():\n    if request.method == 'POST':\n        msg_id = int(request.form['msg_id'])\n        user_id = session['logged_id']\n        content = request.form['content']\n        c_time = datetime.now().strftime('%Y-%m-%d %H:%M:%S')\n        cursor.execute(\"INSERT INTO comment(msg_id,user_id,content,c_time) VALUES(%s,%s,%s,%s);\", (msg_id, user_id, content, c_time))\n        conn.commit()\n    return redirect(url_for('comment.show', msg_id=msg_id))", "commit_link": "github.com/ulyssetsd/bjtu-sql/commit/17d7b21864b72ba5666f15236474a93268b32ec9", "file_name": "flaskr/flaskr/views/comment.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 8, "char_start": 276, "char_end": 348, "line": "        sql = \"INSERT INTO comment(msg_id,user_id,content,c_time) \" + \\\n"}, {"line_no": 9, "char_start": 348, "char_end": 428, "line": "                \"VALUES(%d,%d,'%s','%s');\" % (msg_id, user_id, content, c_time)\n"}, {"line_no": 10, "char_start": 428, "char_end": 456, "line": "        cursor.execute(sql)\n"}], "added": [{"line_no": 8, "char_start": 276, "char_end": 410, "line": "        cursor.execute(\"INSERT INTO comment(msg_id,user_id,content,c_time) VALUES(%s,%s,%s,%s);\", (msg_id, user_id, content, c_time))\n"}]}, "char_changes": {"deleted": [{"char_start": 285, "char_end": 290, "chars": "ql = "}, {"char_start": 342, "char_end": 365, "chars": "\" + \\\n                \""}, {"char_start": 373, "char_end": 374, "chars": "d"}, {"char_start": 376, "char_end": 377, "chars": "d"}, {"char_start": 378, "char_end": 379, "chars": "'"}, {"char_start": 381, "char_end": 382, "chars": "'"}, {"char_start": 383, "char_end": 384, "chars": "'"}, {"char_start": 386, "char_end": 387, "chars": "'"}, {"char_start": 390, "char_end": 392, "chars": " %"}, {"char_start": 427, "char_end": 454, "chars": "\n        cursor.execute(sql"}], "added": [{"char_start": 284, "char_end": 287, "chars": "cur"}, {"char_start": 288, "char_end": 299, "chars": "or.execute("}, {"char_start": 359, "char_end": 360, "chars": "s"}, {"char_start": 362, "char_end": 363, "chars": "s"}, {"char_start": 372, "char_end": 373, "chars": ","}]}}
{"func_name": "get_mod_taken_together_with", "func_src_before": "def get_mod_taken_together_with(code):\n    '''\n        Retrieves the list of modules taken together with the specified\n        module code in the same semester.\n\n        Returns a table of lists (up to 10 top results). Each list contains\n        (specified code, module code of mod taken together, aySem, number of students)\n\n        e.g. [(CS1010, CS1231, AY 16/17 Sem 1, 5)] means there are 5 students\n        taking CS1010 and CS1231 together in AY 16/17 Sem 1.\n    '''\n    NUM_TOP_RESULTS_TO_RETURN = 10\n\n    sql_command = \"SELECT sp1.moduleCode, sp2.moduleCode, sp1.acadYearAndSem, COUNT(*) \" + \\\n                \"FROM studentPlans sp1, studentPlans sp2 \" + \\\n                \"WHERE sp1.moduleCode = '\" + code + \"' AND \" + \\\n                \"sp2.moduleCode <> sp1.moduleCode AND \" + \\\n                \"sp1.studentId = sp2.studentId AND \" + \\\n                \"sp1.acadYearAndSem = sp2.acadYearAndSem \" + \\\n                \"GROUP BY sp1.moduleCode, sp2.moduleCode, sp1.acadYearAndSem \" + \\\n                \"ORDER BY COUNT(*) DESC\"\n\n    DB_CURSOR.execute(sql_command)\n\n    return DB_CURSOR.fetchmany(NUM_TOP_RESULTS_TO_RETURN)", "func_src_after": "def get_mod_taken_together_with(code):\n    '''\n        Retrieves the list of modules taken together with the specified\n        module code in the same semester.\n\n        Returns a table of lists (up to 10 top results). Each list contains\n        (specified code, module code of mod taken together, aySem, number of students)\n\n        e.g. [(CS1010, CS1231, AY 16/17 Sem 1, 5)] means there are 5 students\n        taking CS1010 and CS1231 together in AY 16/17 Sem 1.\n    '''\n    NUM_TOP_RESULTS_TO_RETURN = 10\n\n    sql_command = \"SELECT sp1.moduleCode, sp2.moduleCode, sp1.acadYearAndSem, COUNT(*) \" + \\\n                \"FROM studentPlans sp1, studentPlans sp2 \" + \\\n                \"WHERE sp1.moduleCode = %s AND \" + \\\n                \"sp2.moduleCode <> sp1.moduleCode AND \" + \\\n                \"sp1.studentId = sp2.studentId AND \" + \\\n                \"sp1.acadYearAndSem = sp2.acadYearAndSem \" + \\\n                \"GROUP BY sp1.moduleCode, sp2.moduleCode, sp1.acadYearAndSem \" + \\\n                \"ORDER BY COUNT(*) DESC\"\n\n    DB_CURSOR.execute(sql_command, (code,))\n\n    return DB_CURSOR.fetchmany(NUM_TOP_RESULTS_TO_RETURN)", "commit_link": "github.com/nus-mtp/cs-modify/commit/79b4b1dd7eba5445751808e4c50b49d2dd08366b", "file_name": "components/model.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 16, "char_start": 665, "char_end": 730, "line": "                \"WHERE sp1.moduleCode = '\" + code + \"' AND \" + \\\n"}, {"line_no": 23, "char_start": 1035, "char_end": 1070, "line": "    DB_CURSOR.execute(sql_command)\n"}], "added": [{"line_no": 16, "char_start": 665, "char_end": 718, "line": "                \"WHERE sp1.moduleCode = %s AND \" + \\\n"}, {"line_no": 23, "char_start": 1023, "char_end": 1067, "line": "    DB_CURSOR.execute(sql_command, (code,))\n"}]}, "char_changes": {"deleted": [{"char_start": 705, "char_end": 719, "chars": "'\" + code + \"'"}], "added": [{"char_start": 705, "char_end": 707, "chars": "%s"}, {"char_start": 1056, "char_end": 1065, "chars": ", (code,)"}]}}
{"func_name": "wins", "func_src_before": "@endpoints.route(\"/wins\")\ndef wins():\n    if db == None:\n        init()\n\n    player = request.args.get('tag', default=\"christmasmike\")\n    sql = \"SELECT * FROM matches WHERE winner = '\"+str(player)+\"' ORDER BY date DESC;\"\n    result = db.exec(sql)\n\n    result = [str(x) for x in result]\n    result = '\\n'.join(result)\n    return json.dumps(result)", "func_src_after": "@endpoints.route(\"/wins\")\ndef wins():\n    if db == None:\n        init()\n\n    player = request.args.get('tag', default=\"christmasmike\")\n    sql = \"SELECT * FROM matches WHERE winner = '{player}' ORDER BY date DESC;\"\n    args = {'player': player}\n    result = db.exec(sql, args)\n\n    result = [str(x) for x in result]\n    result = '\\n'.join(result)\n    return json.dumps(result)", "commit_link": "github.com/DKelle/Smash_stats/commit/4bb83f3f6ce7d6bebbeb512cd015f9e72cf36d63", "file_name": "endpoints.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 7, "char_start": 135, "char_end": 222, "line": "    sql = \"SELECT * FROM matches WHERE winner = '\"+str(player)+\"' ORDER BY date DESC;\"\n"}, {"line_no": 8, "char_start": 222, "char_end": 248, "line": "    result = db.exec(sql)\n"}], "added": [{"line_no": 7, "char_start": 135, "char_end": 215, "line": "    sql = \"SELECT * FROM matches WHERE winner = '{player}' ORDER BY date DESC;\"\n"}, {"line_no": 8, "char_start": 215, "char_end": 245, "line": "    args = {'player': player}\n"}, {"line_no": 9, "char_start": 245, "char_end": 277, "line": "    result = db.exec(sql, args)\n"}]}, "char_changes": {"deleted": [{"char_start": 184, "char_end": 190, "chars": "\"+str("}, {"char_start": 196, "char_end": 199, "chars": ")+\""}], "added": [{"char_start": 184, "char_end": 185, "chars": "{"}, {"char_start": 191, "char_end": 192, "chars": "}"}, {"char_start": 219, "char_end": 249, "chars": "args = {'player': player}\n    "}, {"char_start": 269, "char_end": 275, "chars": ", args"}]}}
{"func_name": "delete_event", "func_src_before": "    def delete_event(self, event_id):\n        sql = \"\"\"DELETE FROM events\n                 WHERE event_id = {0}\n                 \"\"\".format(event_id)\n        affected_count = self.cur.execute(sql)\n        self.conn.commit()\n        return affected_count", "func_src_after": "    def delete_event(self, event_id):\n        sql = \"\"\"\n              DELETE FROM events\n              WHERE event_id = %s\n              \"\"\"\n        affected_count = self.cur.execute(sql, (event_id,))\n        self.conn.commit()\n        return affected_count", "commit_link": "github.com/jgayfer/spirit/commit/01c846c534c8d3cf6763f8b7444a0efe2caa3799", "file_name": "db/dbase.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 2, "char_start": 38, "char_end": 74, "line": "        sql = \"\"\"DELETE FROM events\n"}, {"line_no": 3, "char_start": 74, "char_end": 112, "line": "                 WHERE event_id = {0}\n"}, {"line_no": 4, "char_start": 112, "char_end": 150, "line": "                 \"\"\".format(event_id)\n"}, {"line_no": 5, "char_start": 150, "char_end": 197, "line": "        affected_count = self.cur.execute(sql)\n"}], "added": [{"line_no": 2, "char_start": 38, "char_end": 56, "line": "        sql = \"\"\"\n"}, {"line_no": 3, "char_start": 56, "char_end": 89, "line": "              DELETE FROM events\n"}, {"line_no": 4, "char_start": 89, "char_end": 123, "line": "              WHERE event_id = %s\n"}, {"line_no": 5, "char_start": 123, "char_end": 141, "line": "              \"\"\"\n"}, {"line_no": 6, "char_start": 141, "char_end": 201, "line": "        affected_count = self.cur.execute(sql, (event_id,))\n"}]}, "char_changes": {"deleted": [{"char_start": 88, "char_end": 91, "chars": "   "}, {"char_start": 108, "char_end": 111, "chars": "{0}"}, {"char_start": 112, "char_end": 115, "chars": "   "}, {"char_start": 132, "char_end": 149, "chars": ".format(event_id)"}], "added": [{"char_start": 55, "char_end": 70, "chars": "\n              "}, {"char_start": 120, "char_end": 122, "chars": "%s"}, {"char_start": 186, "char_end": 199, "chars": ", (event_id,)"}]}}
{"func_name": "add_item", "func_src_before": "    def add_item(self, item):\n        \"\"\"\"Add new item.\"\"\"\n        if self.connection:\n            self.cursor.execute('insert into item (name, shoppinglistid) values (\"%s\", \"%s\")' % (item[0], item[1]))\n            self.connection.commit()", "func_src_after": "    def add_item(self, item):\n        \"\"\"\"Add new item.\"\"\"\n        if self.connection:\n            t = (item[0], item[1], )\n            self.cursor.execute('insert into item (name, shoppinglistid) values (?, ?)', t)\n            self.connection.commit()", "commit_link": "github.com/ecosl-developers/ecosl/commit/8af050a513338bf68ff2a243e4a2482d24e9aa3a", "file_name": "ecosldb/ecosldb.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 4, "char_start": 87, "char_end": 203, "line": "            self.cursor.execute('insert into item (name, shoppinglistid) values (\"%s\", \"%s\")' % (item[0], item[1]))\n"}], "added": [{"line_no": 4, "char_start": 87, "char_end": 124, "line": "            t = (item[0], item[1], )\n"}, {"line_no": 5, "char_start": 124, "char_end": 216, "line": "            self.cursor.execute('insert into item (name, shoppinglistid) values (?, ?)', t)\n"}]}, "char_changes": {"deleted": [{"char_start": 168, "char_end": 172, "chars": "\"%s\""}, {"char_start": 174, "char_end": 178, "chars": "\"%s\""}, {"char_start": 180, "char_end": 191, "chars": " % (item[0]"}, {"char_start": 193, "char_end": 194, "chars": "i"}, {"char_start": 195, "char_end": 201, "chars": "em[1])"}], "added": [{"char_start": 99, "char_end": 136, "chars": "t = (item[0], item[1], )\n            "}, {"char_start": 205, "char_end": 206, "chars": "?"}, {"char_start": 208, "char_end": 209, "chars": "?"}]}}
{"func_name": "fetch_issue", "func_src_before": "def fetch_issue(cursor, id):\n    \"\"\"\n    Fetch an issue by id along with its tags. Returns None if no issue\n    with the specified id exists in the database.\n    \"\"\"\n    cursor.execute(f\"\"\"\n        SELECT\n            issue.id,\n            issue.title,\n            issue.description,\n            tag.namespace,\n            tag.predicate,\n            tag.value\n        FROM\n            issue LEFT JOIN tag\n            ON issue.id = tag.issue_id\n        WHERE\n            issue.id = {id}\n    \"\"\")\n\n    issue = None\n    for row in cursor:\n        if issue is None:\n            issue = {\n                \"id\": row[\"id\"],\n                \"title\": row[\"title\"],\n                \"description\": row[\"description\"],\n                \"tags\": [],\n            }\n        # If tag exists in row, add to issue.\n        if row[\"value\"]:\n            issue[\"tags\"].append({\n                \"namespace\": row[\"namespace\"],\n                \"predicate\": row[\"predicate\"],\n                \"value\": row[\"value\"],\n            })\n\n    return issue", "func_src_after": "def fetch_issue(cursor, id):\n    \"\"\"\n    Fetch an issue by id along with its tags. Returns None if no issue\n    with the specified id exists in the database.\n    \"\"\"\n    cursor.execute(\"\"\"\n        SELECT\n            issue.id,\n            issue.title,\n            issue.description,\n            tag.namespace,\n            tag.predicate,\n            tag.value\n        FROM\n            issue LEFT JOIN tag\n            ON issue.id = tag.issue_id\n        WHERE\n            issue.id = ?\n    \"\"\", (id,))\n\n    issue = None\n    for row in cursor:\n        if issue is None:\n            issue = {\n                \"id\": row[\"id\"],\n                \"title\": row[\"title\"],\n                \"description\": row[\"description\"],\n                \"tags\": [],\n            }\n        # If tag exists in row, add to issue.\n        if row[\"value\"]:\n            issue[\"tags\"].append({\n                \"namespace\": row[\"namespace\"],\n                \"predicate\": row[\"predicate\"],\n                \"value\": row[\"value\"],\n            })\n\n    return issue", "commit_link": "github.com/nutty7t/tissue/commit/306dd094749bb39cbd5c74a6ded3d3b191033061", "file_name": "server/server.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 6, "char_start": 166, "char_end": 190, "line": "    cursor.execute(f\"\"\"\n"}, {"line_no": 18, "char_start": 457, "char_end": 485, "line": "            issue.id = {id}\n"}, {"line_no": 19, "char_start": 485, "char_end": 494, "line": "    \"\"\")\n"}], "added": [{"line_no": 6, "char_start": 166, "char_end": 189, "line": "    cursor.execute(\"\"\"\n"}, {"line_no": 18, "char_start": 456, "char_end": 481, "line": "            issue.id = ?\n"}, {"line_no": 19, "char_start": 481, "char_end": 497, "line": "    \"\"\", (id,))\n"}]}, "char_changes": {"deleted": [{"char_start": 185, "char_end": 186, "chars": "f"}, {"char_start": 480, "char_end": 484, "chars": "{id}"}], "added": [{"char_start": 479, "char_end": 480, "chars": "?"}, {"char_start": 488, "char_end": 495, "chars": ", (id,)"}]}}
{"func_name": "also_add", "func_src_before": "def also_add(name, also):\n    db = db_connect()\n    cursor = db.cursor()\n    try:\n        cursor.execute('''\n            INSERT INTO isalso(name,also) VALUES('{}','{}')\n            '''.format(name, also))\n        db.commit()\n        logger.debug('added to isalso name {} with value {}'.format(\n            name, also))\n        db.close()\n    except Exception as e:\n        logger.error('Execution failed with error: {}'.format(e))\n        raise", "func_src_after": "def also_add(name, also):\n    db = db_connect()\n    cursor = db.cursor()\n    try:\n        cursor.execute('''\n            INSERT INTO isalso(name,also) VALUES(%(name)s,%(also)s)\n            ''', (\n            name,\n            also,\n        ))\n        db.commit()\n        logger.debug('added to isalso name {} with value {}'.format(\n            name, also))\n        db.close()\n    except Exception as e:\n        logger.error('Execution failed with error: {}'.format(e))\n        raise", "commit_link": "github.com/tylarb/KarmaBoi-PCF/commit/c1d00a27d7f6b7eb6f15a3dacd4269654a32c10a", "file_name": "KarmaBoi/dbopts.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 6, "char_start": 109, "char_end": 169, "line": "            INSERT INTO isalso(name,also) VALUES('{}','{}')\n"}, {"line_no": 7, "char_start": 169, "char_end": 205, "line": "            '''.format(name, also))\n"}], "added": [{"line_no": 6, "char_start": 109, "char_end": 177, "line": "            INSERT INTO isalso(name,also) VALUES(%(name)s,%(also)s)\n"}, {"line_no": 7, "char_start": 177, "char_end": 196, "line": "            ''', (\n"}, {"line_no": 8, "char_start": 196, "char_end": 214, "line": "            name,\n"}, {"line_no": 9, "char_start": 214, "char_end": 232, "line": "            also,\n"}, {"line_no": 10, "char_start": 232, "char_end": 243, "line": "        ))\n"}]}, "char_changes": {"deleted": [{"char_start": 158, "char_end": 162, "chars": "'{}'"}, {"char_start": 163, "char_end": 167, "chars": "'{}'"}, {"char_start": 184, "char_end": 191, "chars": ".format"}], "added": [{"char_start": 158, "char_end": 166, "chars": "%(name)s"}, {"char_start": 167, "char_end": 175, "chars": "%(also)s"}, {"char_start": 192, "char_end": 194, "chars": ", "}, {"char_start": 195, "char_end": 208, "chars": "\n            "}, {"char_start": 213, "char_end": 225, "chars": "\n           "}, {"char_start": 230, "char_end": 240, "chars": ",\n        "}]}}
{"func_name": "getCommentsLike", "func_src_before": "    def getCommentsLike(self,commentid):\n        sqlText=\"select userid from comment_like where commentid=%d\"%(commentid)\n        result=sql.queryDB(self.conn,sqlText)\n        return result;", "func_src_after": "    def getCommentsLike(self,commentid):\n        sqlText=\"select userid from comment_like where commentid=%s\"\n        params=[commentid]\n        result=sql.queryDB(self.conn,sqlText,params)\n        return result;", "commit_link": "github.com/ShaominLi/Twitter_project/commit/5329d91f9e569c95184053c8e7ef596949c33ce9", "file_name": "modules/comment.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 2, "char_start": 41, "char_end": 122, "line": "        sqlText=\"select userid from comment_like where commentid=%d\"%(commentid)\n"}, {"line_no": 3, "char_start": 122, "char_end": 168, "line": "        result=sql.queryDB(self.conn,sqlText)\n"}], "added": [{"line_no": 2, "char_start": 41, "char_end": 110, "line": "        sqlText=\"select userid from comment_like where commentid=%s\"\n"}, {"line_no": 3, "char_start": 110, "char_end": 137, "line": "        params=[commentid]\n"}, {"line_no": 4, "char_start": 137, "char_end": 190, "line": "        result=sql.queryDB(self.conn,sqlText,params)\n"}]}, "char_changes": {"deleted": [{"char_start": 107, "char_end": 108, "chars": "d"}, {"char_start": 109, "char_end": 111, "chars": "%("}, {"char_start": 120, "char_end": 121, "chars": ")"}], "added": [{"char_start": 107, "char_end": 108, "chars": "s"}, {"char_start": 109, "char_end": 126, "chars": "\n        params=["}, {"char_start": 135, "char_end": 136, "chars": "]"}, {"char_start": 181, "char_end": 188, "chars": ",params"}]}}
{"func_name": "update_theory_base", "func_src_before": "def update_theory_base(tag, link):\n    theory = sqlite3.connect(os.path.abspath(os.path.dirname(__file__)) + \"\\\\theory.db\")\n    conn = theory.cursor()\n    conn.execute(\"insert into \" + str(tag) + \" values (?)\", (str(link), ))\n    theory.commit()\n    theory.close()", "func_src_after": "def update_theory_base(tag, link):\n    theory = sqlite3.connect(os.path.abspath(os.path.dirname(__file__)) + \"\\\\theory.db\")\n    conn = theory.cursor()\n    conn.execute(\"insert into ? values (?)\", (tag, str(link)))\n    theory.commit()\n    theory.close()", "commit_link": "github.com/lissrbay/codeforces_bot/commit/cc7f5143445a0030b1149ac60a65b1b1b9c92a90", "file_name": "bases/update.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 4, "char_start": 151, "char_end": 226, "line": "    conn.execute(\"insert into \" + str(tag) + \" values (?)\", (str(link), ))\n"}], "added": [{"line_no": 4, "char_start": 151, "char_end": 214, "line": "    conn.execute(\"insert into ? values (?)\", (tag, str(link)))\n"}]}, "char_changes": {"deleted": [{"char_start": 181, "char_end": 197, "chars": "\" + str(tag) + \""}, {"char_start": 221, "char_end": 223, "chars": ", "}], "added": [{"char_start": 181, "char_end": 182, "chars": "?"}, {"char_start": 197, "char_end": 202, "chars": "tag, "}]}}
{"func_name": "get_asset_and_volume", "func_src_before": "@app.route('/get_asset_and_volume')\ndef get_asset_and_volume():\n    asset_id = request.args.get('asset_id')\n\n    if not isObject(asset_id):\n        ws.send('{\"id\":1, \"method\":\"call\", \"params\":[0,\"lookup_asset_symbols\",[[\"' + asset_id + '\"], 0]]}')\n        result_l = ws.recv()\n        j_l = json.loads(result_l)\n        asset_id = j_l[\"result\"][0][\"id\"]\n\n    #print asset_id\n    ws.send('{\"id\":1, \"method\":\"call\", \"params\":[0,\"get_assets\",[[\"' + asset_id + '\"], 0]]}')\n    result = ws.recv()\n    j = json.loads(result)\n\n    dynamic_asset_data_id =  j[\"result\"][0][\"dynamic_asset_data_id\"]\n\n    ws.send('{\"id\": 1, \"method\": \"call\", \"params\": [0, \"get_objects\", [[\"'+dynamic_asset_data_id+'\"]]]}')\n    result2 = ws.recv()\n    j2 = json.loads(result2)\n    #print j2[\"result\"][0][\"current_supply\"]\n\n    j[\"result\"][0][\"current_supply\"] = j2[\"result\"][0][\"current_supply\"]\n    j[\"result\"][0][\"confidential_supply\"] = j2[\"result\"][0][\"confidential_supply\"]\n    #print j[\"result\"]\n\n    j[\"result\"][0][\"accumulated_fees\"] = j2[\"result\"][0][\"accumulated_fees\"]\n    j[\"result\"][0][\"fee_pool\"] = j2[\"result\"][0][\"fee_pool\"]\n\n    issuer = j[\"result\"][0][\"issuer\"]\n    ws.send('{\"id\": 1, \"method\": \"call\", \"params\": [0, \"get_objects\", [[\"'+issuer+'\"]]]}')\n    result3 = ws.recv()\n    j3 = json.loads(result3)\n    j[\"result\"][0][\"issuer_name\"] = j3[\"result\"][0][\"name\"]\n\n\n    con = psycopg2.connect(**config.POSTGRES)\n    cur = con.cursor()\n\n    query = \"SELECT volume, mcap FROM assets WHERE aid='\"+asset_id+\"'\"\n    cur.execute(query)\n    results = cur.fetchall()\n    con.close()\n    try:\n        j[\"result\"][0][\"volume\"] = results[0][0]\n        j[\"result\"][0][\"mcap\"] = results[0][1]\n    except:\n        j[\"result\"][0][\"volume\"] = 0\n        j[\"result\"][0][\"mcap\"] = 0\n\n    return jsonify(j[\"result\"])", "func_src_after": "@app.route('/get_asset_and_volume')\ndef get_asset_and_volume():\n    asset_id = request.args.get('asset_id')\n\n    if not isObject(asset_id):\n        ws.send('{\"id\":1, \"method\":\"call\", \"params\":[0,\"lookup_asset_symbols\",[[\"' + asset_id + '\"], 0]]}')\n        result_l = ws.recv()\n        j_l = json.loads(result_l)\n        asset_id = j_l[\"result\"][0][\"id\"]\n\n    #print asset_id\n    ws.send('{\"id\":1, \"method\":\"call\", \"params\":[0,\"get_assets\",[[\"' + asset_id + '\"], 0]]}')\n    result = ws.recv()\n    j = json.loads(result)\n\n    dynamic_asset_data_id =  j[\"result\"][0][\"dynamic_asset_data_id\"]\n\n    ws.send('{\"id\": 1, \"method\": \"call\", \"params\": [0, \"get_objects\", [[\"'+dynamic_asset_data_id+'\"]]]}')\n    result2 = ws.recv()\n    j2 = json.loads(result2)\n    #print j2[\"result\"][0][\"current_supply\"]\n\n    j[\"result\"][0][\"current_supply\"] = j2[\"result\"][0][\"current_supply\"]\n    j[\"result\"][0][\"confidential_supply\"] = j2[\"result\"][0][\"confidential_supply\"]\n    #print j[\"result\"]\n\n    j[\"result\"][0][\"accumulated_fees\"] = j2[\"result\"][0][\"accumulated_fees\"]\n    j[\"result\"][0][\"fee_pool\"] = j2[\"result\"][0][\"fee_pool\"]\n\n    issuer = j[\"result\"][0][\"issuer\"]\n    ws.send('{\"id\": 1, \"method\": \"call\", \"params\": [0, \"get_objects\", [[\"'+issuer+'\"]]]}')\n    result3 = ws.recv()\n    j3 = json.loads(result3)\n    j[\"result\"][0][\"issuer_name\"] = j3[\"result\"][0][\"name\"]\n\n\n    con = psycopg2.connect(**config.POSTGRES)\n    cur = con.cursor()\n\n    query = \"SELECT volume, mcap FROM assets WHERE aid=%s\"\n    cur.execute(query, (asset_id,))\n    results = cur.fetchall()\n    con.close()\n    try:\n        j[\"result\"][0][\"volume\"] = results[0][0]\n        j[\"result\"][0][\"mcap\"] = results[0][1]\n    except:\n        j[\"result\"][0][\"volume\"] = 0\n        j[\"result\"][0][\"mcap\"] = 0\n\n    return jsonify(j[\"result\"])", "commit_link": "github.com/VinChain/vinchain-python-api-backend/commit/b78088a551fbb712121269c6eb7f43ede120ff60", "file_name": "api.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 40, "char_start": 1428, "char_end": 1499, "line": "    query = \"SELECT volume, mcap FROM assets WHERE aid='\"+asset_id+\"'\"\n"}, {"line_no": 41, "char_start": 1499, "char_end": 1522, "line": "    cur.execute(query)\n"}], "added": [{"line_no": 40, "char_start": 1428, "char_end": 1487, "line": "    query = \"SELECT volume, mcap FROM assets WHERE aid=%s\"\n"}, {"line_no": 41, "char_start": 1487, "char_end": 1523, "line": "    cur.execute(query, (asset_id,))\n"}]}, "char_changes": {"deleted": [{"char_start": 1483, "char_end": 1487, "chars": "'\"+a"}, {"char_start": 1488, "char_end": 1497, "chars": "set_id+\"'"}], "added": [{"char_start": 1483, "char_end": 1484, "chars": "%"}, {"char_start": 1508, "char_end": 1521, "chars": ", (asset_id,)"}]}}
{"func_name": "reportMatch", "func_src_before": "def reportMatch(winner, loser):\n    \"\"\"Records the outcome of a single match between two players.\n\n    Args:\n      winner:  the id number of the player who won\n      loser:  the id number of the player who lost\n    \"\"\"\n    try:\n        int(winner)\n        int(loser)\n    except ValueError:\n        raise ValueError(\n            \"\\\"winner\\\" and/or \\\"loser\\\" input are not integers.\\n\"\n            \"Please use the id number of each player to report match results.\"\n        )\n    w = str(winner)\n    l = str(loser)\n    db = connect()\n    c = db.cursor()\n    statement = \"INSERT INTO matches values ({w}, {l})\".format(w=w, l=l)\n    c.execute(statement)\n    db.commit()\n    db.close()", "func_src_after": "def reportMatch(winner, loser):\n    \"\"\"Records the outcome of a single match between two players.\n\n    Args:\n      winner:  the id number of the player who won\n      loser:  the id number of the player who lost\n    \"\"\"\n    try:\n        int(winner)\n        int(loser)\n    except ValueError:\n        raise ValueError(\n            \"\\\"winner\\\" and/or \\\"loser\\\" input are not integers.\\n\"\n            \"Please use the id number of each player to report match results.\"\n        )\n    w = str(winner)\n    l = str(loser)\n    db = connect()\n    c = db.cursor()\n    c.execute(\"INSERT INTO matches values (%s, %s)\", (w,l))\n    db.commit()\n    db.close()", "commit_link": "github.com/tdnelson2/tournament-db/commit/00f3caeed0e12e806c2808d100908698777d9e98", "file_name": "tournament.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 20, "char_start": 551, "char_end": 624, "line": "    statement = \"INSERT INTO matches values ({w}, {l})\".format(w=w, l=l)\n"}, {"line_no": 21, "char_start": 624, "char_end": 649, "line": "    c.execute(statement)\n"}], "added": [{"line_no": 20, "char_start": 551, "char_end": 611, "line": "    c.execute(\"INSERT INTO matches values (%s, %s)\", (w,l))\n"}]}, "char_changes": {"deleted": [{"char_start": 555, "char_end": 559, "chars": "stat"}, {"char_start": 560, "char_end": 561, "chars": "m"}, {"char_start": 562, "char_end": 563, "chars": "n"}, {"char_start": 564, "char_end": 567, "chars": " = "}, {"char_start": 596, "char_end": 599, "chars": "{w}"}, {"char_start": 601, "char_end": 604, "chars": "{l}"}, {"char_start": 606, "char_end": 613, "chars": ".format"}, {"char_start": 615, "char_end": 617, "chars": "=w"}, {"char_start": 618, "char_end": 621, "chars": " l="}, {"char_start": 623, "char_end": 647, "chars": "\n    c.execute(statement"}], "added": [{"char_start": 555, "char_end": 557, "chars": "c."}, {"char_start": 558, "char_end": 559, "chars": "x"}, {"char_start": 560, "char_end": 562, "chars": "cu"}, {"char_start": 563, "char_end": 565, "chars": "e("}, {"char_start": 594, "char_end": 596, "chars": "%s"}, {"char_start": 598, "char_end": 600, "chars": "%s"}, {"char_start": 602, "char_end": 604, "chars": ", "}]}}
{"func_name": "getPlayer", "func_src_before": "def getPlayer(player):\n\tdb.execute(\"SELECT * FROM players WHERE Name = '%s' COLLATE NOCASE\" % player)\n\tplayerstats = dict(db.fetchone())\n\treturn playerstats", "func_src_after": "def getPlayer(player):\n\tdb.execute(\"SELECT * FROM players WHERE Name = ? COLLATE NOCASE\", player)\n\tplayerstats = dict(db.fetchone())\n\treturn playerstats", "commit_link": "github.com/iScrE4m/XLeague/commit/59cab6e5fd8bd5e47f2418a7c71cb1d4e3cad0d2", "file_name": "plugins/database.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 2, "char_start": 23, "char_end": 102, "line": "\tdb.execute(\"SELECT * FROM players WHERE Name = '%s' COLLATE NOCASE\" % player)\n"}], "added": [{"line_no": 2, "char_start": 23, "char_end": 98, "line": "\tdb.execute(\"SELECT * FROM players WHERE Name = ? COLLATE NOCASE\", player)\n"}]}, "char_changes": {"deleted": [{"char_start": 71, "char_end": 75, "chars": "'%s'"}, {"char_start": 91, "char_end": 93, "chars": " %"}], "added": [{"char_start": 71, "char_end": 72, "chars": "?"}, {"char_start": 88, "char_end": 89, "chars": ","}]}}
{"func_name": "karma_sub", "func_src_before": "def karma_sub(name):\n    karma = karma_ask(name)\n    db = db_connect()\n    cursor = db.cursor()\n    if karma is None:\n        try:\n            cursor.execute('''\n                INSERT INTO people(name,karma,shame) VALUES('{}',-1,0)\n                '''.format(name))\n            db.commit()\n            logger.debug('Inserted into karmadb -1 karma for {}'.format(name))\n            db.close()\n            return -1\n\n        except Exception as e:\n            logger.error('Execution failed with error: {}'.format(e))\n            raise\n    else:\n        karma = karma - 1\n        try:\n            cursor.execute('''\n                UPDATE people SET karma = {0} WHERE name = '{1}'\n                '''.format(karma, name))\n            db.commit()\n            logger.debug('Inserted into karmadb -1 karma for {}'.format(name))\n            db.close()\n            return karma\n        except Exception as e:\n            logger.error('Execution failed with error: {}'.format(e))\n            raise", "func_src_after": "def karma_sub(name):\n    karma = karma_ask(name)\n    db = db_connect()\n    cursor = db.cursor()\n    if karma is None:\n        try:\n            cursor.execute('''\n                INSERT INTO people(name,karma,shame) VALUES(%(name)s,-1,0)\n                ''', (name, ))\n            db.commit()\n            logger.debug('Inserted into karmadb -1 karma for {}'.format(name))\n            db.close()\n            return -1\n\n        except Exception as e:\n            logger.error('Execution failed with error: {}'.format(e))\n            raise\n    else:\n        karma = karma - 1\n        try:\n            cursor.execute('''\n                UPDATE people SET karma = %(karma)s WHERE name = %(name)s\n                ''', (\n                karma,\n                name,\n            ))\n            db.commit()\n            logger.debug('Inserted into karmadb -1 karma for {}'.format(name))\n            db.close()\n            return karma\n        except Exception as e:\n            logger.error('Execution failed with error: {}'.format(e))\n            raise", "commit_link": "github.com/tylarb/KarmaBoi-PCF/commit/c1d00a27d7f6b7eb6f15a3dacd4269654a32c10a", "file_name": "KarmaBoi/dbopts.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 8, "char_start": 162, "char_end": 233, "line": "                INSERT INTO people(name,karma,shame) VALUES('{}',-1,0)\n"}, {"line_no": 9, "char_start": 233, "char_end": 267, "line": "                '''.format(name))\n"}, {"line_no": 22, "char_start": 615, "char_end": 680, "line": "                UPDATE people SET karma = {0} WHERE name = '{1}'\n"}, {"line_no": 23, "char_start": 680, "char_end": 721, "line": "                '''.format(karma, name))\n"}], "added": [{"line_no": 8, "char_start": 162, "char_end": 237, "line": "                INSERT INTO people(name,karma,shame) VALUES(%(name)s,-1,0)\n"}, {"line_no": 9, "char_start": 237, "char_end": 268, "line": "                ''', (name, ))\n"}, {"line_no": 22, "char_start": 616, "char_end": 690, "line": "                UPDATE people SET karma = %(karma)s WHERE name = %(name)s\n"}, {"line_no": 23, "char_start": 690, "char_end": 713, "line": "                ''', (\n"}, {"line_no": 24, "char_start": 713, "char_end": 736, "line": "                karma,\n"}, {"line_no": 25, "char_start": 736, "char_end": 758, "line": "                name,\n"}, {"line_no": 26, "char_start": 758, "char_end": 773, "line": "            ))\n"}]}, "char_changes": {"deleted": [{"char_start": 222, "char_end": 226, "chars": "'{}'"}, {"char_start": 252, "char_end": 259, "chars": ".format"}, {"char_start": 657, "char_end": 660, "chars": "{0}"}, {"char_start": 674, "char_end": 679, "chars": "'{1}'"}, {"char_start": 699, "char_end": 706, "chars": ".format"}], "added": [{"char_start": 222, "char_end": 230, "chars": "%(name)s"}, {"char_start": 256, "char_end": 258, "chars": ", "}, {"char_start": 263, "char_end": 265, "chars": ", "}, {"char_start": 658, "char_end": 667, "chars": "%(karma)s"}, {"char_start": 681, "char_end": 689, "chars": "%(name)s"}, {"char_start": 709, "char_end": 711, "chars": ", "}, {"char_start": 712, "char_end": 729, "chars": "\n                "}, {"char_start": 735, "char_end": 751, "chars": "\n               "}, {"char_start": 756, "char_end": 770, "chars": ",\n            "}]}}
{"func_name": "login", "func_src_before": "@app.route('/', methods=['POST'])\ndef login():\n    print('login')\n    user = str(request.form['username'])\n    password = str(request.form['password'])\n    cur.execute('SELECT * FROM users WHERE name = \\'{}\\' AND password = \\'{}\\';'.format(user, password))\n    response = cur.fetchone()\n    if response != None:\n        print(response, 'OK')\n        return redirect(url_for('enter_test_point'))\n    else:\n        print(response, 'not OK')\n        flash('Invalid login or password')\n        return render_template('login.html')", "func_src_after": "@app.route('/', methods=['POST'])\ndef login():\n    print('login')\n    user = str(request.form['username'])\n    password = str(request.form['password'])\n    cur.execute(\"SELECT * FROM users WHERE name = ? AND password = ?;\", [user, password])\n    response = cur.fetchone()\n    if response != None:\n        print(response, 'OK')\n        return redirect(url_for('enter_test_point'))\n    else:\n        print(response, 'not OK')\n        flash('Invalid login or password')\n        return render_template('login.html')", "commit_link": "github.com/ChemiKyle/Waterspots/commit/3f9d5099496336f3f34c48abf0cf55acaaa29011", "file_name": "app.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 6, "char_start": 152, "char_end": 257, "line": "    cur.execute('SELECT * FROM users WHERE name = \\'{}\\' AND password = \\'{}\\';'.format(user, password))\n"}], "added": [{"line_no": 6, "char_start": 152, "char_end": 242, "line": "    cur.execute(\"SELECT * FROM users WHERE name = ? AND password = ?;\", [user, password])\n"}]}, "char_changes": {"deleted": [{"char_start": 168, "char_end": 169, "chars": "'"}, {"char_start": 202, "char_end": 208, "chars": "\\'{}\\'"}, {"char_start": 224, "char_end": 230, "chars": "\\'{}\\'"}, {"char_start": 231, "char_end": 240, "chars": "'.format("}, {"char_start": 254, "char_end": 255, "chars": ")"}], "added": [{"char_start": 168, "char_end": 169, "chars": "\""}, {"char_start": 202, "char_end": 203, "chars": "?"}, {"char_start": 219, "char_end": 220, "chars": "?"}, {"char_start": 221, "char_end": 225, "chars": "\", ["}, {"char_start": 239, "char_end": 240, "chars": "]"}]}}
{"func_name": "fetch_data", "func_src_before": "    def fetch_data(self, session, id):\n        self._openContainer(session)\n        sid = str(id)\n        if (self.idNormalizer is not None):\n            sid = self.idNormalizer.process_string(session, sid)\n        query = (\"SELECT data FROM %s WHERE identifier = '%s';\" %\n                 (self.table, sid)\n                 )\n        res = self._query(query)\n        try:\n            data = res.dictresult()[0]['data']\n        except IndexError:\n            raise ObjectDoesNotExistException(id)\n        try:\n            ndata = pg.unescape_bytea(data)\n        except:\n            # insufficient PyGreSQL version\n            ndata = data.replace(\"\\\\'\", \"'\")\n\n        ndata = ndata.replace('\\\\000\\\\001', nonTextToken)\n        ndata = ndata.replace('\\\\012', '\\n')\n        return ndata", "func_src_after": "    def fetch_data(self, session, id):\n        self._openContainer(session)\n        sid = str(id)\n        if (self.idNormalizer is not None):\n            sid = self.idNormalizer.process_string(session, sid)\n        query = (\"SELECT data FROM %s WHERE identifier = $1;\" %\n                 (self.table)\n                 )\n        res = self._query(query, sid)\n        try:\n            data = res.dictresult()[0]['data']\n        except IndexError:\n            raise ObjectDoesNotExistException(id)\n        try:\n            ndata = pg.unescape_bytea(data)\n        except:\n            # insufficient PyGreSQL version\n            ndata = data.replace(\"\\\\'\", \"'\")\n\n        ndata = ndata.replace('\\\\000\\\\001', nonTextToken)\n        ndata = ndata.replace('\\\\012', '\\n')\n        return ndata", "commit_link": "github.com/cheshire3/cheshire3/commit/d350363b4ea10f102c24c8f26d7b76b006323e8e", "file_name": "cheshire3/sql/postgresStore.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 6, "char_start": 207, "char_end": 273, "line": "        query = (\"SELECT data FROM %s WHERE identifier = '%s';\" %\n"}, {"line_no": 7, "char_start": 273, "char_end": 308, "line": "                 (self.table, sid)\n"}, {"line_no": 9, "char_start": 327, "char_end": 360, "line": "        res = self._query(query)\n"}], "added": [{"line_no": 6, "char_start": 207, "char_end": 271, "line": "        query = (\"SELECT data FROM %s WHERE identifier = $1;\" %\n"}, {"line_no": 7, "char_start": 271, "char_end": 301, "line": "                 (self.table)\n"}, {"line_no": 9, "char_start": 320, "char_end": 358, "line": "        res = self._query(query, sid)\n"}]}, "char_changes": {"deleted": [{"char_start": 264, "char_end": 268, "chars": "'%s'"}, {"char_start": 301, "char_end": 306, "chars": ", sid"}], "added": [{"char_start": 264, "char_end": 266, "chars": "$1"}, {"char_start": 351, "char_end": 356, "chars": ", sid"}]}}
{"func_name": "registerPlayer", "func_src_before": "def registerPlayer(name):\n    \"\"\"Adds a player to the tournament database.\n\n    The database assigns a unique serial id number for the player.  (This\n    should be handled by your SQL database schema, not in your Python code.)\n\n    Args:\n      name: the player's full name (need not be unique).\n    \"\"\"\n    conn = connect()\n    cursor = conn.cursor()\n    cursor.execute(\"INSERT INTO players (name) VALUES ('%s')\" % (name,));\n    conn.commit()\n    conn.close()", "func_src_after": "def registerPlayer(name):\n    \"\"\"Adds a player to the tournament database.\n\n    The database assigns a unique serial id number for the player.  (This\n    should be handled by your SQL database schema, not in your Python code.)\n\n    Args:\n      name: the player's full name (need not be unique).\n    \"\"\"\n    conn = connect()\n    cursor = conn.cursor()\n    query = \"INSERT INTO players (name) VALUES (%s);\"\n    cursor.execute(query, (name,))\n    conn.commit()\n    conn.close()", "commit_link": "github.com/sarahkcaplan/tournament/commit/40aba5686059f5f398f6323b1483412c56140cc0", "file_name": "tournament.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 12, "char_start": 351, "char_end": 425, "line": "    cursor.execute(\"INSERT INTO players (name) VALUES ('%s')\" % (name,));\n"}], "added": [{"line_no": 12, "char_start": 351, "char_end": 405, "line": "    query = \"INSERT INTO players (name) VALUES (%s);\"\n"}, {"line_no": 13, "char_start": 405, "char_end": 440, "line": "    cursor.execute(query, (name,))\n"}]}, "char_changes": {"deleted": [{"char_start": 355, "char_end": 356, "chars": "c"}, {"char_start": 357, "char_end": 360, "chars": "rso"}, {"char_start": 361, "char_end": 370, "chars": ".execute("}, {"char_start": 406, "char_end": 407, "chars": "'"}, {"char_start": 409, "char_end": 410, "chars": "'"}, {"char_start": 413, "char_end": 414, "chars": "%"}, {"char_start": 423, "char_end": 424, "chars": ";"}], "added": [{"char_start": 355, "char_end": 356, "chars": "q"}, {"char_start": 358, "char_end": 363, "chars": "ry = "}, {"char_start": 402, "char_end": 403, "chars": ";"}, {"char_start": 404, "char_end": 405, "chars": "\n"}, {"char_start": 406, "char_end": 430, "chars": "   cursor.execute(query,"}]}}
{"func_name": "register", "func_src_before": "@mod.route('/register', methods=['GET', 'POST'])\ndef register():\n    if request.method == 'POST':\n        error = None\n        email = request.form['email'].strip()\n        nickname = request.form['nickname'].strip()\n        password = request.form['password'].strip()\n        password2 = request.form['password2'].strip()\n\n        email = email.lower()\n\n        if email == \"\" or nickname == \"\" or password == \"\" or password2 == \"\":\n            error = 'Please input all the information'\n        elif password2 != password:\n            error = 'The password is not repeated correctly'\n        elif len(password) < 6:\n            error = 'The password has at least 6 characters'\n        elif not re.match(r'^[0-9a-zA-Z_]{0,19}@' +\n                          '[0-9a-zA-Z]{1,15}\\.[com,cn,net]', email):\n            error = 'Please input the right email'\n\n        sql = \"SELECT * FROM users where email = '%s';\" % (email)\n        cursor.execute(sql)\n        u = cursor.fetchone()\n\n        if u is not None:\n            error = 'The email has already exsit'\n\n        if error is not None:\n            return render_template('register.html', error=error)\n        else:\n            password = bcrypt.generate_password_hash(password)\n            cursor.execute(\"INSERT INTO users(email,nickname,password) VALUES(%s,%s,%s);\", (email, nickname, password))\n            conn.commit()\n            flash('Register Success!')\n            return redirect(url_for('users.login'))\n\n    return render_template('register.html')", "func_src_after": "@mod.route('/register', methods=['GET', 'POST'])\ndef register():\n    if request.method == 'POST':\n        error = None\n        email = request.form['email'].strip()\n        nickname = request.form['nickname'].strip()\n        password = request.form['password'].strip()\n        password2 = request.form['password2'].strip()\n\n        email = email.lower()\n\n        if email == \"\" or nickname == \"\" or password == \"\" or password2 == \"\":\n            error = 'Please input all the information'\n        elif password2 != password:\n            error = 'The password is not repeated correctly'\n        elif len(password) < 6:\n            error = 'The password has at least 6 characters'\n        elif not re.match(r'^[0-9a-zA-Z_]{0,19}@' +\n                          '[0-9a-zA-Z]{1,15}\\.[com,cn,net]', email):\n            error = 'Please input the right email'\n\n        cursor.execute(\"SELECT * FROM users where email = %s;\", (email,))\n        u = cursor.fetchone()\n\n        if u is not None:\n            error = 'The email has already exsit'\n\n        if error is not None:\n            return render_template('register.html', error=error)\n        else:\n            password = bcrypt.generate_password_hash(password)\n            cursor.execute(\"INSERT INTO users(email,nickname,password) VALUES(%s,%s,%s);\", (email, nickname, password))\n            conn.commit()\n            flash('Register Success!')\n            return redirect(url_for('users.login'))\n\n    return render_template('register.html')", "commit_link": "github.com/ulyssetsd/bjtu-sql/commit/17d7b21864b72ba5666f15236474a93268b32ec9", "file_name": "flaskr/flaskr/views/users.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 22, "char_start": 852, "char_end": 918, "line": "        sql = \"SELECT * FROM users where email = '%s';\" % (email)\n"}, {"line_no": 23, "char_start": 918, "char_end": 946, "line": "        cursor.execute(sql)\n"}], "added": [{"line_no": 22, "char_start": 852, "char_end": 926, "line": "        cursor.execute(\"SELECT * FROM users where email = %s;\", (email,))\n"}]}, "char_changes": {"deleted": [{"char_start": 861, "char_end": 866, "chars": "ql = "}, {"char_start": 901, "char_end": 902, "chars": "'"}, {"char_start": 904, "char_end": 905, "chars": "'"}, {"char_start": 907, "char_end": 909, "chars": " %"}, {"char_start": 917, "char_end": 944, "chars": "\n        cursor.execute(sql"}], "added": [{"char_start": 860, "char_end": 863, "chars": "cur"}, {"char_start": 864, "char_end": 875, "chars": "or.execute("}, {"char_start": 914, "char_end": 915, "chars": ","}, {"char_start": 922, "char_end": 923, "chars": ","}]}}
{"func_name": "process_form", "func_src_before": "def process_form():\n    # see https://docs.python.org/3.4/library/cgi.html for the basic usage\n    # here.\n    form = cgi.FieldStorage()\n\n\n    # connect to the database\n    conn = MySQLdb.connect(host   = pnsdp.SQL_HOST,\n                           user   = pnsdp.SQL_USER,\n                           passwd = pnsdp.SQL_PASSWD,\n                           db     = pnsdp.SQL_DB)\n\n\n    if \"user\" not in form or \"game\" not in form:\n        raise FormError(\"Invalid parameters.\")\n    if \"pos\" not in form and \"resign\" not in form:\n        raise FormError(\"Invalid parameters.\")\n\n    game = int(form[\"game\"].value)\n\n\n    (players,size,state) = get_game_info(conn, game)\n\n    user = form[\"user\"].value\n    if user not in players:\n        raise FormError(\"Invalid player ID - player is not part of this game\")\n\n\n    if \"resign\" in form:\n        resign = True\n    else:\n        resign = False\n        pos = form[\"pos\"].value.split(\",\")\n        assert len(pos) == 2\n        x = int(pos[0])\n        y = int(pos[1])\n\n\n    (board,nextPlayer,letter) = build_board(conn, game,size)\n\n    if user != players[nextPlayer]:\n        raise FormError(\"Internal error, incorrect player is attempting to move.\")\n\n\n    if resign:\n        # this user is choosing to resign.  Update the game state to reflect that.\n        other_player_name = players[1-nextPlayer]\n\n        cursor = conn.cursor()\n        cursor.execute(\"\"\"UPDATE games SET state=\"%s:resignation\" WHERE id=%d;\"\"\" % (other_player_name,game))\n        cursor.close()\n\n    else:\n        assert x >= 0 and x < size\n        assert y >= 0 and y < size\n\n        assert board[x][y] == \"\"\n        board[x][y] = \"XO\"[nextPlayer]\n\n        # we've done all of our sanity checks.  We now know enough to say that\n        # it's safe to add a new move.\n        cursor = conn.cursor()\n        cursor.execute(\"\"\"INSERT INTO moves(gameID,x,y,letter,time) VALUES(%d,%d,%d,\"%s\",NOW());\"\"\" % (game,x,y,letter))\n\n        if cursor.rowcount != 1:\n            raise FormError(\"Could not make move, reason unknown.\")\n\n        cursor.close()\n\n        result = analyze_board(board)\n        if result != \"\":\n            if result == \"win\":\n                result = players[nextPlayer]+\":win\"\n\n            cursor = conn.cursor()\n            cursor.execute(\"\"\"UPDATE games SET state=\"%s\" WHERE id=%d;\"\"\" % (result,game))\n            cursor.close()\n\n    # we've made changes, make sure to commit them!\n    conn.commit()\n    conn.close()\n\n\n    # return the parms to the caller, so that they can build a good redirect\n    return (user,game)", "func_src_after": "def process_form():\n    # see https://docs.python.org/3.4/library/cgi.html for the basic usage\n    # here.\n    form = cgi.FieldStorage()\n\n\n    # connect to the database\n    conn = MySQLdb.connect(host   = pnsdp.SQL_HOST,\n                           user   = pnsdp.SQL_USER,\n                           passwd = pnsdp.SQL_PASSWD,\n                           db     = pnsdp.SQL_DB)\n\n\n    if \"user\" not in form or \"game\" not in form:\n        raise FormError(\"Invalid parameters.\")\n    if \"pos\" not in form and \"resign\" not in form:\n        raise FormError(\"Invalid parameters.\")\n\n    game = int(form[\"game\"].value)\n\n\n    (players,size,state) = get_game_info(conn, game)\n\n    user = form[\"user\"].value\n    if user not in players:\n        raise FormError(\"Invalid player ID - player is not part of this game\")\n\n\n    if \"resign\" in form:\n        resign = True\n    else:\n        resign = False\n        pos = form[\"pos\"].value.split(\",\")\n        assert len(pos) == 2\n        x = int(pos[0])\n        y = int(pos[1])\n\n\n    (board,nextPlayer,letter) = build_board(conn, game,size)\n\n    if user != players[nextPlayer]:\n        raise FormError(\"Internal error, incorrect player is attempting to move.\")\n\n\n    if resign:\n        # this user is choosing to resign.  Update the game state to reflect that.\n        other_player_name = players[1-nextPlayer]\n\n        cursor = conn.cursor()\n        cursor.execute(\"\"\"UPDATE games SET state=\"%s:resignation\" WHERE id=%d;\"\"\", (other_player_name,game))\n        cursor.close()\n\n    else:\n        assert x >= 0 and x < size\n        assert y >= 0 and y < size\n\n        assert board[x][y] == \"\"\n        board[x][y] = \"XO\"[nextPlayer]\n\n        # we've done all of our sanity checks.  We now know enough to say that\n        # it's safe to add a new move.\n        cursor = conn.cursor()\n        cursor.execute(\"\"\"INSERT INTO moves(gameID,x,y,letter,time) VALUES(%d,%d,%d,\"%s\",NOW());\"\"\", (game,x,y,letter))\n\n        if cursor.rowcount != 1:\n            raise FormError(\"Could not make move, reason unknown.\")\n\n        cursor.close()\n\n        result = analyze_board(board)\n        if result != \"\":\n            if result == \"win\":\n                result = players[nextPlayer]+\":win\"\n\n            cursor = conn.cursor()\n            cursor.execute(\"\"\"UPDATE games SET state=\"%s\" WHERE id=%d;\"\"\", (result,game))\n            cursor.close()\n\n    # we've made changes, make sure to commit them!\n    conn.commit()\n    conn.close()\n\n\n    # return the parms to the caller, so that they can build a good redirect\n    return (user,game)", "commit_link": "github.com/russ-lewis/ttt_-_python_cgi/commit/6096f43fd4b2d91211eec4614b7960c0816900da", "file_name": "cgi/move.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 50, "char_start": 1369, "char_end": 1479, "line": "        cursor.execute(\"\"\"UPDATE games SET state=\"%s:resignation\" WHERE id=%d;\"\"\" % (other_player_name,game))\n"}, {"line_no": 63, "char_start": 1806, "char_end": 1927, "line": "        cursor.execute(\"\"\"INSERT INTO moves(gameID,x,y,letter,time) VALUES(%d,%d,%d,\"%s\",NOW());\"\"\" % (game,x,y,letter))\n"}, {"line_no": 76, "char_start": 2237, "char_end": 2328, "line": "            cursor.execute(\"\"\"UPDATE games SET state=\"%s\" WHERE id=%d;\"\"\" % (result,game))\n"}], "added": [{"line_no": 50, "char_start": 1369, "char_end": 1478, "line": "        cursor.execute(\"\"\"UPDATE games SET state=\"%s:resignation\" WHERE id=%d;\"\"\", (other_player_name,game))\n"}, {"line_no": 63, "char_start": 1805, "char_end": 1925, "line": "        cursor.execute(\"\"\"INSERT INTO moves(gameID,x,y,letter,time) VALUES(%d,%d,%d,\"%s\",NOW());\"\"\", (game,x,y,letter))\n"}, {"line_no": 76, "char_start": 2235, "char_end": 2325, "line": "            cursor.execute(\"\"\"UPDATE games SET state=\"%s\" WHERE id=%d;\"\"\", (result,game))\n"}]}, "char_changes": {"deleted": [{"char_start": 1450, "char_end": 1452, "chars": " %"}, {"char_start": 1905, "char_end": 1907, "chars": " %"}, {"char_start": 2310, "char_end": 2312, "chars": " %"}], "added": [{"char_start": 1450, "char_end": 1451, "chars": ","}, {"char_start": 1904, "char_end": 1905, "chars": ","}, {"char_start": 2308, "char_end": 2309, "chars": ","}]}}
{"func_name": "load_user", "func_src_before": "@login_manager.user_loader\ndef load_user(s_id):\n    email = str(s_id)\n    query = '''select * from usr where email like\\'''' + email + '\\''\n    cursor = g.conn.execute(query)\n    user = User()\n    for row in cursor:\n        user.name = str(row.name)\n        user.email = str(row.email)\n        break\n    return user", "func_src_after": "@login_manager.user_loader\ndef load_user(s_id):\n    email = str(s_id)\n    query = 'select * from usr where email like %s'\n    cursor = g.conn.execute(query, (email, ))\n    user = User()\n    for row in cursor:\n        user.name = str(row.name)\n        user.email = str(row.email)\n        break\n    return user", "commit_link": "github.com/Daniel-Bu/w4111-project1/commit/fe04bedc72e62fd4c4ee046a9af29fd81e9b3340", "file_name": "Web-app/Server.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 4, "char_start": 70, "char_end": 140, "line": "    query = '''select * from usr where email like\\'''' + email + '\\''\n"}, {"line_no": 5, "char_start": 140, "char_end": 175, "line": "    cursor = g.conn.execute(query)\n"}], "added": [{"line_no": 4, "char_start": 70, "char_end": 122, "line": "    query = 'select * from usr where email like %s'\n"}, {"line_no": 5, "char_start": 122, "char_end": 168, "line": "    cursor = g.conn.execute(query, (email, ))\n"}]}, "char_changes": {"deleted": [{"char_start": 83, "char_end": 85, "chars": "''"}, {"char_start": 119, "char_end": 124, "chars": "\\''''"}, {"char_start": 125, "char_end": 138, "chars": "+ email + '\\'"}], "added": [{"char_start": 118, "char_end": 120, "chars": "%s"}, {"char_start": 155, "char_end": 166, "chars": ", (email, )"}]}}
{"func_name": "delete", "func_src_before": "@mod.route('/delete/<int:cmt_id>', methods=['GET', 'POST'])\ndef delete(cmt_id):\n    if request.method == 'GET':\n        sql = \"SELECT msg_id FROM comment where cmt_id = %d;\" % (cmt_id)\n        cursor.execute(sql)\n        m = cursor.fetchone()\n        sql = \"DELETE FROM comment where cmt_id = '%d';\" % (cmt_id)\n        cursor.execute(sql)\n        conn.commit()\n        flash('Delete Success!')\n    return redirect(url_for('comment.show', msg_id=m[0]))", "func_src_after": "@mod.route('/delete/<int:cmt_id>', methods=['GET', 'POST'])\ndef delete(cmt_id):\n    if request.method == 'GET':\n        cursor.execute(\"SELECT msg_id FROM comment where cmt_id = %s;\", (cmt_id,))\n        m = cursor.fetchone()\n        cursor.execute(\"DELETE FROM comment where cmt_id = %s;\", (cmt_id,))\n        conn.commit()\n        flash('Delete Success!')\n    return redirect(url_for('comment.show', msg_id=m[0]))", "commit_link": "github.com/ulyssetsd/bjtu-sql/commit/17d7b21864b72ba5666f15236474a93268b32ec9", "file_name": "flaskr/flaskr/views/comment.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 4, "char_start": 112, "char_end": 185, "line": "        sql = \"SELECT msg_id FROM comment where cmt_id = %d;\" % (cmt_id)\n"}, {"line_no": 5, "char_start": 185, "char_end": 213, "line": "        cursor.execute(sql)\n"}, {"line_no": 7, "char_start": 243, "char_end": 311, "line": "        sql = \"DELETE FROM comment where cmt_id = '%d';\" % (cmt_id)\n"}, {"line_no": 8, "char_start": 311, "char_end": 339, "line": "        cursor.execute(sql)\n"}], "added": [{"line_no": 4, "char_start": 112, "char_end": 195, "line": "        cursor.execute(\"SELECT msg_id FROM comment where cmt_id = %s;\", (cmt_id,))\n"}, {"line_no": 6, "char_start": 225, "char_end": 301, "line": "        cursor.execute(\"DELETE FROM comment where cmt_id = %s;\", (cmt_id,))\n"}]}, "char_changes": {"deleted": [{"char_start": 121, "char_end": 126, "chars": "ql = "}, {"char_start": 170, "char_end": 171, "chars": "d"}, {"char_start": 173, "char_end": 175, "chars": " %"}, {"char_start": 184, "char_end": 211, "chars": "\n        cursor.execute(sql"}, {"char_start": 252, "char_end": 257, "chars": "ql = "}, {"char_start": 293, "char_end": 294, "chars": "'"}, {"char_start": 295, "char_end": 297, "chars": "d'"}, {"char_start": 299, "char_end": 301, "chars": " %"}, {"char_start": 310, "char_end": 337, "chars": "\n        cursor.execute(sql"}], "added": [{"char_start": 120, "char_end": 123, "chars": "cur"}, {"char_start": 124, "char_end": 135, "chars": "or.execute("}, {"char_start": 179, "char_end": 180, "chars": "s"}, {"char_start": 182, "char_end": 183, "chars": ","}, {"char_start": 191, "char_end": 193, "chars": ",)"}, {"char_start": 203, "char_end": 207, "chars": "m = "}, {"char_start": 214, "char_end": 215, "chars": "f"}, {"char_start": 217, "char_end": 221, "chars": "chon"}, {"char_start": 241, "char_end": 245, "chars": "xecu"}, {"char_start": 285, "char_end": 286, "chars": "s"}, {"char_start": 288, "char_end": 289, "chars": ","}, {"char_start": 297, "char_end": 298, "chars": ","}]}}
{"func_name": "get_markets", "func_src_before": "@app.route('/get_markets')\ndef get_markets():\n    asset_id = request.args.get('asset_id')\n\n    if not isObject(asset_id):\n        ws.send('{\"id\":1, \"method\":\"call\", \"params\":[0,\"lookup_asset_symbols\",[[\"' + asset_id + '\"], 0]]}')\n        result_l = ws.recv()\n        j_l = json.loads(result_l)\n        asset_id = j_l[\"result\"][0][\"id\"]\n\n\n    con = psycopg2.connect(**config.POSTGRES)\n    cur = con.cursor()\n\n    query = \"SELECT * FROM markets WHERE aid='\"+asset_id+\"'\"\n    cur.execute(query)\n    results = cur.fetchall()\n    con.close()\n    return jsonify(results)", "func_src_after": "@app.route('/get_markets')\ndef get_markets():\n    asset_id = request.args.get('asset_id')\n\n    if not isObject(asset_id):\n        ws.send('{\"id\":1, \"method\":\"call\", \"params\":[0,\"lookup_asset_symbols\",[[\"' + asset_id + '\"], 0]]}')\n        result_l = ws.recv()\n        j_l = json.loads(result_l)\n        asset_id = j_l[\"result\"][0][\"id\"]\n\n\n    con = psycopg2.connect(**config.POSTGRES)\n    cur = con.cursor()\n\n    query = \"SELECT * FROM markets WHERE aid=%s\"\n    cur.execute(query, (asset_id,))\n    results = cur.fetchall()\n    con.close()\n    return jsonify(results)", "commit_link": "github.com/VinChain/vinchain-python-api-backend/commit/b78088a551fbb712121269c6eb7f43ede120ff60", "file_name": "api.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 15, "char_start": 408, "char_end": 469, "line": "    query = \"SELECT * FROM markets WHERE aid='\"+asset_id+\"'\"\n"}, {"line_no": 16, "char_start": 469, "char_end": 492, "line": "    cur.execute(query)\n"}], "added": [{"line_no": 15, "char_start": 408, "char_end": 457, "line": "    query = \"SELECT * FROM markets WHERE aid=%s\"\n"}, {"line_no": 16, "char_start": 457, "char_end": 493, "line": "    cur.execute(query, (asset_id,))\n"}]}, "char_changes": {"deleted": [{"char_start": 453, "char_end": 457, "chars": "'\"+a"}, {"char_start": 458, "char_end": 467, "chars": "set_id+\"'"}], "added": [{"char_start": 453, "char_end": 454, "chars": "%"}, {"char_start": 478, "char_end": 491, "chars": ", (asset_id,)"}]}}
{"func_name": "get_secrets", "func_src_before": "\tdef get_secrets(self, from_date_added=0):\n\t\tsecrets = []\n\t\tfor row in self.cursor.execute('SELECT encrypted, json_id, date_added FROM secret WHERE date_added > %s ORDER BY date_added DESC' % from_date_added):\n\t\t\taes_key, json_id, date_added = cryptlib.eciesDecrypt(row[0], self.privkey), row[1], row[2]\n\t\t\tif aes_key != None:\n\t\t\t\tsecrets.append([aes_key, json_id])\n\t\t\tfrom_date_added = max(from_date_added, date_added)\n\t\treturn (secrets, from_date_added)", "func_src_after": "\tdef get_secrets(self, from_date_added=0):\n\t\tsecrets = []\n\t\tfor row in self.cursor.execute('SELECT encrypted, json_id, date_added FROM secret WHERE date_added > ? ORDER BY date_added DESC', (from_date_added,)):\n\t\t\taes_key, json_id, date_added = cryptlib.eciesDecrypt(row[0], self.privkey), row[1], row[2]\n\t\t\tif aes_key != None:\n\t\t\t\tsecrets.append([aes_key, json_id])\n\t\t\tfrom_date_added = max(from_date_added, date_added)\n\t\treturn (secrets, from_date_added)", "commit_link": "github.com/imachug/ZeroMailProxy/commit/8f62d024c6c4c957079d147e59f26d15c07dc888", "file_name": "zeromail.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 3, "char_start": 58, "char_end": 210, "line": "\t\tfor row in self.cursor.execute('SELECT encrypted, json_id, date_added FROM secret WHERE date_added > %s ORDER BY date_added DESC' % from_date_added):\n"}], "added": [{"line_no": 3, "char_start": 58, "char_end": 211, "line": "\t\tfor row in self.cursor.execute('SELECT encrypted, json_id, date_added FROM secret WHERE date_added > ? ORDER BY date_added DESC', (from_date_added,)):\n"}]}, "char_changes": {"deleted": [{"char_start": 161, "char_end": 163, "chars": "%s"}, {"char_start": 189, "char_end": 191, "chars": " %"}], "added": [{"char_start": 161, "char_end": 162, "chars": "?"}, {"char_start": 188, "char_end": 189, "chars": ","}, {"char_start": 190, "char_end": 191, "chars": "("}, {"char_start": 206, "char_end": 208, "chars": ",)"}]}}
{"func_name": "add_consumption_data_row", "func_src_before": "    def add_consumption_data_row(self, ts, energy_used, power_used):\n\n        if power_used > 0:\n\n            query = '''\n                INSERT OR IGNORE INTO Consumption (\n                    TimeStamp,\n                    EnergyUsed,\n                    PowerUsed                                \n                ) VALUES (\n                    %s,\n                    %s,\n                    %s\n                );\n            ''' % (ts, 0, 0)\n            self.c.execute(query)\n\n            query = '''\n                UPDATE Consumption SET \n                EnergyUsed = EnergyUsed + %s,\n                PowerUsed = PowerUsed + %s\n                WHERE TimeStamp = %s;\n            ''' % (energy_used, power_used, ts)\n\n            self.c.execute(query)\n\n            self.db.commit()", "func_src_after": "    def add_consumption_data_row(self, ts, energy_used, power_used):\n\n        if power_used > 0:\n\n            query = '''\n                INSERT OR IGNORE INTO Consumption (\n                    TimeStamp,\n                    EnergyUsed,\n                    PowerUsed                                \n                ) VALUES (\n                    ?,\n                    ?,\n                    ?\n                );\n            '''\n            self.c.execute(query, (ts, 0, 0))\n\n            query = '''\n                UPDATE Consumption SET \n                EnergyUsed = EnergyUsed + ?,\n                PowerUsed = PowerUsed + ?\n                WHERE TimeStamp=?;\n            '''\n\n            self.c.execute(query, (energy_used, power_used, ts))\n\n            self.db.commit()", "commit_link": "github.com/philipptrenz/s0-bridge/commit/269b48caa05377b7c58c3e6d1622a4429cb5ba65", "file_name": "util/database.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 11, "char_start": 326, "char_end": 350, "line": "                    %s,\n"}, {"line_no": 12, "char_start": 350, "char_end": 374, "line": "                    %s,\n"}, {"line_no": 13, "char_start": 374, "char_end": 397, "line": "                    %s\n"}, {"line_no": 15, "char_start": 416, "char_end": 445, "line": "            ''' % (ts, 0, 0)\n"}, {"line_no": 16, "char_start": 445, "char_end": 479, "line": "            self.c.execute(query)\n"}, {"line_no": 20, "char_start": 544, "char_end": 590, "line": "                EnergyUsed = EnergyUsed + %s,\n"}, {"line_no": 21, "char_start": 590, "char_end": 633, "line": "                PowerUsed = PowerUsed + %s\n"}, {"line_no": 22, "char_start": 633, "char_end": 671, "line": "                WHERE TimeStamp = %s;\n"}, {"line_no": 23, "char_start": 671, "char_end": 719, "line": "            ''' % (energy_used, power_used, ts)\n"}, {"line_no": 25, "char_start": 720, "char_end": 754, "line": "            self.c.execute(query)\n"}], "added": [{"line_no": 11, "char_start": 326, "char_end": 349, "line": "                    ?,\n"}, {"line_no": 12, "char_start": 349, "char_end": 372, "line": "                    ?,\n"}, {"line_no": 13, "char_start": 372, "char_end": 394, "line": "                    ?\n"}, {"line_no": 15, "char_start": 413, "char_end": 429, "line": "            '''\n"}, {"line_no": 16, "char_start": 429, "char_end": 475, "line": "            self.c.execute(query, (ts, 0, 0))\n"}, {"line_no": 20, "char_start": 540, "char_end": 585, "line": "                EnergyUsed = EnergyUsed + ?,\n"}, {"line_no": 21, "char_start": 585, "char_end": 627, "line": "                PowerUsed = PowerUsed + ?\n"}, {"line_no": 22, "char_start": 627, "char_end": 662, "line": "                WHERE TimeStamp=?;\n"}, {"line_no": 23, "char_start": 662, "char_end": 678, "line": "            '''\n"}, {"line_no": 25, "char_start": 679, "char_end": 744, "line": "            self.c.execute(query, (energy_used, power_used, ts))\n"}]}, "char_changes": {"deleted": [{"char_start": 346, "char_end": 348, "chars": "%s"}, {"char_start": 370, "char_end": 372, "chars": "%s"}, {"char_start": 394, "char_end": 396, "chars": "%s"}, {"char_start": 431, "char_end": 444, "chars": " % (ts, 0, 0)"}, {"char_start": 586, "char_end": 588, "chars": "%s"}, {"char_start": 630, "char_end": 632, "chars": "%s"}, {"char_start": 664, "char_end": 665, "chars": " "}, {"char_start": 666, "char_end": 669, "chars": " %s"}, {"char_start": 686, "char_end": 718, "chars": " % (energy_used, power_used, ts)"}], "added": [{"char_start": 346, "char_end": 347, "chars": "?"}, {"char_start": 369, "char_end": 370, "chars": "?"}, {"char_start": 392, "char_end": 393, "chars": "?"}, {"char_start": 461, "char_end": 473, "chars": ", (ts, 0, 0)"}, {"char_start": 582, "char_end": 583, "chars": "?"}, {"char_start": 625, "char_end": 626, "chars": "?"}, {"char_start": 659, "char_end": 660, "chars": "?"}, {"char_start": 711, "char_end": 742, "chars": ", (energy_used, power_used, ts)"}]}}
{"func_name": "lookup_assets", "func_src_before": "@app.route('/lookup_assets')\ndef lookup_assets():\n    start = request.args.get('start')\n\n    con = psycopg2.connect(**config.POSTGRES)\n    cur = con.cursor()\n\n    query = \"SELECT aname FROM assets WHERE aname LIKE '\"+start+\"%'\"\n    cur.execute(query)\n    results = cur.fetchall()\n    con.close()\n    return jsonify(results)", "func_src_after": "@app.route('/lookup_assets')\ndef lookup_assets():\n    start = request.args.get('start')\n\n    con = psycopg2.connect(**config.POSTGRES)\n    cur = con.cursor()\n\n    query = \"SELECT aname FROM assets WHERE aname LIKE %s\"\n    cur.execute(query, (start+'%',))\n    results = cur.fetchall()\n    con.close()\n    return jsonify(results)", "commit_link": "github.com/VinChain/vinchain-python-api-backend/commit/b78088a551fbb712121269c6eb7f43ede120ff60", "file_name": "api.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 8, "char_start": 159, "char_end": 228, "line": "    query = \"SELECT aname FROM assets WHERE aname LIKE '\"+start+\"%'\"\n"}, {"line_no": 9, "char_start": 228, "char_end": 251, "line": "    cur.execute(query)\n"}], "added": [{"line_no": 8, "char_start": 159, "char_end": 218, "line": "    query = \"SELECT aname FROM assets WHERE aname LIKE %s\"\n"}, {"line_no": 9, "char_start": 218, "char_end": 255, "line": "    cur.execute(query, (start+'%',))\n"}]}, "char_changes": {"deleted": [{"char_start": 214, "char_end": 224, "chars": "'\"+start+\""}, {"char_start": 225, "char_end": 226, "chars": "'"}], "added": [{"char_start": 214, "char_end": 215, "chars": "%"}, {"char_start": 239, "char_end": 253, "chars": ", (start+'%',)"}]}}
{"func_name": "set_state", "func_src_before": "def set_state(chat_id, value):\n    settings = sqlite3.connect(os.path.abspath(os.path.dirname(__file__)) + \"\\\\bases\\\\settings.db\")\n    conn = settings.cursor()\n    conn.execute(\"update users set state ='\" + str(value) + \"' where chat_id = '\" + str(chat_id) + \"'\")\n    settings.commit()\n    settings.close()", "func_src_after": "def set_state(chat_id, value):\n    settings = sqlite3.connect(os.path.abspath(os.path.dirname(__file__)) + \"\\\\bases\\\\settings.db\")\n    conn = settings.cursor()\n    conn.execute(\"update users set state = ? where chat_id = ?\", (str(value), str(chat_id)))\n    settings.commit()\n    settings.close()", "commit_link": "github.com/lissrbay/codeforces_bot/commit/cc7f5143445a0030b1149ac60a65b1b1b9c92a90", "file_name": "bot.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 4, "char_start": 160, "char_end": 264, "line": "    conn.execute(\"update users set state ='\" + str(value) + \"' where chat_id = '\" + str(chat_id) + \"'\")\n"}], "added": [{"line_no": 4, "char_start": 160, "char_end": 253, "line": "    conn.execute(\"update users set state = ? where chat_id = ?\", (str(value), str(chat_id)))\n"}]}, "char_changes": {"deleted": [{"char_start": 202, "char_end": 204, "chars": "'\""}, {"char_start": 205, "char_end": 222, "chars": "+ str(value) + \"'"}, {"char_start": 239, "char_end": 240, "chars": "'"}, {"char_start": 242, "char_end": 243, "chars": "+"}, {"char_start": 256, "char_end": 262, "chars": " + \"'\""}], "added": [{"char_start": 203, "char_end": 204, "chars": "?"}, {"char_start": 221, "char_end": 222, "chars": "?"}, {"char_start": 223, "char_end": 224, "chars": ","}, {"char_start": 225, "char_end": 237, "chars": "(str(value),"}, {"char_start": 250, "char_end": 251, "chars": ")"}]}}
{"func_name": "_get_degree_2", "func_src_before": "def _get_degree_2(user_id, cnx):\n    \"\"\"Get all users of degree 2 follow that are not currently followed.\n    Example:\n        this user (follows) user B (follows) user B\n        AND user (does NOT follow) user B\n        means that user B will be in the list\n    Args:\n        user_id (int): id of user\n        cnx: DB connection\n    Returns:\n        list: list of user_ids\n    \"\"\"\n    sql = 'WITH tmp_suggest (followed_id) AS ' \\\n    '(' \\\n        'SELECT b.followed_id AS followed_id ' \\\n        'FROM ' \\\n            'tbl_follow a INNER JOIN tbl_follow b ' \\\n            'ON a.followed_id = b.follower_id ' \\\n        'WHERE a.follower_id = %s ' \\\n        'AND b.followed_id NOT IN ' \\\n            '(SELECT followed_id FROM tbl_follow WHERE follower_id = %s) ' \\\n        'AND b.followed_id != %s ' \\\n    ') ' \\\n    'SELECT followed_id, COUNT(*) AS num_mutual FROM tmp_suggest ' \\\n    'GROUP BY followed_id ' \\\n    'ORDER BY num_mutual DESC' % (user_id, user_id, user_id)\n    with cnx.cursor() as cursor:\n        cursor.execute(sql)\n        res = cursor.fetchall()\n    return list(map(lambda x: x[0], res))", "func_src_after": "def _get_degree_2(user_id, cnx):\n    \"\"\"Get all users of degree 2 follow that are not currently followed.\n    Example:\n        this user (follows) user B (follows) user B\n        AND user (does NOT follow) user B\n        means that user B will be in the list\n    Args:\n        user_id (int): id of user\n        cnx: DB connection\n    Returns:\n        list: list of user_ids\n    \"\"\"\n    sql = 'WITH tmp_suggest (followed_id) AS ' \\\n    '(' \\\n        'SELECT b.followed_id AS followed_id ' \\\n        'FROM ' \\\n            'tbl_follow a INNER JOIN tbl_follow b ' \\\n            'ON a.followed_id = b.follower_id ' \\\n        'WHERE a.follower_id = %s ' \\\n        'AND b.followed_id NOT IN ' \\\n            '(SELECT followed_id FROM tbl_follow WHERE follower_id = %s) ' \\\n        'AND b.followed_id != %s ' \\\n    ') ' \\\n    'SELECT followed_id, COUNT(*) AS num_mutual FROM tmp_suggest ' \\\n    'GROUP BY followed_id ' \\\n    'ORDER BY num_mutual DESC'\n    with cnx.cursor() as cursor:\n        cursor.execute(sql, (user_id, user_id, user_id))\n        res = cursor.fetchall()\n    return list(map(lambda x: x[0], res))", "commit_link": "github.com/young-goons/rifflo-server/commit/fb311df76713b638c9486250f9badb288ffb2189", "file_name": "server/ygoons/modules/user/follow_suggest.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 26, "char_start": 912, "char_end": 973, "line": "    'ORDER BY num_mutual DESC' % (user_id, user_id, user_id)\n"}, {"line_no": 28, "char_start": 1006, "char_end": 1034, "line": "        cursor.execute(sql)\n"}], "added": [{"line_no": 26, "char_start": 912, "char_end": 943, "line": "    'ORDER BY num_mutual DESC'\n"}, {"line_no": 28, "char_start": 976, "char_end": 1033, "line": "        cursor.execute(sql, (user_id, user_id, user_id))\n"}]}, "char_changes": {"deleted": [{"char_start": 942, "char_end": 972, "chars": " % (user_id, user_id, user_id)"}], "added": [{"char_start": 1002, "char_end": 1031, "chars": ", (user_id, user_id, user_id)"}]}}
{"func_name": "get_tournaments_during_month", "func_src_before": "def get_tournaments_during_month(db, scene, date):\n    y, m, d = date.split('-')\n    ym_date = '{}-{}'.format(y, m)\n    sql = \"select url, date from matches where scene='{}' and date like '%{}%' group by url, date order by date\".format(scene, ym_date)\n    res = db.exec(sql)\n    urls = [r[0] for r in res]\n    return urls", "func_src_after": "def get_tournaments_during_month(db, scene, date):\n    y, m, d = date.split('-')\n    ym_date = '{}-{}'.format(y, m)\n    sql = \"select url, date from matches where scene='{scene}' and date like '%{date}%' group by url, date order by date\"\n    args = {'scene': scene, 'date': ym_date}\n    res = db.exec(sql, args)\n    urls = [r[0] for r in res]\n    return urls", "commit_link": "github.com/DKelle/Smash_stats/commit/4bb83f3f6ce7d6bebbeb512cd015f9e72cf36d63", "file_name": "bracket_utils.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 4, "char_start": 116, "char_end": 252, "line": "    sql = \"select url, date from matches where scene='{}' and date like '%{}%' group by url, date order by date\".format(scene, ym_date)\n"}, {"line_no": 5, "char_start": 252, "char_end": 275, "line": "    res = db.exec(sql)\n"}], "added": [{"line_no": 4, "char_start": 116, "char_end": 238, "line": "    sql = \"select url, date from matches where scene='{scene}' and date like '%{date}%' group by url, date order by date\"\n"}, {"line_no": 5, "char_start": 238, "char_end": 283, "line": "    args = {'scene': scene, 'date': ym_date}\n"}, {"line_no": 6, "char_start": 283, "char_end": 312, "line": "    res = db.exec(sql, args)\n"}]}, "char_changes": {"deleted": [{"char_start": 228, "char_end": 231, "chars": ".fo"}, {"char_start": 232, "char_end": 236, "chars": "mat("}, {"char_start": 250, "char_end": 251, "chars": ")"}], "added": [{"char_start": 171, "char_end": 176, "chars": "scene"}, {"char_start": 196, "char_end": 200, "chars": "date"}, {"char_start": 237, "char_end": 242, "chars": "\n    "}, {"char_start": 243, "char_end": 259, "chars": "rgs = {'scene': "}, {"char_start": 266, "char_end": 274, "chars": "'date': "}, {"char_start": 281, "char_end": 282, "chars": "}"}, {"char_start": 304, "char_end": 310, "chars": ", args"}]}}
{"func_name": "add_input", "func_src_before": "    def add_input(self,data):\n        connection = self.connect()\n        try:\n            # The following is a flaw\n            query = \"INSERT INTO crimes(description) VALUES ('{}');\".format(data)\n            with connection.cursor() as cursor:\n                cursor.execute(query)\n                connection.commit()\n        finally:\n            connection.close()", "func_src_after": "    def add_input(self,data):\n        connection = self.connect()\n        try:\n            # The following is a flaw\n            query = \"INSERT INTO crimes(description) VALUES (%s);\"\n            with connection.cursor() as cursor:\n                cursor.execute(query, data)\n                connection.commit()\n        finally:\n            connection.close()", "commit_link": "github.com/amrishc/crimemap/commit/51b3d51aa031d7c285295de36f5464d43debf6de", "file_name": "dbhelper.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 5, "char_start": 117, "char_end": 199, "line": "            query = \"INSERT INTO crimes(description) VALUES ('{}');\".format(data)\n"}, {"line_no": 7, "char_start": 247, "char_end": 285, "line": "                cursor.execute(query)\n"}], "added": [{"line_no": 5, "char_start": 117, "char_end": 184, "line": "            query = \"INSERT INTO crimes(description) VALUES (%s);\"\n"}, {"line_no": 7, "char_start": 232, "char_end": 276, "line": "                cursor.execute(query, data)\n"}]}, "char_changes": {"deleted": [{"char_start": 178, "char_end": 182, "chars": "'{}'"}, {"char_start": 185, "char_end": 198, "chars": ".format(data)"}], "added": [{"char_start": 178, "char_end": 180, "chars": "%s"}, {"char_start": 268, "char_end": 274, "chars": ", data"}]}}
{"func_name": "get_error_days", "func_src_before": "def get_error_days(cur, error_percent):\n    \"\"\"Fetches the days in which requests led to errors.\n\n    Fetches the days in which the specified percentage\n    of requests led to errors.\n\n    Args:\n        cur(obj): The cursor to execute the query.\n        error_percent(int): The percentage of requests that led to errors.\n\n    Return:\n        True if success, False otherwise.\n    \"\"\"\n    query = '''SELECT to_char(log_errors.date, 'Mon DD YYYY'),\n            round((log_errors.errors * 100\n            / log_requests.total::numeric), 2) as percent\n            FROM log_errors, log_requests\n            WHERE log_errors.date = log_requests.date AND\n            log_errors.errors * 100\n            / log_requests.total::numeric > {}\n            ORDER BY log_errors.date'''.format(error_percent)\n    rows = get_data(cur, query)\n\n    # Write data to txt file.\n    if rows is not None:\n        file = open(\"error_report.txt\", \"w\")\n        for row in rows:\n            file.write(\"{} - {}% errors \\n\".format(row[0], row[1]))\n        file.close()\n\n        return True\n    else:\n        return False", "func_src_after": "def get_error_days(cur, error_percent):\n    \"\"\"Fetches the days in which requests led to errors.\n\n    Fetches the days in which the specified percentage\n    of requests led to errors.\n\n    Args:\n        cur(obj): The cursor to execute the query.\n        error_percent(int): The percentage of requests that led to errors.\n\n    Return:\n        True if success, False otherwise.\n    \"\"\"\n    data = (error_percent, )\n    query = '''SELECT to_char(log_errors.date, 'Mon DD YYYY'),\n            round((log_errors.errors * 100\n            / log_requests.total::numeric), 2) as percent\n            FROM log_errors, log_requests\n            WHERE log_errors.date = log_requests.date AND\n            log_errors.errors * 100\n            / log_requests.total::numeric > %s\n            ORDER BY log_errors.date'''\n    rows = get_data(cur, query, data)\n\n    # Write data to txt file.\n    if rows is not None:\n        file = open(\"error_report.txt\", \"w\")\n        for row in rows:\n            file.write(\"{} - {}% errors \\n\".format(row[0], row[1]))\n        file.close()\n\n        return True\n    else:\n        return False", "commit_link": "github.com/rrbiz662/log-analysis/commit/20fefbde3738088586a3c5679f743493d0a504f6", "file_name": "news_data_analysis.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 20, "char_start": 684, "char_end": 731, "line": "            / log_requests.total::numeric > {}\n"}, {"line_no": 21, "char_start": 731, "char_end": 793, "line": "            ORDER BY log_errors.date'''.format(error_percent)\n"}, {"line_no": 22, "char_start": 793, "char_end": 825, "line": "    rows = get_data(cur, query)\n"}], "added": [{"line_no": 14, "char_start": 384, "char_end": 413, "line": "    data = (error_percent, )\n"}, {"line_no": 21, "char_start": 713, "char_end": 760, "line": "            / log_requests.total::numeric > %s\n"}, {"line_no": 22, "char_start": 760, "char_end": 800, "line": "            ORDER BY log_errors.date'''\n"}, {"line_no": 23, "char_start": 800, "char_end": 838, "line": "    rows = get_data(cur, query, data)\n"}]}, "char_changes": {"deleted": [{"char_start": 728, "char_end": 730, "chars": "{}"}, {"char_start": 770, "char_end": 792, "chars": ".format(error_percent)"}], "added": [{"char_start": 388, "char_end": 417, "chars": "data = (error_percent, )\n    "}, {"char_start": 757, "char_end": 759, "chars": "%s"}, {"char_start": 830, "char_end": 836, "chars": ", data"}]}}
{"func_name": "all_deposits", "func_src_before": "    def all_deposits(self,coin):\n        sql = \"SELECT * FROM deposits WHERE coin='%s'\" % coin\n        self.cursor.execute(sql)\n        return self.cursor.fetchall()", "func_src_after": "    def all_deposits(self,coin):\n        sql = \"SELECT * FROM deposits WHERE coin='%s'\"\n        self.cursor.execute(sql, (coin,))\n        return self.cursor.fetchall()", "commit_link": "github.com/ktechmidas/garlictipsbot/commit/7c262255f933cb721109ac4be752b5b7599275aa", "file_name": "deposit.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 2, "char_start": 33, "char_end": 95, "line": "        sql = \"SELECT * FROM deposits WHERE coin='%s'\" % coin\n"}, {"line_no": 3, "char_start": 95, "char_end": 128, "line": "        self.cursor.execute(sql)\n"}], "added": [{"line_no": 2, "char_start": 33, "char_end": 88, "line": "        sql = \"SELECT * FROM deposits WHERE coin='%s'\"\n"}, {"line_no": 3, "char_start": 88, "char_end": 130, "line": "        self.cursor.execute(sql, (coin,))\n"}]}, "char_changes": {"deleted": [{"char_start": 87, "char_end": 94, "chars": " % coin"}], "added": [{"char_start": 119, "char_end": 128, "chars": ", (coin,)"}]}}
{"func_name": "get_user", "func_src_before": "    def get_user(self):\n        if not hasattr(self, '_user'):\n            qs = \"select * from account_access where access_token = '%s'\" % self.access_token\n            result = self.db.get(qs)\n            if result:\n                self._user = result\n            else:\n                self._user = None\n        \n        return self._user", "func_src_after": "    def get_user(self):\n        if not hasattr(self, '_user'):\n            qs = \"select * from account_access where access_token = %s\"\n            result = self.db.get(qs, self.access_token)\n            if result:\n                self._user = result\n            else:\n                self._user = None\n        \n        return self._user", "commit_link": "github.com/bonbondirac/tsunami/commit/396cc394bd6daaf0ee9c16b1b55a4082eeaac208", "file_name": "src/auth.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 3, "char_start": 63, "char_end": 157, "line": "            qs = \"select * from account_access where access_token = '%s'\" % self.access_token\n"}, {"line_no": 4, "char_start": 157, "char_end": 194, "line": "            result = self.db.get(qs)\n"}], "added": [{"line_no": 3, "char_start": 63, "char_end": 135, "line": "            qs = \"select * from account_access where access_token = %s\"\n"}, {"line_no": 4, "char_start": 135, "char_end": 191, "line": "            result = self.db.get(qs, self.access_token)\n"}]}, "char_changes": {"deleted": [{"char_start": 131, "char_end": 132, "chars": "'"}, {"char_start": 134, "char_end": 135, "chars": "'"}, {"char_start": 136, "char_end": 156, "chars": " % self.access_token"}], "added": [{"char_start": 170, "char_end": 189, "chars": ", self.access_token"}]}}
{"func_name": "compare_and_update", "func_src_before": "    @staticmethod\n    def compare_and_update(user, message):\n        \"\"\"\n        This method compare a user object from the bot and his info from\n        the Telegram message to check whether a user has changed his bio\n        or not. If yes, the user object that represents him in the bot will\n        be updated accordingly. Now this function is called only when a user\n        asks the bot for showing the most popular cams\n\n        :param user: user object that represents a Telegram user in this bot\n        :param message: object from Telegram that contains info about user's\n        message and about himself\n        :return: None\n        \"\"\"\n\n        log.info('Checking whether user have changed his info or not...')\n        msg = message.from_user\n        usr_from_message = User(message.chat.id, msg.first_name, msg.username,\n                                msg.last_name)\n\n        if user.chat_id != usr_from_message.chat_id:\n            log.error(\"Wrong user to compare!\")\n            return\n\n        if user.first_name != usr_from_message.first_name:\n            user.first_name = usr_from_message.first_name\n\n        elif user.nickname != usr_from_message.nickname:\n            user.nickname = usr_from_message.nickname\n\n        elif user.last_name != usr_from_message.last_name:\n            user.last_name = usr_from_message.last_name\n\n        else:\n            log.debug(\"User's info hasn't changed\")\n            return\n\n        log.info(\"User has changed his info\")\n        log.debug(\"Updating user's info in the database...\")\n        query = (f\"UPDATE users \"\n                 f\"SET first_name='{user.first_name}', \"\n                 f\"nickname='{user.nickname}', \"\n                 f\"last_name='{user.last_name}' \"\n                 f\"WHERE chat_id={user.chat_id}\")\n\n        try:\n            db.add(query)\n        except DatabaseError:\n            log.error(\"Could not update info about %s in the database\",\n                      user)\n        else:\n            log.debug(\"User's info has been updated\")", "func_src_after": "    @staticmethod\n    def compare_and_update(user, message):\n        \"\"\"\n        This method compare a user object from the bot and his info from\n        the Telegram message to check whether a user has changed his bio\n        or not. If yes, the user object that represents him in the bot will\n        be updated accordingly. Now this function is called only when a user\n        asks the bot for showing the most popular cams\n\n        :param user: user object that represents a Telegram user in this bot\n        :param message: object from Telegram that contains info about user's\n        message and about himself\n        :return: None\n        \"\"\"\n\n        log.info('Checking whether user have changed his info or not...')\n        msg = message.from_user\n        usr_from_message = User(message.chat.id, msg.first_name, msg.username,\n                                msg.last_name)\n\n        if user.chat_id != usr_from_message.chat_id:\n            log.error(\"Wrong user to compare!\")\n            return\n\n        if user.first_name != usr_from_message.first_name:\n            user.first_name = usr_from_message.first_name\n\n        elif user.nickname != usr_from_message.nickname:\n            user.nickname = usr_from_message.nickname\n\n        elif user.last_name != usr_from_message.last_name:\n            user.last_name = usr_from_message.last_name\n\n        else:\n            log.debug(\"User's info hasn't changed\")\n            return\n\n        log.info(\"User has changed his info\")\n        log.debug(\"Updating user's info in the database...\")\n        query = (f\"UPDATE users \"\n                 f\"SET first_name=%s, \"\n                 f\"nickname=%s, \"\n                 f\"last_name=%s \"\n                 f\"WHERE chat_id=%s\")\n\n        parameters = (user.first_name, user.nickname, user.last_name,\n                      user.chat_id)\n\n        try:\n            db.add(query, parameters)\n        except DatabaseError:\n            log.error(\"Could not update info about %s in the database\",\n                      user)\n        else:\n            log.debug(\"User's info has been updated\")", "commit_link": "github.com/RandyRomero/photoGPSbot/commit/0e9f57f13e61863b3672f5730e27f149da00786a", "file_name": "photogpsbot/users.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 41, "char_start": 1578, "char_end": 1635, "line": "                 f\"SET first_name='{user.first_name}', \"\n"}, {"line_no": 42, "char_start": 1635, "char_end": 1684, "line": "                 f\"nickname='{user.nickname}', \"\n"}, {"line_no": 43, "char_start": 1684, "char_end": 1734, "line": "                 f\"last_name='{user.last_name}' \"\n"}, {"line_no": 44, "char_start": 1734, "char_end": 1784, "line": "                 f\"WHERE chat_id={user.chat_id}\")\n"}, {"line_no": 47, "char_start": 1798, "char_end": 1824, "line": "            db.add(query)\n"}], "added": [{"line_no": 41, "char_start": 1578, "char_end": 1618, "line": "                 f\"SET first_name=%s, \"\n"}, {"line_no": 42, "char_start": 1618, "char_end": 1652, "line": "                 f\"nickname=%s, \"\n"}, {"line_no": 43, "char_start": 1652, "char_end": 1686, "line": "                 f\"last_name=%s \"\n"}, {"line_no": 44, "char_start": 1686, "char_end": 1724, "line": "                 f\"WHERE chat_id=%s\")\n"}, {"line_no": 45, "char_start": 1724, "char_end": 1725, "line": "\n"}, {"line_no": 46, "char_start": 1725, "char_end": 1795, "line": "        parameters = (user.first_name, user.nickname, user.last_name,\n"}, {"line_no": 47, "char_start": 1795, "char_end": 1831, "line": "                      user.chat_id)\n"}, {"line_no": 50, "char_start": 1845, "char_end": 1883, "line": "            db.add(query, parameters)\n"}]}, "char_changes": {"deleted": [{"char_start": 1612, "char_end": 1615, "chars": "'{u"}, {"char_start": 1616, "char_end": 1631, "chars": "er.first_name}'"}, {"char_start": 1663, "char_end": 1666, "chars": "'{u"}, {"char_start": 1667, "char_end": 1680, "chars": "er.nickname}'"}, {"char_start": 1713, "char_end": 1722, "chars": "'{user.la"}, {"char_start": 1723, "char_end": 1731, "chars": "t_name}'"}, {"char_start": 1767, "char_end": 1768, "chars": "{"}, {"char_start": 1780, "char_end": 1782, "chars": "}\""}], "added": [{"char_start": 1612, "char_end": 1613, "chars": "%"}, {"char_start": 1646, "char_end": 1647, "chars": "%"}, {"char_start": 1681, "char_end": 1682, "chars": "%"}, {"char_start": 1719, "char_end": 1817, "chars": "%s\")\n\n        parameters = (user.first_name, user.nickname, user.last_name,\n                      "}, {"char_start": 1869, "char_end": 1881, "chars": ", parameters"}]}}
{"func_name": "GameNewPlayed", "func_src_before": "def GameNewPlayed(Played, ID):\n\tdb.execute(\"UPDATE games set GamesPlayed = %i WHERE ID = %i\" % (Played, ID))\n\tdatabase.commit()", "func_src_after": "def GameNewPlayed(Played, ID):\n\tdb.execute(\"UPDATE games set GamesPlayed = ? WHERE ID = ?\", Played, ID)\n\tdatabase.commit()", "commit_link": "github.com/iScrE4m/XLeague/commit/59cab6e5fd8bd5e47f2418a7c71cb1d4e3cad0d2", "file_name": "plugins/database.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 2, "char_start": 31, "char_end": 109, "line": "\tdb.execute(\"UPDATE games set GamesPlayed = %i WHERE ID = %i\" % (Played, ID))\n"}], "added": [{"line_no": 2, "char_start": 31, "char_end": 104, "line": "\tdb.execute(\"UPDATE games set GamesPlayed = ? WHERE ID = ?\", Played, ID)\n"}]}, "char_changes": {"deleted": [{"char_start": 75, "char_end": 77, "chars": "%i"}, {"char_start": 89, "char_end": 91, "chars": "%i"}, {"char_start": 92, "char_end": 94, "chars": " %"}, {"char_start": 95, "char_end": 96, "chars": "("}, {"char_start": 106, "char_end": 107, "chars": ")"}], "added": [{"char_start": 75, "char_end": 76, "chars": "?"}, {"char_start": 88, "char_end": 89, "chars": "?"}, {"char_start": 90, "char_end": 91, "chars": ","}]}}
{"func_name": "insertNPC", "func_src_before": "def insertNPC(name, race,classe,sex,level,image,legit):\n\tc, conn = getConnection()\n\tdate = now()\n\tc.execute(\"INSERT INTO npc VALUES ('\"+date+\"','\"+str(name)+\"','\"+race+\"','\"+classe+\"','\"+sex+\"','\"+str(level)+\"','\"+image+\"','\"+str(legit)+\"')\")\n\tconn.commit()\n\tconn.close()", "func_src_after": "def insertNPC(name, race,classe,sex,level,image,legit):\n\tc, conn = getConnection()\n\tdate = now()\n\tc.execute(\"INSERT INTO npc VALUES (?,?,?,?,?,?,?,?)\",(date,str(name),race,classe,sex,str(level),image,str(legit)))\n\tconn.commit()\n\tconn.close()", "commit_link": "github.com/DangerBlack/DungeonsAndDragonsMasterBot/commit/63f980c6dff746f5fcf3005d0646b6c24f81cdc0", "file_name": "database.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 4, "char_start": 97, "char_end": 243, "line": "\tc.execute(\"INSERT INTO npc VALUES ('\"+date+\"','\"+str(name)+\"','\"+race+\"','\"+classe+\"','\"+sex+\"','\"+str(level)+\"','\"+image+\"','\"+str(legit)+\"')\")\n"}], "added": [{"line_no": 4, "char_start": 97, "char_end": 213, "line": "\tc.execute(\"INSERT INTO npc VALUES (?,?,?,?,?,?,?,?)\",(date,str(name),race,classe,sex,str(level),image,str(legit)))\n"}]}, "char_changes": {"deleted": [{"char_start": 133, "char_end": 134, "chars": "'"}, {"char_start": 135, "char_end": 136, "chars": "+"}, {"char_start": 140, "char_end": 143, "chars": "+\"'"}, {"char_start": 144, "char_end": 147, "chars": "'\"+"}, {"char_start": 156, "char_end": 159, "chars": "+\"'"}, {"char_start": 160, "char_end": 163, "chars": "'\"+"}, {"char_start": 167, "char_end": 170, "chars": "+\"'"}, {"char_start": 171, "char_end": 174, "chars": "'\"+"}, {"char_start": 180, "char_end": 183, "chars": "+\"'"}, {"char_start": 184, "char_end": 187, "chars": "'\"+"}, {"char_start": 190, "char_end": 193, "chars": "+\"'"}, {"char_start": 194, "char_end": 197, "chars": "'\"+"}, {"char_start": 207, "char_end": 210, "chars": "+\"'"}, {"char_start": 211, "char_end": 214, "chars": "'\"+"}, {"char_start": 219, "char_end": 222, "chars": "+\"'"}, {"char_start": 223, "char_end": 226, "chars": "'\"+"}, {"char_start": 236, "char_end": 239, "chars": "+\"'"}, {"char_start": 240, "char_end": 241, "chars": "\""}], "added": [{"char_start": 133, "char_end": 149, "chars": "?,?,?,?,?,?,?,?)"}, {"char_start": 150, "char_end": 152, "chars": ",("}]}}
{"func_name": "get", "func_src_before": "    def get(self, user_id):\n        \"\"\" Fetch data for user with corresponding user_id \"\"\"\n        return database_utilities.execute_query(f\"\"\"select * from users where user_id = '{user_id}'\"\"\")", "func_src_after": "    def get(self, user_id):\n        \"\"\" Fetch data for user with corresponding user_id \"\"\"\n        return database_utilities.execute_query(f\"\"\"select * from users where user_id = %s\"\"\", (user_id, ))", "commit_link": "github.com/sgosal2/tiger-boards-backend/commit/4670109dd613df2f2fe7e8403ebd149df2b55485", "file_name": "apis/users.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 3, "char_start": 91, "char_end": 194, "line": "        return database_utilities.execute_query(f\"\"\"select * from users where user_id = '{user_id}'\"\"\")\n"}], "added": [{"line_no": 3, "char_start": 91, "char_end": 198, "line": "        return database_utilities.execute_query(f\"\"\"select * from users where user_id = %s\"\"\", (user_id, ))\n"}]}, "char_changes": {"deleted": [{"char_start": 179, "char_end": 181, "chars": "'{"}, {"char_start": 188, "char_end": 193, "chars": "}'\"\"\""}], "added": [{"char_start": 179, "char_end": 187, "chars": "%s\"\"\", ("}, {"char_start": 194, "char_end": 197, "chars": ", )"}]}}
{"func_name": "h2h", "func_src_before": "@endpoints.route(\"/h2h\")\ndef h2h():\n    if db == None:\n        init()\n\n    player1 = request.args.get('tag1', default=\"christmasmike\")\n    player2 = request.args.get('tag2', default=\"christmasmike\")\n    sql = \"SELECT * FROM matches WHERE (player1 = '\"+str(player1)+\"' OR \"\\\n            +\"player2 = '\"+str(player1)+\"') AND (player1 = '\"+str(player2)+\"' OR \"\\\n            +\"player2 = '\"+str(player2)+\"') ORDER BY date DESC;\"\n    result = db.exec(sql)\n    return json.dumps(result)", "func_src_after": "@endpoints.route(\"/h2h\")\ndef h2h():\n    if db == None:\n        init()\n\n    player1 = request.args.get('tag1', default=\"christmasmike\")\n    player2 = request.args.get('tag2', default=\"christmasmike\")\n    sql = \"SELECT * FROM matches WHERE (player1 = '{player1}' OR \"\\\n            +\"player2 = '{player1}') AND (player1 = '{player2}' OR \"\\\n            +\"player2 = '{player2}') ORDER BY date DESC;\"\n    args = {'player1': player1, 'player2': player2}\n    result = db.exec(sql, args)\n    return json.dumps(result)", "commit_link": "github.com/DKelle/Smash_stats/commit/4bb83f3f6ce7d6bebbeb512cd015f9e72cf36d63", "file_name": "endpoints.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 8, "char_start": 199, "char_end": 274, "line": "    sql = \"SELECT * FROM matches WHERE (player1 = '\"+str(player1)+\"' OR \"\\\n"}, {"line_no": 9, "char_start": 274, "char_end": 358, "line": "            +\"player2 = '\"+str(player1)+\"') AND (player1 = '\"+str(player2)+\"' OR \"\\\n"}, {"line_no": 10, "char_start": 358, "char_end": 423, "line": "            +\"player2 = '\"+str(player2)+\"') ORDER BY date DESC;\"\n"}, {"line_no": 11, "char_start": 423, "char_end": 449, "line": "    result = db.exec(sql)\n"}], "added": [{"line_no": 8, "char_start": 199, "char_end": 267, "line": "    sql = \"SELECT * FROM matches WHERE (player1 = '{player1}' OR \"\\\n"}, {"line_no": 9, "char_start": 267, "char_end": 337, "line": "            +\"player2 = '{player1}') AND (player1 = '{player2}' OR \"\\\n"}, {"line_no": 10, "char_start": 337, "char_end": 395, "line": "            +\"player2 = '{player2}') ORDER BY date DESC;\"\n"}, {"line_no": 11, "char_start": 395, "char_end": 447, "line": "    args = {'player1': player1, 'player2': player2}\n"}, {"line_no": 12, "char_start": 447, "char_end": 479, "line": "    result = db.exec(sql, args)\n"}]}, "char_changes": {"deleted": [{"char_start": 250, "char_end": 256, "chars": "\"+str("}, {"char_start": 263, "char_end": 266, "chars": ")+\""}, {"char_start": 299, "char_end": 305, "chars": "\"+str("}, {"char_start": 312, "char_end": 315, "chars": ")+\""}, {"char_start": 334, "char_end": 340, "chars": "\"+str("}, {"char_start": 347, "char_end": 350, "chars": ")+\""}, {"char_start": 383, "char_end": 389, "chars": "\"+str("}, {"char_start": 396, "char_end": 399, "chars": ")+\""}], "added": [{"char_start": 250, "char_end": 251, "chars": "{"}, {"char_start": 258, "char_end": 259, "chars": "}"}, {"char_start": 292, "char_end": 293, "chars": "{"}, {"char_start": 300, "char_end": 301, "chars": "}"}, {"char_start": 320, "char_end": 321, "chars": "{"}, {"char_start": 328, "char_end": 329, "chars": "}"}, {"char_start": 362, "char_end": 363, "chars": "{"}, {"char_start": 370, "char_end": 371, "chars": "}"}, {"char_start": 399, "char_end": 451, "chars": "args = {'player1': player1, 'player2': player2}\n    "}, {"char_start": 471, "char_end": 477, "chars": ", args"}]}}
{"func_name": "insertData", "func_src_before": "    def insertData(self,userid,post):\n        sqlText=\"insert into post(userid,date,comment) \\\n                values(%d,current_timestamp(0),'%s');\"%(userid,post);\n        result=sql.insertDB(self.conn,sqlText)\n        return result;", "func_src_after": "    def insertData(self,userid,post):\n        sqlText=\"insert into post(userid,date,comment) \\\n                values(%s,current_timestamp(0),%s);\"\n        params=[userid,post];\n        result=sql.insertDB(self.conn,sqlText,params)\n        return result;", "commit_link": "github.com/ShaominLi/Twitter_project/commit/5329d91f9e569c95184053c8e7ef596949c33ce9", "file_name": "modules/post.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 3, "char_start": 95, "char_end": 165, "line": "                values(%d,current_timestamp(0),'%s');\"%(userid,post);\n"}, {"line_no": 4, "char_start": 165, "char_end": 212, "line": "        result=sql.insertDB(self.conn,sqlText)\n"}], "added": [{"line_no": 3, "char_start": 95, "char_end": 148, "line": "                values(%s,current_timestamp(0),%s);\"\n"}, {"line_no": 4, "char_start": 148, "char_end": 178, "line": "        params=[userid,post];\n"}, {"line_no": 5, "char_start": 178, "char_end": 232, "line": "        result=sql.insertDB(self.conn,sqlText,params)\n"}]}, "char_changes": {"deleted": [{"char_start": 119, "char_end": 120, "chars": "d"}, {"char_start": 142, "char_end": 143, "chars": "'"}, {"char_start": 145, "char_end": 146, "chars": "'"}, {"char_start": 149, "char_end": 151, "chars": "%("}, {"char_start": 162, "char_end": 163, "chars": ")"}], "added": [{"char_start": 119, "char_end": 120, "chars": "s"}, {"char_start": 147, "char_end": 164, "chars": "\n        params=["}, {"char_start": 175, "char_end": 176, "chars": "]"}, {"char_start": 223, "char_end": 230, "chars": ",params"}]}}
{"func_name": "get_requested_month_for_inverter", "func_src_before": "    def get_requested_month_for_inverter(self, inverter_serial, date):\n        data = dict()\n\n        month_start, month_end = self.get_epoch_month(date)\n        data['interval'] = {'from': self.convert_local_ts_to_utc(month_start, self.local_timezone), 'to': self.convert_local_ts_to_utc(month_end, self.local_timezone)}\n        month_total = 0\n\n        query = '''\n            SELECT TimeStamp, DayYield AS Power \n            FROM MonthData \n            WHERE TimeStamp BETWEEN %s AND %s AND Serial = %s\n            '''\n\n        data['data'] = list()\n        for row in self.c.execute(query % (month_start, month_end, inverter_serial)):\n            data['data'].append({'time': self.convert_local_ts_to_utc(row[0], self.local_timezone), 'power': row[1]})\n            month_total += row[1]\n\n        data['total'] = month_total\n\n        query = '''\n            SELECT MIN(TimeStamp) as Min, MAX(TimeStamp) as Max \n            FROM MonthData \n            WHERE Serial = %s;\n            ''' % inverter_serial\n\n        self.c.execute(query)\n        first_data, last_data = self.c.fetchone()\n\n        if first_data: data['hasPrevious'] = (first_data < month_start)\n        else: data['hasPrevious'] = False\n        if last_data: data['hasNext'] = (last_data > month_end)\n        else: data['hasNext'] = False\n\n        return data", "func_src_after": "    def get_requested_month_for_inverter(self, inverter_serial, date):\n        data = dict()\n\n        month_start, month_end = self.get_epoch_month(date)\n        data['interval'] = {'from': self.convert_local_ts_to_utc(month_start, self.local_timezone), 'to': self.convert_local_ts_to_utc(month_end, self.local_timezone)}\n        month_total = 0\n\n        query = '''\n            SELECT TimeStamp, DayYield AS Power \n            FROM MonthData \n            WHERE TimeStamp BETWEEN ? AND ? AND Serial=?;\n            '''\n\n        data['data'] = list()\n        for row in self.c.execute(query, (month_start, month_end, inverter_serial)):\n            data['data'].append({'time': self.convert_local_ts_to_utc(row[0], self.local_timezone), 'power': row[1]})\n            month_total += row[1]\n\n        data['total'] = month_total\n\n        query = '''\n            SELECT MIN(TimeStamp) as Min, MAX(TimeStamp) as Max \n            FROM MonthData \n            WHERE Serial=?;\n            '''\n\n        self.c.execute(query, (inverter_serial,))\n        first_data, last_data = self.c.fetchone()\n\n        if first_data: data['hasPrevious'] = (first_data < month_start)\n        else: data['hasPrevious'] = False\n        if last_data: data['hasNext'] = (last_data > month_end)\n        else: data['hasNext'] = False\n\n        return data", "commit_link": "github.com/philipptrenz/sunportal/commit/7eef493a168ed4e6731ff800713bfb8aee99a506", "file_name": "util/database.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 11, "char_start": 444, "char_end": 506, "line": "            WHERE TimeStamp BETWEEN %s AND %s AND Serial = %s\n"}, {"line_no": 15, "char_start": 553, "char_end": 639, "line": "        for row in self.c.execute(query % (month_start, month_end, inverter_serial)):\n"}, {"line_no": 24, "char_start": 942, "char_end": 973, "line": "            WHERE Serial = %s;\n"}, {"line_no": 25, "char_start": 973, "char_end": 1007, "line": "            ''' % inverter_serial\n"}, {"line_no": 27, "char_start": 1008, "char_end": 1038, "line": "        self.c.execute(query)\n"}], "added": [{"line_no": 11, "char_start": 444, "char_end": 502, "line": "            WHERE TimeStamp BETWEEN ? AND ? AND Serial=?;\n"}, {"line_no": 15, "char_start": 549, "char_end": 634, "line": "        for row in self.c.execute(query, (month_start, month_end, inverter_serial)):\n"}, {"line_no": 24, "char_start": 937, "char_end": 965, "line": "            WHERE Serial=?;\n"}, {"line_no": 25, "char_start": 965, "char_end": 981, "line": "            '''\n"}, {"line_no": 27, "char_start": 982, "char_end": 1032, "line": "        self.c.execute(query, (inverter_serial,))\n"}]}, "char_changes": {"deleted": [{"char_start": 480, "char_end": 482, "chars": "%s"}, {"char_start": 487, "char_end": 489, "chars": "%s"}, {"char_start": 500, "char_end": 501, "chars": " "}, {"char_start": 502, "char_end": 505, "chars": " %s"}, {"char_start": 592, "char_end": 594, "chars": " %"}, {"char_start": 966, "char_end": 967, "chars": " "}, {"char_start": 968, "char_end": 971, "chars": " %s"}, {"char_start": 988, "char_end": 1006, "chars": " % inverter_serial"}], "added": [{"char_start": 480, "char_end": 481, "chars": "?"}, {"char_start": 486, "char_end": 487, "chars": "?"}, {"char_start": 499, "char_end": 501, "chars": "?;"}, {"char_start": 588, "char_end": 589, "chars": ","}, {"char_start": 962, "char_end": 963, "chars": "?"}, {"char_start": 1010, "char_end": 1030, "chars": ", (inverter_serial,)"}]}}
{"func_name": "delete_resultSet", "func_src_before": "    def delete_resultSet(self, session, id):\n        self._openContainer(session)\n        sid = str(id)\n        if (self.idNormalizer is not None):\n            sid = self.idNormalizer.process_string(session, sid)\n        query = \"DELETE FROM %s WHERE identifier = '%s';\" % (self.table, sid)\n        self._query(query)", "func_src_after": "    def delete_resultSet(self, session, id):\n        self._openContainer(session)\n        sid = str(id)\n        if (self.idNormalizer is not None):\n            sid = self.idNormalizer.process_string(session, sid)\n        query = \"DELETE FROM %s WHERE identifier = $1;\" % (self.table)\n        self._query(query, sid)", "commit_link": "github.com/cheshire3/cheshire3/commit/d350363b4ea10f102c24c8f26d7b76b006323e8e", "file_name": "cheshire3/sql/resultSetStore.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 6, "char_start": 213, "char_end": 291, "line": "        query = \"DELETE FROM %s WHERE identifier = '%s';\" % (self.table, sid)\n"}, {"line_no": 7, "char_start": 291, "char_end": 317, "line": "        self._query(query)\n"}], "added": [{"line_no": 6, "char_start": 213, "char_end": 284, "line": "        query = \"DELETE FROM %s WHERE identifier = $1;\" % (self.table)\n"}, {"line_no": 7, "char_start": 284, "char_end": 315, "line": "        self._query(query, sid)"}]}, "char_changes": {"deleted": [{"char_start": 264, "char_end": 268, "chars": "'%s'"}, {"char_start": 284, "char_end": 289, "chars": ", sid"}], "added": [{"char_start": 264, "char_end": 266, "chars": "$1"}, {"char_start": 309, "char_end": 314, "chars": ", sid"}]}}
{"func_name": "getSeriesDateFromDatabase", "func_src_before": "def getSeriesDateFromDatabase(submission):\n    database = sqlite3.connect('database.db')\n    cursor = database.cursor()\n    return cursor.execute(\"SELECT StartDate FROM SeriesTracking WHERE SeriesTitle = '\" + str(getTitle(submission)) + \"'\").fetchone()[0]\n    database.close()", "func_src_after": "def getSeriesDateFromDatabase(submission):\n    database = sqlite3.connect('database.db')\n    cursor = database.cursor()\n    return cursor.execute(\"SELECT StartDate FROM SeriesTracking WHERE SeriesTitle = ?\", [getTitle(submission)]).fetchone()[0]\n    database.close()", "commit_link": "github.com/LiquidFun/Reddit-GeoGuessr-Tracking-Bot/commit/0cad2d52e24b05da32789fbc8face7a9999a71f9", "file_name": "CheckAndPostForSeriesSubmissions.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 4, "char_start": 120, "char_end": 256, "line": "    return cursor.execute(\"SELECT StartDate FROM SeriesTracking WHERE SeriesTitle = '\" + str(getTitle(submission)) + \"'\").fetchone()[0]\n"}], "added": [{"line_no": 4, "char_start": 120, "char_end": 246, "line": "    return cursor.execute(\"SELECT StartDate FROM SeriesTracking WHERE SeriesTitle = ?\", [getTitle(submission)]).fetchone()[0]\n"}]}, "char_changes": {"deleted": [{"char_start": 204, "char_end": 205, "chars": "'"}, {"char_start": 206, "char_end": 208, "chars": " +"}, {"char_start": 209, "char_end": 213, "chars": "str("}, {"char_start": 233, "char_end": 240, "chars": ") + \"'\""}], "added": [{"char_start": 204, "char_end": 205, "chars": "?"}, {"char_start": 206, "char_end": 207, "chars": ","}, {"char_start": 208, "char_end": 209, "chars": "["}, {"char_start": 229, "char_end": 230, "chars": "]"}]}}
{"func_name": "karma_add", "func_src_before": "def karma_add(name):\n    karma = karma_ask(name)\n    db = db_connect()\n    cursor = db.cursor()\n    if karma is None:\n        try:\n            cursor.execute('''\n                INSERT INTO people(name,karma,shame) VALUES('{}',1,0)\n                '''.format(name))\n            db.commit()\n            logger.debug('Inserted into karmadb 1 karma for {}'.format(name))\n            return 1\n        except Exception as e:\n            logger.error('Execution failed with error: {}'.format(e))\n            raise\n    else:\n        karma = karma + 1\n        try:\n            cursor.execute('''\n                UPDATE people SET karma = {0} WHERE name = '{1}'\n                '''.format(karma, name))\n            db.commit()\n            logger.debug('Inserted into karmadb {} karma for {}'.format(\n                karma, name))\n            return karma\n\n        except Exception as e:\n            logger.error('Execution failed with error: {}'.format(e))\n            raise\n    db.close()", "func_src_after": "def karma_add(name):\n    karma = karma_ask(name)\n    db = db_connect()\n    cursor = db.cursor()\n    if karma is None:\n        try:\n            cursor.execute('''\n                INSERT INTO people(name,karma,shame) VALUES(%(name)s,1,0)\n                ''', name)\n            db.commit()\n            logger.debug('Inserted into karmadb 1 karma for {}'.format(name))\n            return 1\n        except Exception as e:\n            logger.error('Execution failed with error: {}'.format(e))\n            raise\n    else:\n        karma = karma + 1\n        try:\n            cursor.execute('''\n                UPDATE people SET karma = %(karma)s WHERE name = %(name)s\n                ''', (karma, name))\n            db.commit()\n            logger.debug('Inserted into karmadb {} karma for {}'.format(\n                karma,\n                name,\n            ))\n            return karma\n\n        except Exception as e:\n            logger.error('Execution failed with error: {}'.format(e))\n            raise\n    db.close()", "commit_link": "github.com/tylarb/KarmaBoi-PCF/commit/c1d00a27d7f6b7eb6f15a3dacd4269654a32c10a", "file_name": "KarmaBoi/dbopts.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 8, "char_start": 162, "char_end": 232, "line": "                INSERT INTO people(name,karma,shame) VALUES('{}',1,0)\n"}, {"line_no": 9, "char_start": 232, "char_end": 266, "line": "                '''.format(name))\n"}, {"line_no": 20, "char_start": 588, "char_end": 653, "line": "                UPDATE people SET karma = {0} WHERE name = '{1}'\n"}, {"line_no": 21, "char_start": 653, "char_end": 694, "line": "                '''.format(karma, name))\n"}, {"line_no": 24, "char_start": 791, "char_end": 821, "line": "                karma, name))\n"}], "added": [{"line_no": 8, "char_start": 162, "char_end": 236, "line": "                INSERT INTO people(name,karma,shame) VALUES(%(name)s,1,0)\n"}, {"line_no": 9, "char_start": 236, "char_end": 263, "line": "                ''', name)\n"}, {"line_no": 20, "char_start": 585, "char_end": 659, "line": "                UPDATE people SET karma = %(karma)s WHERE name = %(name)s\n"}, {"line_no": 21, "char_start": 659, "char_end": 695, "line": "                ''', (karma, name))\n"}, {"line_no": 24, "char_start": 792, "char_end": 815, "line": "                karma,\n"}, {"line_no": 25, "char_start": 815, "char_end": 837, "line": "                name,\n"}, {"line_no": 26, "char_start": 837, "char_end": 852, "line": "            ))\n"}]}, "char_changes": {"deleted": [{"char_start": 222, "char_end": 226, "chars": "'{}'"}, {"char_start": 251, "char_end": 259, "chars": ".format("}, {"char_start": 263, "char_end": 264, "chars": ")"}, {"char_start": 630, "char_end": 633, "chars": "{0}"}, {"char_start": 647, "char_end": 652, "chars": "'{1}'"}, {"char_start": 672, "char_end": 679, "chars": ".format"}], "added": [{"char_start": 222, "char_end": 230, "chars": "%(name)s"}, {"char_start": 255, "char_end": 257, "chars": ", "}, {"char_start": 627, "char_end": 636, "chars": "%(karma)s"}, {"char_start": 650, "char_end": 658, "chars": "%(name)s"}, {"char_start": 678, "char_end": 680, "chars": ", "}, {"char_start": 814, "char_end": 830, "chars": "\n               "}, {"char_start": 835, "char_end": 849, "chars": ",\n            "}]}}
{"func_name": "update_date_modified", "func_src_before": "  def update_date_modified(self):\n    sql = \"UPDATE jdk_entries \" + \\\n      \"SET date_last_modified = \" + CURRENT_DATESTAMP + \" \" + \\\n      \"WHERE jdk_entries.id = '\" + self.entry_id + \"';\"\n    \n    db_execute(sql)\n\n    return None", "func_src_after": "  def update_date_modified(self):\n    quote_tuple = CURRENT_DATESTAMP, self.entry_id\n\n    sql = \"UPDATE jdk_entries \" + \\\n      \"SET date_last_modified = ? \" + \\\n      \"WHERE jdk_entries.id = ?;\"\n    \n    db_execute(sql, quote_tuple)\n\n    return None", "commit_link": "github.com/peterlebrun/jdk/commit/000238566fbe55ba09676c3d57af04ae207235ae", "file_name": "entry.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 3, "char_start": 70, "char_end": 134, "line": "      \"SET date_last_modified = \" + CURRENT_DATESTAMP + \" \" + \\\n"}, {"line_no": 4, "char_start": 134, "char_end": 190, "line": "      \"WHERE jdk_entries.id = '\" + self.entry_id + \"';\"\n"}, {"line_no": 6, "char_start": 195, "char_end": 215, "line": "    db_execute(sql)\n"}], "added": [{"line_no": 2, "char_start": 34, "char_end": 85, "line": "    quote_tuple = CURRENT_DATESTAMP, self.entry_id\n"}, {"line_no": 3, "char_start": 85, "char_end": 86, "line": "\n"}, {"line_no": 5, "char_start": 122, "char_end": 162, "line": "      \"SET date_last_modified = ? \" + \\\n"}, {"line_no": 6, "char_start": 162, "char_end": 196, "line": "      \"WHERE jdk_entries.id = ?;\"\n"}, {"line_no": 8, "char_start": 201, "char_end": 234, "line": "    db_execute(sql, quote_tuple)\n"}]}, "char_changes": {"deleted": [{"char_start": 102, "char_end": 127, "chars": "\" + CURRENT_DATESTAMP + \""}, {"char_start": 164, "char_end": 187, "chars": "'\" + self.entry_id + \"'"}], "added": [{"char_start": 38, "char_end": 90, "chars": "quote_tuple = CURRENT_DATESTAMP, self.entry_id\n\n    "}, {"char_start": 154, "char_end": 155, "chars": "?"}, {"char_start": 192, "char_end": 193, "chars": "?"}, {"char_start": 219, "char_end": 232, "chars": ", quote_tuple"}]}}
{"func_name": "system_search", "func_src_before": "    def system_search(self, search):\r\n        search = search.lower()\r\n        conn = sqlite3.connect('data/ed.db').cursor()\r\n        table = conn.execute(f\"select * from populated where lower(name) = '{search}'\")\r\n        results = table.fetchone()\r\n        if not results:\r\n            table = conn.execute(f\"select * from systems where lower(name) = '{search}'\")\r\n            results = table.fetchone()\r\n        if results:\r\n            keys = tuple(i[0] for i in table.description) \r\n            return '\\n'.join(f'{key.replace(\"_\", \" \").title()}: {field}'\r\n                             for key, field in zip(keys[1:], results[1:]) if field)\r\n        else:\r\n            return 'No systems found.'", "func_src_after": "    def system_search(self, search):\r\n        search = search.lower()\r\n        conn = sqlite3.connect('data/ed.db').cursor()\r\n        table = conn.execute('select * from populated where lower(name) = ?', (search,))\r\n        results = table.fetchone()\r\n        if not results:\r\n            table = conn.execute('select * from systems where lower(name) = ?', (search,))\r\n            results = table.fetchone()\r\n        if results:\r\n            keys = tuple(i[0] for i in table.description) \r\n            return '\\n'.join(f'{key.replace(\"_\", \" \").title()}: {field}'\r\n                             for key, field in zip(keys[1:], results[1:]) if field)\r\n        else:\r\n            return 'No systems found.'", "commit_link": "github.com/BeatButton/beattie/commit/ab36b2053ee09faf4cc9a279cf7a4c010864cb29", "file_name": "eddb.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 4, "char_start": 126, "char_end": 215, "line": "        table = conn.execute(f\"select * from populated where lower(name) = '{search}'\")\r\n"}, {"line_no": 7, "char_start": 276, "char_end": 367, "line": "            table = conn.execute(f\"select * from systems where lower(name) = '{search}'\")\r\n"}], "added": [{"line_no": 4, "char_start": 126, "char_end": 216, "line": "        table = conn.execute('select * from populated where lower(name) = ?', (search,))\r\n"}, {"line_no": 7, "char_start": 277, "char_end": 369, "line": "            table = conn.execute('select * from systems where lower(name) = ?', (search,))\r\n"}]}, "char_changes": {"deleted": [{"char_start": 155, "char_end": 157, "chars": "f\""}, {"char_start": 202, "char_end": 203, "chars": "{"}, {"char_start": 209, "char_end": 212, "chars": "}'\""}, {"char_start": 309, "char_end": 311, "chars": "f\""}, {"char_start": 354, "char_end": 355, "chars": "{"}, {"char_start": 361, "char_end": 364, "chars": "}'\""}], "added": [{"char_start": 155, "char_end": 156, "chars": "'"}, {"char_start": 200, "char_end": 201, "chars": "?"}, {"char_start": 202, "char_end": 205, "chars": ", ("}, {"char_start": 211, "char_end": 213, "chars": ",)"}, {"char_start": 310, "char_end": 311, "chars": "'"}, {"char_start": 353, "char_end": 354, "chars": "?"}, {"char_start": 355, "char_end": 358, "chars": ", ("}, {"char_start": 364, "char_end": 366, "chars": ",)"}]}}
{"func_name": "add_input", "func_src_before": "    def add_input(self, data):\n        connection = self.connect()\n        try:\n            # The following introduces a deliberate security flaw - SQL Injection\n            query = \"INSERT INTO crimes (description) VALUES ('{}');\".format(data)\n            with connection.cursor() as cursor:\n                cursor.execute(query)\n                connection.commit()\n        finally:\n            connection.close()", "func_src_after": "    def add_input(self, data):\n        connection = self.connect()\n        try:\n            # The following introduces a deliberate security flaw - SQL Injection\n            query = \"INSERT INTO crimes (description) VALUES (%s);\"\n            with connection.cursor() as cursor:\n                cursor.execute(query, data)\n                connection.commit()\n        finally:\n            connection.close()", "commit_link": "github.com/rwolf527/crimemap/commit/50b0695e0b4c46165e6146f6fac4cd6871d9fdf6", "file_name": "dbhelper.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 5, "char_start": 162, "char_end": 245, "line": "            query = \"INSERT INTO crimes (description) VALUES ('{}');\".format(data)\n"}, {"line_no": 7, "char_start": 293, "char_end": 331, "line": "                cursor.execute(query)\n"}], "added": [{"line_no": 5, "char_start": 162, "char_end": 230, "line": "            query = \"INSERT INTO crimes (description) VALUES (%s);\"\n"}, {"line_no": 7, "char_start": 278, "char_end": 322, "line": "                cursor.execute(query, data)\n"}]}, "char_changes": {"deleted": [{"char_start": 224, "char_end": 228, "chars": "'{}'"}, {"char_start": 231, "char_end": 244, "chars": ".format(data)"}], "added": [{"char_start": 224, "char_end": 226, "chars": "%s"}, {"char_start": 314, "char_end": 320, "chars": ", data"}]}}
{"func_name": "get_login", "func_src_before": "@bot.message_handler(commands =['login'])\ndef get_login(message):\n    settings = sqlite3.connect(os.path.abspath(os.path.dirname(__file__)) + \"\\\\bases\\\\settings.db\")\n    conn = settings.cursor()\n    conn.execute(\"select * from users where chat_id = '\" + str(message.chat.id) + \"'\")\n    name = conn.fetchone()\n    if name != None:\n        bot.send_message(message.chat.id, \"Previous handle: \" + str(name[1]))\n    else:\n        bot.send_message(message.chat.id, \"Previous handle: None\")\n    settings.close()\n    bot.send_message(message.chat.id, \"Type new handle: \")\n    set_state(message.chat.id, config.States.S_LOGIN.value)", "func_src_after": "@bot.message_handler(commands =['login'])\ndef get_login(message):\n    settings = sqlite3.connect(os.path.abspath(os.path.dirname(__file__)) + \"\\\\bases\\\\settings.db\")\n    conn = settings.cursor()\n    conn.execute(\"select * from users where chat_id = ?\", (str(message.chat.id),))\n    name = conn.fetchone()\n    if name != None:\n        bot.send_message(message.chat.id, \"Previous handle: \" + str(name[1]))\n    else:\n        bot.send_message(message.chat.id, \"Previous handle: None\")\n    settings.close()\n    bot.send_message(message.chat.id, \"Type new handle: \")\n    set_state(message.chat.id, config.States.S_LOGIN.value)", "commit_link": "github.com/lissrbay/codeforces_bot/commit/cc7f5143445a0030b1149ac60a65b1b1b9c92a90", "file_name": "bot.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 5, "char_start": 195, "char_end": 282, "line": "    conn.execute(\"select * from users where chat_id = '\" + str(message.chat.id) + \"'\")\n"}], "added": [{"line_no": 5, "char_start": 195, "char_end": 278, "line": "    conn.execute(\"select * from users where chat_id = ?\", (str(message.chat.id),))\n"}]}, "char_changes": {"deleted": [{"char_start": 249, "char_end": 250, "chars": "'"}, {"char_start": 251, "char_end": 253, "chars": " +"}, {"char_start": 274, "char_end": 280, "chars": " + \"'\""}], "added": [{"char_start": 249, "char_end": 250, "chars": "?"}, {"char_start": 251, "char_end": 252, "chars": ","}, {"char_start": 253, "char_end": 254, "chars": "("}, {"char_start": 274, "char_end": 276, "chars": ",)"}]}}
{"func_name": "login", "func_src_before": "    def login(self, username, password):\n        select_query = \"\"\"\n            SELECT client_id, username, balance, message\n            FROM Clients\n            WHERE username = '{}' AND password = '{}'\n            LIMIT 1\n        \"\"\".format(username, password)\n\n        cursor = self.__conn.cursor()\n\n        cursor.execute(select_query)\n        user = cursor.fetchone()\n\n        if(user):\n            return Client(user[0], user[1], user[2], user[3])\n        else:\n            return False", "func_src_after": "    def login(self, username, password):\n        select_query = \"\"\"\n            SELECT client_id, username, balance, message\n            FROM Clients\n            WHERE username = ? AND password = ?\n            LIMIT 1\n        \"\"\"\n\n        cursor = self.__conn.cursor()\n\n        cursor.execute(select_query, (username, password))\n        user = cursor.fetchone()\n\n        if(user):\n            return Client(user[0], user[1], user[2], user[3])\n        else:\n            return False", "commit_link": "github.com/AnetaStoycheva/Programming101_HackBulgaria/commit/c0d6f4b8fe83a375832845a45952b5153e4c34f3", "file_name": "Week_9/sql_manager.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 5, "char_start": 150, "char_end": 204, "line": "            WHERE username = '{}' AND password = '{}'\n"}, {"line_no": 7, "char_start": 224, "char_end": 263, "line": "        \"\"\".format(username, password)\n"}, {"line_no": 11, "char_start": 303, "char_end": 340, "line": "        cursor.execute(select_query)\n"}], "added": [{"line_no": 5, "char_start": 150, "char_end": 198, "line": "            WHERE username = ? AND password = ?\n"}, {"line_no": 7, "char_start": 218, "char_end": 230, "line": "        \"\"\"\n"}, {"line_no": 11, "char_start": 270, "char_end": 329, "line": "        cursor.execute(select_query, (username, password))\n"}]}, "char_changes": {"deleted": [{"char_start": 179, "char_end": 183, "chars": "'{}'"}, {"char_start": 199, "char_end": 203, "chars": "'{}'"}, {"char_start": 235, "char_end": 262, "chars": ".format(username, password)"}], "added": [{"char_start": 179, "char_end": 180, "chars": "?"}, {"char_start": 196, "char_end": 197, "chars": "?"}, {"char_start": 305, "char_end": 327, "chars": ", (username, password)"}]}}
{"func_name": "get_current_state", "func_src_before": "def get_current_state(chat_id):\n    settings = sqlite3.connect(os.path.abspath(os.path.dirname(__file__))+\"\\\\bases\\\\settings.db\")\n    conn = settings.cursor()\n    conn.execute(\"select * from users where chat_id = '\" + str(chat_id) + \"'\")\n    name = conn.fetchone()\n    if name != None:\n        return name[4]\n    else:\n        return False\n    settings.close()", "func_src_after": "def get_current_state(chat_id):\n    settings = sqlite3.connect(os.path.abspath(os.path.dirname(__file__))+\"\\\\bases\\\\settings.db\")\n    conn = settings.cursor()\n    conn.execute(\"select * from users where chat_id = ?\", (str(chat_id),))\n    name = conn.fetchone()\n    if name != None:\n        return name[4]\n    else:\n        return False\n    settings.close()", "commit_link": "github.com/lissrbay/codeforces_bot/commit/cc7f5143445a0030b1149ac60a65b1b1b9c92a90", "file_name": "bot.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 4, "char_start": 159, "char_end": 238, "line": "    conn.execute(\"select * from users where chat_id = '\" + str(chat_id) + \"'\")\n"}], "added": [{"line_no": 4, "char_start": 159, "char_end": 234, "line": "    conn.execute(\"select * from users where chat_id = ?\", (str(chat_id),))\n"}]}, "char_changes": {"deleted": [{"char_start": 213, "char_end": 214, "chars": "'"}, {"char_start": 215, "char_end": 217, "chars": " +"}, {"char_start": 230, "char_end": 236, "chars": " + \"'\""}], "added": [{"char_start": 213, "char_end": 214, "chars": "?"}, {"char_start": 215, "char_end": 216, "chars": ","}, {"char_start": 217, "char_end": 218, "chars": "("}, {"char_start": 230, "char_end": 232, "chars": ",)"}]}}
{"func_name": "fetch_page_name", "func_src_before": "  def fetch_page_name(self, page_id):\n    '''\n    Returns the page name corresponding to the provided page ID.\n\n    Args:\n      page_id: The page ID whose ID to fetch.\n\n    Returns:\n      str: The page name corresponding to the provided page ID.\n\n    Raises:\n      ValueError: If the provided page ID is invalid or does not exist.\n    '''\n    helpers.validate_page_id(page_id)\n\n    query = 'SELECT name FROM pages WHERE id=\"{0}\"'.format(page_id)\n    self.cursor.execute(query)\n\n    page_name = self.cursor.fetchone()\n\n    if not page_name:\n      raise ValueError('Invalid page ID \"{0}\" provided. Page ID does not exist.'.format(page_id))\n\n    return page_name[0].encode('utf-8').replace('_', ' ')", "func_src_after": "  def fetch_page_name(self, page_id):\n    '''\n    Returns the page name corresponding to the provided page ID.\n\n    Args:\n      page_id: The page ID whose ID to fetch.\n\n    Returns:\n      str: The page name corresponding to the provided page ID.\n\n    Raises:\n      ValueError: If the provided page ID is invalid or does not exist.\n    '''\n    helpers.validate_page_id(page_id)\n\n    query = 'SELECT name FROM pages WHERE id = ?;'\n    query_bindings = (page_id,)\n    self.cursor.execute(query, query_bindings)\n\n    page_name = self.cursor.fetchone()\n\n    if not page_name:\n      raise ValueError('Invalid page ID \"{0}\" provided. Page ID does not exist.'.format(page_id))\n\n    return page_name[0].encode('utf-8').replace('_', ' ')", "commit_link": "github.com/jwngr/sdow/commit/4db98f3521592f17550d2b723336f33fec5e112a", "file_name": "sdow/database.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 16, "char_start": 378, "char_end": 446, "line": "    query = 'SELECT name FROM pages WHERE id=\"{0}\"'.format(page_id)\n"}, {"line_no": 17, "char_start": 446, "char_end": 477, "line": "    self.cursor.execute(query)\n"}], "added": [{"line_no": 16, "char_start": 378, "char_end": 429, "line": "    query = 'SELECT name FROM pages WHERE id = ?;'\n"}, {"line_no": 17, "char_start": 429, "char_end": 461, "line": "    query_bindings = (page_id,)\n"}, {"line_no": 18, "char_start": 461, "char_end": 508, "line": "    self.cursor.execute(query, query_bindings)\n"}]}, "char_changes": {"deleted": [{"char_start": 423, "char_end": 428, "chars": "\"{0}\""}, {"char_start": 429, "char_end": 432, "chars": ".fo"}, {"char_start": 433, "char_end": 436, "chars": "mat"}], "added": [{"char_start": 422, "char_end": 423, "chars": " "}, {"char_start": 424, "char_end": 427, "chars": " ?;"}, {"char_start": 428, "char_end": 436, "chars": "\n    que"}, {"char_start": 437, "char_end": 450, "chars": "y_bindings = "}, {"char_start": 458, "char_end": 459, "chars": ","}, {"char_start": 490, "char_end": 506, "chars": ", query_bindings"}]}}
{"func_name": "save_page_edit", "func_src_before": "@app.route('/<page_name>/save', methods=['POST'])\ndef save_page_edit(page_name):\n    # grab the new content from the user\n    content = request.form.get('content')\n    # check if 'page_name' exists in the database\n    query = db.query(\"select page_content.content, page.id as page_id, page_content.id as content_id from page, page_content where page.id = page_content.page_id and page.page_name = '%s' order by page_content.id desc limit 1\" % page_name)\n    result = query.namedresult()\n    # if it doesn't exist, create a new page in the database\n    if len(result) < 1:\n        db.insert(\n            'page', {\n                'page_name': page_name\n            }\n        )\n    else:\n        pass\n    # now that we're certain that the page exists in the database, we again grab the query\n    # and insert new content in the database\n    query = db.query(\"select id from page where page_name = '%s'\" % page_name)\n    page_id = query.namedresult()[0].id\n    db.insert(\n        'page_content', {\n            'page_id': page_id,\n            'content': content,\n            'timestamp': time.strftime(\"%Y-%m-%d %H:%M:%S\", localtime())\n        }\n    )\n    return redirect(\"/%s\" % page_name)", "func_src_after": "@app.route('/<page_name>/save', methods=['POST'])\ndef save_page_edit(page_name):\n    # grab the new content from the user\n    content = request.form.get('content')\n    # check if 'page_name' exists in the database\n    query = db.query(\"select page_content.content, page.id as page_id, page_content.id as content_id from page, page_content where page.id = page_content.page_id and page.page_name = $1 order by page_content.id desc limit 1\", page_name)\n    result = query.namedresult()\n    # if it doesn't exist, create a new page in the database\n    if len(result) < 1:\n        db.insert(\n            'page', {\n                'page_name': page_name\n            }\n        )\n    else:\n        pass\n    # now that we're certain that the page exists in the database, we again grab the query\n    # and insert new content in the database\n    query = db.query(\"select id from page where page_name = '%s'\" % page_name)\n    page_id = query.namedresult()[0].id\n    db.insert(\n        'page_content', {\n            'page_id': page_id,\n            'content': content,\n            'timestamp': time.strftime(\"%Y-%m-%d %H:%M:%S\", localtime())\n        }\n    )\n    return redirect(\"/%s\" % page_name)", "commit_link": "github.com/Pumala/python_wiki_app_redo/commit/65d60747cd8efb05970304234d3bd949d2088e8b", "file_name": "server.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 6, "char_start": 214, "char_end": 454, "line": "    query = db.query(\"select page_content.content, page.id as page_id, page_content.id as content_id from page, page_content where page.id = page_content.page_id and page.page_name = '%s' order by page_content.id desc limit 1\" % page_name)\n"}], "added": [{"line_no": 6, "char_start": 214, "char_end": 451, "line": "    query = db.query(\"select page_content.content, page.id as page_id, page_content.id as content_id from page, page_content where page.id = page_content.page_id and page.page_name = $1 order by page_content.id desc limit 1\", page_name)\n"}]}, "char_changes": {"deleted": [{"char_start": 397, "char_end": 401, "chars": "'%s'"}, {"char_start": 440, "char_end": 442, "chars": " %"}], "added": [{"char_start": 397, "char_end": 399, "chars": "$1"}, {"char_start": 438, "char_end": 439, "chars": ","}]}}
{"func_name": "get_top_popular", "func_src_before": "def get_top_popular(top_num):\r\n    \"\"\" query the top(top_num) popular articles\r\n        top_num => list of [title, count]\r\n    \"\"\"\r\n    cmd = \"\"\"SELECT title, views FROM articles\r\n             INNER JOIN (\r\n             SELECT path, count(path) AS views\r\n             FROM log GROUP BY log.path\r\n             ) AS log\r\n             ON log.path = '/article/' || articles.slug\r\n             ORDER BY views DESC\r\n             LIMIT {}\"\"\".format(top_num)\r\n    return execute_query(cmd)", "func_src_after": "def get_top_popular(top_num):\r\n    \"\"\" query the top(top_num) popular articles\r\n        top_num => list of [title, count]\r\n    \"\"\"\r\n    cmd = \"\"\"SELECT title, views FROM articles\r\n             INNER JOIN (\r\n             SELECT path, count(path) AS views\r\n             FROM log GROUP BY log.path\r\n             ) AS log\r\n             ON log.path = '/article/' || articles.slug\r\n             ORDER BY views DESC\r\n             LIMIT %s\"\"\"\r\n    data = [top_num, ]\r\n    return execute_query(cmd, data)", "commit_link": "github.com/thugasin/udacity-homework-logAnalyzer/commit/506f25f9a1caee7f17034adf7c75e0efbc88082b", "file_name": "logAnalyzerDb.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 12, "char_start": 410, "char_end": 452, "line": "             LIMIT {}\"\"\".format(top_num)\r\n"}, {"line_no": 13, "char_start": 452, "char_end": 481, "line": "    return execute_query(cmd)\r\n"}], "added": [{"line_no": 12, "char_start": 410, "char_end": 436, "line": "             LIMIT %s\"\"\"\r\n"}, {"line_no": 13, "char_start": 436, "char_end": 460, "line": "    data = [top_num, ]\r\n"}, {"line_no": 14, "char_start": 460, "char_end": 495, "line": "    return execute_query(cmd, data)\r\n"}]}, "char_changes": {"deleted": [{"char_start": 429, "char_end": 431, "chars": "{}"}, {"char_start": 434, "char_end": 439, "chars": ".form"}, {"char_start": 441, "char_end": 442, "chars": "("}, {"char_start": 449, "char_end": 450, "chars": ")"}], "added": [{"char_start": 429, "char_end": 431, "chars": "%s"}, {"char_start": 434, "char_end": 441, "chars": "\r\n    d"}, {"char_start": 443, "char_end": 448, "chars": "a = ["}, {"char_start": 455, "char_end": 458, "chars": ", ]"}, {"char_start": 488, "char_end": 494, "chars": ", data"}]}}
{"func_name": "render_page_edit", "func_src_before": "@app.route('/<page_name>/edit')\ndef render_page_edit(page_name):\n    query = db.query(\"select page_content.content from page, page_content where page.id = page_content.page_id and page.page_name = '%s' order by page_content.id desc limit 1\" % page_name)\n    wiki_page = query.namedresult()\n    if len(wiki_page) > 0:\n        content = wiki_page[0].content\n    else:\n        content = \"\"\n    return render_template(\n        'edit_page.html',\n        page_name = page_name,\n        content = content\n    )", "func_src_after": "@app.route('/<page_name>/edit')\ndef render_page_edit(page_name):\n    query = db.query(\"select page_content.content from page, page_content where page.id = page_content.page_id and page.page_name = $1 order by page_content.id desc limit 1\", page_name)\n    wiki_page = query.namedresult()\n    if len(wiki_page) > 0:\n        content = wiki_page[0].content\n    else:\n        content = \"\"\n    return render_template(\n        'edit_page.html',\n        page_name = page_name,\n        content = content\n    )", "commit_link": "github.com/Pumala/python_wiki_app_redo/commit/65d60747cd8efb05970304234d3bd949d2088e8b", "file_name": "server.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 3, "char_start": 65, "char_end": 254, "line": "    query = db.query(\"select page_content.content from page, page_content where page.id = page_content.page_id and page.page_name = '%s' order by page_content.id desc limit 1\" % page_name)\n"}], "added": [{"line_no": 3, "char_start": 65, "char_end": 251, "line": "    query = db.query(\"select page_content.content from page, page_content where page.id = page_content.page_id and page.page_name = $1 order by page_content.id desc limit 1\", page_name)\n"}]}, "char_changes": {"deleted": [{"char_start": 197, "char_end": 201, "chars": "'%s'"}, {"char_start": 240, "char_end": 242, "chars": " %"}], "added": [{"char_start": 197, "char_end": 199, "chars": "$1"}, {"char_start": 238, "char_end": 239, "chars": ","}]}}
{"func_name": "get_monthly_ranks_for_scene", "func_src_before": "def get_monthly_ranks_for_scene(db, scene, tag):\n\n    sql = \"SELECT date, rank FROM ranks WHERE scene='{}' AND player='{}'\".format(scene, tag)\n    res = db.exec(sql)\n\n    res = [r for r in res if played_during_month(db, scene, tag, get_previous_month(r[0]))]\n\n    # Build up a dict of {date: rank}\n    ranks = {}\n    for r in res:\n        ranks[r[0]] = r[1]\n\n    return ranks", "func_src_after": "def get_monthly_ranks_for_scene(db, scene, tag):\n\n    sql = \"SELECT date, rank FROM ranks WHERE scene='{scene}' AND player='{tag}'\"\n    args = {'scene': scene, 'tag': tag}\n    res = db.exec(sql, args)\n\n    res = [r for r in res if played_during_month(db, scene, tag, get_previous_month(r[0]))]\n\n    # Build up a dict of {date: rank}\n    ranks = {}\n    for r in res:\n        ranks[r[0]] = r[1]\n\n    return ranks", "commit_link": "github.com/DKelle/Smash_stats/commit/4bb83f3f6ce7d6bebbeb512cd015f9e72cf36d63", "file_name": "bracket_utils.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 3, "char_start": 50, "char_end": 143, "line": "    sql = \"SELECT date, rank FROM ranks WHERE scene='{}' AND player='{}'\".format(scene, tag)\n"}, {"line_no": 4, "char_start": 143, "char_end": 166, "line": "    res = db.exec(sql)\n"}], "added": [{"line_no": 3, "char_start": 50, "char_end": 132, "line": "    sql = \"SELECT date, rank FROM ranks WHERE scene='{scene}' AND player='{tag}'\"\n"}, {"line_no": 4, "char_start": 132, "char_end": 172, "line": "    args = {'scene': scene, 'tag': tag}\n"}, {"line_no": 5, "char_start": 172, "char_end": 201, "line": "    res = db.exec(sql, args)\n"}]}, "char_changes": {"deleted": [{"char_start": 123, "char_end": 126, "chars": ".fo"}, {"char_start": 127, "char_end": 131, "chars": "mat("}, {"char_start": 141, "char_end": 142, "chars": ")"}], "added": [{"char_start": 104, "char_end": 109, "chars": "scene"}, {"char_start": 125, "char_end": 128, "chars": "tag"}, {"char_start": 131, "char_end": 136, "chars": "\n    "}, {"char_start": 137, "char_end": 153, "chars": "rgs = {'scene': "}, {"char_start": 160, "char_end": 161, "chars": "'"}, {"char_start": 164, "char_end": 171, "chars": "': tag}"}, {"char_start": 193, "char_end": 199, "chars": ", args"}]}}
{"func_name": "auto_unlock_tasks", "func_src_before": "    @staticmethod\n    def auto_unlock_tasks(project_id: int):\n        \"\"\"Unlock all tasks locked for longer than the auto-unlock delta\"\"\"\n        expiry_delta = Task.auto_unlock_delta()\n        lock_duration = (datetime.datetime.min + expiry_delta).time().isoformat()\n        expiry_date = datetime.datetime.utcnow() - expiry_delta\n        old_locks_query = '''SELECT t.id\n            FROM tasks t, task_history th\n            WHERE t.id = th.task_id\n            AND t.project_id = th.project_id\n            AND t.task_status IN (1,3)\n            AND th.action IN ( 'LOCKED_FOR_VALIDATION','LOCKED_FOR_MAPPING' )\n            AND th.action_text IS NULL\n            AND t.project_id = {0}\n            AND th.action_date <= '{1}'\n            '''.format(project_id, str(expiry_date))\n\n        old_tasks = db.engine.execute(old_locks_query)\n\n        if old_tasks.rowcount == 0:\n            # no tasks older than the delta found, return without further processing\n            return\n\n        for old_task in old_tasks:\n            task = Task.get(old_task[0], project_id)\n            task.auto_unlock_expired_tasks(expiry_date, lock_duration)", "func_src_after": "    @staticmethod\n    def auto_unlock_tasks(project_id: int):\n        \"\"\"Unlock all tasks locked for longer than the auto-unlock delta\"\"\"\n        expiry_delta = Task.auto_unlock_delta()\n        lock_duration = (datetime.datetime.min + expiry_delta).time().isoformat()\n        expiry_date = datetime.datetime.utcnow() - expiry_delta\n        old_locks_query = '''SELECT t.id\n            FROM tasks t, task_history th\n            WHERE t.id = th.task_id\n            AND t.project_id = th.project_id\n            AND t.task_status IN (1,3)\n            AND th.action IN ( 'LOCKED_FOR_VALIDATION','LOCKED_FOR_MAPPING' )\n            AND th.action_text IS NULL\n            AND t.project_id = :project_id\n            AND th.action_date <= :expiry_date\n            '''\n\n        old_tasks = db.engine.execute(text(old_locks_query), project_id=project_id, expiry_date=str(expiry_date))\n\n        if old_tasks.rowcount == 0:\n            # no tasks older than the delta found, return without further processing\n            return\n\n        for old_task in old_tasks:\n            task = Task.get(old_task[0], project_id)\n            task.auto_unlock_expired_tasks(expiry_date, lock_duration)", "commit_link": "github.com/hotosm/tasking-manager/commit/dee040a2d22b3c4d5e38e2dbf8c6b651ad4c241a", "file_name": "server/models/postgis/task.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 14, "char_start": 652, "char_end": 687, "line": "            AND t.project_id = {0}\n"}, {"line_no": 15, "char_start": 687, "char_end": 727, "line": "            AND th.action_date <= '{1}'\n"}, {"line_no": 16, "char_start": 727, "char_end": 780, "line": "            '''.format(project_id, str(expiry_date))\n"}, {"line_no": 18, "char_start": 781, "char_end": 836, "line": "        old_tasks = db.engine.execute(old_locks_query)\n"}], "added": [{"line_no": 14, "char_start": 652, "char_end": 695, "line": "            AND t.project_id = :project_id\n"}, {"line_no": 15, "char_start": 695, "char_end": 742, "line": "            AND th.action_date <= :expiry_date\n"}, {"line_no": 16, "char_start": 742, "char_end": 758, "line": "            '''\n"}, {"line_no": 18, "char_start": 759, "char_end": 873, "line": "        old_tasks = db.engine.execute(text(old_locks_query), project_id=project_id, expiry_date=str(expiry_date))\n"}]}, "char_changes": {"deleted": [{"char_start": 683, "char_end": 686, "chars": "{0}"}, {"char_start": 721, "char_end": 726, "chars": "'{1}'"}, {"char_start": 742, "char_end": 779, "chars": ".format(project_id, str(expiry_date))"}], "added": [{"char_start": 683, "char_end": 694, "chars": ":project_id"}, {"char_start": 729, "char_end": 741, "chars": ":expiry_date"}, {"char_start": 797, "char_end": 802, "chars": "text("}, {"char_start": 817, "char_end": 871, "chars": "), project_id=project_id, expiry_date=str(expiry_date)"}]}}
{"func_name": "add_input", "func_src_before": "    def add_input(self, data):\n        connection = self.connect()\n        try:\n            # The following introduces a deliberate security flaw. \n            # See section on SQL injection below\n            query = \"INSERT INTO crimes (description) VALUES('{}');\".format(data)\n            with connection.cursor() as cursor:\n                cursor.execute(query)\n                connection.commit()\n        finally:\n            connection.close()", "func_src_after": "    def add_input(self, data):\n        connection = self.connect()\n        try:\n            # The following introduces a deliberate security flaw. \n            # See section on SQL injection below\n            query = \"INSERT INTO crimes (description) VALUES(%s);\"\n            with connection.cursor() as cursor:\n                cursor.execute(query, data)\n                connection.commit()\n        finally:\n            connection.close()", "commit_link": "github.com/mudspringhiker/crimemap/commit/35e78962e7288c643cdde0f886ff7aa5ac77cb8c", "file_name": "dbhelper.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 6, "char_start": 197, "char_end": 279, "line": "            query = \"INSERT INTO crimes (description) VALUES('{}');\".format(data)\n"}, {"line_no": 8, "char_start": 327, "char_end": 365, "line": "                cursor.execute(query)\n"}], "added": [{"line_no": 6, "char_start": 197, "char_end": 264, "line": "            query = \"INSERT INTO crimes (description) VALUES(%s);\"\n"}, {"line_no": 8, "char_start": 312, "char_end": 356, "line": "                cursor.execute(query, data)\n"}]}, "char_changes": {"deleted": [{"char_start": 258, "char_end": 262, "chars": "'{}'"}, {"char_start": 265, "char_end": 278, "chars": ".format(data)"}], "added": [{"char_start": 258, "char_end": 260, "chars": "%s"}, {"char_start": 348, "char_end": 354, "chars": ", data"}]}}
{"func_name": "getAllComments", "func_src_before": "    def getAllComments(self):\n        sqlText=\"select comment from comments where userid=%d order by date;\"\n        allposts=sql.queryDB(self.conn,sqlText)\n        return allposts;", "func_src_after": "    def getAllComments(self):\n        sqlText=\"select comment from comments where userid=%s order by date;\"\n        params = [self.userid]\n        allposts=sql.queryDB(self.conn,sqlText,params)\n        return allposts;", "commit_link": "github.com/ShaominLi/Twitter_project/commit/5329d91f9e569c95184053c8e7ef596949c33ce9", "file_name": "modules/users.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 2, "char_start": 30, "char_end": 108, "line": "        sqlText=\"select comment from comments where userid=%d order by date;\"\n"}, {"line_no": 3, "char_start": 108, "char_end": 156, "line": "        allposts=sql.queryDB(self.conn,sqlText)\n"}], "added": [{"line_no": 2, "char_start": 30, "char_end": 108, "line": "        sqlText=\"select comment from comments where userid=%s order by date;\"\n"}, {"line_no": 3, "char_start": 108, "char_end": 139, "line": "        params = [self.userid]\n"}, {"line_no": 4, "char_start": 139, "char_end": 194, "line": "        allposts=sql.queryDB(self.conn,sqlText,params)\n"}]}, "char_changes": {"deleted": [{"char_start": 90, "char_end": 91, "chars": "d"}], "added": [{"char_start": 90, "char_end": 91, "chars": "s"}, {"char_start": 116, "char_end": 147, "chars": "params = [self.userid]\n        "}, {"char_start": 185, "char_end": 192, "chars": ",params"}]}}
{"func_name": "update_user", "func_src_before": "def update_user(username, chat_id, last_update):\n    conn = sqlite3.connect(os.path.abspath(os.path.dirname(__file__)) + \"\\\\users\\\\\" + username + '.db')\n    conn2 = sqlite3.connect(os.path.abspath(os.path.dirname(__file__)) + '\\\\cf.db')\n    settings = sqlite3.connect(os.path.abspath(os.path.dirname(__file__)) + \"\\\\settings.db\")\n    cursor = conn.cursor()\n    cursor2 = conn2.cursor()\n    cursor_settings = settings.cursor()\n    cursor_settings.execute(\"select last_problem from users where chat_id = '\" + str(chat_id) + \"'\")\n    update_eq = cursor_settings.fetchone()\n    cursor_settings.execute(\"select * from last_update_problemset\")\n    update_base = cursor_settings.fetchone()\n    last_problem = update_base[0]\n    if update_eq[0] != update_base[0]:\n        cursor2.execute(\"SELECT * FROM problems\")\n        x = cursor2.fetchone()\n        while x != None:\n            cursor.execute(\"select * from result where problem = '\" + str(x[0]) + \"' and diff = '\" + str(x[1]) + \"'\")\n            x2 = cursor.fetchone()\n            if x2 == None:\n                cursor.execute(\"insert into result values (?, ?, ? )\", (x[0], x[1], \"NULL\"))\n            last_problem = x\n            x = cursor2.fetchone()\n        conn2.close()\n        settings.close()\n    if len(last_problem) == 2:\n        last_problem = last_problem[0] + last_problem[1]\n\n    url = 'http://codeforces.com/submissions/' + username\n    r = requests.get(url)\n    max_page = 1\n    soup = BeautifulSoup(r.text, \"lxml\")\n\n    for link in soup.find_all(attrs={\"class\": \"page-index\"}):\n        s = link.find('a')\n        s2 = s.get(\"href\").split('/')\n        max_page = max(max_page, int(s2[4]))\n\n    v = False\n    r = requests.get('http://codeforces.com/submissions/' + username + '/page/0')\n    soup = BeautifulSoup(r.text, \"lxml\")\n    last_try_new = soup.find(attrs={\"class\": \"status-small\"})\n    last_try_new = str(last_try_new).split()\n    last_try_new = str(last_try_new[2]) + str(last_try_new[3])\n    for i in range(1, max_page + 1):\n        r = requests.get('http://codeforces.com/submissions/' + username + '/page/' + str(i))\n        soup = BeautifulSoup(r.text, \"lxml\")\n        count = 0\n        j = 0\n        ver = soup.find_all(attrs={\"class\": \"submissionVerdictWrapper\"})\n        last_try = soup.find_all(attrs={\"class\": \"status-small\"})\n        for link in soup.find_all('a'):\n            last_try_date = str(last_try[j]).split()\n            last_try_date = str(last_try_date[2]) + str(last_try_date[3])\n            if last_try_date == last_update:\n                v = True\n                break\n            s = link.get('href')\n            if s != None and s.find('/problemset') != -1:\n                s = s.split('/')\n                if len(s) == 5:\n                    s2 = str(ver[count]).split()\n                    s2 = s2[5].split('\\\"')\n                    count += 1\n                    j += 1\n                    cursor.execute(\"select * from result where problem = '\" + s[3] + \"'and diff = '\" + s[4] + \"'\")\n                    x = cursor.fetchone()\n                    if s2[1] == 'OK' and x != None:\n                        cursor.execute(\n                            \"update result set verdict = '\" + s2[1] + \"' where problem = '\" + s[3] + \"' and diff = '\" +\n                            s[4] + \"'\")\n                    if x[2] != 'OK':\n                        cursor.execute(\n                            \"update result set verdict = '\" + s2[1] + \"' where problem = '\" + s[3] + \"' and diff = '\" +\n                            s[4] + \"'\")\n        if v:\n            break\n\n    conn.commit()\n    conn.close()\n\n    settings = sqlite3.connect(os.path.abspath(os.path.dirname(__file__)) + \"\\\\settings.db\")\n    conn = settings.cursor()\n    conn.execute(\"update users set username = '\" + str(username) + \"' where chat_id = '\" + str(chat_id) + \"'\")\n    conn.execute(\"update users set last_update = '\" + str(last_try_new) + \"' where chat_id = '\" + str(chat_id) + \"'\")\n    conn.execute(\"update users set last_problem = '\" + str(last_problem) + \"' where chat_id = '\" + str(chat_id) + \"'\")\n\n    settings.commit()\n    settings.close()", "func_src_after": "def update_user(username, chat_id, last_update):\n    conn = sqlite3.connect(os.path.abspath(os.path.dirname(__file__)) + \"\\\\users\\\\\" + username + '.db')\n    conn2 = sqlite3.connect(os.path.abspath(os.path.dirname(__file__)) + '\\\\cf.db')\n    settings = sqlite3.connect(os.path.abspath(os.path.dirname(__file__)) + \"\\\\settings.db\")\n    cursor = conn.cursor()\n    cursor2 = conn2.cursor()\n    cursor_settings = settings.cursor()\n    cursor_settings.execute(\"select last_problem from users where chat_id = ?\", (str(chat_id), ))\n    update_eq = cursor_settings.fetchone()\n    cursor_settings.execute(\"select * from last_update_problemset\")\n    update_base = cursor_settings.fetchone()\n    last_problem = update_base[0]\n    if update_eq[0] != update_base[0]:\n        cursor2.execute(\"SELECT * FROM problems\")\n        x = cursor2.fetchone()\n        while x != None:\n            cursor.execute(\"select * from result where problem = ? and diff = ?\", (str(x[0]), str(x[1])))\n            x2 = cursor.fetchone()\n            if x2 == None:\n                cursor.execute(\"insert into result values (?, ?, ? )\", (x[0], x[1], \"NULL\"))\n            last_problem = x\n            x = cursor2.fetchone()\n        conn2.close()\n        settings.close()\n    if len(last_problem) == 2:\n        last_problem = last_problem[0] + last_problem[1]\n\n    url = 'http://codeforces.com/submissions/' + username\n    r = requests.get(url)\n    max_page = 1\n    soup = BeautifulSoup(r.text, \"lxml\")\n\n    for link in soup.find_all(attrs={\"class\": \"page-index\"}):\n        s = link.find('a')\n        s2 = s.get(\"href\").split('/')\n        max_page = max(max_page, int(s2[4]))\n\n    v = False\n    r = requests.get('http://codeforces.com/submissions/' + username + '/page/0')\n    soup = BeautifulSoup(r.text, \"lxml\")\n    last_try_new = soup.find(attrs={\"class\": \"status-small\"})\n    last_try_new = str(last_try_new).split()\n    last_try_new = str(last_try_new[2]) + str(last_try_new[3])\n    for i in range(1, max_page + 1):\n        r = requests.get('http://codeforces.com/submissions/' + username + '/page/' + str(i))\n        soup = BeautifulSoup(r.text, \"lxml\")\n        count = 0\n        j = 0\n        ver = soup.find_all(attrs={\"class\": \"submissionVerdictWrapper\"})\n        last_try = soup.find_all(attrs={\"class\": \"status-small\"})\n        for link in soup.find_all('a'):\n            last_try_date = str(last_try[j]).split()\n            last_try_date = str(last_try_date[2]) + str(last_try_date[3])\n            if last_try_date == last_update:\n                v = True\n                break\n            s = link.get('href')\n            if s != None and s.find('/problemset') != -1:\n                s = s.split('/')\n                if len(s) == 5:\n                    s2 = str(ver[count]).split()\n                    s2 = s2[5].split('\\\"')\n                    count += 1\n                    j += 1\n                    cursor.execute(\"select * from result where problem = ? and diff = ?\", (s[3], s[4]))\n                    x = cursor.fetchone()\n                    if s2[1] == 'OK' and x != None:\n                        cursor.execute(\"update result set verdict = ? where problem = ? and diff = ?\", (s2[1], s[3], s[4]))\n                    if x[2] != 'OK':\n                        cursor.execute(\"update result set verdict = ? where problem = ? and diff = ?\", (s2[1], s[3], s[4]))\n        if v:\n            break\n\n    conn.commit()\n    conn.close()\n\n    settings = sqlite3.connect(os.path.abspath(os.path.dirname(__file__)) + \"\\\\settings.db\")\n    conn = settings.cursor()\n    conn.execute(\"update users set username = ? where chat_id = ?\", (str(username), str(chat_id)))\n    conn.execute(\"update users set last_update = ? where chat_id = ?\", (str(last_try_new), str(chat_id)))\n    conn.execute(\"update users set last_problem = ? where chat_id = ?\", (str(last_problem), str(chat_id)))\n\n    settings.commit()\n    settings.close()", "commit_link": "github.com/lissrbay/codeforces_bot/commit/cc7f5143445a0030b1149ac60a65b1b1b9c92a90", "file_name": "bases/update.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 8, "char_start": 426, "char_end": 527, "line": "    cursor_settings.execute(\"select last_problem from users where chat_id = '\" + str(chat_id) + \"'\")\n"}, {"line_no": 17, "char_start": 862, "char_end": 980, "line": "            cursor.execute(\"select * from result where problem = '\" + str(x[0]) + \"' and diff = '\" + str(x[1]) + \"'\")\n"}, {"line_no": 65, "char_start": 2870, "char_end": 2985, "line": "                    cursor.execute(\"select * from result where problem = '\" + s[3] + \"'and diff = '\" + s[4] + \"'\")\n"}, {"line_no": 68, "char_start": 3079, "char_end": 3119, "line": "                        cursor.execute(\n"}, {"line_no": 69, "char_start": 3119, "char_end": 3239, "line": "                            \"update result set verdict = '\" + s2[1] + \"' where problem = '\" + s[3] + \"' and diff = '\" +\n"}, {"line_no": 70, "char_start": 3239, "char_end": 3279, "line": "                            s[4] + \"'\")\n"}, {"line_no": 72, "char_start": 3316, "char_end": 3356, "line": "                        cursor.execute(\n"}, {"line_no": 73, "char_start": 3356, "char_end": 3476, "line": "                            \"update result set verdict = '\" + s2[1] + \"' where problem = '\" + s[3] + \"' and diff = '\" +\n"}, {"line_no": 74, "char_start": 3476, "char_end": 3516, "line": "                            s[4] + \"'\")\n"}, {"line_no": 83, "char_start": 3707, "char_end": 3818, "line": "    conn.execute(\"update users set username = '\" + str(username) + \"' where chat_id = '\" + str(chat_id) + \"'\")\n"}, {"line_no": 84, "char_start": 3818, "char_end": 3936, "line": "    conn.execute(\"update users set last_update = '\" + str(last_try_new) + \"' where chat_id = '\" + str(chat_id) + \"'\")\n"}, {"line_no": 85, "char_start": 3936, "char_end": 4055, "line": "    conn.execute(\"update users set last_problem = '\" + str(last_problem) + \"' where chat_id = '\" + str(chat_id) + \"'\")\n"}], "added": [{"line_no": 8, "char_start": 426, "char_end": 524, "line": "    cursor_settings.execute(\"select last_problem from users where chat_id = ?\", (str(chat_id), ))\n"}, {"line_no": 17, "char_start": 859, "char_end": 965, "line": "            cursor.execute(\"select * from result where problem = ? and diff = ?\", (str(x[0]), str(x[1])))\n"}, {"line_no": 65, "char_start": 2855, "char_end": 2959, "line": "                    cursor.execute(\"select * from result where problem = ? and diff = ?\", (s[3], s[4]))\n"}, {"line_no": 68, "char_start": 3053, "char_end": 3177, "line": "                        cursor.execute(\"update result set verdict = ? where problem = ? and diff = ?\", (s2[1], s[3], s[4]))\n"}, {"line_no": 70, "char_start": 3214, "char_end": 3338, "line": "                        cursor.execute(\"update result set verdict = ? where problem = ? and diff = ?\", (s2[1], s[3], s[4]))\n"}, {"line_no": 79, "char_start": 3529, "char_end": 3628, "line": "    conn.execute(\"update users set username = ? where chat_id = ?\", (str(username), str(chat_id)))\n"}, {"line_no": 80, "char_start": 3628, "char_end": 3734, "line": "    conn.execute(\"update users set last_update = ? where chat_id = ?\", (str(last_try_new), str(chat_id)))\n"}, {"line_no": 81, "char_start": 3734, "char_end": 3841, "line": "    conn.execute(\"update users set last_problem = ? where chat_id = ?\", (str(last_problem), str(chat_id)))\n"}]}, "char_changes": {"deleted": [{"char_start": 502, "char_end": 503, "chars": "'"}, {"char_start": 504, "char_end": 506, "chars": " +"}, {"char_start": 519, "char_end": 521, "chars": " +"}, {"char_start": 522, "char_end": 525, "chars": "\"'\""}, {"char_start": 927, "char_end": 946, "chars": "'\" + str(x[0]) + \"'"}, {"char_start": 958, "char_end": 959, "chars": "'"}, {"char_start": 961, "char_end": 962, "chars": "+"}, {"char_start": 972, "char_end": 978, "chars": " + \"'\""}, {"char_start": 2943, "char_end": 2954, "chars": "'\" + s[3] +"}, {"char_start": 2955, "char_end": 2957, "chars": "\"'"}, {"char_start": 2968, "char_end": 2969, "chars": "'"}, {"char_start": 2971, "char_end": 2972, "chars": "+"}, {"char_start": 2977, "char_end": 2983, "chars": " + \"'\""}, {"char_start": 3118, "char_end": 3147, "chars": "\n                            "}, {"char_start": 3176, "char_end": 3191, "chars": "'\" + s2[1] + \"'"}, {"char_start": 3208, "char_end": 3222, "chars": "'\" + s[3] + \"'"}, {"char_start": 3234, "char_end": 3235, "chars": "'"}, {"char_start": 3236, "char_end": 3258, "chars": " +\n                   "}, {"char_start": 3260, "char_end": 3266, "chars": "      "}, {"char_start": 3271, "char_end": 3277, "chars": " + \"'\""}, {"char_start": 3355, "char_end": 3384, "chars": "\n                            "}, {"char_start": 3413, "char_end": 3428, "chars": "'\" + s2[1] + \"'"}, {"char_start": 3445, "char_end": 3459, "chars": "'\" + s[3] + \"'"}, {"char_start": 3471, "char_end": 3472, "chars": "'"}, {"char_start": 3473, "char_end": 3494, "chars": " +\n                  "}, {"char_start": 3495, "char_end": 3496, "chars": " "}, {"char_start": 3497, "char_end": 3503, "chars": "      "}, {"char_start": 3508, "char_end": 3514, "chars": " + \"'\""}, {"char_start": 3753, "char_end": 3776, "chars": "'\" + str(username) + \"'"}, {"char_start": 3793, "char_end": 3794, "chars": "'"}, {"char_start": 3796, "char_end": 3797, "chars": "+"}, {"char_start": 3810, "char_end": 3816, "chars": " + \"'\""}, {"char_start": 3867, "char_end": 3868, "chars": "'"}, {"char_start": 3869, "char_end": 3871, "chars": " +"}, {"char_start": 3889, "char_end": 3915, "chars": " + \"' where chat_id = '\" +"}, {"char_start": 3928, "char_end": 3934, "chars": " + \"'\""}, {"char_start": 3986, "char_end": 4013, "chars": "'\" + str(last_problem) + \"'"}, {"char_start": 4030, "char_end": 4031, "chars": "'"}, {"char_start": 4033, "char_end": 4034, "chars": "+"}, {"char_start": 4047, "char_end": 4053, "chars": " + \"'\""}], "added": [{"char_start": 502, "char_end": 503, "chars": "?"}, {"char_start": 504, "char_end": 505, "chars": ","}, {"char_start": 506, "char_end": 507, "chars": "("}, {"char_start": 519, "char_end": 520, "chars": ","}, {"char_start": 521, "char_end": 522, "chars": ")"}, {"char_start": 924, "char_end": 925, "chars": "?"}, {"char_start": 937, "char_end": 938, "chars": "?"}, {"char_start": 939, "char_end": 940, "chars": ","}, {"char_start": 941, "char_end": 952, "chars": "(str(x[0]),"}, {"char_start": 962, "char_end": 963, "chars": ")"}, {"char_start": 2928, "char_end": 2929, "chars": "?"}, {"char_start": 2941, "char_end": 2942, "chars": "?"}, {"char_start": 2943, "char_end": 2944, "chars": ","}, {"char_start": 2945, "char_end": 2951, "chars": "(s[3],"}, {"char_start": 2956, "char_end": 2957, "chars": ")"}, {"char_start": 3121, "char_end": 3122, "chars": "?"}, {"char_start": 3139, "char_end": 3140, "chars": "?"}, {"char_start": 3152, "char_end": 3153, "chars": "?"}, {"char_start": 3154, "char_end": 3155, "chars": ","}, {"char_start": 3156, "char_end": 3163, "chars": "(s2[1],"}, {"char_start": 3164, "char_end": 3169, "chars": "s[3],"}, {"char_start": 3174, "char_end": 3175, "chars": ")"}, {"char_start": 3282, "char_end": 3283, "chars": "?"}, {"char_start": 3300, "char_end": 3301, "chars": "?"}, {"char_start": 3313, "char_end": 3314, "chars": "?"}, {"char_start": 3315, "char_end": 3316, "chars": ","}, {"char_start": 3317, "char_end": 3324, "chars": "(s2[1],"}, {"char_start": 3325, "char_end": 3330, "chars": "s[3],"}, {"char_start": 3335, "char_end": 3336, "chars": ")"}, {"char_start": 3575, "char_end": 3576, "chars": "?"}, {"char_start": 3593, "char_end": 3594, "chars": "?"}, {"char_start": 3595, "char_end": 3596, "chars": ","}, {"char_start": 3597, "char_end": 3612, "chars": "(str(username),"}, {"char_start": 3625, "char_end": 3626, "chars": ")"}, {"char_start": 3677, "char_end": 3678, "chars": "?"}, {"char_start": 3695, "char_end": 3696, "chars": "?"}, {"char_start": 3697, "char_end": 3698, "chars": ","}, {"char_start": 3699, "char_end": 3718, "chars": "(str(last_try_new),"}, {"char_start": 3731, "char_end": 3732, "chars": ")"}, {"char_start": 3784, "char_end": 3801, "chars": "? where chat_id ="}, {"char_start": 3802, "char_end": 3805, "chars": "?\","}, {"char_start": 3806, "char_end": 3807, "chars": "("}, {"char_start": 3824, "char_end": 3825, "chars": ","}, {"char_start": 3838, "char_end": 3839, "chars": ")"}]}}
{"func_name": "save_accepted_transaction", "func_src_before": "    def save_accepted_transaction(self, user_id, project_id, money):\n        self.cursor.execute(\"update users set money = money - %s where id = %s\"%(money, user_id))\n        self.cursor.execute(\"update projects set money = money + %s where id = %s\" % (money, project_id))\n        self.cursor.execute(\"insert into transactions (project_id, user_id, money, timestamp, state) values (%s, %s, %s, now(), 'accepted' )\" % (project_id, user_id, money))\n        self.db.commit()", "func_src_after": "    def save_accepted_transaction(self, user_id, project_id, money):\n        self.cursor.execute(\"update users set money = money - %s where id = %s\", (money, user_id))\n        self.cursor.execute(\"update projects set money = money + %s where id = %s\", (money, project_id))\n        self.cursor.execute(\"insert into transactions (project_id, user_id, money, timestamp, state) values (%s, %s, \"\n                            \"%s, now(), 'accepted' )\", (project_id, user_id, money))\n        self.db.commit()", "commit_link": "github.com/JLucka/kickstarter-dev/commit/e2ffa062697e060fdfbd2eccbb89a8c53a569e0b", "file_name": "backend/transactions/TransactionConnector.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 2, "char_start": 69, "char_end": 167, "line": "        self.cursor.execute(\"update users set money = money - %s where id = %s\"%(money, user_id))\n"}, {"line_no": 3, "char_start": 167, "char_end": 273, "line": "        self.cursor.execute(\"update projects set money = money + %s where id = %s\" % (money, project_id))\n"}, {"line_no": 4, "char_start": 273, "char_end": 447, "line": "        self.cursor.execute(\"insert into transactions (project_id, user_id, money, timestamp, state) values (%s, %s, %s, now(), 'accepted' )\" % (project_id, user_id, money))\n"}], "added": [{"line_no": 2, "char_start": 69, "char_end": 168, "line": "        self.cursor.execute(\"update users set money = money - %s where id = %s\", (money, user_id))\n"}, {"line_no": 3, "char_start": 168, "char_end": 273, "line": "        self.cursor.execute(\"update projects set money = money + %s where id = %s\", (money, project_id))\n"}, {"line_no": 4, "char_start": 273, "char_end": 392, "line": "        self.cursor.execute(\"insert into transactions (project_id, user_id, money, timestamp, state) values (%s, %s, \"\n"}, {"line_no": 5, "char_start": 392, "char_end": 477, "line": "                            \"%s, now(), 'accepted' )\", (project_id, user_id, money))\n"}]}, "char_changes": {"deleted": [{"char_start": 148, "char_end": 149, "chars": "%"}, {"char_start": 249, "char_end": 251, "chars": " %"}, {"char_start": 414, "char_end": 416, "chars": " %"}], "added": [{"char_start": 148, "char_end": 150, "chars": ", "}, {"char_start": 250, "char_end": 251, "chars": ","}, {"char_start": 390, "char_end": 421, "chars": "\"\n                            \""}, {"char_start": 445, "char_end": 446, "chars": ","}]}}
{"func_name": "shame_ask", "func_src_before": "def shame_ask(name):\n    db = db_connect()\n    cursor = db.cursor()\n    try:\n        cursor.execute('''\n            SELECT shame FROM people WHERE name='{}'\n            '''.format(name))\n        shame = cursor.fetchone()\n        db.close()\n        if shame is None:\n            logger.debug('No shame found for name {}'.format(name))\n            return shame\n        else:\n            shame = shame[0]\n            logger.debug('shame of {} found for name {}'.format(shame, name))\n            return shame\n    except Exception as e:\n        logger.error('Execution failed with error: {}'.format(e))\n        raise", "func_src_after": "def shame_ask(name):\n    db = db_connect()\n    cursor = db.cursor()\n    try:\n        cursor.execute('''\n            SELECT shame FROM people WHERE name=%(name)s\n            ''', (name, ))\n        shame = cursor.fetchone()\n        db.close()\n        if shame is None:\n            logger.debug('No shame found for name {}'.format(name))\n            return shame\n        else:\n            shame = shame[0]\n            logger.debug('shame of {} found for name {}'.format(shame, name))\n            return shame\n    except Exception as e:\n        logger.error('Execution failed with error: {}'.format(e))\n        raise", "commit_link": "github.com/tylarb/KarmaBoi-PCF/commit/c1d00a27d7f6b7eb6f15a3dacd4269654a32c10a", "file_name": "KarmaBoi/dbopts.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 6, "char_start": 104, "char_end": 157, "line": "            SELECT shame FROM people WHERE name='{}'\n"}, {"line_no": 7, "char_start": 157, "char_end": 187, "line": "            '''.format(name))\n"}], "added": [{"line_no": 6, "char_start": 104, "char_end": 161, "line": "            SELECT shame FROM people WHERE name=%(name)s\n"}, {"line_no": 7, "char_start": 161, "char_end": 188, "line": "            ''', (name, ))\n"}]}, "char_changes": {"deleted": [{"char_start": 152, "char_end": 156, "chars": "'{}'"}, {"char_start": 172, "char_end": 179, "chars": ".format"}], "added": [{"char_start": 152, "char_end": 160, "chars": "%(name)s"}, {"char_start": 176, "char_end": 178, "chars": ", "}, {"char_start": 183, "char_end": 185, "chars": ", "}]}}
{"func_name": "incrementOption", "func_src_before": "def incrementOption(cursor, poll_name, option):\n    key = poll_name+\"-\"+option\n    req = \"UPDATE {} SET count=count+1 WHERE name_option = '{}';\".format(CFG(\"options_table_name\"), key)\n    cursor.execute(req)", "func_src_after": "def incrementOption(cursor, poll_name, option):\n    key = poll_name+\"-\"+option\n    req = \"UPDATE {} SET count=count+1 WHERE name_option=?\".format(CFG(\"options_table_name\"))\n    cursor.execute(req, (key,))", "commit_link": "github.com/FAUSheppy/simple-python-poll/commit/186c5ff5cdf58272e253a1bb432419ee50d93109", "file_name": "database.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 3, "char_start": 79, "char_end": 184, "line": "    req = \"UPDATE {} SET count=count+1 WHERE name_option = '{}';\".format(CFG(\"options_table_name\"), key)\n"}, {"line_no": 4, "char_start": 184, "char_end": 207, "line": "    cursor.execute(req)\n"}], "added": [{"line_no": 3, "char_start": 79, "char_end": 173, "line": "    req = \"UPDATE {} SET count=count+1 WHERE name_option=?\".format(CFG(\"options_table_name\"))\n"}, {"line_no": 4, "char_start": 173, "char_end": 204, "line": "    cursor.execute(req, (key,))\n"}]}, "char_changes": {"deleted": [{"char_start": 135, "char_end": 136, "chars": " "}, {"char_start": 137, "char_end": 143, "chars": " '{}';"}, {"char_start": 177, "char_end": 182, "chars": ", key"}], "added": [{"char_start": 136, "char_end": 137, "chars": "?"}, {"char_start": 195, "char_end": 203, "chars": ", (key,)"}]}}
{"func_name": "overview", "func_src_before": "@app.route('/overview/<classNum>')\ndef overview(classNum):\n\tif 'username' in session:\n\t\tclassNoSpace = classNum.split(' ')[0]+classNum.split(' ')[1]\n\n\t\t#Save the current course as a session variable.\n\t\tsession['currentCourse'] = classNoSpace\n\n\t\tconn = mysql.connect()\n\t\tcursor = conn.cursor()\n\n\t\tcursor.execute(\"SELECT courseName,courseOverview from courses where courseAbbreviation='\" + classNoSpace + \"'\")\n\t\tdata = cursor.fetchone()\n\n\t\treturn render_template('overview.html', className = classNum, courseTitle = data[0], courseOverview = data[1])\n\n\treturn redirect(url_for('index'))", "func_src_after": "@app.route('/overview/<classNum>')\ndef overview(classNum):\n\tif 'username' in session:\n\t\tclassNoSpace = classNum.split(' ')[0]+classNum.split(' ')[1]\n\n\t\t#Save the current course as a session variable.\n\t\tsession['currentCourse'] = classNoSpace\n\n\t\tconn = mysql.connect()\n\t\tcursor = conn.cursor()\n\n\t\tcursor.execute(\"SELECT courseName,courseOverview from courses where courseAbbreviation=%s\", (classNoSpace))\n\t\tdata = cursor.fetchone()\n\n\t\treturn render_template('overview.html', className = classNum, courseTitle = data[0], courseOverview = data[1])\n\n\treturn redirect(url_for('index'))", "commit_link": "github.com/CaitlinKennedy/Tech-Track/commit/20ef2d4010f9497b8221524edd0c706e2c6a4147", "file_name": "src/tech_track.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 12, "char_start": 294, "char_end": 408, "line": "\t\tcursor.execute(\"SELECT courseName,courseOverview from courses where courseAbbreviation='\" + classNoSpace + \"'\")\n"}], "added": [{"line_no": 12, "char_start": 294, "char_end": 404, "line": "\t\tcursor.execute(\"SELECT courseName,courseOverview from courses where courseAbbreviation=%s\", (classNoSpace))\n"}]}, "char_changes": {"deleted": [{"char_start": 383, "char_end": 384, "chars": "'"}, {"char_start": 386, "char_end": 388, "chars": "+ "}, {"char_start": 400, "char_end": 406, "chars": " + \"'\""}], "added": [{"char_start": 383, "char_end": 385, "chars": "%s"}, {"char_start": 386, "char_end": 387, "chars": ","}, {"char_start": 388, "char_end": 389, "chars": "("}, {"char_start": 401, "char_end": 402, "chars": ")"}]}}
{"func_name": "addTags", "func_src_before": "def addTags(tag_list, listing_id):\n    \"\"\"\n    Adds a list of tags tag_list for a given listing with listing_id to the database\n    \"\"\"\n    cur = conn.cursor()\n    for x in tag_list:\n        sql = \"INSERT INTO {} VALUES {}\".format(listing_tags_table_name, str((listing_id, x)))\n        cur.execute(sql)", "func_src_after": "def addTags(tag_list, listing_id):\n    \"\"\"\n    Adds a list of tags tag_list for a given listing with listing_id to the database\n    \"\"\"\n    cur = conn.cursor()\n    for x in tag_list:\n        sql = \"INSERT INTO %s VALUES (%s %s)\"\n        cur.execute(sql, (listing_tags_table_name, listing_id, x))", "commit_link": "github.com/tasbir49/BreadWinner/commit/332a9f2c619be399ae94244bb8bd0977fc62bc16", "file_name": "backend-api/backend-api.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 7, "char_start": 183, "char_end": 278, "line": "        sql = \"INSERT INTO {} VALUES {}\".format(listing_tags_table_name, str((listing_id, x)))\n"}, {"line_no": 8, "char_start": 278, "char_end": 302, "line": "        cur.execute(sql)\n"}], "added": [{"line_no": 7, "char_start": 183, "char_end": 229, "line": "        sql = \"INSERT INTO %s VALUES (%s %s)\"\n"}, {"line_no": 8, "char_start": 229, "char_end": 295, "line": "        cur.execute(sql, (listing_tags_table_name, listing_id, x))\n"}]}, "char_changes": {"deleted": [{"char_start": 210, "char_end": 212, "chars": "{}"}, {"char_start": 220, "char_end": 222, "chars": "{}"}, {"char_start": 223, "char_end": 226, "chars": ".fo"}, {"char_start": 227, "char_end": 229, "chars": "ma"}, {"char_start": 256, "char_end": 261, "chars": "str(("}, {"char_start": 276, "char_end": 302, "chars": ")\n        cur.execute(sql)"}], "added": [{"char_start": 210, "char_end": 212, "chars": "%s"}, {"char_start": 220, "char_end": 227, "chars": "(%s %s)"}, {"char_start": 228, "char_end": 239, "chars": "\n        cu"}, {"char_start": 240, "char_end": 246, "chars": ".execu"}, {"char_start": 247, "char_end": 254, "chars": "e(sql, "}]}}
{"func_name": "edit", "func_src_before": "@mod.route('/edit/<int:cmt_id>', methods=['GET', 'POST'])\ndef edit(cmt_id):\n    m = None\n    if request.method == 'GET':\n        sql = \"SELECT * FROM comment where cmt_id = %d;\" % (cmt_id)\n        cursor.execute(sql)\n        m = cursor.fetchone()\n        return render_template('comment/edit.html', m=m, cmt_id=cmt_id)\n\n    if request.method == 'POST':\n        content = request.form['content']\n        sql = \"UPDATE comment SET content = '%s' where cmt_id = '%d';\" \\\n            % (content, cmt_id)\n        cursor.execute(sql)\n        conn.commit()\n        sql = \"SELECT msg_id FROM comment where cmt_id = %d;\" % (cmt_id)\n        cursor.execute(sql)\n        m = cursor.fetchone()\n        flash('Edit Success!')\n        return redirect(url_for('comment.show', msg_id=m[0]))\n\n    return render_template('comment/edit.html', m=m, cmt_id=cmt_id)", "func_src_after": "@mod.route('/edit/<int:cmt_id>', methods=['GET', 'POST'])\ndef edit(cmt_id):\n    m = None\n    if request.method == 'GET':\n        cursor.execute(\"SELECT * FROM comment where cmt_id = %s;\", (cmt_id,))\n        m = cursor.fetchone()\n        return render_template('comment/edit.html', m=m, cmt_id=cmt_id)\n\n    if request.method == 'POST':\n        content = request.form['content']\n        cursor.execute(\"UPDATE comment SET content = %s where cmt_id = %s;\", (content, cmt_id))\n        conn.commit()\n        cursor.execute(\"SELECT msg_id FROM comment where cmt_id = %s;\", (cmt_id,))\n        m = cursor.fetchone()\n        flash('Edit Success!')\n        return redirect(url_for('comment.show', msg_id=m[0]))\n\n    return render_template('comment/edit.html', m=m, cmt_id=cmt_id)", "commit_link": "github.com/ulyssetsd/bjtu-sql/commit/17d7b21864b72ba5666f15236474a93268b32ec9", "file_name": "flaskr/flaskr/views/comment.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 5, "char_start": 121, "char_end": 189, "line": "        sql = \"SELECT * FROM comment where cmt_id = %d;\" % (cmt_id)\n"}, {"line_no": 6, "char_start": 189, "char_end": 217, "line": "        cursor.execute(sql)\n"}, {"line_no": 12, "char_start": 395, "char_end": 468, "line": "        sql = \"UPDATE comment SET content = '%s' where cmt_id = '%d';\" \\\n"}, {"line_no": 13, "char_start": 468, "char_end": 500, "line": "            % (content, cmt_id)\n"}, {"line_no": 14, "char_start": 500, "char_end": 528, "line": "        cursor.execute(sql)\n"}, {"line_no": 16, "char_start": 550, "char_end": 623, "line": "        sql = \"SELECT msg_id FROM comment where cmt_id = %d;\" % (cmt_id)\n"}, {"line_no": 17, "char_start": 623, "char_end": 651, "line": "        cursor.execute(sql)\n"}], "added": [{"line_no": 5, "char_start": 121, "char_end": 199, "line": "        cursor.execute(\"SELECT * FROM comment where cmt_id = %s;\", (cmt_id,))\n"}, {"line_no": 11, "char_start": 377, "char_end": 473, "line": "        cursor.execute(\"UPDATE comment SET content = %s where cmt_id = %s;\", (content, cmt_id))\n"}, {"line_no": 13, "char_start": 495, "char_end": 578, "line": "        cursor.execute(\"SELECT msg_id FROM comment where cmt_id = %s;\", (cmt_id,))\n"}]}, "char_changes": {"deleted": [{"char_start": 130, "char_end": 135, "chars": "ql = "}, {"char_start": 174, "char_end": 175, "chars": "d"}, {"char_start": 177, "char_end": 179, "chars": " %"}, {"char_start": 188, "char_end": 215, "chars": "\n        cursor.execute(sql"}, {"char_start": 404, "char_end": 409, "chars": "ql = "}, {"char_start": 439, "char_end": 440, "chars": "'"}, {"char_start": 442, "char_end": 443, "chars": "'"}, {"char_start": 459, "char_end": 460, "chars": "'"}, {"char_start": 461, "char_end": 463, "chars": "d'"}, {"char_start": 465, "char_end": 481, "chars": " \\\n            %"}, {"char_start": 499, "char_end": 526, "chars": "\n        cursor.execute(sql"}, {"char_start": 559, "char_end": 564, "chars": "ql = "}, {"char_start": 608, "char_end": 609, "chars": "d"}, {"char_start": 611, "char_end": 613, "chars": " %"}, {"char_start": 622, "char_end": 649, "chars": "\n        cursor.execute(sql"}], "added": [{"char_start": 129, "char_end": 132, "chars": "cur"}, {"char_start": 133, "char_end": 144, "chars": "or.execute("}, {"char_start": 183, "char_end": 184, "chars": "s"}, {"char_start": 186, "char_end": 187, "chars": ","}, {"char_start": 195, "char_end": 196, "chars": ","}, {"char_start": 385, "char_end": 388, "chars": "cur"}, {"char_start": 389, "char_end": 400, "chars": "or.execute("}, {"char_start": 449, "char_end": 450, "chars": "s"}, {"char_start": 452, "char_end": 453, "chars": ","}, {"char_start": 503, "char_end": 506, "chars": "cur"}, {"char_start": 507, "char_end": 518, "chars": "or.execute("}, {"char_start": 562, "char_end": 563, "chars": "s"}, {"char_start": 565, "char_end": 566, "chars": ","}, {"char_start": 574, "char_end": 575, "chars": ","}]}}
{"func_name": "process_form", "func_src_before": "def process_form():\n    # see https://docs.python.org/3.4/library/cgi.html for the basic usage\n    # here.\n    form = cgi.FieldStorage()\n\n\n    if \"player1\" not in form or \"player2\" not in form or \"size\" not in form:\n        raise FormError(\"Invalid parameters.\")\n\n    player1 = form[\"player1\"].value\n    player2 = form[\"player2\"].value\n    for c in player1+player2:\n        if c not in \"_-\" and not c.isdigit() and not c.isalpha():\n            raise FormError(\"Invalid parameters: The player names can only contains upper and lowercase characters, digits, underscores, and hypens\")\n            return\n\n    try:\n        size = int(form[\"size\"].value)\n    except:\n        raise FormError(\"Invalid parameters: 'size' is not an integer.\")\n        return\n\n    if size < 2 or size > 9:\n        raise FormError(\"The 'size' must be in the range 2-9, inclusive.\")\n\n\n    # connect to the database\n    conn = MySQLdb.connect(host   = pnsdp.SQL_HOST,\n                           user   = pnsdp.SQL_USER,\n                           passwd = pnsdp.SQL_PASSWD,\n                           db     = pnsdp.SQL_DB)\n    cursor = conn.cursor()\n\n    # insert the new row\n    cursor.execute(\"\"\"INSERT INTO games(player1,player2,size) VALUES(\"%s\",\"%s\",%d);\"\"\" % (player1,player2,size))\n\n    gameID = cursor.lastrowid\n\n\n    # MySQLdb has been building a transaction as we run.  Commit them now, and\n    # also clean up the other resources we've allocated.\n    conn.commit()\n    cursor.close()\n    conn.close()\n\n    return gameID", "func_src_after": "def process_form():\n    # see https://docs.python.org/3.4/library/cgi.html for the basic usage\n    # here.\n    form = cgi.FieldStorage()\n\n\n    if \"player1\" not in form or \"player2\" not in form or \"size\" not in form:\n        raise FormError(\"Invalid parameters.\")\n\n    player1 = form[\"player1\"].value\n    player2 = form[\"player2\"].value\n    for c in player1+player2:\n        if c not in \"_-\" and not c.isdigit() and not c.isalpha():\n            raise FormError(\"Invalid parameters: The player names can only contains upper and lowercase characters, digits, underscores, and hypens\")\n            return\n\n    try:\n        size = int(form[\"size\"].value)\n    except:\n        raise FormError(\"Invalid parameters: 'size' is not an integer.\")\n        return\n\n    if size < 2 or size > 9:\n        raise FormError(\"The 'size' must be in the range 2-9, inclusive.\")\n\n\n    # connect to the database\n    conn = MySQLdb.connect(host   = pnsdp.SQL_HOST,\n                           user   = pnsdp.SQL_USER,\n                           passwd = pnsdp.SQL_PASSWD,\n                           db     = pnsdp.SQL_DB)\n    cursor = conn.cursor()\n\n    # insert the new row\n    cursor.execute(\"\"\"INSERT INTO games(player1,player2,size) VALUES(\"%s\",\"%s\",%d);\"\"\", (player1,player2,size))\n\n    gameID = cursor.lastrowid\n\n\n    # MySQLdb has been building a transaction as we run.  Commit them now, and\n    # also clean up the other resources we've allocated.\n    conn.commit()\n    cursor.close()\n    conn.close()\n\n    return gameID", "commit_link": "github.com/russ-lewis/ttt_-_python_cgi/commit/6096f43fd4b2d91211eec4614b7960c0816900da", "file_name": "cgi/create_game.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 35, "char_start": 1148, "char_end": 1261, "line": "    cursor.execute(\"\"\"INSERT INTO games(player1,player2,size) VALUES(\"%s\",\"%s\",%d);\"\"\" % (player1,player2,size))\n"}], "added": [{"line_no": 35, "char_start": 1148, "char_end": 1260, "line": "    cursor.execute(\"\"\"INSERT INTO games(player1,player2,size) VALUES(\"%s\",\"%s\",%d);\"\"\", (player1,player2,size))\n"}]}, "char_changes": {"deleted": [{"char_start": 1234, "char_end": 1236, "chars": " %"}], "added": [{"char_start": 1234, "char_end": 1235, "chars": ","}]}}
{"func_name": "clean_cache", "func_src_before": "    def clean_cache(self, limit):\n        \"\"\"\n        Method that remove several User objects from cache - the least \n        active users\n        :param limit: number of the users that the method should remove\n        from cache\n        :return: None\n        \"\"\"\n\n        log.info('Figuring out the least active users...')\n        # Select users that the least active recently\n        user_ids = tuple(self.users.keys())\n        query = ('SELECT chat_id '\n                 'FROM photo_queries_table2 '\n                 f'WHERE chat_id in {user_ids} '\n                 'GROUP BY chat_id '\n                 'ORDER BY MAX(time) '\n                 f'LIMIT {limit}')\n\n        try:\n            cursor = db.execute_query(query)\n        except DatabaseConnectionError:\n            log.error(\"Can't figure out the least active users...\")\n            return\n\n        if not cursor.rowcount:\n            log.warning(\"There are no users in the db\")\n            return\n\n        # Make list out of tuple of tuples that is returned by MySQL\n        least_active_users = [chat_id[0] for chat_id in cursor.fetchall()]\n        log.info('Removing %d least active users from cache...', limit)\n        num_deleted_entries = 0\n        for entry in least_active_users:\n            log.debug('Deleting %s...', entry)\n            deleted_entry = self.users.pop(entry, None)\n            if deleted_entry:\n                num_deleted_entries += 1\n        log.debug(\"%d users were removed from cache.\", num_deleted_entries)", "func_src_after": "    def clean_cache(self, limit):\n        \"\"\"\n        Method that remove several User objects from cache - the least \n        active users\n        :param limit: number of the users that the method should remove\n        from cache\n        :return: None\n        \"\"\"\n\n        log.info('Figuring out the least active users...')\n        # Select users that the least active recently\n        user_ids = tuple(self.users.keys())\n        query = ('SELECT chat_id '\n                 'FROM photo_queries_table2 '\n                 f'WHERE chat_id in {user_ids} '\n                 'GROUP BY chat_id '\n                 'ORDER BY MAX(time) '\n                 f'LIMIT %s')\n\n        parameters = limit,\n\n        try:\n            cursor = db.execute_query(query, parameters)\n        except DatabaseConnectionError:\n            log.error(\"Can't figure out the least active users...\")\n            return\n\n        if not cursor.rowcount:\n            log.warning(\"There are no users in the db\")\n            return\n\n        # Make list out of tuple of tuples that is returned by MySQL\n        least_active_users = [chat_id[0] for chat_id in cursor.fetchall()]\n        log.info('Removing %d least active users from cache...', limit)\n        num_deleted_entries = 0\n        for entry in least_active_users:\n            log.debug('Deleting %s...', entry)\n            deleted_entry = self.users.pop(entry, None)\n            if deleted_entry:\n                num_deleted_entries += 1\n        log.debug(\"%d users were removed from cache.\", num_deleted_entries)", "commit_link": "github.com/RandyRomero/photoGPSbot/commit/0e9f57f13e61863b3672f5730e27f149da00786a", "file_name": "photogpsbot/users.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 18, "char_start": 628, "char_end": 663, "line": "                 f'LIMIT {limit}')\n"}, {"line_no": 21, "char_start": 677, "char_end": 722, "line": "            cursor = db.execute_query(query)\n"}], "added": [{"line_no": 18, "char_start": 628, "char_end": 658, "line": "                 f'LIMIT %s')\n"}, {"line_no": 19, "char_start": 658, "char_end": 659, "line": "\n"}, {"line_no": 20, "char_start": 659, "char_end": 687, "line": "        parameters = limit,\n"}, {"line_no": 23, "char_start": 701, "char_end": 758, "line": "            cursor = db.execute_query(query, parameters)\n"}]}, "char_changes": {"deleted": [{"char_start": 653, "char_end": 654, "chars": "{"}, {"char_start": 659, "char_end": 662, "chars": "}')"}], "added": [{"char_start": 653, "char_end": 680, "chars": "%s')\n\n        parameters = "}, {"char_start": 685, "char_end": 686, "chars": ","}, {"char_start": 744, "char_end": 756, "chars": ", parameters"}]}}
{"func_name": "quiz", "func_src_before": "@app.route('/quiz')\ndef quiz():\n\n    varga = request.args.get('varga')\n\n    try:\n        rows =[]\n\n        with sql.connect('amara.db') as con:\n            con.row_factory = sql.Row\n            cur = con.cursor()\n            cur.execute(\"select * from pada inner join mula on pada.sloka_line = mula.sloka_line where pada.varga = '%s' order by random() limit 1;\" % varga)\n            rows = cur.fetchall();\n\n            artha = rows[0][\"artha\"];\n            cur.execute(\"select pada from pada where varga = '%s' and artha = '%s' order by id\" % (varga, artha));\n            paryaya = cur.fetchall();\n\n            return render_template('quiz.html', rows=rows, paryaya=paryaya, varga=varga)\n    finally:\n        con.close()", "func_src_after": "@app.route('/quiz')\ndef quiz():\n\n    varga = request.args.get('varga')\n\n    try:\n        rows =[]\n\n        with sql.connect('amara.db') as con:\n            con.row_factory = sql.Row\n            cur = con.cursor()\n            cur.execute(\"select * from pada inner join mula on pada.sloka_line = mula.sloka_line where pada.varga = ? order by random() limit 1;\", [varga])\n            rows = cur.fetchall();\n\n            artha = rows[0][\"artha\"];\n            cur.execute(\"select pada from pada where varga = ? and artha = ? order by id\", [varga, artha]);\n            paryaya = cur.fetchall();\n\n            return render_template('quiz.html', rows=rows, paryaya=paryaya, varga=varga)\n    finally:\n        con.close()", "commit_link": "github.com/aupasana/amara-quiz/commit/6ceb5dc8ec38b4a3f1399e578ab970f7e3354922", "file_name": "docker/app.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 12, "char_start": 213, "char_end": 371, "line": "            cur.execute(\"select * from pada inner join mula on pada.sloka_line = mula.sloka_line where pada.varga = '%s' order by random() limit 1;\" % varga)\n"}, {"line_no": 16, "char_start": 445, "char_end": 560, "line": "            cur.execute(\"select pada from pada where varga = '%s' and artha = '%s' order by id\" % (varga, artha));\n"}], "added": [{"line_no": 12, "char_start": 213, "char_end": 369, "line": "            cur.execute(\"select * from pada inner join mula on pada.sloka_line = mula.sloka_line where pada.varga = ? order by random() limit 1;\", [varga])\n"}, {"line_no": 16, "char_start": 443, "char_end": 551, "line": "            cur.execute(\"select pada from pada where varga = ? and artha = ? order by id\", [varga, artha]);\n"}]}, "char_changes": {"deleted": [{"char_start": 329, "char_end": 333, "chars": "'%s'"}, {"char_start": 361, "char_end": 363, "chars": " %"}, {"char_start": 506, "char_end": 510, "chars": "'%s'"}, {"char_start": 523, "char_end": 527, "chars": "'%s'"}, {"char_start": 540, "char_end": 542, "chars": " %"}, {"char_start": 543, "char_end": 544, "chars": "("}, {"char_start": 556, "char_end": 557, "chars": ")"}], "added": [{"char_start": 329, "char_end": 330, "chars": "?"}, {"char_start": 358, "char_end": 359, "chars": ","}, {"char_start": 360, "char_end": 361, "chars": "["}, {"char_start": 366, "char_end": 367, "chars": "]"}, {"char_start": 504, "char_end": 505, "chars": "?"}, {"char_start": 518, "char_end": 519, "chars": "?"}, {"char_start": 532, "char_end": 533, "chars": ","}, {"char_start": 534, "char_end": 535, "chars": "["}, {"char_start": 547, "char_end": 548, "chars": "]"}]}}
{"func_name": "reportMatch._checkPairing", "func_src_before": "    def _checkPairing():\n        if winner == loser:\n            raise ValueError('Attempt to match player against self')\n\n        q = '''\n        SELECT COUNT(*) FROM matches\n        WHERE (matches.winner_id = %s AND matches.loser_id = %s)\n              OR (matches.winner_id = %s AND matches.loser_id = %s);\n        ''' % (winner, loser, loser, winner)\n        cur.execute(q)\n        if cur.fetchone()[0] > 0:\n            raise ValueError('Pairing %s, %s already played' % (winner, loser))", "func_src_after": "    def _checkPairing():\n        if winner == loser:\n            raise ValueError('Attempt to match player against self')\n\n        q = '''\n        SELECT COUNT(*) FROM matches\n        WHERE (matches.winner_id = %s AND matches.loser_id = %s)\n              OR (matches.winner_id = %s AND matches.loser_id = %s);\n        '''\n        cur.execute(q, (winner, loser, loser, winner))\n        if cur.fetchone()[0] > 0:\n            raise ValueError('Pairing %s, %s already played' % (winner, loser))", "commit_link": "github.com/juanchopanza/Tournament/commit/5799aee52d2cabb685800b88977257bd0964d0da", "file_name": "vagrant/tournament/tournament.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 9, "char_start": 310, "char_end": 355, "line": "        ''' % (winner, loser, loser, winner)\n"}, {"line_no": 10, "char_start": 355, "char_end": 378, "line": "        cur.execute(q)\n"}], "added": [{"line_no": 9, "char_start": 310, "char_end": 322, "line": "        '''\n"}, {"line_no": 10, "char_start": 322, "char_end": 377, "line": "        cur.execute(q, (winner, loser, loser, winner))\n"}]}, "char_changes": {"deleted": [{"char_start": 322, "char_end": 323, "chars": "%"}, {"char_start": 354, "char_end": 376, "chars": "\n        cur.execute(q"}], "added": [{"char_start": 321, "char_end": 327, "chars": "\n     "}, {"char_start": 328, "char_end": 344, "chars": "  cur.execute(q,"}]}}
{"func_name": "add_month_data_row", "func_src_before": "    def add_month_data_row(self, inverter_serial, ts, etoday, etotal):\n\n        y = datetime.fromtimestamp(ts) - timedelta(days=1)\n        y_ts = int(datetime(y.year, y.month, y.day, 23, tzinfo=pytz.utc).timestamp())\n\n        query = '''\n            INSERT INTO MonthData (\n                TimeStamp,\n                Serial,\n                DayYield,\n                TotalYield                                 \n            ) VALUES (\n                %s,\n                %s,\n                %s,\n                %s\n            );\n        ''' % (y_ts, inverter_serial, etoday, etotal)\n        self.c.execute(query)", "func_src_after": "    def add_month_data_row(self, inverter_serial, ts, etoday, etotal):\n\n        y = datetime.fromtimestamp(ts) - timedelta(days=1)\n        y_ts = int(datetime(y.year, y.month, y.day, 23, tzinfo=pytz.utc).timestamp())\n\n        query = '''\n            INSERT INTO MonthData (\n                TimeStamp,\n                Serial,\n                DayYield,\n                TotalYield                                 \n            ) VALUES (\n                ?,\n                ?,\n                ?,\n                ?\n            );\n        '''\n        self.c.execute(query, (y_ts, inverter_serial, etoday, etotal))", "commit_link": "github.com/philipptrenz/s0-bridge/commit/269b48caa05377b7c58c3e6d1622a4429cb5ba65", "file_name": "util/database.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 13, "char_start": 434, "char_end": 454, "line": "                %s,\n"}, {"line_no": 14, "char_start": 454, "char_end": 474, "line": "                %s,\n"}, {"line_no": 15, "char_start": 474, "char_end": 494, "line": "                %s,\n"}, {"line_no": 16, "char_start": 494, "char_end": 513, "line": "                %s\n"}, {"line_no": 18, "char_start": 528, "char_end": 582, "line": "        ''' % (y_ts, inverter_serial, etoday, etotal)\n"}, {"line_no": 19, "char_start": 582, "char_end": 611, "line": "        self.c.execute(query)\n"}], "added": [{"line_no": 13, "char_start": 434, "char_end": 453, "line": "                ?,\n"}, {"line_no": 14, "char_start": 453, "char_end": 472, "line": "                ?,\n"}, {"line_no": 15, "char_start": 472, "char_end": 491, "line": "                ?,\n"}, {"line_no": 16, "char_start": 491, "char_end": 509, "line": "                ?\n"}, {"line_no": 18, "char_start": 524, "char_end": 536, "line": "        '''\n"}, {"line_no": 19, "char_start": 536, "char_end": 606, "line": "        self.c.execute(query, (y_ts, inverter_serial, etoday, etotal))\n"}]}, "char_changes": {"deleted": [{"char_start": 450, "char_end": 452, "chars": "%s"}, {"char_start": 470, "char_end": 472, "chars": "%s"}, {"char_start": 490, "char_end": 492, "chars": "%s"}, {"char_start": 510, "char_end": 512, "chars": "%s"}, {"char_start": 540, "char_end": 541, "chars": "%"}, {"char_start": 581, "char_end": 610, "chars": "\n        self.c.execute(query"}], "added": [{"char_start": 450, "char_end": 451, "chars": "?"}, {"char_start": 469, "char_end": 470, "chars": "?"}, {"char_start": 488, "char_end": 489, "chars": "?"}, {"char_start": 507, "char_end": 508, "chars": "?"}, {"char_start": 535, "char_end": 541, "chars": "\n     "}, {"char_start": 542, "char_end": 565, "chars": "  self.c.execute(query,"}]}}
{"func_name": "create_playlist", "func_src_before": "def create_playlist(name, db):\n    db.execute(\n        \"INSERT INTO playlist (name, video_position) VALUES('{name}', 0);\".format(name=name))", "func_src_after": "def create_playlist(name, db):\n    db.execute(\n        \"INSERT INTO playlist (name, video_position) VALUES(%s, 0);\", (name,))", "commit_link": "github.com/Madmous/playlist/commit/666e52c5f0b8c1f4296e84471637033d9542a7a6", "file_name": "playlist/playlist_repository.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 3, "char_start": 47, "char_end": 140, "line": "        \"INSERT INTO playlist (name, video_position) VALUES('{name}', 0);\".format(name=name))\n"}], "added": [{"line_no": 3, "char_start": 47, "char_end": 125, "line": "        \"INSERT INTO playlist (name, video_position) VALUES(%s, 0);\", (name,))"}]}, "char_changes": {"deleted": [{"char_start": 107, "char_end": 115, "chars": "'{name}'"}, {"char_start": 121, "char_end": 128, "chars": ".format"}, {"char_start": 133, "char_end": 138, "chars": "=name"}], "added": [{"char_start": 107, "char_end": 109, "chars": "%s"}, {"char_start": 115, "char_end": 117, "chars": ", "}, {"char_start": 122, "char_end": 123, "chars": ","}]}}
{"func_name": "karma_ask", "func_src_before": "def karma_ask(name):\n    db = db_connect()\n    cursor = db.cursor()\n    try:\n        cursor.execute(\n            ''' SELECT karma FROM people WHERE name='{}' '''.format(name))\n        karma = cursor.fetchone()\n        if karma is None:\n            logger.debug('No karma found for name {}'.format(name))\n            db.close()\n            return karma\n        else:\n            karma = karma[0]\n            logger.debug('karma of {} found for name {}'.format(karma, name))\n            db.close()\n            return karma\n    except Exception as e:\n        logger.error('Execution failed with error: {}'.format(e))\n        raise", "func_src_after": "def karma_ask(name):\n    db = db_connect()\n    cursor = db.cursor()\n    try:\n        cursor.execute(''' SELECT karma FROM people WHERE name=%(name)s ''',\n                       (name, ))\n        karma = cursor.fetchone()\n        if karma is None:\n            logger.debug('No karma found for name {}'.format(name))\n            db.close()\n            return karma\n        else:\n            karma = karma[0]\n            logger.debug('karma of {} found for name {}'.format(karma, name))\n            db.close()\n            return karma\n    except Exception as e:\n        logger.error('Execution failed with error: {}'.format(e))\n        raise", "commit_link": "github.com/tylarb/KarmaBoi-PCF/commit/c1d00a27d7f6b7eb6f15a3dacd4269654a32c10a", "file_name": "KarmaBoi/dbopts.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 5, "char_start": 77, "char_end": 101, "line": "        cursor.execute(\n"}, {"line_no": 6, "char_start": 101, "char_end": 176, "line": "            ''' SELECT karma FROM people WHERE name='{}' '''.format(name))\n"}], "added": [{"line_no": 5, "char_start": 77, "char_end": 154, "line": "        cursor.execute(''' SELECT karma FROM people WHERE name=%(name)s ''',\n"}, {"line_no": 6, "char_start": 154, "char_end": 187, "line": "                       (name, ))\n"}]}, "char_changes": {"deleted": [{"char_start": 100, "char_end": 113, "chars": "\n            "}, {"char_start": 153, "char_end": 157, "chars": "'{}'"}, {"char_start": 161, "char_end": 168, "chars": ".format"}], "added": [{"char_start": 140, "char_end": 148, "chars": "%(name)s"}, {"char_start": 152, "char_end": 177, "chars": ",\n                       "}, {"char_start": 182, "char_end": 184, "chars": ", "}]}}
{"func_name": "post", "func_src_before": "    def post(self):\n        \"\"\" Returns JWT upon login verification \"\"\"\n        json_data = request.get_json()\n        if not json_data['email']:\n            return jsonify({\"msg\": \"Missing email\"}), 400\n\n        data = database_utilities.execute_query(\n            f\"\"\"select * from admins where email = '{json_data['email']}'\"\"\")\n        if data:\n            email = data[0]['email']\n            access_token = create_access_token(identity=email)\n            refresh_token = create_refresh_token(identity=email)\n\n            resp = jsonify({\"login\": True})\n            set_access_cookies(resp, access_token)\n            set_refresh_cookies(resp, refresh_token)\n            return resp\n        else:\n            return jsonify({\"msg\": \"User is not an admin\"})", "func_src_after": "    def post(self):\n        \"\"\" Returns JWT upon login verification \"\"\"\n        json_data = request.get_json()\n        if not json_data['email']:\n            return jsonify({\"msg\": \"Missing email\"}), 400\n\n        data = database_utilities.execute_query(\n            f\"\"\"select * from admins where email = %s\"\"\", (json_data['email'], ))\n        if data:\n            email = data[0]['email']\n            access_token = create_access_token(identity=email)\n            refresh_token = create_refresh_token(identity=email)\n\n            resp = jsonify({\"login\": True})\n            set_access_cookies(resp, access_token)\n            set_refresh_cookies(resp, refresh_token)\n            return resp\n        else:\n            return jsonify({\"msg\": \"User is not an admin\"})", "commit_link": "github.com/sgosal2/tiger-boards-backend/commit/4670109dd613df2f2fe7e8403ebd149df2b55485", "file_name": "apis/login.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 8, "char_start": 254, "char_end": 332, "line": "            f\"\"\"select * from admins where email = '{json_data['email']}'\"\"\")\n"}], "added": [{"line_no": 8, "char_start": 254, "char_end": 336, "line": "            f\"\"\"select * from admins where email = %s\"\"\", (json_data['email'], ))\n"}]}, "char_changes": {"deleted": [{"char_start": 305, "char_end": 307, "chars": "'{"}, {"char_start": 325, "char_end": 330, "chars": "}'\"\"\""}], "added": [{"char_start": 305, "char_end": 313, "chars": "%s\"\"\", ("}, {"char_start": 331, "char_end": 334, "chars": ", )"}]}}
{"func_name": "add_day_data_row", "func_src_before": "    def add_day_data_row(self, ts, data, prev_etotal):\n\n        if data['power'] > 0:\n\n            inv_serial = data['source']['serial_id']\n            query = '''\n               INSERT INTO DayData (\n                   TimeStamp,\n                   Serial,\n                   Power,\n                   TotalYield\n               ) VALUES (\n                   %s,\n                   %s,\n                   %s,\n                   %s\n               );\n            ''' % (ts, inv_serial, data['power'],  prev_etotal + data['energy'])\n            self.c.execute(query)", "func_src_after": "    def add_day_data_row(self, ts, data, prev_etotal):\n\n        if data['power'] > 0:\n\n            inv_serial = data['source']['serial_id']\n            query = '''\n               INSERT INTO DayData (\n                   TimeStamp,\n                   Serial,\n                   Power,\n                   TotalYield\n               ) VALUES (\n                   ?,\n                   ?,\n                   ?,\n                   ?\n               );\n            '''\n            self.c.execute(query, (ts, inv_serial, data['power'],  prev_etotal + data['energy']))", "commit_link": "github.com/philipptrenz/s0-bridge/commit/269b48caa05377b7c58c3e6d1622a4429cb5ba65", "file_name": "util/database.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 13, "char_start": 340, "char_end": 363, "line": "                   %s,\n"}, {"line_no": 14, "char_start": 363, "char_end": 386, "line": "                   %s,\n"}, {"line_no": 15, "char_start": 386, "char_end": 409, "line": "                   %s,\n"}, {"line_no": 16, "char_start": 409, "char_end": 431, "line": "                   %s\n"}, {"line_no": 18, "char_start": 449, "char_end": 530, "line": "            ''' % (ts, inv_serial, data['power'],  prev_etotal + data['energy'])\n"}, {"line_no": 19, "char_start": 530, "char_end": 563, "line": "            self.c.execute(query)\n"}], "added": [{"line_no": 13, "char_start": 340, "char_end": 362, "line": "                   ?,\n"}, {"line_no": 14, "char_start": 362, "char_end": 384, "line": "                   ?,\n"}, {"line_no": 15, "char_start": 384, "char_end": 406, "line": "                   ?,\n"}, {"line_no": 16, "char_start": 406, "char_end": 427, "line": "                   ?\n"}, {"line_no": 18, "char_start": 445, "char_end": 461, "line": "            '''\n"}, {"line_no": 19, "char_start": 461, "char_end": 558, "line": "            self.c.execute(query, (ts, inv_serial, data['power'],  prev_etotal + data['energy']))\n"}]}, "char_changes": {"deleted": [{"char_start": 359, "char_end": 361, "chars": "%s"}, {"char_start": 382, "char_end": 384, "chars": "%s"}, {"char_start": 405, "char_end": 407, "chars": "%s"}, {"char_start": 428, "char_end": 430, "chars": "%s"}, {"char_start": 465, "char_end": 466, "chars": "%"}, {"char_start": 529, "char_end": 562, "chars": "\n            self.c.execute(query"}], "added": [{"char_start": 359, "char_end": 360, "chars": "?"}, {"char_start": 381, "char_end": 382, "chars": "?"}, {"char_start": 403, "char_end": 404, "chars": "?"}, {"char_start": 425, "char_end": 426, "chars": "?"}, {"char_start": 460, "char_end": 468, "chars": "\n       "}, {"char_start": 469, "char_end": 494, "chars": "    self.c.execute(query,"}]}}
{"func_name": "store_metadata", "func_src_before": "    def store_metadata(self, session, key, mType, value):\n        if (self.idNormalizer is not None):\n            id = self.idNormalizer.process_string(session, id)\n        elif type(id) == unicode:\n            id = id.encode('utf-8')\n        else:\n            id = str(id)\n        self._openContainer(session)\n        query = (\"UPDATE %s SET %s = %r WHERE identifier = '%s';\" %\n                 (self.table, mType, value, id)\n                 )\n        try:\n            self._query(query)\n        except:\n            return None\n        return value", "func_src_after": "    def store_metadata(self, session, key, mType, value):\n        if (self.idNormalizer is not None):\n            id = self.idNormalizer.process_string(session, id)\n        elif type(id) == unicode:\n            id = id.encode('utf-8')\n        else:\n            id = str(id)\n        self._openContainer(session)\n        query = (\"UPDATE %s SET %s = $1 WHERE identifier = $2;\" %\n                 (self.table, mType)\n                 )\n        args = (value, id)\n        try:\n            self._query(query, *args)\n        except:\n            return None\n        return value", "commit_link": "github.com/cheshire3/cheshire3/commit/d350363b4ea10f102c24c8f26d7b76b006323e8e", "file_name": "cheshire3/sql/postgresStore.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 9, "char_start": 311, "char_end": 379, "line": "        query = (\"UPDATE %s SET %s = %r WHERE identifier = '%s';\" %\n"}, {"line_no": 10, "char_start": 379, "char_end": 427, "line": "                 (self.table, mType, value, id)\n"}, {"line_no": 13, "char_start": 459, "char_end": 490, "line": "            self._query(query)\n"}], "added": [{"line_no": 9, "char_start": 311, "char_end": 377, "line": "        query = (\"UPDATE %s SET %s = $1 WHERE identifier = $2;\" %\n"}, {"line_no": 10, "char_start": 377, "char_end": 414, "line": "                 (self.table, mType)\n"}, {"line_no": 12, "char_start": 433, "char_end": 460, "line": "        args = (value, id)\n"}, {"line_no": 14, "char_start": 473, "char_end": 511, "line": "            self._query(query, *args)\n"}]}, "char_changes": {"deleted": [{"char_start": 348, "char_end": 350, "chars": "%r"}, {"char_start": 370, "char_end": 374, "chars": "'%s'"}, {"char_start": 414, "char_end": 415, "chars": ","}, {"char_start": 416, "char_end": 422, "chars": "value,"}, {"char_start": 423, "char_end": 425, "chars": "id"}, {"char_start": 435, "char_end": 441, "chars": "      "}], "added": [{"char_start": 348, "char_end": 350, "chars": "$1"}, {"char_start": 370, "char_end": 372, "chars": "$2"}, {"char_start": 441, "char_end": 468, "chars": "args = (value, id)\n        "}, {"char_start": 502, "char_end": 509, "chars": ", *args"}]}}
{"func_name": "get", "func_src_before": "    def get(self, space_id):\n        \"\"\" Fetch data for space with the corresponding space_id \"\"\"\n        return database_utilities.execute_query(\n            f\"\"\"select * from spaces where space_id = '{space_id}'\"\"\")", "func_src_after": "    def get(self, space_id):\n        \"\"\" Fetch data for space with the corresponding space_id \"\"\"\n        return database_utilities.execute_query(\n            f\"\"\"select * from spaces where space_id = %s\"\"\", (space_id, ))", "commit_link": "github.com/sgosal2/tiger-boards-backend/commit/4670109dd613df2f2fe7e8403ebd149df2b55485", "file_name": "apis/spaces.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 4, "char_start": 147, "char_end": 217, "line": "            f\"\"\"select * from spaces where space_id = '{space_id}'\"\"\")\n"}], "added": [{"line_no": 4, "char_start": 147, "char_end": 221, "line": "            f\"\"\"select * from spaces where space_id = %s\"\"\", (space_id, ))\n"}]}, "char_changes": {"deleted": [{"char_start": 201, "char_end": 203, "chars": "'{"}, {"char_start": 211, "char_end": 216, "chars": "}'\"\"\""}], "added": [{"char_start": 201, "char_end": 209, "chars": "%s\"\"\", ("}, {"char_start": 217, "char_end": 220, "chars": ", )"}]}}
{"func_name": "check", "func_src_before": "def check(current_num):\n    try:\n        cursor.execute('SELECT * FROM comics WHERE num=\"%s\"' % current_num)\n    except sqlite3.OperationalError:\n        cursor.execute('CREATE TABLE comics (num text)')\n        return False\n    else:\n        return False if cursor.fetchone() is None else True", "func_src_after": "def check(current_num):\n    try:\n        cursor.execute('SELECT * FROM comics WHERE num=?', (current_num,))\n    except sqlite3.OperationalError:\n        cursor.execute('CREATE TABLE comics (num text)')\n        return False\n    else:\n        return False if cursor.fetchone() is None else True", "commit_link": "github.com/lord63/a_bunch_of_code/commit/c0d67a1312306fd1257c354bfb5d6cac7643aa29", "file_name": "comics/check_comics.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 3, "char_start": 33, "char_end": 109, "line": "        cursor.execute('SELECT * FROM comics WHERE num=\"%s\"' % current_num)\n"}], "added": [{"line_no": 3, "char_start": 33, "char_end": 108, "line": "        cursor.execute('SELECT * FROM comics WHERE num=?', (current_num,))\n"}]}, "char_changes": {"deleted": [{"char_start": 88, "char_end": 92, "chars": "\"%s\""}, {"char_start": 93, "char_end": 95, "chars": " %"}], "added": [{"char_start": 88, "char_end": 89, "chars": "?"}, {"char_start": 90, "char_end": 91, "chars": ","}, {"char_start": 92, "char_end": 93, "chars": "("}, {"char_start": 104, "char_end": 106, "chars": ",)"}]}}
{"func_name": "delete_crawl", "func_src_before": "@app.route('/delete_crawl', methods=['POST'])\n@is_logged_in\ndef delete_crawl():\n\n        # Get Form Fields\n        cid = request.form['cid']\n\n        # Create cursor\n        cur = mysql.connection.cursor()\n\n        # Get user by username\n        result = cur.execute(\"DELETE FROM Crawls WHERE cid = %s\" % cid)\n\n        # Commit to DB\n        mysql.connection.commit()\n\n        # Close connection\n        cur.close()\n\n        # FIXME check if successfull first, return message\n        flash('Crawl successfully removed', 'success')\n\n        return redirect(url_for('dashboard'))", "func_src_after": "@app.route('/delete_crawl', methods=['POST'])\n@is_logged_in\ndef delete_crawl():\n\n        # Get Form Fields\n        cid = request.form['cid']\n\n        # Create cursor\n        cur = mysql.connection.cursor()\n\n        # Get user by username\n        result = cur.execute(\"\"\"DELETE FROM Crawls WHERE cid = %s\"\"\" (cid,))\n\n        # Commit to DB\n        mysql.connection.commit()\n\n        # Close connection\n        cur.close()\n\n        # FIXME check if successfull first, return message\n        flash('Crawl successfully removed', 'success')\n\n        return redirect(url_for('dashboard'))", "commit_link": "github.com/yannvon/table-detection/commit/4bad3673debf0b9491b520f0e22e9186af78c375", "file_name": "bar.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 12, "char_start": 238, "char_end": 310, "line": "        result = cur.execute(\"DELETE FROM Crawls WHERE cid = %s\" % cid)\n"}], "added": [{"line_no": 12, "char_start": 238, "char_end": 315, "line": "        result = cur.execute(\"\"\"DELETE FROM Crawls WHERE cid = %s\"\"\" (cid,))\n"}]}, "char_changes": {"deleted": [{"char_start": 303, "char_end": 305, "chars": "% "}], "added": [{"char_start": 268, "char_end": 270, "chars": "\"\""}, {"char_start": 304, "char_end": 306, "chars": "\"\""}, {"char_start": 307, "char_end": 308, "chars": "("}, {"char_start": 311, "char_end": 313, "chars": ",)"}]}}
{"func_name": "add_movie", "func_src_before": "@app.route('/movies/add', methods=['GET', 'POST'])\ndef add_movie():\n    form = MovieForm()\n    if not form.validate_on_submit():\n        return render_template('new_movie.html', title='Add New Movie', form=form)\n    lang_id = add_language(form.data['language'])\n    movie = {\n            'title': '',\n            'description': '',\n            'release_year': 0,\n            'rental_duration': 0,\n            'rental_rate': 0.00,\n            'length': 0,\n            'replacement_cost': 0.00\n        }\n    for k, v in movie.items():\n        movie[k] = form.data[k]\n    movie['language_id'] = movie.get('language_id', lang_id)\n    cur.execute(\n        \"\"\"\n        INSERT INTO film (title, description, release_year, language_id, rental_duration, rental_rate, length, replacement_cost)\n        VALUES ('{}', '{}', {}, {}, {}, {}, {}, {})\n        \"\"\".format(*[v for k, v in movie.items()])\n    )\n    try:\n        cur.execute(f\"SELECT * FROM film where fulltext @@ to_tsquery('Dark Knight')\")\n        res = cur.fetchall()\n        conn.commit()\n        return redirect(url_for('movies'))\n    except Exception as e:\n        return redirect(url_for('index'))", "func_src_after": "@app.route('/movies/add', methods=['GET', 'POST'])\ndef add_movie():\n    form = MovieForm()\n    if not form.validate_on_submit():\n        return render_template('new_movie.html', title='Add New Movie', form=form)\n    lang_id = add_language(form.data['language'])\n    movie = {\n            'title': '',\n            'description': '',\n            'release_year': 0,\n            'rental_duration': 0,\n            'rental_rate': 0.00,\n            'length': 0,\n            'replacement_cost': 0.00\n        }\n    for k, v in movie.items():\n        movie[k] = form.data[k]\n    movie['language_id'] = movie.get('language_id', lang_id)\n    cur.execute(\n        \"\"\"\n        INSERT INTO film (title, description, release_year, language_id, rental_duration, rental_rate, length, replacement_cost)\n        VALUES (%s, %s, %s, %s, %s, %s, %s, %s)\n        \"\"\", [(v, ) for k, v in movie.items()]\n    )\n    try:\n        cur.execute(\"SELECT * FROM film where fulltext @@ to_tsquery(%s)\", (movie['title'], ))\n        res = cur.fetchall()\n        conn.commit()\n        return redirect(url_for('movies'))\n    except Exception as e:\n        return redirect(url_for('index'))", "commit_link": "github.com/Elbertbiggs360/dvdrental/commit/ad144ae2a08a332498d0831bc255170d57ba754b", "file_name": "app.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 22, "char_start": 784, "char_end": 836, "line": "        VALUES ('{}', '{}', {}, {}, {}, {}, {}, {})\n"}, {"line_no": 23, "char_start": 836, "char_end": 887, "line": "        \"\"\".format(*[v for k, v in movie.items()])\n"}, {"line_no": 26, "char_start": 902, "char_end": 989, "line": "        cur.execute(f\"SELECT * FROM film where fulltext @@ to_tsquery('Dark Knight')\")\n"}], "added": [{"line_no": 22, "char_start": 784, "char_end": 832, "line": "        VALUES (%s, %s, %s, %s, %s, %s, %s, %s)\n"}, {"line_no": 23, "char_start": 832, "char_end": 879, "line": "        \"\"\", [(v, ) for k, v in movie.items()]\n"}, {"line_no": 26, "char_start": 894, "char_end": 989, "line": "        cur.execute(\"SELECT * FROM film where fulltext @@ to_tsquery(%s)\", (movie['title'], ))\n"}]}, "char_changes": {"deleted": [{"char_start": 800, "char_end": 804, "chars": "'{}'"}, {"char_start": 806, "char_end": 810, "chars": "'{}'"}, {"char_start": 812, "char_end": 814, "chars": "{}"}, {"char_start": 816, "char_end": 818, "chars": "{}"}, {"char_start": 820, "char_end": 822, "chars": "{}"}, {"char_start": 824, "char_end": 826, "chars": "{}"}, {"char_start": 828, "char_end": 830, "chars": "{}"}, {"char_start": 832, "char_end": 834, "chars": "{}"}, {"char_start": 847, "char_end": 856, "chars": ".format(*"}, {"char_start": 885, "char_end": 886, "chars": ")"}, {"char_start": 922, "char_end": 923, "chars": "f"}, {"char_start": 973, "char_end": 980, "chars": "Dark Kn"}, {"char_start": 981, "char_end": 983, "chars": "gh"}, {"char_start": 986, "char_end": 987, "chars": "\""}], "added": [{"char_start": 800, "char_end": 802, "chars": "%s"}, {"char_start": 804, "char_end": 806, "chars": "%s"}, {"char_start": 808, "char_end": 810, "chars": "%s"}, {"char_start": 812, "char_end": 814, "chars": "%s"}, {"char_start": 816, "char_end": 818, "chars": "%s"}, {"char_start": 820, "char_end": 822, "chars": "%s"}, {"char_start": 824, "char_end": 826, "chars": "%s"}, {"char_start": 828, "char_end": 830, "chars": "%s"}, {"char_start": 843, "char_end": 846, "chars": ", ["}, {"char_start": 848, "char_end": 851, "chars": ", )"}, {"char_start": 963, "char_end": 968, "chars": "%s)\","}, {"char_start": 969, "char_end": 978, "chars": "(movie['t"}, {"char_start": 980, "char_end": 982, "chars": "le"}, {"char_start": 983, "char_end": 986, "chars": "], "}]}}
{"func_name": "new_category", "func_src_before": "def new_category(category_name):\n    try:\n        conn = check_heroku_db()\n        cur = conn.cursor()\n        cur.execute('''INSERT INTO categories (cat_name) VALUES (%s)''', (category_name,))\n        conn.commit()\n        conn.close()\n\n    except psycopg2.DatabaseError as e:\n        print('Error %s' % e)\n        sys.exit(1)", "func_src_after": "def new_category(category_name):\n    try:\n        conn = check_heroku_db()\n        cur = conn.cursor()\n\n        query = \"INSERT INTO categories (cat_name) VALUES (%s);\"\n        data = (category_name,)\n        cur.execute(query, data)\n\n        conn.commit()\n        conn.close()\n\n    except psycopg2.DatabaseError as e:\n        print('Error %s' % e)\n        sys.exit(1)", "commit_link": "github.com/leeorb321/expenses/commit/f93c0fa4d30787ef16420bfefc52565b98bc7fcf", "file_name": "db.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 5, "char_start": 103, "char_end": 194, "line": "        cur.execute('''INSERT INTO categories (cat_name) VALUES (%s)''', (category_name,))\n"}], "added": [{"line_no": 5, "char_start": 103, "char_end": 104, "line": "\n"}, {"line_no": 6, "char_start": 104, "char_end": 169, "line": "        query = \"INSERT INTO categories (cat_name) VALUES (%s);\"\n"}, {"line_no": 7, "char_start": 169, "char_end": 201, "line": "        data = (category_name,)\n"}, {"line_no": 8, "char_start": 201, "char_end": 234, "line": "        cur.execute(query, data)\n"}, {"line_no": 9, "char_start": 234, "char_end": 235, "line": "\n"}]}, "char_changes": {"deleted": [{"char_start": 111, "char_end": 112, "chars": "c"}, {"char_start": 114, "char_end": 126, "chars": ".execute('''"}, {"char_start": 171, "char_end": 175, "chars": "''',"}], "added": [{"char_start": 103, "char_end": 104, "chars": "\n"}, {"char_start": 112, "char_end": 113, "chars": "q"}, {"char_start": 115, "char_end": 121, "chars": "ry = \""}, {"char_start": 166, "char_end": 183, "chars": ";\"\n        data ="}, {"char_start": 200, "char_end": 232, "chars": "\n        cur.execute(query, data"}, {"char_start": 233, "char_end": 234, "chars": "\n"}]}}
{"func_name": "get_first_month", "func_src_before": "def get_first_month(db, scene):\n    sql = \"select date from matches where scene='{}' order by date limit 1;\".format(scene)\n    res = db.exec(sql)\n    date = res[0][0]\n    return date", "func_src_after": "def get_first_month(db, scene):\n    sql = \"select date from matches where scene='{scene}' order by date limit 1;\"\n    args = {'scene': scene}\n    res = db.exec(sql, args)\n    date = res[0][0]\n    return date", "commit_link": "github.com/DKelle/Smash_stats/commit/4bb83f3f6ce7d6bebbeb512cd015f9e72cf36d63", "file_name": "bracket_utils.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 2, "char_start": 32, "char_end": 123, "line": "    sql = \"select date from matches where scene='{}' order by date limit 1;\".format(scene)\n"}, {"line_no": 3, "char_start": 123, "char_end": 146, "line": "    res = db.exec(sql)\n"}], "added": [{"line_no": 2, "char_start": 32, "char_end": 114, "line": "    sql = \"select date from matches where scene='{scene}' order by date limit 1;\"\n"}, {"line_no": 3, "char_start": 114, "char_end": 142, "line": "    args = {'scene': scene}\n"}, {"line_no": 4, "char_start": 142, "char_end": 171, "line": "    res = db.exec(sql, args)\n"}]}, "char_changes": {"deleted": [{"char_start": 108, "char_end": 111, "chars": ".fo"}, {"char_start": 112, "char_end": 116, "chars": "mat("}, {"char_start": 121, "char_end": 122, "chars": ")"}], "added": [{"char_start": 82, "char_end": 87, "chars": "scene"}, {"char_start": 113, "char_end": 119, "chars": "\n    a"}, {"char_start": 120, "char_end": 127, "chars": "gs = {'"}, {"char_start": 132, "char_end": 141, "chars": "': scene}"}, {"char_start": 163, "char_end": 169, "chars": ", args"}]}}
{"func_name": "getOptions", "func_src_before": "def getOptions(poll_name):\n    conn, c = connectDB()\n    options_str = queryOne(c, \"SELECT options FROM {} WHERE name='{}'\".format(CFG(\"poll_table_name\"), poll_name))\n    if options_str == None:\n        return None\n    options = options_str.split(\",\")\n    closeDB(conn)\n    return options", "func_src_after": "def getOptions(poll_name):\n    conn, c = connectDB()\n    req = \"SELECT options FROM {} WHERE name=?\".format(CFG(\"poll_table_name\"))\n    options_str = queryOne(c, req, (poll_name,))\n    if options_str == None:\n        return None\n    options = options_str.split(\",\")\n    closeDB(conn)\n    return options", "commit_link": "github.com/FAUSheppy/simple-python-poll/commit/186c5ff5cdf58272e253a1bb432419ee50d93109", "file_name": "database.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 3, "char_start": 53, "char_end": 167, "line": "    options_str = queryOne(c, \"SELECT options FROM {} WHERE name='{}'\".format(CFG(\"poll_table_name\"), poll_name))\n"}], "added": [{"line_no": 3, "char_start": 53, "char_end": 132, "line": "    req = \"SELECT options FROM {} WHERE name=?\".format(CFG(\"poll_table_name\"))\n"}, {"line_no": 4, "char_start": 132, "char_end": 181, "line": "    options_str = queryOne(c, req, (poll_name,))\n"}]}, "char_changes": {"deleted": [{"char_start": 57, "char_end": 67, "chars": "options_st"}, {"char_start": 71, "char_end": 83, "chars": "queryOne(c, "}, {"char_start": 118, "char_end": 122, "chars": "'{}'"}], "added": [{"char_start": 58, "char_end": 60, "chars": "eq"}, {"char_start": 98, "char_end": 99, "chars": "?"}, {"char_start": 130, "char_end": 160, "chars": ")\n    options_str = queryOne(c"}, {"char_start": 162, "char_end": 168, "chars": "req, ("}, {"char_start": 177, "char_end": 178, "chars": ","}]}}
{"func_name": "retrieve_last_video_position", "func_src_before": "def retrieve_last_video_position(playlist_id, db):\n    db.execute(\"SELECT max(position) as position from video WHERE playlist_id={playlist_id};\".format(\n        playlist_id=playlist_id))\n    row = db.fetchone()\n    return row['position']", "func_src_after": "def retrieve_last_video_position(playlist_id, db):\n    db.execute(\n        \"SELECT max(position) as position from video WHERE playlist_id=%s;\", (playlist_id,))\n    row = db.fetchone()\n    return row['position']", "commit_link": "github.com/Madmous/playlist/commit/666e52c5f0b8c1f4296e84471637033d9542a7a6", "file_name": "video/video_repository.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 2, "char_start": 51, "char_end": 153, "line": "    db.execute(\"SELECT max(position) as position from video WHERE playlist_id={playlist_id};\".format(\n"}, {"line_no": 3, "char_start": 153, "char_end": 187, "line": "        playlist_id=playlist_id))\n"}], "added": [{"line_no": 2, "char_start": 51, "char_end": 67, "line": "    db.execute(\n"}, {"line_no": 3, "char_start": 67, "char_end": 160, "line": "        \"SELECT max(position) as position from video WHERE playlist_id=%s;\", (playlist_id,))\n"}]}, "char_changes": {"deleted": [{"char_start": 129, "char_end": 136, "chars": "{playli"}, {"char_start": 137, "char_end": 142, "chars": "t_id}"}, {"char_start": 144, "char_end": 158, "chars": ".format(\n     "}, {"char_start": 159, "char_end": 173, "chars": "  playlist_id="}], "added": [{"char_start": 66, "char_end": 75, "chars": "\n        "}, {"char_start": 138, "char_end": 139, "chars": "%"}, {"char_start": 142, "char_end": 144, "chars": ", "}, {"char_start": 156, "char_end": 157, "chars": ","}]}}
{"func_name": "view_page_history", "func_src_before": "@app.route('/<page_name>/history')\ndef view_page_history(page_name):\n    query = db.query(\"select page_content.timestamp, page_content.id from page, page_content where page.id = page_content.page_id and page.page_name = '%s'\" % page_name)\n    page_histories = query.namedresult()\n\n    return render_template(\n        'page_history.html',\n        page_name = page_name,\n        page_histories = page_histories\n    )", "func_src_after": "@app.route('/<page_name>/history')\ndef view_page_history(page_name):\n    query = db.query(\"select page_content.timestamp, page_content.id from page, page_content where page.id = page_content.page_id and page.page_name = $1\", page_name)\n    page_histories = query.namedresult()\n\n    return render_template(\n        'page_history.html',\n        page_name = page_name,\n        page_histories = page_histories\n    )", "commit_link": "github.com/Pumala/python_wiki_app_redo/commit/65d60747cd8efb05970304234d3bd949d2088e8b", "file_name": "server.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 3, "char_start": 69, "char_end": 239, "line": "    query = db.query(\"select page_content.timestamp, page_content.id from page, page_content where page.id = page_content.page_id and page.page_name = '%s'\" % page_name)\n"}], "added": [{"line_no": 3, "char_start": 69, "char_end": 236, "line": "    query = db.query(\"select page_content.timestamp, page_content.id from page, page_content where page.id = page_content.page_id and page.page_name = $1\", page_name)\n"}]}, "char_changes": {"deleted": [{"char_start": 220, "char_end": 224, "chars": "'%s'"}, {"char_start": 225, "char_end": 227, "chars": " %"}], "added": [{"char_start": 220, "char_end": 222, "chars": "$1"}, {"char_start": 223, "char_end": 224, "chars": ","}]}}
{"func_name": "add_input", "func_src_before": "    def add_input(self, data):\n        connection = self.connects()\n        try:\n            # The following introduces a deliberate security flaw. See section on SQL injecton below\n            query = \"INSERT INTO crimes (description) VALUES ('{}');\".format(\n                data)\n            with connection.cursor() as cursor:\n                cursor.execute(query)\n                connection.commit()\n        finally:\n            connection.close()", "func_src_after": "    def add_input(self, data):\n        connection = self.connects()\n        try:\n            # The following introduces a deliberate security flaw. See section on SQL injecton below\n            query = \"INSERT INTO crimes (description) VALUES (%s);\"\n            with connection.cursor() as cursor:\n                cursor.execute(query, data)\n                connection.commit()\n        finally:\n            connection.close()", "commit_link": "github.com/JeremiahO/crimemap/commit/c17537fcd7aa4e2a26f7ca5cefaeb356ff646858", "file_name": "dbhelper.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 5, "char_start": 182, "char_end": 260, "line": "            query = \"INSERT INTO crimes (description) VALUES ('{}');\".format(\n"}, {"line_no": 6, "char_start": 260, "char_end": 282, "line": "                data)\n"}, {"line_no": 8, "char_start": 330, "char_end": 368, "line": "                cursor.execute(query)\n"}], "added": [{"line_no": 5, "char_start": 182, "char_end": 250, "line": "            query = \"INSERT INTO crimes (description) VALUES (%s);\"\n"}, {"line_no": 7, "char_start": 298, "char_end": 342, "line": "                cursor.execute(query, data)\n"}]}, "char_changes": {"deleted": [{"char_start": 244, "char_end": 248, "chars": "'{}'"}, {"char_start": 251, "char_end": 281, "chars": ".format(\n                data)"}], "added": [{"char_start": 244, "char_end": 246, "chars": "%s"}, {"char_start": 334, "char_end": 340, "chars": ", data"}]}}
{"func_name": "get_top_author", "func_src_before": "def get_top_author(top_num):\r\n    \"\"\" query the top(top_num) popular author\r\n        top_num => list of [author, count]\r\n    \"\"\"\r\n    cmd = \"\"\"SELECT authors.name,author_result.num\r\n                    FROM authors JOIN\r\n                    (SELECT SUM(article_result.num) as num,\r\n                    article_result.author\r\n                    from (SELECT articles.title, articles.author,\r\n                    SUM(log.views) AS num\r\n                    FROM articles\r\n                    INNER JOIN (\r\n                    SELECT path, count(path) AS views\r\n                    FROM log GROUP BY log.path\r\n                    ) AS log ON log.path = '/article/'\r\n                    || articles.slug\r\n                    GROUP BY articles.title, articles.author)\r\n                    AS article_result\r\n                    GROUP BY article_result.author) as author_result\r\n                    ON authors.id = author_result.author\r\n                    ORDER BY num DESC LIMIT {}\"\"\".format(top_num)\r\n    return execute_query(cmd)", "func_src_after": "def get_top_author(top_num):\r\n    \"\"\" query the top(top_num) popular author\r\n        top_num => list of [author, count]\r\n    \"\"\"\r\n    cmd = \"\"\"SELECT authors.name,author_result.num\r\n                    FROM authors JOIN\r\n                    (SELECT SUM(article_result.num) as num,\r\n                    article_result.author\r\n                    from (SELECT articles.title, articles.author,\r\n                    SUM(log.views) AS num\r\n                    FROM articles\r\n                    INNER JOIN (\r\n                    SELECT path, count(path) AS views\r\n                    FROM log GROUP BY log.path\r\n                    ) AS log ON log.path = '/article/'\r\n                    || articles.slug\r\n                    GROUP BY articles.title, articles.author)\r\n                    AS article_result\r\n                    GROUP BY article_result.author) as author_result\r\n                    ON authors.id = author_result.author\r\n                    ORDER BY num DESC LIMIT %s\"\"\"\r\n    data = [top_num, ]\r\n    return execute_query(cmd, data)", "commit_link": "github.com/thugasin/udacity-homework-logAnalyzer/commit/506f25f9a1caee7f17034adf7c75e0efbc88082b", "file_name": "logAnalyzerDb.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 21, "char_start": 931, "char_end": 998, "line": "                    ORDER BY num DESC LIMIT {}\"\"\".format(top_num)\r\n"}, {"line_no": 22, "char_start": 998, "char_end": 1027, "line": "    return execute_query(cmd)\r\n"}], "added": [{"line_no": 21, "char_start": 931, "char_end": 982, "line": "                    ORDER BY num DESC LIMIT %s\"\"\"\r\n"}, {"line_no": 22, "char_start": 982, "char_end": 1006, "line": "    data = [top_num, ]\r\n"}, {"line_no": 23, "char_start": 1006, "char_end": 1041, "line": "    return execute_query(cmd, data)\r\n"}]}, "char_changes": {"deleted": [{"char_start": 975, "char_end": 977, "chars": "{}"}, {"char_start": 980, "char_end": 985, "chars": ".form"}, {"char_start": 987, "char_end": 988, "chars": "("}, {"char_start": 995, "char_end": 996, "chars": ")"}], "added": [{"char_start": 975, "char_end": 977, "chars": "%s"}, {"char_start": 980, "char_end": 987, "chars": "\r\n    d"}, {"char_start": 989, "char_end": 994, "chars": "a = ["}, {"char_start": 1001, "char_end": 1004, "chars": ", ]"}, {"char_start": 1034, "char_end": 1040, "chars": ", data"}]}}
{"func_name": "get_all_referrers", "func_src_before": "@app.route('/get_all_referrers')\ndef get_all_referrers():\n    account_id = request.args.get('account_id')\n\n    if not isObject(account_id):\n        ws.send('{\"id\":1, \"method\":\"call\", \"params\":[0,\"lookup_account_names\",[[\"' + account_id + '\"], 0]]}')\n        result_l = ws.recv()\n        j_l = json.loads(result_l)\n\n        account_id = j_l[\"result\"][0][\"id\"]\n\n    con = psycopg2.connect(**config.POSTGRES)\n    cur = con.cursor()\n\n    query = \"select * from referrers where referrer='\"+account_id+\"'\"\n    cur.execute(query)\n    results = cur.fetchall()\n\n    return jsonify(results)", "func_src_after": "@app.route('/get_all_referrers')\ndef get_all_referrers():\n    account_id = request.args.get('account_id')\n\n    if not isObject(account_id):\n        ws.send('{\"id\":1, \"method\":\"call\", \"params\":[0,\"lookup_account_names\",[[\"' + account_id + '\"], 0]]}')\n        result_l = ws.recv()\n        j_l = json.loads(result_l)\n\n        account_id = j_l[\"result\"][0][\"id\"]\n\n    con = psycopg2.connect(**config.POSTGRES)\n    cur = con.cursor()\n\n    query = \"select * from referrers where referrer=%s\"\n    cur.execute(query, (account_id,))\n    results = cur.fetchall()\n\n    return jsonify(results)", "commit_link": "github.com/VinChain/vinchain-python-api-backend/commit/b78088a551fbb712121269c6eb7f43ede120ff60", "file_name": "api.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 15, "char_start": 430, "char_end": 500, "line": "    query = \"select * from referrers where referrer='\"+account_id+\"'\"\n"}, {"line_no": 16, "char_start": 500, "char_end": 523, "line": "    cur.execute(query)\n"}], "added": [{"line_no": 15, "char_start": 430, "char_end": 486, "line": "    query = \"select * from referrers where referrer=%s\"\n"}, {"line_no": 16, "char_start": 486, "char_end": 524, "line": "    cur.execute(query, (account_id,))\n"}]}, "char_changes": {"deleted": [{"char_start": 482, "char_end": 498, "chars": "'\"+account_id+\"'"}], "added": [{"char_start": 482, "char_end": 484, "chars": "%s"}, {"char_start": 507, "char_end": 522, "chars": ", (account_id,)"}]}}
{"func_name": "add_translationname", "func_src_before": "    def add_translationname(self, trname):\n        \"\"\"Add new translation by item name for an item.\"\"\"\n        if self.connection:\n            for item in self.find_item_name([trname[0], '0']):\n                self.cursor.execute('insert into itemtranslation (itemid, itemlanguageid, translation) values (\"%s\", \"%s\", \"%s\")' % (item[0], trname[1], trname[2]))\n            self.connection.commit()", "func_src_after": "    def add_translationname(self, trname):\n        \"\"\"Add new translation by item name for an item.\"\"\"\n        if self.connection:\n            for item in self.find_item_name([trname[0], '0']):\n                t = (item[0], trname[1], trname[2], )\n                self.cursor.execute('insert into itemtranslation (itemid, itemlanguageid, translation) values (?, ?, ?)', t)\n            self.connection.commit()", "commit_link": "github.com/ecosl-developers/ecosl/commit/8af050a513338bf68ff2a243e4a2482d24e9aa3a", "file_name": "ecosldb/ecosldb.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 5, "char_start": 194, "char_end": 359, "line": "                self.cursor.execute('insert into itemtranslation (itemid, itemlanguageid, translation) values (\"%s\", \"%s\", \"%s\")' % (item[0], trname[1], trname[2]))\n"}], "added": [{"line_no": 5, "char_start": 194, "char_end": 248, "line": "                t = (item[0], trname[1], trname[2], )\n"}, {"line_no": 6, "char_start": 248, "char_end": 373, "line": "                self.cursor.execute('insert into itemtranslation (itemid, itemlanguageid, translation) values (?, ?, ?)', t)\n"}, {"line_no": 7, "char_start": 373, "char_end": 409, "line": "            self.connection.commit()\n"}]}, "char_changes": {"deleted": [{"char_start": 305, "char_end": 309, "chars": "\"%s\""}, {"char_start": 311, "char_end": 315, "chars": "\"%s\""}, {"char_start": 317, "char_end": 321, "chars": "\"%s\""}, {"char_start": 323, "char_end": 334, "chars": " % (item[0]"}, {"char_start": 337, "char_end": 357, "chars": "rname[1], trname[2])"}], "added": [{"char_start": 210, "char_end": 264, "chars": "t = (item[0], trname[1], trname[2], )\n                "}, {"char_start": 359, "char_end": 360, "chars": "?"}, {"char_start": 362, "char_end": 363, "chars": "?"}, {"char_start": 365, "char_end": 366, "chars": "?"}]}}
{"func_name": "get_max_task_id_for_project", "func_src_before": "    @staticmethod\n    def get_max_task_id_for_project(project_id: int):\n        \"\"\"Gets the nights task id currently in use on a project\"\"\"\n        sql = \"\"\"select max(id) from tasks where project_id = {0} GROUP BY project_id\"\"\".format(project_id)\n        result = db.engine.execute(sql)\n        if result.rowcount == 0:\n            raise NotFound()\n        for row in result:\n            return row[0]", "func_src_after": "    @staticmethod\n    def get_max_task_id_for_project(project_id: int):\n        \"\"\"Gets the nights task id currently in use on a project\"\"\"\n        sql = \"\"\"select max(id) from tasks where project_id = :project_id GROUP BY project_id\"\"\"\n        result = db.engine.execute(text(sql), project_id=project_id)\n        if result.rowcount == 0:\n            raise NotFound()\n        for row in result:\n            return row[0]", "commit_link": "github.com/hotosm/tasking-manager/commit/dee040a2d22b3c4d5e38e2dbf8c6b651ad4c241a", "file_name": "server/models/postgis/task.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 4, "char_start": 140, "char_end": 248, "line": "        sql = \"\"\"select max(id) from tasks where project_id = {0} GROUP BY project_id\"\"\".format(project_id)\n"}, {"line_no": 5, "char_start": 248, "char_end": 288, "line": "        result = db.engine.execute(sql)\n"}], "added": [{"line_no": 4, "char_start": 140, "char_end": 237, "line": "        sql = \"\"\"select max(id) from tasks where project_id = :project_id GROUP BY project_id\"\"\"\n"}, {"line_no": 5, "char_start": 237, "char_end": 306, "line": "        result = db.engine.execute(text(sql), project_id=project_id)\n"}]}, "char_changes": {"deleted": [{"char_start": 202, "char_end": 205, "chars": "{0}"}, {"char_start": 228, "char_end": 247, "chars": ".format(project_id)"}], "added": [{"char_start": 202, "char_end": 213, "chars": ":project_id"}, {"char_start": 272, "char_end": 277, "chars": "text("}, {"char_start": 280, "char_end": 304, "chars": "), project_id=project_id"}]}}
{"func_name": "findNPC", "func_src_before": "def findNPC(race, classe, sex,level):\n\tc, conn = getConnection()\n\tdate = now()\n\t#select image, SUM(legit) as l FROM npc WHERE race='Elf' AND class='Bard' AND sex='Male' GROUP BY image HAVING l>5 ORDER BY SUM(legit) DESC;\n\tc.execute(\"select image, avg(legit) as l FROM npc WHERE race='\"+race+\"' AND class='\"+classe+\"' AND sex='\"+sex+\"' GROUP BY image HAVING l > 5 ORDER BY SUM(legit) DESC;\")\n\tconn.commit()\n\tout = c.fetchmany(5)\n\tconn.close()\n\treturn out", "func_src_after": "def findNPC(race, classe, sex,level):\n\tc, conn = getConnection()\n\tdate = now()\n\t#select image, SUM(legit) as l FROM npc WHERE race='Elf' AND class='Bard' AND sex='Male' GROUP BY image HAVING l>5 ORDER BY SUM(legit) DESC;\n\tc.execute(\"select image, avg(legit) as l FROM npc WHERE race=(?) AND class=(?) AND sex=(?) GROUP BY image HAVING l > 5 ORDER BY SUM(legit) DESC\",(race,classe,sex))\n\tconn.commit()\n\tout = c.fetchmany(5)\n\tconn.close()\n\treturn out", "commit_link": "github.com/DangerBlack/DungeonsAndDragonsMasterBot/commit/63f980c6dff746f5fcf3005d0646b6c24f81cdc0", "file_name": "database.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 5, "char_start": 221, "char_end": 391, "line": "\tc.execute(\"select image, avg(legit) as l FROM npc WHERE race='\"+race+\"' AND class='\"+classe+\"' AND sex='\"+sex+\"' GROUP BY image HAVING l > 5 ORDER BY SUM(legit) DESC;\")\n"}], "added": [{"line_no": 5, "char_start": 221, "char_end": 386, "line": "\tc.execute(\"select image, avg(legit) as l FROM npc WHERE race=(?) AND class=(?) AND sex=(?) GROUP BY image HAVING l > 5 ORDER BY SUM(legit) DESC\",(race,classe,sex))\n"}]}, "char_changes": {"deleted": [{"char_start": 283, "char_end": 293, "chars": "'\"+race+\"'"}, {"char_start": 304, "char_end": 316, "chars": "'\"+classe+\"'"}, {"char_start": 325, "char_end": 334, "chars": "'\"+sex+\"'"}, {"char_start": 387, "char_end": 388, "chars": ";"}], "added": [{"char_start": 283, "char_end": 286, "chars": "(?)"}, {"char_start": 297, "char_end": 300, "chars": "(?)"}, {"char_start": 309, "char_end": 312, "chars": "(?)"}, {"char_start": 366, "char_end": 384, "chars": ",(race,classe,sex)"}]}}
{"func_name": "edit", "func_src_before": "@mod.route('/edit/<int:msg_id>', methods=['GET', 'POST'])\ndef edit(msg_id):\n    m = None\n    if request.method == 'GET':\n        sql = \"SELECT * FROM message where msg_id = %d;\" % (msg_id)\n        cursor.execute(sql)\n        m = cursor.fetchone()\n        return render_template('message/edit.html', m=m, msg_id=msg_id)\n\n    if request.method == 'POST':\n        content = request.form['content']\n        sql = \"UPDATE message SET content = '%s' where msg_id = '%d';\" \\\n            % (content, msg_id)\n        cursor.execute(sql)\n        conn.commit()\n        flash('Edit Success!')\n        return redirect(url_for('show_entries'))\n\n    return render_template('message/edit.html', m=m, msg_id=msg_id)", "func_src_after": "@mod.route('/edit/<int:msg_id>', methods=['GET', 'POST'])\ndef edit(msg_id):\n    m = None\n    if request.method == 'GET':\n        cursor.execute(\"SELECT * FROM message where msg_id = %s;\", (msg_id,))\n        m = cursor.fetchone()\n        return render_template('message/edit.html', m=m, msg_id=msg_id)\n\n    if request.method == 'POST':\n        content = request.form['content']\n        cursor.execute(\"UPDATE message SET content = %s where msg_id = %s;\", (content, msg_id))\n        conn.commit()\n        flash('Edit Success!')\n        return redirect(url_for('show_entries'))\n\n    return render_template('message/edit.html', m=m, msg_id=msg_id)", "commit_link": "github.com/ulyssetsd/bjtu-sql/commit/17d7b21864b72ba5666f15236474a93268b32ec9", "file_name": "flaskr/flaskr/views/message.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 5, "char_start": 121, "char_end": 189, "line": "        sql = \"SELECT * FROM message where msg_id = %d;\" % (msg_id)\n"}, {"line_no": 6, "char_start": 189, "char_end": 217, "line": "        cursor.execute(sql)\n"}, {"line_no": 12, "char_start": 395, "char_end": 468, "line": "        sql = \"UPDATE message SET content = '%s' where msg_id = '%d';\" \\\n"}, {"line_no": 13, "char_start": 468, "char_end": 500, "line": "            % (content, msg_id)\n"}, {"line_no": 14, "char_start": 500, "char_end": 528, "line": "        cursor.execute(sql)\n"}], "added": [{"line_no": 5, "char_start": 121, "char_end": 199, "line": "        cursor.execute(\"SELECT * FROM message where msg_id = %s;\", (msg_id,))\n"}, {"line_no": 11, "char_start": 377, "char_end": 473, "line": "        cursor.execute(\"UPDATE message SET content = %s where msg_id = %s;\", (content, msg_id))\n"}]}, "char_changes": {"deleted": [{"char_start": 130, "char_end": 135, "chars": "ql = "}, {"char_start": 174, "char_end": 175, "chars": "d"}, {"char_start": 177, "char_end": 179, "chars": " %"}, {"char_start": 188, "char_end": 215, "chars": "\n        cursor.execute(sql"}, {"char_start": 404, "char_end": 409, "chars": "ql = "}, {"char_start": 439, "char_end": 440, "chars": "'"}, {"char_start": 442, "char_end": 443, "chars": "'"}, {"char_start": 459, "char_end": 460, "chars": "'"}, {"char_start": 461, "char_end": 463, "chars": "d'"}, {"char_start": 465, "char_end": 481, "chars": " \\\n            %"}, {"char_start": 499, "char_end": 526, "chars": "\n        cursor.execute(sql"}], "added": [{"char_start": 129, "char_end": 132, "chars": "cur"}, {"char_start": 133, "char_end": 144, "chars": "or.execute("}, {"char_start": 183, "char_end": 184, "chars": "s"}, {"char_start": 186, "char_end": 187, "chars": ","}, {"char_start": 195, "char_end": 196, "chars": ","}, {"char_start": 385, "char_end": 388, "chars": "cur"}, {"char_start": 389, "char_end": 400, "chars": "or.execute("}, {"char_start": 449, "char_end": 450, "chars": "s"}, {"char_start": 452, "char_end": 453, "chars": ","}]}}
{"func_name": "add_input", "func_src_before": "    def add_input(self,data):\n        connection = self.connect()\n\n        try:\n            query = \"INSERT INTO crimes (description) VALUES ('{}');\".format(data)\n            with connection.cursor() as cursor:\n                cursor.execute(query)\n                connection.commit()\n        finally:\n            connection.close()", "func_src_after": "    def add_input(self,data):\n        connection = self.connect()\n\n        try:\n            query = \"INSERT INTO crimes (description) VALUES (%s);\"\n            with connection.cursor() as cursor:\n                cursor.execute(query,data)\n                connection.commit()\n        finally:\n            connection.close()", "commit_link": "github.com/sgnab/crime-map-app/commit/209b23bad13594c9cdf18d8788fcba7c8f68d37b", "file_name": "dbhelper.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 5, "char_start": 80, "char_end": 163, "line": "            query = \"INSERT INTO crimes (description) VALUES ('{}');\".format(data)\n"}, {"line_no": 7, "char_start": 211, "char_end": 249, "line": "                cursor.execute(query)\n"}], "added": [{"line_no": 5, "char_start": 80, "char_end": 148, "line": "            query = \"INSERT INTO crimes (description) VALUES (%s);\"\n"}, {"line_no": 7, "char_start": 196, "char_end": 239, "line": "                cursor.execute(query,data)\n"}]}, "char_changes": {"deleted": [{"char_start": 142, "char_end": 146, "chars": "'{}'"}, {"char_start": 149, "char_end": 162, "chars": ".format(data)"}], "added": [{"char_start": 142, "char_end": 144, "chars": "%s"}, {"char_start": 232, "char_end": 237, "chars": ",data"}]}}
{"func_name": "fetch_resultSet", "func_src_before": "    def fetch_resultSet(self, session, id):\n        self._openContainer(session)\n\n        sid = str(id)\n        if (self.idNormalizer is not None):\n            sid = self.idNormalizer.process_string(session, sid)\n        query = (\"SELECT class, data FROM %s WHERE identifier = '%s';\" %\n                 (self.table, sid)\n                 )\n        res = self._query(query)\n        try:\n            rdict = res.dictresult()[0]\n        except IndexError:\n            raise ObjectDoesNotExistException('%s/%s' % (self.id, sid))\n\n        data = rdict['data']\n        try:\n            ndata = pg.unescape_bytea(data)\n        except:\n            # Insufficient PyGreSQL version\n            ndata = data.replace(\"\\\\'\", \"'\")\n\n        ndata = ndata.replace('\\\\000', '\\x00')\n        ndata = ndata.replace('\\\\012', '\\n')\n        # data is res.dictresult()\n        cl = rdict['class']\n        rset = dynamic.buildObject(session, cl, [[]])\n        rset.deserialize(session, ndata)\n        rset.id = id\n\n        # Update expires\n        now = time.time()\n        nowStr = time.strftime(\"%Y-%m-%d %H:%M:%S\", time.gmtime(now))\n        expires = now + self.get_default(session, 'expires', 600)\n        rset.timeExpires = expires\n        expiresStr = time.strftime(\"%Y-%m-%d %H:%M:%S\", time.gmtime(expires))\n\n        query = (\"UPDATE %s SET timeAccessed = '%s', expires = '%s' \"\n                 \"WHERE identifier = '%s';\" %\n                 (self.table, nowStr, expiresStr, sid)\n                 )\n        self._query(query)\n        return rset", "func_src_after": "    def fetch_resultSet(self, session, id):\n        self._openContainer(session)\n\n        sid = str(id)\n        if (self.idNormalizer is not None):\n            sid = self.idNormalizer.process_string(session, sid)\n        query = (\"SELECT class, data FROM %s WHERE identifier = $1;\" %\n                 (self.table)\n                 )\n        res = self._query(query, sid)\n        try:\n            rdict = res.dictresult()[0]\n        except IndexError:\n            raise ObjectDoesNotExistException('%s/%s' % (self.id, sid))\n\n        data = rdict['data']\n        try:\n            ndata = pg.unescape_bytea(data)\n        except:\n            # Insufficient PyGreSQL version\n            ndata = data.replace(\"\\\\'\", \"'\")\n\n        ndata = ndata.replace('\\\\000', '\\x00')\n        ndata = ndata.replace('\\\\012', '\\n')\n        # data is res.dictresult()\n        cl = rdict['class']\n        rset = dynamic.buildObject(session, cl, [[]])\n        rset.deserialize(session, ndata)\n        rset.id = id\n\n        # Update expires\n        now = time.time()\n        nowStr = time.strftime(\"%Y-%m-%d %H:%M:%S\", time.gmtime(now))\n        expires = now + self.get_default(session, 'expires', 600)\n        rset.timeExpires = expires\n        expiresStr = time.strftime(\"%Y-%m-%d %H:%M:%S\", time.gmtime(expires))\n\n        query = (\"UPDATE %s SET timeAccessed = $1, expires = $2 \"\n                 \"WHERE identifier = $3;\" % (self.table)\n                 )\n        self._query(query, nowStr, expiresStr, sid)\n        return rset", "commit_link": "github.com/cheshire3/cheshire3/commit/d350363b4ea10f102c24c8f26d7b76b006323e8e", "file_name": "cheshire3/sql/resultSetStore.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 7, "char_start": 213, "char_end": 286, "line": "        query = (\"SELECT class, data FROM %s WHERE identifier = '%s';\" %\n"}, {"line_no": 8, "char_start": 286, "char_end": 321, "line": "                 (self.table, sid)\n"}, {"line_no": 10, "char_start": 340, "char_end": 373, "line": "        res = self._query(query)\n"}, {"line_no": 38, "char_start": 1291, "char_end": 1361, "line": "        query = (\"UPDATE %s SET timeAccessed = '%s', expires = '%s' \"\n"}, {"line_no": 39, "char_start": 1361, "char_end": 1407, "line": "                 \"WHERE identifier = '%s';\" %\n"}, {"line_no": 40, "char_start": 1407, "char_end": 1462, "line": "                 (self.table, nowStr, expiresStr, sid)\n"}, {"line_no": 42, "char_start": 1481, "char_end": 1508, "line": "        self._query(query)\n"}], "added": [{"line_no": 7, "char_start": 213, "char_end": 284, "line": "        query = (\"SELECT class, data FROM %s WHERE identifier = $1;\" %\n"}, {"line_no": 8, "char_start": 284, "char_end": 314, "line": "                 (self.table)\n"}, {"line_no": 10, "char_start": 333, "char_end": 371, "line": "        res = self._query(query, sid)\n"}, {"line_no": 38, "char_start": 1289, "char_end": 1355, "line": "        query = (\"UPDATE %s SET timeAccessed = $1, expires = $2 \"\n"}, {"line_no": 39, "char_start": 1355, "char_end": 1412, "line": "                 \"WHERE identifier = $3;\" % (self.table)\n"}, {"line_no": 41, "char_start": 1431, "char_end": 1483, "line": "        self._query(query, nowStr, expiresStr, sid)\n"}]}, "char_changes": {"deleted": [{"char_start": 277, "char_end": 281, "chars": "'%s'"}, {"char_start": 314, "char_end": 319, "chars": ", sid"}, {"char_start": 1338, "char_end": 1342, "chars": "'%s'"}, {"char_start": 1354, "char_end": 1358, "chars": "'%s'"}, {"char_start": 1398, "char_end": 1402, "chars": "'%s'"}, {"char_start": 1406, "char_end": 1423, "chars": "\n                "}, {"char_start": 1435, "char_end": 1460, "chars": ", nowStr, expiresStr, sid"}], "added": [{"char_start": 277, "char_end": 279, "chars": "$1"}, {"char_start": 364, "char_end": 369, "chars": ", sid"}, {"char_start": 1336, "char_end": 1338, "chars": "$1"}, {"char_start": 1350, "char_end": 1352, "chars": "$2"}, {"char_start": 1392, "char_end": 1394, "chars": "$3"}, {"char_start": 1456, "char_end": 1481, "chars": ", nowStr, expiresStr, sid"}]}}
{"func_name": "init_user", "func_src_before": "def init_user(username, chat_id):\n    conn = sqlite3.connect(os.path.abspath(os.path.dirname(__file__)) + \"\\\\users\\\\\" + username + '.db')\n    conn2 = sqlite3.connect(os.path.abspath(os.path.dirname(__file__)) + '\\\\cf.db')\n    cursor = conn.cursor()\n    cursor2 = conn2.cursor()\n    cursor.execute(\"CREATE TABLE result (problem INTEGER, diff STRING, verdict STRING)\")\n    cursor2.execute(\"SELECT * FROM problems\")\n    x = cursor2.fetchone()\n    while x != None:\n        cursor.execute(\"insert into result values (?, ?, ? )\", (x[0], x[1], \"NULL\"))\n        x = cursor2.fetchone()\n\n    url = 'http://codeforces.com/submissions/' + username\n    r = requests.get(url)\n    max_page = 1\n    soup = BeautifulSoup(r.text, \"lxml\")\n\n    for link in soup.find_all(attrs={\"class\": \"page-index\"}):\n        s = link.find('a')\n        s2 = s.get(\"href\").split('/')\n        max_page = max(max_page, int(s2[4]))\n\n    old = \"\"\n    r = requests.get('http://codeforces.com/submissions/' + username + '/page/0')\n    soup = BeautifulSoup(r.text, \"lxml\")\n    last_try = soup.find(attrs={\"class\":\"status-small\"})\n    if not last_try == None:\n        last_try = str(last_try).split()\n        last_try = str(last_try[2]) + str(last_try[3])\n\n    for i in range(1, max_page + 1):\n        r = requests.get('http://codeforces.com/submissions/' + username + '/page/' + str(i))\n        soup = BeautifulSoup(r.text, \"lxml\")\n        count = 0\n        ver = soup.find_all(attrs={\"class\": \"submissionVerdictWrapper\"})\n        for link in soup.find_all('a'):\n            s = link.get('href')\n            if s != None and s.find('/problemset') != -1:\n                s = s.split('/')\n                if len(s) == 5:\n                    s2 = str(ver[count]).split()\n                    s2 = s2[5].split('\\\"')\n                    count += 1\n                    cursor.execute(\"select * from result where problem = '\" + s[3] + \"'and diff = '\" + s[4] + \"'\")\n                    x = cursor.fetchone()\n                    if s2[1] == 'OK' and x != None:\n                        cursor.execute(\"update result set verdict = '\" + s2[1] + \"' where problem = '\" + s[3] + \"' and diff = '\" + s[4] + \"'\")\n                    if x != None and x[2] != 'OK':\n                        cursor.execute(\"update result set verdict = '\" + s2[1] +\"' where problem = '\" + s[3] + \"' and diff = '\" + s[4] + \"'\")\n\n    conn.commit()\n    conn.close()\n    conn2.close()\n\n    settings = sqlite3.connect(os.path.abspath(os.path.dirname(__file__)) + \"\\\\settings.db\")\n    conn = settings.cursor()\n    conn.execute(\"select * from last_update_problemset\")\n    last_problem = conn.fetchone()\n    conn.execute(\"select * from users where chat_id = '\" + str(chat_id) + \"'\")\n    x = conn.fetchone()\n    if x == None:\n        conn.execute(\"insert into users values (?, ?, ?, ?, ?)\", (chat_id, username, str(last_try), str(last_problem[0]), 1))\n    else:\n        conn.execute(\"update users set username = '\" + str(username) + \"' where chat_id = '\" + str(chat_id) + \"'\")\n        conn.execute(\"update users set last_update = '\" + str(last_try) + \"' where chat_id = '\" + str(chat_id) + \"'\")\n        conn.execute(\"update users set last_problem = '\" + str(last_problem[0]) + \"' where chat_id = '\" + str(chat_id) + \"'\")\n        conn.execute(\"update users set state = '\" + str(1) + \"' where chat_id = '\" + str(chat_id) + \"'\")\n    settings.commit()\n    settings.close()", "func_src_after": "def init_user(username, chat_id):\n    conn = sqlite3.connect(os.path.abspath(os.path.dirname(__file__)) + \"\\\\users\\\\\" + username + '.db')\n    conn2 = sqlite3.connect(os.path.abspath(os.path.dirname(__file__)) + '\\\\cf.db')\n    cursor = conn.cursor()\n    cursor2 = conn2.cursor()\n    cursor.execute(\"CREATE TABLE result (problem INTEGER, diff STRING, verdict STRING)\")\n    cursor2.execute(\"SELECT * FROM problems\")\n    x = cursor2.fetchone()\n    while x != None:\n        cursor.execute(\"insert into result values (?, ?, ? )\", (x[0], x[1], \"NULL\"))\n        x = cursor2.fetchone()\n\n    url = 'http://codeforces.com/submissions/' + username\n    r = requests.get(url)\n    max_page = 1\n    soup = BeautifulSoup(r.text, \"lxml\")\n\n    for link in soup.find_all(attrs={\"class\": \"page-index\"}):\n        s = link.find('a')\n        s2 = s.get(\"href\").split('/')\n        max_page = max(max_page, int(s2[4]))\n    r = requests.get('http://codeforces.com/submissions/' + username + '/page/0')\n    soup = BeautifulSoup(r.text, \"lxml\")\n    last_try = soup.find(attrs={\"class\":\"status-small\"})\n    if not last_try == None:\n        last_try = str(last_try).split()\n        last_try = str(last_try[2]) + str(last_try[3])\n\n    for i in range(1, max_page + 1):\n        r = requests.get('http://codeforces.com/submissions/' + username + '/page/' + str(i))\n        soup = BeautifulSoup(r.text, \"lxml\")\n        count = 0\n        ver = soup.find_all(attrs={\"class\": \"submissionVerdictWrapper\"})\n        for link in soup.find_all('a'):\n            s = link.get('href')\n            if s != None and s.find('/problemset') != -1:\n                s = s.split('/')\n                if len(s) == 5:\n                    s2 = str(ver[count]).split()\n                    s2 = s2[5].split('\\\"')\n                    count += 1\n                    cursor.execute(\"select * from result where problem = ? and diff = ?\", (s[3], s[4]))\n                    x = cursor.fetchone()\n                    if s2[1] == 'OK' and x != None:\n                        cursor.execute(\"update result set verdict = ? where problem = ? and diff = ?\", (s2[1], s[3], s[4]))\n                    if x != None and x[2] != 'OK':\n                        cursor.execute(\"update result set verdict = ? where problem = ? and diff = ?\", (s2[1], s[3], s[4]))\n    conn.commit()\n    conn.close()\n    conn2.close()\n    settings = sqlite3.connect(os.path.abspath(os.path.dirname(__file__)) + \"\\\\settings.db\")\n    conn = settings.cursor()\n    conn.execute(\"select * from last_update_problemset\")\n    last_problem = conn.fetchone()\n    conn.execute(\"select * from users where chat_id = ?\", (str(chat_id),))\n    x = conn.fetchone()\n    if x == None:\n        conn.execute(\"insert into users values (?, ?, ?, ?, ?)\", (chat_id, username, str(last_try), str(last_problem[0]), 1))\n    else:\n        conn.execute(\"update users set username = ? where chat_id = ?\", (str(username), str(chat_id)))\n        conn.execute(\"update users set last_update = ? where chat_id = ?\", (str(last_try), str(chat_id)))\n        conn.execute(\"update users set last_problem = ? where chat_id = ?\", (str(last_problem[0]), str(chat_id)))\n        conn.execute(\"update users set state = ? where chat_id = ?\", (str(1), str(chat_id)))\n    settings.commit()\n    settings.close()", "commit_link": "github.com/lissrbay/codeforces_bot/commit/cc7f5143445a0030b1149ac60a65b1b1b9c92a90", "file_name": "bases/createuserbase.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 22, "char_start": 893, "char_end": 894, "line": "\n"}, {"line_no": 23, "char_start": 894, "char_end": 907, "line": "    old = \"\"\n"}, {"line_no": 44, "char_start": 1799, "char_end": 1914, "line": "                    cursor.execute(\"select * from result where problem = '\" + s[3] + \"'and diff = '\" + s[4] + \"'\")\n"}, {"line_no": 47, "char_start": 2008, "char_end": 2151, "line": "                        cursor.execute(\"update result set verdict = '\" + s2[1] + \"' where problem = '\" + s[3] + \"' and diff = '\" + s[4] + \"'\")\n"}, {"line_no": 49, "char_start": 2202, "char_end": 2344, "line": "                        cursor.execute(\"update result set verdict = '\" + s2[1] +\"' where problem = '\" + s[3] + \"' and diff = '\" + s[4] + \"'\")\n"}, {"line_no": 50, "char_start": 2344, "char_end": 2345, "line": "\n"}, {"line_no": 54, "char_start": 2398, "char_end": 2399, "line": "\n"}, {"line_no": 59, "char_start": 2613, "char_end": 2692, "line": "    conn.execute(\"select * from users where chat_id = '\" + str(chat_id) + \"'\")\n"}, {"line_no": 64, "char_start": 2870, "char_end": 2985, "line": "        conn.execute(\"update users set username = '\" + str(username) + \"' where chat_id = '\" + str(chat_id) + \"'\")\n"}, {"line_no": 65, "char_start": 2985, "char_end": 3103, "line": "        conn.execute(\"update users set last_update = '\" + str(last_try) + \"' where chat_id = '\" + str(chat_id) + \"'\")\n"}, {"line_no": 66, "char_start": 3103, "char_end": 3229, "line": "        conn.execute(\"update users set last_problem = '\" + str(last_problem[0]) + \"' where chat_id = '\" + str(chat_id) + \"'\")\n"}, {"line_no": 67, "char_start": 3229, "char_end": 3334, "line": "        conn.execute(\"update users set state = '\" + str(1) + \"' where chat_id = '\" + str(chat_id) + \"'\")\n"}], "added": [{"line_no": 42, "char_start": 1785, "char_end": 1889, "line": "                    cursor.execute(\"select * from result where problem = ? and diff = ?\", (s[3], s[4]))\n"}, {"line_no": 45, "char_start": 1983, "char_end": 2107, "line": "                        cursor.execute(\"update result set verdict = ? where problem = ? and diff = ?\", (s2[1], s[3], s[4]))\n"}, {"line_no": 47, "char_start": 2158, "char_end": 2282, "line": "                        cursor.execute(\"update result set verdict = ? where problem = ? and diff = ?\", (s2[1], s[3], s[4]))\n"}, {"line_no": 55, "char_start": 2549, "char_end": 2624, "line": "    conn.execute(\"select * from users where chat_id = ?\", (str(chat_id),))\n"}, {"line_no": 60, "char_start": 2802, "char_end": 2905, "line": "        conn.execute(\"update users set username = ? where chat_id = ?\", (str(username), str(chat_id)))\n"}, {"line_no": 61, "char_start": 2905, "char_end": 3011, "line": "        conn.execute(\"update users set last_update = ? where chat_id = ?\", (str(last_try), str(chat_id)))\n"}, {"line_no": 62, "char_start": 3011, "char_end": 3125, "line": "        conn.execute(\"update users set last_problem = ? where chat_id = ?\", (str(last_problem[0]), str(chat_id)))\n"}, {"line_no": 63, "char_start": 3125, "char_end": 3218, "line": "        conn.execute(\"update users set state = ? where chat_id = ?\", (str(1), str(chat_id)))\n"}]}, "char_changes": {"deleted": [{"char_start": 893, "char_end": 907, "chars": "\n    old = \"\"\n"}, {"char_start": 1872, "char_end": 1883, "chars": "'\" + s[3] +"}, {"char_start": 1884, "char_end": 1886, "chars": "\"'"}, {"char_start": 1897, "char_end": 1898, "chars": "'"}, {"char_start": 1900, "char_end": 1901, "chars": "+"}, {"char_start": 1906, "char_end": 1912, "chars": " + \"'\""}, {"char_start": 2076, "char_end": 2091, "chars": "'\" + s2[1] + \"'"}, {"char_start": 2108, "char_end": 2122, "chars": "'\" + s[3] + \"'"}, {"char_start": 2134, "char_end": 2135, "chars": "'"}, {"char_start": 2137, "char_end": 2138, "chars": "+"}, {"char_start": 2143, "char_end": 2149, "chars": " + \"'\""}, {"char_start": 2270, "char_end": 2284, "chars": "'\" + s2[1] +\"'"}, {"char_start": 2301, "char_end": 2315, "chars": "'\" + s[3] + \"'"}, {"char_start": 2327, "char_end": 2328, "chars": "'"}, {"char_start": 2330, "char_end": 2331, "chars": "+"}, {"char_start": 2336, "char_end": 2342, "chars": " + \"'\""}, {"char_start": 2343, "char_end": 2344, "chars": "\n"}, {"char_start": 2398, "char_end": 2399, "chars": "\n"}, {"char_start": 2667, "char_end": 2668, "chars": "'"}, {"char_start": 2669, "char_end": 2671, "chars": " +"}, {"char_start": 2684, "char_end": 2690, "chars": " + \"'\""}, {"char_start": 2920, "char_end": 2943, "chars": "'\" + str(username) + \"'"}, {"char_start": 2960, "char_end": 2961, "chars": "'"}, {"char_start": 2963, "char_end": 2964, "chars": "+"}, {"char_start": 2977, "char_end": 2983, "chars": " + \"'\""}, {"char_start": 3038, "char_end": 3061, "chars": "'\" + str(last_try) + \"'"}, {"char_start": 3078, "char_end": 3079, "chars": "'"}, {"char_start": 3081, "char_end": 3082, "chars": "+"}, {"char_start": 3095, "char_end": 3101, "chars": " + \"'\""}, {"char_start": 3157, "char_end": 3158, "chars": "'"}, {"char_start": 3159, "char_end": 3161, "chars": " +"}, {"char_start": 3182, "char_end": 3208, "chars": " + \"' where chat_id = '\" +"}, {"char_start": 3221, "char_end": 3227, "chars": " + \"'\""}, {"char_start": 3276, "char_end": 3292, "chars": "'\" + str(1) + \"'"}, {"char_start": 3309, "char_end": 3310, "chars": "'"}, {"char_start": 3312, "char_end": 3313, "chars": "+"}, {"char_start": 3326, "char_end": 3332, "chars": " + \"'\""}], "added": [{"char_start": 1858, "char_end": 1859, "chars": "?"}, {"char_start": 1871, "char_end": 1872, "chars": "?"}, {"char_start": 1873, "char_end": 1874, "chars": ","}, {"char_start": 1875, "char_end": 1881, "chars": "(s[3],"}, {"char_start": 1886, "char_end": 1887, "chars": ")"}, {"char_start": 2051, "char_end": 2052, "chars": "?"}, {"char_start": 2069, "char_end": 2070, "chars": "?"}, {"char_start": 2082, "char_end": 2083, "chars": "?"}, {"char_start": 2084, "char_end": 2085, "chars": ","}, {"char_start": 2086, "char_end": 2087, "chars": "("}, {"char_start": 2088, "char_end": 2089, "chars": "2"}, {"char_start": 2090, "char_end": 2091, "chars": "1"}, {"char_start": 2092, "char_end": 2093, "chars": ","}, {"char_start": 2094, "char_end": 2099, "chars": "s[3],"}, {"char_start": 2100, "char_end": 2105, "chars": "s[4])"}, {"char_start": 2226, "char_end": 2227, "chars": "?"}, {"char_start": 2244, "char_end": 2245, "chars": "?"}, {"char_start": 2257, "char_end": 2258, "chars": "?"}, {"char_start": 2259, "char_end": 2260, "chars": ","}, {"char_start": 2261, "char_end": 2262, "chars": "("}, {"char_start": 2263, "char_end": 2264, "chars": "2"}, {"char_start": 2265, "char_end": 2266, "chars": "1"}, {"char_start": 2267, "char_end": 2268, "chars": ","}, {"char_start": 2269, "char_end": 2274, "chars": "s[3],"}, {"char_start": 2275, "char_end": 2279, "chars": "s[4]"}, {"char_start": 2280, "char_end": 2281, "chars": ")"}, {"char_start": 2603, "char_end": 2604, "chars": "?"}, {"char_start": 2605, "char_end": 2606, "chars": ","}, {"char_start": 2607, "char_end": 2608, "chars": "("}, {"char_start": 2620, "char_end": 2622, "chars": ",)"}, {"char_start": 2852, "char_end": 2853, "chars": "?"}, {"char_start": 2870, "char_end": 2871, "chars": "?"}, {"char_start": 2872, "char_end": 2873, "chars": ","}, {"char_start": 2874, "char_end": 2889, "chars": "(str(username),"}, {"char_start": 2902, "char_end": 2903, "chars": ")"}, {"char_start": 2958, "char_end": 2959, "chars": "?"}, {"char_start": 2976, "char_end": 2977, "chars": "?"}, {"char_start": 2978, "char_end": 2979, "chars": ","}, {"char_start": 2980, "char_end": 2995, "chars": "(str(last_try),"}, {"char_start": 3008, "char_end": 3009, "chars": ")"}, {"char_start": 3065, "char_end": 3084, "chars": "? where chat_id = ?"}, {"char_start": 3085, "char_end": 3086, "chars": ","}, {"char_start": 3087, "char_end": 3088, "chars": "("}, {"char_start": 3108, "char_end": 3109, "chars": ","}, {"char_start": 3122, "char_end": 3123, "chars": ")"}, {"char_start": 3172, "char_end": 3173, "chars": "?"}, {"char_start": 3190, "char_end": 3191, "chars": "?"}, {"char_start": 3192, "char_end": 3193, "chars": ","}, {"char_start": 3194, "char_end": 3202, "chars": "(str(1),"}, {"char_start": 3215, "char_end": 3216, "chars": ")"}]}}
{"func_name": "process_vote", "func_src_before": "def process_vote(target,action,chan,mask,db,notice,conn):\n    if ' ' in target: \n        notice('Invalid nick')\n        return\n\n    try: votes2kick = database.get(db,'channels','votekick','chan',chan)\n    except: votes2kick = 10\n    try: votes2ban = database.get(db,'channels','voteban','chan',chan)\n    except: votes2ban = 10\n\n    if len(target) is 0:\n        if action is 'kick': notice('Votes required to kick: {}'.format(votes2kick))\n        elif action is 'ban': notice('Votes required to ban: {}'.format(votes2ban))\n        return\n\n    votefinished = False\n    global db_ready\n    if not db_ready: db_init(db)\n    chan = chan.lower()\n    target = target.lower()\n    voter = user.format_hostmask(mask)\n    voters = db.execute(\"SELECT voters FROM votes where chan='{}' and action='{}' and target like '{}'\".format(chan,action,target)).fetchone()\n\n    if conn.nick.lower() in target: return \"I dont think so Tim.\"\n\n    if voters: \n        voters = voters[0]\n        if voter in voters: \n            notice(\"You have already voted.\")\n            return\n        else:\n            voters = '{} {}'.format(voters,voter).strip()\n            notice(\"Thank you for your vote!\")\n    else: \n        voters = voter\n\n    votecount = len(voters.split(' '))\n\n    if 'kick' in action: \n        votemax = int(votes2kick)\n        if votecount >= votemax:\n            votefinished = True\n            conn.send(\"KICK {} {} :{}\".format(chan, target, \"You have been voted off the island.\"))\n    if 'ban' in action:\n        votemax = int(votes2ban)\n        if votecount >= votemax:\n            votefinished = True\n            conn.send(\"MODE {} +b {}\".format(chan, user.get_hostmask(target,db)))\n            conn.send(\"KICK {} {} :\".format(chan, target, \"You have been voted off the island.\"))\n    \n    if votefinished: db.execute(\"DELETE FROM votes where chan='{}' and action='{}' and target like '{}'\".format(chan,action,target))\n    else: db.execute(\"insert or replace into votes(chan, action, target, voters, time) values(?,?,?,?,?)\", (chan, action, target, voters, time.time()))\n        \n    db.commit()\n    return (\"Votes to {} {}: {}/{}\".format(action, target, votecount,votemax))", "func_src_after": "def process_vote(target,action,chan,mask,db,notice,conn):\n    if ' ' in target: \n        notice('Invalid nick')\n        return\n\n    try: votes2kick = database.get(db,'channels','votekick','chan',chan)\n    except: votes2kick = 10\n    try: votes2ban = database.get(db,'channels','voteban','chan',chan)\n    except: votes2ban = 10\n\n    if len(target) is 0:\n        if action is 'kick': notice('Votes required to kick: {}'.format(votes2kick))\n        elif action is 'ban': notice('Votes required to ban: {}'.format(votes2ban))\n        return\n\n    votefinished = False\n    global db_ready\n    if not db_ready: db_init(db)\n    chan = chan.lower()\n    target = target.lower()\n    voter = user.format_hostmask(mask)\n    voters = db.execute(\"SELECT voters FROM votes where chan=? and action=? and target like ?\", chan, action, target).fetchone()\n\n    if conn.nick.lower() in target: return \"I dont think so Tim.\"\n\n    if voters: \n        voters = voters[0]\n        if voter in voters: \n            notice(\"You have already voted.\")\n            return\n        else:\n            voters = '{} {}'.format(voters,voter).strip()\n            notice(\"Thank you for your vote!\")\n    else: \n        voters = voter\n\n    votecount = len(voters.split(' '))\n\n    if 'kick' in action: \n        votemax = int(votes2kick)\n        if votecount >= votemax:\n            votefinished = True\n            conn.send(\"KICK {} {} :{}\".format(chan, target, \"You have been voted off the island.\"))\n    if 'ban' in action:\n        votemax = int(votes2ban)\n        if votecount >= votemax:\n            votefinished = True\n            conn.send(\"MODE {} +b {}\".format(chan, user.get_hostmask(target,db)))\n            conn.send(\"KICK {} {} :\".format(chan, target, \"You have been voted off the island.\"))\n    \n    if votefinished: db.execute(\"DELETE FROM votes where chan=? and action=? and target like ?\", chan, action, target)\n    else: db.execute(\"insert or replace into votes(chan, action, target, voters, time) values(?,?,?,?,?)\", (chan, action, target, voters, time.time()))\n        \n    db.commit()\n    return (\"Votes to {} {}: {}/{}\".format(action, target, votecount,votemax))", "commit_link": "github.com/gstack/uguubot/commit/700ff40be84be88964e61f8ae780564e5862460d", "file_name": "plugins/vote.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 22, "char_start": 707, "char_end": 850, "line": "    voters = db.execute(\"SELECT voters FROM votes where chan='{}' and action='{}' and target like '{}'\".format(chan,action,target)).fetchone()\n"}, {"line_no": 51, "char_start": 1781, "char_end": 1914, "line": "    if votefinished: db.execute(\"DELETE FROM votes where chan='{}' and action='{}' and target like '{}'\".format(chan,action,target))\n"}], "added": [{"line_no": 22, "char_start": 707, "char_end": 836, "line": "    voters = db.execute(\"SELECT voters FROM votes where chan=? and action=? and target like ?\", chan, action, target).fetchone()\n"}, {"line_no": 51, "char_start": 1767, "char_end": 1886, "line": "    if votefinished: db.execute(\"DELETE FROM votes where chan=? and action=? and target like ?\", chan, action, target)\n"}]}, "char_changes": {"deleted": [{"char_start": 768, "char_end": 772, "chars": "'{}'"}, {"char_start": 784, "char_end": 788, "chars": "'{}'"}, {"char_start": 805, "char_end": 809, "chars": "'{}'"}, {"char_start": 810, "char_end": 818, "chars": ".format("}, {"char_start": 836, "char_end": 837, "chars": ")"}, {"char_start": 1843, "char_end": 1847, "chars": "'{}'"}, {"char_start": 1859, "char_end": 1863, "chars": "'{}'"}, {"char_start": 1880, "char_end": 1884, "chars": "'{}'"}, {"char_start": 1885, "char_end": 1893, "chars": ".format("}, {"char_start": 1911, "char_end": 1912, "chars": ")"}], "added": [{"char_start": 768, "char_end": 769, "chars": "?"}, {"char_start": 781, "char_end": 782, "chars": "?"}, {"char_start": 799, "char_end": 800, "chars": "?"}, {"char_start": 801, "char_end": 803, "chars": ", "}, {"char_start": 808, "char_end": 809, "chars": " "}, {"char_start": 816, "char_end": 817, "chars": " "}, {"char_start": 1829, "char_end": 1830, "chars": "?"}, {"char_start": 1842, "char_end": 1843, "chars": "?"}, {"char_start": 1860, "char_end": 1861, "chars": "?"}, {"char_start": 1862, "char_end": 1864, "chars": ", "}, {"char_start": 1869, "char_end": 1870, "chars": " "}, {"char_start": 1877, "char_end": 1878, "chars": " "}]}}
{"func_name": "like", "func_src_before": "@mod.route('/like/<int:msg_id>', methods=['GET', 'POST'])\ndef like(msg_id):\n    if request.method == 'GET':\n        user_id = session['logged_id']\n        c_time = datetime.now().strftime('%Y-%m-%d %H:%M:%S')\n        sql = \"INSERT INTO like_msg(msg_id, user_id,c_time) \" + \\\n                \"VALUES(%d,'%s','%s');\" % (msg_id, user_id, c_time)\n        cursor.execute(sql)\n        conn.commit()\n    return redirect(url_for('show_entries'))", "func_src_after": "@mod.route('/like/<int:msg_id>', methods=['GET', 'POST'])\ndef like(msg_id):\n    if request.method == 'GET':\n        user_id = session['logged_id']\n        c_time = datetime.now().strftime('%Y-%m-%d %H:%M:%S')\n        cursor.execute(\"INSERT INTO like_msg(msg_id, user_id,c_time) VALUES(%s,%s,%s);\", (msg_id, user_id, c_time))\n        conn.commit()\n    return redirect(url_for('show_entries'))", "commit_link": "github.com/ulyssetsd/bjtu-sql/commit/17d7b21864b72ba5666f15236474a93268b32ec9", "file_name": "flaskr/flaskr/views/like_msg.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 6, "char_start": 209, "char_end": 275, "line": "        sql = \"INSERT INTO like_msg(msg_id, user_id,c_time) \" + \\\n"}, {"line_no": 7, "char_start": 275, "char_end": 343, "line": "                \"VALUES(%d,'%s','%s');\" % (msg_id, user_id, c_time)\n"}, {"line_no": 8, "char_start": 343, "char_end": 371, "line": "        cursor.execute(sql)\n"}], "added": [{"line_no": 6, "char_start": 209, "char_end": 325, "line": "        cursor.execute(\"INSERT INTO like_msg(msg_id, user_id,c_time) VALUES(%s,%s,%s);\", (msg_id, user_id, c_time))\n"}]}, "char_changes": {"deleted": [{"char_start": 218, "char_end": 223, "chars": "ql = "}, {"char_start": 269, "char_end": 292, "chars": "\" + \\\n                \""}, {"char_start": 300, "char_end": 301, "chars": "d"}, {"char_start": 302, "char_end": 303, "chars": "'"}, {"char_start": 305, "char_end": 306, "chars": "'"}, {"char_start": 307, "char_end": 308, "chars": "'"}, {"char_start": 310, "char_end": 311, "chars": "'"}, {"char_start": 314, "char_end": 316, "chars": " %"}, {"char_start": 342, "char_end": 369, "chars": "\n        cursor.execute(sql"}], "added": [{"char_start": 217, "char_end": 220, "chars": "cur"}, {"char_start": 221, "char_end": 232, "chars": "or.execute("}, {"char_start": 286, "char_end": 287, "chars": "s"}, {"char_start": 296, "char_end": 297, "chars": ","}]}}
{"func_name": "tag_to_tag_num", "func_src_before": "    def tag_to_tag_num(self, tag):\n        ''' Returns tag_num given tag. '''\n\n        q = \"SELECT rowid FROM tags WHERE tag = '\" + tag + \"'\"\n        self.query(q)\n        return self.c.fetchone()[0]", "func_src_after": "    def tag_to_tag_num(self, tag):\n        ''' Returns tag_num given tag. '''\n\n        q = \"SELECT rowid FROM tags WHERE tag = ?\"\n        self.query(q, tag)\n        return self.c.fetchone()[0]", "commit_link": "github.com/pukkapies/urop2019/commit/3ca2e2c291d2d5fe262d20a8e0520bdfb622432b", "file_name": "modules/query_lastfm.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 4, "char_start": 79, "char_end": 142, "line": "        q = \"SELECT rowid FROM tags WHERE tag = '\" + tag + \"'\"\n"}, {"line_no": 5, "char_start": 142, "char_end": 164, "line": "        self.query(q)\n"}], "added": [{"line_no": 4, "char_start": 79, "char_end": 130, "line": "        q = \"SELECT rowid FROM tags WHERE tag = ?\"\n"}, {"line_no": 5, "char_start": 130, "char_end": 157, "line": "        self.query(q, tag)\n"}]}, "char_changes": {"deleted": [{"char_start": 127, "char_end": 140, "chars": "'\" + tag + \"'"}], "added": [{"char_start": 127, "char_end": 128, "chars": "?"}, {"char_start": 150, "char_end": 155, "chars": ", tag"}]}}
{"func_name": "update_history_and_sourcebyinstitution", "func_src_before": "def update_history_and_sourcebyinstitution(conn, sqlite, k10plus, ai):\n    \"\"\"\n    Get all current sources and title numbers from Solr and log them into database.\n    \"\"\"\n    current_sources = get_all_current_sources(k10plus, ai)\n    current_institutions = get_all_current_institutions(k10plus, ai)\n    old_sourcebyinstitutions = get_all_old_sourcebyinstitutions(conn, sqlite)\n    current_sourcebyinstitutions = []\n\n    for source in current_sources:\n\n        for institution in current_institutions:\n\n            if not institution or institution == \" \" or '\"' in institution:\n                continue\n\n            sourcebyinstitution = \"SID \" + str(source) + \" (\" + institution + \")\"\n            current_sourcebyinstitutions.append(sourcebyinstitution)\n\n            params = {\n                \"q\": 'source_id:%s AND institution:\"%s\"' % (source, institution),\n                \"rows\": 0,\n                \"wt\": \"json\"\n            }\n\n            # check k10plus\n            result = get_solr_result(k10plus, params)\n            number = result[\"response\"][\"numFound\"]\n            if number != 0:\n                sql = 'INSERT INTO history (sourcebyinstitution, titles) VALUES (\"%s\", %s)' % (sourcebyinstitution, number)\n                sqlite.execute(sql)\n                conn.commit()\n            else:\n                # check ai\n                result = get_solr_result(ai, params)\n                number = result[\"response\"][\"numFound\"]\n                if number != 0:\n                    # TODO: escape via sqlite\n                    sql = 'INSERT INTO history (sourcebyinstitution, titles) VALUES (\"%s\", %s)' % (sourcebyinstitution, number)\n                    sqlite.execute(sql)\n                    conn.commit()\n\n            if sourcebyinstitution not in old_sourcebyinstitutions:\n                logging.info(\"The %s is now connected to SID %s.\", institution, source)\n                sql = \"INSERT INTO sourcebyinstitution (sourcebyinstitution) VALUES ('%s')\" % sourcebyinstitution\n                sqlite.execute(sql)\n                conn.commit()\n\n            if number != 0:\n                old_sourcebyinstitution_number = get_old_sourcebyinstitution_number(conn, sqlite, sourcebyinstitution)\n                if number < old_sourcebyinstitution_number:\n                    message = \"Die Anzahl der Titel hat sich bei %s gegenueber einem frueheren Import verringert.\" % (sourcebyinstitution)\n                    send_message(message)\n\n            # requests.exceptions.ConnectionError: HTTPConnectionPool(XXXXXX): Max retries exceeded\n            time.sleep(0.25)\n\n    for old_sourcebyinstitution in old_sourcebyinstitutions:\n        if old_sourcebyinstitution not in current_sourcebyinstitutions:\n            message = \"Die %s ist nicht laenger f\u00fcr die SID %s angesigelt.\" % (institution, source)\n            send_message(message)", "func_src_after": "def update_history_and_sourcebyinstitution(conn, sqlite, k10plus, ai):\n    \"\"\"\n    Get all current sources and title numbers from Solr and log them into database.\n    \"\"\"\n    current_sources = get_all_current_sources(k10plus, ai)\n    current_institutions = get_all_current_institutions(k10plus, ai)\n    old_sourcebyinstitutions = get_all_old_sourcebyinstitutions(conn, sqlite)\n    current_sourcebyinstitutions = []\n\n    for source in current_sources:\n\n        for institution in current_institutions:\n\n            if not institution or institution == \" \" or '\"' in institution:\n                continue\n\n            sourcebyinstitution = \"SID \" + str(source) + \" (\" + institution + \")\"\n            current_sourcebyinstitutions.append(sourcebyinstitution)\n\n            params = {\n                \"q\": 'source_id:%s AND institution:\"%s\"' % (source, institution),\n                \"rows\": 0,\n                \"wt\": \"json\"\n            }\n\n            # check k10plus\n            result = get_solr_result(k10plus, params)\n            number = result[\"response\"][\"numFound\"]\n            if number != 0:\n                sql = 'INSERT INTO history (sourcebyinstitution, titles) VALUES (?, ?)'\n                sqlite.execute(sql, (sourcebyinstitution, number))\n                conn.commit()\n            else:\n                # check ai\n                result = get_solr_result(ai, params)\n                number = result[\"response\"][\"numFound\"]\n                if number != 0:\n                    # TODO: escape via sqlite\n                    sql = 'INSERT INTO history (sourcebyinstitution, titles) VALUES (?, ?)'\n                    sqlite.execute(sql, (sourcebyinstitution, number))\n                    conn.commit()\n\n            if sourcebyinstitution not in old_sourcebyinstitutions:\n                logging.info(\"The %s is now connected to SID %s.\", institution, source)\n                sql = \"INSERT INTO sourcebyinstitution (sourcebyinstitution) VALUES (?)\"\n                sqlite.execute(sql, (sourcebyinstitution))\n                conn.commit()\n\n            if number != 0:\n                old_sourcebyinstitution_number = get_old_sourcebyinstitution_number(conn, sqlite, sourcebyinstitution)\n                if number < old_sourcebyinstitution_number:\n                    message = \"Die Anzahl der Titel hat sich bei %s gegenueber einem frueheren Import verringert.\" % (sourcebyinstitution)\n                    send_message(message)\n\n            # requests.exceptions.ConnectionError: HTTPConnectionPool(XXXXXX): Max retries exceeded\n            time.sleep(0.25)\n\n    for old_sourcebyinstitution in old_sourcebyinstitutions:\n        if old_sourcebyinstitution not in current_sourcebyinstitutions:\n            message = \"Die %s ist nicht laenger f\u00fcr die SID %s angesigelt.\" % (institution, source)\n            send_message(message)", "commit_link": "github.com/miku/siskin/commit/7fa398d2fea72bf2e8b4808f75df4b3d35ae959a", "file_name": "bin/solrcheckup.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 30, "char_start": 1094, "char_end": 1218, "line": "                sql = 'INSERT INTO history (sourcebyinstitution, titles) VALUES (\"%s\", %s)' % (sourcebyinstitution, number)\n"}, {"line_no": 31, "char_start": 1218, "char_end": 1254, "line": "                sqlite.execute(sql)\n"}, {"line_no": 39, "char_start": 1516, "char_end": 1644, "line": "                    sql = 'INSERT INTO history (sourcebyinstitution, titles) VALUES (\"%s\", %s)' % (sourcebyinstitution, number)\n"}, {"line_no": 40, "char_start": 1644, "char_end": 1684, "line": "                    sqlite.execute(sql)\n"}, {"line_no": 45, "char_start": 1875, "char_end": 1989, "line": "                sql = \"INSERT INTO sourcebyinstitution (sourcebyinstitution) VALUES ('%s')\" % sourcebyinstitution\n"}, {"line_no": 46, "char_start": 1989, "char_end": 2025, "line": "                sqlite.execute(sql)\n"}], "added": [{"line_no": 30, "char_start": 1094, "char_end": 1182, "line": "                sql = 'INSERT INTO history (sourcebyinstitution, titles) VALUES (?, ?)'\n"}, {"line_no": 31, "char_start": 1182, "char_end": 1249, "line": "                sqlite.execute(sql, (sourcebyinstitution, number))\n"}, {"line_no": 39, "char_start": 1511, "char_end": 1603, "line": "                    sql = 'INSERT INTO history (sourcebyinstitution, titles) VALUES (?, ?)'\n"}, {"line_no": 40, "char_start": 1603, "char_end": 1674, "line": "                    sqlite.execute(sql, (sourcebyinstitution, number))\n"}, {"line_no": 45, "char_start": 1865, "char_end": 1954, "line": "                sql = \"INSERT INTO sourcebyinstitution (sourcebyinstitution) VALUES (?)\"\n"}, {"line_no": 46, "char_start": 1954, "char_end": 2013, "line": "                sqlite.execute(sql, (sourcebyinstitution))\n"}]}, "char_changes": {"deleted": [{"char_start": 1175, "char_end": 1179, "chars": "\"%s\""}, {"char_start": 1181, "char_end": 1183, "chars": "%s"}, {"char_start": 1185, "char_end": 1217, "chars": " % (sourcebyinstitution, number)"}, {"char_start": 1601, "char_end": 1605, "chars": "\"%s\""}, {"char_start": 1607, "char_end": 1609, "chars": "%s"}, {"char_start": 1611, "char_end": 1643, "chars": " % (sourcebyinstitution, number)"}, {"char_start": 1960, "char_end": 1964, "chars": "'%s'"}, {"char_start": 1966, "char_end": 1988, "chars": " % sourcebyinstitution"}], "added": [{"char_start": 1175, "char_end": 1176, "chars": "?"}, {"char_start": 1178, "char_end": 1179, "chars": "?"}, {"char_start": 1216, "char_end": 1247, "chars": ", (sourcebyinstitution, number)"}, {"char_start": 1596, "char_end": 1597, "chars": "?"}, {"char_start": 1599, "char_end": 1600, "chars": "?"}, {"char_start": 1641, "char_end": 1672, "chars": ", (sourcebyinstitution, number)"}, {"char_start": 1950, "char_end": 1951, "chars": "?"}, {"char_start": 1988, "char_end": 2011, "chars": ", (sourcebyinstitution)"}]}}
{"func_name": "change_message", "func_src_before": "    def change_message(self, new_message, logged_user):\n        update_sql = \"\"\"\n            UPDATE Clients\n            SET message = '{}'\n            WHERE client_id = '{}'\n        \"\"\".format(new_message, logged_user.get_client_id())\n\n        cursor = self.__conn.cursor()\n\n        cursor.execute(update_sql)\n        self.__conn.commit()\n        logged_user.set_message(new_message)", "func_src_after": "    def change_message(self, new_message, logged_user):\n        update_sql = \"\"\"\n            UPDATE Clients\n            SET message = ?\n            WHERE client_id = ?\n        \"\"\"\n\n        cursor = self.__conn.cursor()\n\n        cursor.execute(update_sql, (new_message, logged_user.get_client_id()))\n        self.__conn.commit()\n        logged_user.set_message(new_message)", "commit_link": "github.com/AnetaStoycheva/Programming101_HackBulgaria/commit/c0d6f4b8fe83a375832845a45952b5153e4c34f3", "file_name": "Week_9/sql_manager.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 4, "char_start": 108, "char_end": 139, "line": "            SET message = '{}'\n"}, {"line_no": 5, "char_start": 139, "char_end": 174, "line": "            WHERE client_id = '{}'\n"}, {"line_no": 6, "char_start": 174, "char_end": 235, "line": "        \"\"\".format(new_message, logged_user.get_client_id())\n"}, {"line_no": 10, "char_start": 275, "char_end": 310, "line": "        cursor.execute(update_sql)\n"}], "added": [{"line_no": 4, "char_start": 108, "char_end": 136, "line": "            SET message = ?\n"}, {"line_no": 5, "char_start": 136, "char_end": 168, "line": "            WHERE client_id = ?\n"}, {"line_no": 6, "char_start": 168, "char_end": 180, "line": "        \"\"\"\n"}, {"line_no": 10, "char_start": 220, "char_end": 299, "line": "        cursor.execute(update_sql, (new_message, logged_user.get_client_id()))\n"}]}, "char_changes": {"deleted": [{"char_start": 134, "char_end": 138, "chars": "'{}'"}, {"char_start": 169, "char_end": 173, "chars": "'{}'"}, {"char_start": 185, "char_end": 234, "chars": ".format(new_message, logged_user.get_client_id())"}], "added": [{"char_start": 134, "char_end": 135, "chars": "?"}, {"char_start": 166, "char_end": 167, "chars": "?"}, {"char_start": 253, "char_end": 297, "chars": ", (new_message, logged_user.get_client_id())"}]}}
{"func_name": "create_event", "func_src_before": "    def create_event(self, title, start_time, time_zone, server_id, description):\n        sql = \"\"\"INSERT INTO events (title, start_time, time_zone, server_id, description)\n                 VALUES ('{0}', '{1}', '{2}', '{3}', '{4}')\n                 \"\"\".format(title, start_time, time_zone, server_id, description)\n        self.cur.execute(sql)\n        self.conn.commit()", "func_src_after": "    def create_event(self, title, start_time, time_zone, server_id, description):\n        sql = \"\"\"\n              INSERT INTO events (title, start_time, time_zone, server_id, description)\n              VALUES (%s, %s, %s, %s, %s)\n              \"\"\"\n        self.cur.execute(sql, (title, start_time, time_zone, server_id, description))\n        self.conn.commit()", "commit_link": "github.com/jgayfer/spirit/commit/01c846c534c8d3cf6763f8b7444a0efe2caa3799", "file_name": "db/dbase.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 2, "char_start": 82, "char_end": 173, "line": "        sql = \"\"\"INSERT INTO events (title, start_time, time_zone, server_id, description)\n"}, {"line_no": 3, "char_start": 173, "char_end": 233, "line": "                 VALUES ('{0}', '{1}', '{2}', '{3}', '{4}')\n"}, {"line_no": 4, "char_start": 233, "char_end": 315, "line": "                 \"\"\".format(title, start_time, time_zone, server_id, description)\n"}, {"line_no": 5, "char_start": 315, "char_end": 345, "line": "        self.cur.execute(sql)\n"}], "added": [{"line_no": 2, "char_start": 82, "char_end": 100, "line": "        sql = \"\"\"\n"}, {"line_no": 3, "char_start": 100, "char_end": 188, "line": "              INSERT INTO events (title, start_time, time_zone, server_id, description)\n"}, {"line_no": 4, "char_start": 188, "char_end": 230, "line": "              VALUES (%s, %s, %s, %s, %s)\n"}, {"line_no": 5, "char_start": 230, "char_end": 248, "line": "              \"\"\"\n"}, {"line_no": 6, "char_start": 248, "char_end": 334, "line": "        self.cur.execute(sql, (title, start_time, time_zone, server_id, description))\n"}]}, "char_changes": {"deleted": [{"char_start": 187, "char_end": 190, "chars": "   "}, {"char_start": 198, "char_end": 203, "chars": "'{0}'"}, {"char_start": 205, "char_end": 210, "chars": "'{1}'"}, {"char_start": 212, "char_end": 217, "chars": "'{2}'"}, {"char_start": 219, "char_end": 224, "chars": "'{3}'"}, {"char_start": 226, "char_end": 231, "chars": "'{4}'"}, {"char_start": 250, "char_end": 253, "chars": "\"\"\""}, {"char_start": 254, "char_end": 256, "chars": "fo"}, {"char_start": 257, "char_end": 259, "chars": "ma"}, {"char_start": 314, "char_end": 343, "chars": "\n        self.cur.execute(sql"}], "added": [{"char_start": 99, "char_end": 114, "chars": "\n              "}, {"char_start": 210, "char_end": 212, "chars": "%s"}, {"char_start": 214, "char_end": 216, "chars": "%s"}, {"char_start": 218, "char_end": 220, "chars": "%s"}, {"char_start": 222, "char_end": 224, "chars": "%s"}, {"char_start": 226, "char_end": 228, "chars": "%s"}, {"char_start": 247, "char_end": 259, "chars": "\n        sel"}, {"char_start": 260, "char_end": 263, "chars": ".cu"}, {"char_start": 264, "char_end": 270, "chars": ".execu"}, {"char_start": 271, "char_end": 278, "chars": "e(sql, "}]}}
{"func_name": "get_login2", "func_src_before": "@bot.message_handler(func = lambda message: get_current_state(message.chat.id) == config.States.S_LOGIN.value)\ndef get_login2(message):\n    settings = sqlite3.connect(os.path.abspath(os.path.dirname(__file__)) + \"\\\\bases\\\\settings.db\")\n    conn = settings.cursor()\n    if bases.createuserbase.check_username(message.text):\n        bot.send_message(message.chat.id, \"Invalid handle.\")\n        set_state(message.chat.id, config.States.S_START.value)\n        return 0\n\n    conn.execute(\"select * from users where chat_id = '\" + str(message.chat.id) + \"'\")\n    name = conn.fetchone()\n    settings.close()\n    bases.update.cf_update()\n    bases.createuserbase.clean_base(name[1])\n    bases.createuserbase.clean_base(message.text)\n    bot.send_message(message.chat.id, \"Creating base...\")\n    bases.createuserbase.init_user(message.text, message.chat.id)\n    bot.send_message(message.chat.id, \"Done!\")\n    set_state(message.chat.id, config.States.S_START.value)", "func_src_after": "@bot.message_handler(func = lambda message: get_current_state(message.chat.id) == config.States.S_LOGIN.value)\ndef get_login2(message):\n    settings = sqlite3.connect(os.path.abspath(os.path.dirname(__file__)) + \"\\\\bases\\\\settings.db\")\n    conn = settings.cursor()\n    if bases.createuserbase.check_username(message.text):\n        bot.send_message(message.chat.id, \"Invalid handle.\")\n        set_state(message.chat.id, config.States.S_START.value)\n        return 0\n    conn.execute(\"select * from users where chat_id = ?\", (str(message.chat.id),))\n    name = conn.fetchone()\n    settings.close()\n    bases.update.cf_update()\n    bases.createuserbase.clean_base(name[1])\n    bases.createuserbase.clean_base(message.text)\n    bot.send_message(message.chat.id, \"Creating base...\")\n    bases.createuserbase.init_user(message.text, message.chat.id)\n    bot.send_message(message.chat.id, \"Done!\")\n    set_state(message.chat.id, config.States.S_START.value)", "commit_link": "github.com/lissrbay/codeforces_bot/commit/cc7f5143445a0030b1149ac60a65b1b1b9c92a90", "file_name": "bot.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 9, "char_start": 465, "char_end": 466, "line": "\n"}, {"line_no": 10, "char_start": 466, "char_end": 553, "line": "    conn.execute(\"select * from users where chat_id = '\" + str(message.chat.id) + \"'\")\n"}], "added": [{"line_no": 9, "char_start": 465, "char_end": 548, "line": "    conn.execute(\"select * from users where chat_id = ?\", (str(message.chat.id),))\n"}]}, "char_changes": {"deleted": [{"char_start": 465, "char_end": 466, "chars": "\n"}, {"char_start": 520, "char_end": 521, "chars": "'"}, {"char_start": 522, "char_end": 524, "chars": " +"}, {"char_start": 545, "char_end": 551, "chars": " + \"'\""}], "added": [{"char_start": 519, "char_end": 520, "chars": "?"}, {"char_start": 521, "char_end": 522, "chars": ","}, {"char_start": 523, "char_end": 524, "chars": "("}, {"char_start": 544, "char_end": 546, "chars": ",)"}]}}
{"func_name": "get_bracket_graph_data", "func_src_before": "def get_bracket_graph_data(db, tag):\n    # First, we have to find out which scenes this player has brackets in\n    sql = \"SELECT DISTINCT scene FROM ranks WHERE player='{}'\".format(tag)\n    scenes = db.exec(sql)\n    scenes = [s[0] for s in scenes]\n\n    bracket_placings_by_scene = {s: get_bracket_placings_in_scene(db, s, tag) for s in scenes}\n\n    return bracket_placings_by_scene", "func_src_after": "def get_bracket_graph_data(db, tag):\n    # First, we have to find out which scenes this player has brackets in\n    sql = \"SELECT DISTINCT scene FROM ranks WHERE player='{tag}'\"\n    args = {'tag': tag}\n    scenes = db.exec(sql, args)\n    scenes = [s[0] for s in scenes]\n\n    bracket_placings_by_scene = {s: get_bracket_placings_in_scene(db, s, tag) for s in scenes}\n\n    return bracket_placings_by_scene", "commit_link": "github.com/DKelle/Smash_stats/commit/4bb83f3f6ce7d6bebbeb512cd015f9e72cf36d63", "file_name": "bracket_utils.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 3, "char_start": 111, "char_end": 186, "line": "    sql = \"SELECT DISTINCT scene FROM ranks WHERE player='{}'\".format(tag)\n"}, {"line_no": 4, "char_start": 186, "char_end": 212, "line": "    scenes = db.exec(sql)\n"}], "added": [{"line_no": 3, "char_start": 111, "char_end": 177, "line": "    sql = \"SELECT DISTINCT scene FROM ranks WHERE player='{tag}'\"\n"}, {"line_no": 4, "char_start": 177, "char_end": 201, "line": "    args = {'tag': tag}\n"}, {"line_no": 5, "char_start": 201, "char_end": 233, "line": "    scenes = db.exec(sql, args)\n"}]}, "char_changes": {"deleted": [{"char_start": 173, "char_end": 176, "chars": ".fo"}, {"char_start": 177, "char_end": 178, "chars": "m"}, {"char_start": 179, "char_end": 181, "chars": "t("}, {"char_start": 184, "char_end": 185, "chars": ")"}], "added": [{"char_start": 170, "char_end": 173, "chars": "tag"}, {"char_start": 176, "char_end": 182, "chars": "\n    a"}, {"char_start": 183, "char_end": 190, "chars": "gs = {'"}, {"char_start": 191, "char_end": 196, "chars": "ag': "}, {"char_start": 199, "char_end": 200, "chars": "}"}, {"char_start": 225, "char_end": 231, "chars": ", args"}]}}
{"func_name": "get", "func_src_before": "    def get(self, email):\n        \"\"\" Fetch data for admin with the corresponding email \"\"\"\n        return database_utilities.execute_query(f\"\"\"select * from admins where email = '{email}'\"\"\")", "func_src_after": "    def get(self, email):\n        \"\"\" Fetch data for admin with the corresponding email \"\"\"\n        return database_utilities.execute_query(f\"\"\"select * from admins where email = %s\"\"\", (email, ))", "commit_link": "github.com/sgosal2/tiger-boards-backend/commit/4670109dd613df2f2fe7e8403ebd149df2b55485", "file_name": "apis/admins.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 3, "char_start": 92, "char_end": 192, "line": "        return database_utilities.execute_query(f\"\"\"select * from admins where email = '{email}'\"\"\")\n"}], "added": [{"line_no": 3, "char_start": 92, "char_end": 196, "line": "        return database_utilities.execute_query(f\"\"\"select * from admins where email = %s\"\"\", (email, ))\n"}]}, "char_changes": {"deleted": [{"char_start": 179, "char_end": 181, "chars": "'{"}, {"char_start": 186, "char_end": 191, "chars": "}'\"\"\""}], "added": [{"char_start": 179, "char_end": 187, "chars": "%s\"\"\", ("}, {"char_start": 192, "char_end": 195, "chars": ", )"}]}}
{"func_name": "insertUsage", "func_src_before": "def insertUsage(user, command):\n\tc, conn = getConnection()\n\tdate = now()\n\tc.execute(\"INSERT INTO usage (date,user,command) VALUES ('\"+date+\"','\"+str(user)+\"','\"+command+\"')\")\n\tconn.commit()\n\tconn.close()", "func_src_after": "def insertUsage(user, command):\n\tc, conn = getConnection()\n\tdate = now()\n\tc.execute(\"INSERT INTO usage (date,user,command) VALUES (?,?,?)\",(date,str(user),command))\n\tconn.commit()\n\tconn.close()", "commit_link": "github.com/DangerBlack/DungeonsAndDragonsMasterBot/commit/63f980c6dff746f5fcf3005d0646b6c24f81cdc0", "file_name": "database.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 4, "char_start": 73, "char_end": 175, "line": "\tc.execute(\"INSERT INTO usage (date,user,command) VALUES ('\"+date+\"','\"+str(user)+\"','\"+command+\"')\")\n"}], "added": [{"line_no": 4, "char_start": 73, "char_end": 165, "line": "\tc.execute(\"INSERT INTO usage (date,user,command) VALUES (?,?,?)\",(date,str(user),command))\n"}]}, "char_changes": {"deleted": [{"char_start": 131, "char_end": 132, "chars": "'"}, {"char_start": 133, "char_end": 134, "chars": "+"}, {"char_start": 138, "char_end": 141, "chars": "+\"'"}, {"char_start": 142, "char_end": 145, "chars": "'\"+"}, {"char_start": 154, "char_end": 157, "chars": "+\"'"}, {"char_start": 158, "char_end": 161, "chars": "'\"+"}, {"char_start": 168, "char_end": 171, "chars": "+\"'"}, {"char_start": 172, "char_end": 173, "chars": "\""}], "added": [{"char_start": 131, "char_end": 137, "chars": "?,?,?)"}, {"char_start": 138, "char_end": 140, "chars": ",("}]}}
{"func_name": "verify_email", "func_src_before": "    def verify_email(self, member):\n        query = \"SELECT COUNT(email) FROM members WHERE email = '{email}'\".format(email = member)\n        self.cursor.execute(query)\n        result = self.cursor.fetchone()\n        if (int(result[0]) > 0):\n            return True \n        else:\n            return False", "func_src_after": "    def verify_email(self, member):\n        self.cursor.execute(\"SELECT COUNT(email) FROM members WHERE email = ':email'\", {'email':member})\n        result = self.cursor.fetchone()\n        if (int(result[0]) > 0):\n            return True \n        else:\n            return False", "commit_link": "github.com/kenboo98/291-Mini-Project-I/commit/3080ccb687c79c83954ce703faee8fcceec8c9eb", "file_name": "book_rides/book_rides.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 2, "char_start": 36, "char_end": 134, "line": "        query = \"SELECT COUNT(email) FROM members WHERE email = '{email}'\".format(email = member)\n"}, {"line_no": 3, "char_start": 134, "char_end": 169, "line": "        self.cursor.execute(query)\n"}], "added": [{"line_no": 2, "char_start": 36, "char_end": 141, "line": "        self.cursor.execute(\"SELECT COUNT(email) FROM members WHERE email = ':email'\", {'email':member})\n"}]}, "char_changes": {"deleted": [{"char_start": 44, "char_end": 46, "chars": "qu"}, {"char_start": 48, "char_end": 52, "chars": "y = "}, {"char_start": 101, "char_end": 102, "chars": "{"}, {"char_start": 107, "char_end": 108, "chars": "}"}, {"char_start": 110, "char_end": 118, "chars": ".format("}, {"char_start": 123, "char_end": 126, "chars": " = "}, {"char_start": 132, "char_end": 167, "chars": ")\n        self.cursor.execute(query"}], "added": [{"char_start": 44, "char_end": 60, "chars": "self.cursor.exec"}, {"char_start": 61, "char_end": 62, "chars": "t"}, {"char_start": 63, "char_end": 64, "chars": "("}, {"char_start": 113, "char_end": 114, "chars": ":"}, {"char_start": 121, "char_end": 125, "chars": ", {'"}, {"char_start": 130, "char_end": 132, "chars": "':"}, {"char_start": 138, "char_end": 139, "chars": "}"}]}}
{"func_name": "get_previous_yields", "func_src_before": "    def get_previous_yields(self, inverter_serial):\n        query = '''\n           SELECT TimeStamp, EToday, ETotal\n           FROM Inverters\n           WHERE Serial = '%s'\n        ''' % (inverter_serial)\n        self.c.execute(query)\n        data = self.c.fetchone()\n        return data[0], data[1], data[2]", "func_src_after": "    def get_previous_yields(self, inverter_serial):\n        query = '''\n           SELECT TimeStamp, EToday, ETotal\n           FROM Inverters\n           WHERE Serial=?\n        '''\n        self.c.execute(query, (inverter_serial,))\n        data = self.c.fetchone()\n        return data[0], data[1], data[2]", "commit_link": "github.com/philipptrenz/s0-bridge/commit/269b48caa05377b7c58c3e6d1622a4429cb5ba65", "file_name": "util/database.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 5, "char_start": 142, "char_end": 173, "line": "           WHERE Serial = '%s'\n"}, {"line_no": 6, "char_start": 173, "char_end": 205, "line": "        ''' % (inverter_serial)\n"}, {"line_no": 7, "char_start": 205, "char_end": 235, "line": "        self.c.execute(query)\n"}], "added": [{"line_no": 5, "char_start": 142, "char_end": 168, "line": "           WHERE Serial=?\n"}, {"line_no": 6, "char_start": 168, "char_end": 180, "line": "        '''\n"}, {"line_no": 7, "char_start": 180, "char_end": 230, "line": "        self.c.execute(query, (inverter_serial,))\n"}]}, "char_changes": {"deleted": [{"char_start": 165, "char_end": 166, "chars": " "}, {"char_start": 167, "char_end": 172, "chars": " '%s'"}, {"char_start": 184, "char_end": 204, "chars": " % (inverter_serial)"}], "added": [{"char_start": 166, "char_end": 167, "chars": "?"}, {"char_start": 208, "char_end": 228, "chars": ", (inverter_serial,)"}]}}
{"func_name": "referrer_count", "func_src_before": "@app.route('/referrer_count')\ndef referrer_count():\n    account_id = request.args.get('account_id')\n\n    if not isObject(account_id):\n        ws.send('{\"id\":1, \"method\":\"call\", \"params\":[0,\"lookup_account_names\",[[\"' + account_id + '\"], 0]]}')\n        result_l = ws.recv()\n        j_l = json.loads(result_l)\n\n        account_id = j_l[\"result\"][0][\"id\"]\n\n    con = psycopg2.connect(**config.POSTGRES)\n    cur = con.cursor()\n\n    query = \"select count(*) from referrers where referrer='\"+account_id+\"'\"\n    cur.execute(query)\n    results = cur.fetchone()\n\n    return jsonify(results)", "func_src_after": "@app.route('/referrer_count')\ndef referrer_count():\n    account_id = request.args.get('account_id')\n\n    if not isObject(account_id):\n        ws.send('{\"id\":1, \"method\":\"call\", \"params\":[0,\"lookup_account_names\",[[\"' + account_id + '\"], 0]]}')\n        result_l = ws.recv()\n        j_l = json.loads(result_l)\n\n        account_id = j_l[\"result\"][0][\"id\"]\n\n    con = psycopg2.connect(**config.POSTGRES)\n    cur = con.cursor()\n\n    query = \"select count(*) from referrers where referrer=%s\"\n    cur.execute(query, (account_id,))\n    results = cur.fetchone()\n\n    return jsonify(results)", "commit_link": "github.com/VinChain/vinchain-python-api-backend/commit/b78088a551fbb712121269c6eb7f43ede120ff60", "file_name": "api.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 15, "char_start": 424, "char_end": 501, "line": "    query = \"select count(*) from referrers where referrer='\"+account_id+\"'\"\n"}, {"line_no": 16, "char_start": 501, "char_end": 524, "line": "    cur.execute(query)\n"}], "added": [{"line_no": 15, "char_start": 424, "char_end": 487, "line": "    query = \"select count(*) from referrers where referrer=%s\"\n"}, {"line_no": 16, "char_start": 487, "char_end": 525, "line": "    cur.execute(query, (account_id,))\n"}]}, "char_changes": {"deleted": [{"char_start": 483, "char_end": 499, "chars": "'\"+account_id+\"'"}], "added": [{"char_start": 483, "char_end": 485, "chars": "%s"}, {"char_start": 508, "char_end": 523, "chars": ", (account_id,)"}]}}
{"func_name": "analyze_scene", "func_src_before": "    def analyze_scene(self, scene):\n        base_urls = scene.get_base_urls()\n        users = scene.get_users()\n        name = scene.get_name()\n        LOG.info('found the following users for scene {}: {}'.format(name, users))\n\n        # This scene might have one user who always posts the brackets on their challonge account\n        for user in users:\n            # Have we analyzed this user before?\n            sql = \"SELECT * FROM user_analyzed WHERE user='{}';\".format(user)\n            results = self.db.exec(sql)\n\n            # Did we have any matches in the database?\n            if len(results) > 0:\n                # We have analyzed this user before. Just grab one page of brackets to see if there have been any new tournaments\n                # eg, just look at /users/christmasmike?page=1 instead of all the pages that exist\n                most_recent_page = bracket_utils.get_brackets_from_user(user, pages=1)\n                for bracket in most_recent_page:\n                    LOG.info('here are the brackets from the most recent page of user {}: {}'.format(user, most_recent_page))\n                    # This user has already been analyzed, there's a good chance this bracket has been analyzed also\n                    sql = \"SELECT * FROM user_analyzed WHERE url='{}' AND user='{}';\".format(bracket, user)\n                    results = self.db.exec(sql)\n\n                    if len(results) == 0:\n                        # This is a new bracket that must have been published in the last hour or so\n                        LOG.info('found this url from a user: {} {}'.format(bracket, user))\n                        display_name = bracket_utils.get_display_base(bracket)\n                        # We don't care about doubles tournaments\n                        if 'doubles' in display_name.lower() or 'dubs' in display_name.lower():\n                            LOG.info('We are skipping the tournament {} because it is a doubles tournament'.format(display_name))\n                            continue\n\n                        self.data_processor.process(bracket, name, display_name)\n\n                        # mark this bracket as analyzed\n                        sql = \"INSERT INTO user_analyzed (url, user, scene) VALUES ('{}', '{}', '{}');\".format(bracket, user, name)\n                        self.db.exec(sql)\n\n                        # Tweet that we found a new bracket\n                        msg = \"Found new {} bracket: {}\".format(name, bracket)\n                        tweet(msg)\n                    else:\n                        LOG.info('url {} is not new for user {}'.format(bracket, user))\n            else:\n                # This is a new user, analyze all brackets\n                user_urls = bracket_utils.get_brackets_from_user(user)\n                for url in user_urls:\n                    LOG.info('found this url from a user: {} {}'.format(url, user))\n                    display_name = bracket_utils.get_display_base(url)\n                    # We don't care about doubles tournaments\n                    if 'doubles' in display_name.lower() or 'dubs' in display_name.lower():\n                        LOG.info('We are skipping the tournament {} because it is a doubles tournament'.format(display_name))\n                        continue\n\n                    self.data_processor.process(url, name, display_name)\n\n                    # mark this bracket as analyzed\n                    sql = \"INSERT INTO user_analyzed (url, user, scene) VALUES ('{}', '{}', '{}');\".format(url, user, name)\n                    self.db.exec(sql)\n\n                LOG.info('done with user {}'.format(user))\n\n\n        # This scene might always call their brackets the same thing, eg weekly1, weekly2, weekly3 etc\n        for base_url in base_urls:\n            # attempt to load this data from the database\n            LOG.info('About to start this analysis thread for scene {}'.format(scene.get_name()))\n            sql = \"SELECT first,last FROM valids WHERE base_url = '\" + str(base_url) + \"';\"\n            result = self.db.exec(sql)\n            has_results = len(result) > 0 \n\n            # Did we find a match in the database?\n            if has_results:\n                LOG.info(\"validURLs found values in the database\" + str(result))\n                first = result[0][0]\n                last = result[0][1]\n\n                # Check for a new valid URL\n                new_last = bracket_utils._get_last_valid_url(base_url, last-1)\n\n                if not new_last == last:\n                    if new_last - last > 5:\n                        with open(\"DEBUGOUTPUT.txt\", 'a') as f:\n                            f.write(\"[validURLs.py:55]: found a SHIT TON of new tournaments for bracket: {}\".format(base_url))\n\n                    else:\n                        bracket = base_url.replace('###', str(new_last))\n                        LOG.info('Found new bracket: {}'.format(bracket))\n                        msg = \"Found new bracket: {}\".format(bracket)\n                        tweet(msg)\n\n                    # If there's been a new last, update the database\n                    sql = \"UPDATE valids SET last=\" + str(new_last) + \" where base_url = '\"+str(base_url)+\"';\"\n                    self.db.exec(sql)\n\n\n                    # Analyze each of these new brackets\n                    for i in range(last+1, new_last+1):\n                        # Since this URL is new, we have to process the data\n                        bracket = base_url.replace('###', str(i))\n                        # Create the display name for this bracket\n                        # Eg challonge.com/NP9ATX54 -> NP9 54\n                        display_name = bracket_utils.get_display_base(bracket, counter=i)\n                        # We don't care about doubles tournaments\n                        if 'doubles' in display_name.lower() or 'dubs' in display_name.lower():\n                            LOG.info('We are skipping the tournament {} because it is a doubles tournament'.format(display_name))\n                            continue\n\n                        self.data_processor.process(bracket, name, display_name, new_bracket=True)\n\n            else:\n                # We need to create first and last from scratch\n                first = bracket_utils._get_first_valid_url(base_url)\n                last = bracket_utils._get_last_valid_url(base_url, first)\n\n                # This is new data, we need to put it into the db\n                sql = \"INSERT INTO valids (base_url, first, last, scene) VALUES (\"\n                sql += \"'\"+str(base_url)+\"', \"+str(first)+ \", \"+str(last)+\", '\"+str(name)+\"');\"\n                self.db.exec(sql)\n\n                for i in range(first, last+1):\n                    bracket = base_url.replace('###', str(i))\n                    # Create the display name for this bracket\n                    # Eg challonge.com/NP9ATX54 -> NP9 54\n                    display_name = bracket_utils.get_display_base(bracket, counter=i)\n                    # We don't care about doubles tournaments\n                    if 'doubles' in display_name.lower() or 'dubs' in display_name.lower():\n                        LOG.info('We are skipping the tournament {} because it is a doubles tournament'.format(display_name))\n                        continue\n\n                    self.data_processor.process(bracket, name, display_name)\n\n                    # Calculate ranks after each tournament so we can see how players are progressing\n        if not analyzed_scenes and should_tweet:\n            tweet('About to start ranking for scene {}'.format(name))\n        self.data_processor.check_and_update_ranks(name)", "func_src_after": "    def analyze_scene(self, scene):\n        base_urls = scene.get_base_urls()\n        users = scene.get_users()\n        name = scene.get_name()\n        LOG.info('found the following users for scene {}: {}'.format(name, users))\n\n        # This scene might have one user who always posts the brackets on their challonge account\n        for user in users:\n            # Have we analyzed this user before?\n            sql = \"SELECT * FROM user_analyzed WHERE user='{user}';\"\n            args = {'user': user}\n            results = self.db.exec(sql, args)\n\n            # Did we have any matches in the database?\n            if len(results) > 0:\n                # We have analyzed this user before. Just grab one page of brackets to see if there have been any new tournaments\n                # eg, just look at /users/christmasmike?page=1 instead of all the pages that exist\n                most_recent_page = bracket_utils.get_brackets_from_user(user, pages=1)\n                for bracket in most_recent_page:\n                    LOG.info('here are the brackets from the most recent page of user {}: {}'.format(user, most_recent_page))\n                    # This user has already been analyzed, there's a good chance this bracket has been analyzed also\n                    sql = \"SELECT * FROM user_analyzed WHERE url='{bracket}' AND user='{user}';\"\n                    args = {'bracket': bracket, 'user': user}\n                    results = self.db.exec(sql, args)\n\n                    if len(results) == 0:\n                        # This is a new bracket that must have been published in the last hour or so\n                        LOG.info('found this url from a user: {} {}'.format(bracket, user))\n                        display_name = bracket_utils.get_display_base(bracket)\n                        # We don't care about doubles tournaments\n                        if 'doubles' in display_name.lower() or 'dubs' in display_name.lower():\n                            LOG.info('We are skipping the tournament {} because it is a doubles tournament'.format(display_name))\n                            continue\n\n                        self.data_processor.process(bracket, name, display_name)\n\n                        # mark this bracket as analyzed\n                        sql = \"INSERT INTO user_analyzed (url, user, scene) VALUES ('{bracket}', '{user}', '{name}');\"\n                        args = {'bracket': bracket, 'user':user, 'name':name}\n                        self.db.exec(sql, args)\n\n                        # Tweet that we found a new bracket\n                        msg = \"Found new {} bracket: {}\".format(name, bracket)\n                        tweet(msg)\n                    else:\n                        LOG.info('url {} is not new for user {}'.format(bracket, user))\n            else:\n                # This is a new user, analyze all brackets\n                user_urls = bracket_utils.get_brackets_from_user(user)\n                for url in user_urls:\n                    LOG.info('found this url from a user: {} {}'.format(url, user))\n                    display_name = bracket_utils.get_display_base(url)\n                    # We don't care about doubles tournaments\n                    if 'doubles' in display_name.lower() or 'dubs' in display_name.lower():\n                        LOG.info('We are skipping the tournament {} because it is a doubles tournament'.format(display_name))\n                        continue\n\n                    self.data_processor.process(url, name, display_name)\n\n                    # mark this bracket as analyzed\n                    sql = \"INSERT INTO user_analyzed (url, user, scene) VALUES ('{url}', '{user}', '{name}');\"\n                    args = {'url': url, 'user':user, 'name':name}\n                    self.db.exec(sql, args)\n\n                LOG.info('done with user {}'.format(user))\n\n\n        # This scene might always call their brackets the same thing, eg weekly1, weekly2, weekly3 etc\n        for base_url in base_urls:\n            # attempt to load this data from the database\n            LOG.info('About to start this analysis thread for scene {}'.format(scene.get_name()))\n            sql = \"SELECT first,last FROM valids WHERE base_url = '{base_url}';\"\n            args = {'base_url': base_url}\n            result = self.db.exec(sql, args)\n            has_results = len(result) > 0 \n\n            # Did we find a match in the database?\n            if has_results:\n                LOG.info(\"validURLs found values in the database\" + str(result))\n                first = result[0][0]\n                last = result[0][1]\n\n                # Check for a new valid URL\n                new_last = bracket_utils._get_last_valid_url(base_url, last-1)\n\n                if not new_last == last:\n                    if new_last - last > 5:\n                        with open(\"DEBUGOUTPUT.txt\", 'a') as f:\n                            f.write(\"[validURLs.py:55]: found a SHIT TON of new tournaments for bracket: {}\".format(base_url))\n\n                    else:\n                        bracket = base_url.replace('###', str(new_last))\n                        LOG.info('Found new bracket: {}'.format(bracket))\n                        msg = \"Found new bracket: {}\".format(bracket)\n                        tweet(msg)\n\n                    # If there's been a new last, update the database\n                    sql = \"UPDATE valids SET last={new_last} where base_url='{base_url}';\"\n                    args = {'new_last': new_last, 'base_url': base_url}\n                    self.db.exec(sql, args)\n\n\n                    # Analyze each of these new brackets\n                    for i in range(last+1, new_last+1):\n                        # Since this URL is new, we have to process the data\n                        bracket = base_url.replace('###', str(i))\n                        # Create the display name for this bracket\n                        # Eg challonge.com/NP9ATX54 -> NP9 54\n                        display_name = bracket_utils.get_display_base(bracket, counter=i)\n                        # We don't care about doubles tournaments\n                        if 'doubles' in display_name.lower() or 'dubs' in display_name.lower():\n                            LOG.info('We are skipping the tournament {} because it is a doubles tournament'.format(display_name))\n                            continue\n\n                        self.data_processor.process(bracket, name, display_name, new_bracket=True)\n\n            else:\n                # We need to create first and last from scratch\n                first = bracket_utils._get_first_valid_url(base_url)\n                last = bracket_utils._get_last_valid_url(base_url, first)\n\n                # This is new data, we need to put it into the db\n                sql = \"INSERT INTO valids (base_url, first, last, scene) VALUES ('{base_url}', '{first}', '{last}', '{name}');\"\n                args = {'base_url': base_url, 'first': first, 'last': last, 'name': name}\n                self.db.exec(sql, args)\n\n                for i in range(first, last+1):\n                    bracket = base_url.replace('###', str(i))\n                    # Create the display name for this bracket\n                    # Eg challonge.com/NP9ATX54 -> NP9 54\n                    display_name = bracket_utils.get_display_base(bracket, counter=i)\n                    # We don't care about doubles tournaments\n                    if 'doubles' in display_name.lower() or 'dubs' in display_name.lower():\n                        LOG.info('We are skipping the tournament {} because it is a doubles tournament'.format(display_name))\n                        continue\n\n                    self.data_processor.process(bracket, name, display_name)\n\n                    # Calculate ranks after each tournament so we can see how players are progressing\n        if not analyzed_scenes and should_tweet:\n            tweet('About to start ranking for scene {}'.format(name))\n        self.data_processor.check_and_update_ranks(name)", "commit_link": "github.com/DKelle/Smash_stats/commit/4bb83f3f6ce7d6bebbeb512cd015f9e72cf36d63", "file_name": "validURLs.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 10, "char_start": 402, "char_end": 480, "line": "            sql = \"SELECT * FROM user_analyzed WHERE user='{}';\".format(user)\n"}, {"line_no": 11, "char_start": 480, "char_end": 520, "line": "            results = self.db.exec(sql)\n"}, {"line_no": 21, "char_start": 1217, "char_end": 1325, "line": "                    sql = \"SELECT * FROM user_analyzed WHERE url='{}' AND user='{}';\".format(bracket, user)\n"}, {"line_no": 22, "char_start": 1325, "char_end": 1373, "line": "                    results = self.db.exec(sql)\n"}, {"line_no": 36, "char_start": 2156, "char_end": 2288, "line": "                        sql = \"INSERT INTO user_analyzed (url, user, scene) VALUES ('{}', '{}', '{}');\".format(bracket, user, name)\n"}, {"line_no": 37, "char_start": 2288, "char_end": 2330, "line": "                        self.db.exec(sql)\n"}, {"line_no": 58, "char_start": 3400, "char_end": 3524, "line": "                    sql = \"INSERT INTO user_analyzed (url, user, scene) VALUES ('{}', '{}', '{}');\".format(url, user, name)\n"}, {"line_no": 59, "char_start": 3524, "char_end": 3562, "line": "                    self.db.exec(sql)\n"}, {"line_no": 68, "char_start": 3918, "char_end": 4010, "line": "            sql = \"SELECT first,last FROM valids WHERE base_url = '\" + str(base_url) + \"';\"\n"}, {"line_no": 69, "char_start": 4010, "char_end": 4049, "line": "            result = self.db.exec(sql)\n"}, {"line_no": 93, "char_start": 5077, "char_end": 5188, "line": "                    sql = \"UPDATE valids SET last=\" + str(new_last) + \" where base_url = '\"+str(base_url)+\"';\"\n"}, {"line_no": 94, "char_start": 5188, "char_end": 5226, "line": "                    self.db.exec(sql)\n"}, {"line_no": 117, "char_start": 6425, "char_end": 6508, "line": "                sql = \"INSERT INTO valids (base_url, first, last, scene) VALUES (\"\n"}, {"line_no": 118, "char_start": 6508, "char_end": 6604, "line": "                sql += \"'\"+str(base_url)+\"', \"+str(first)+ \", \"+str(last)+\", '\"+str(name)+\"');\"\n"}, {"line_no": 119, "char_start": 6604, "char_end": 6638, "line": "                self.db.exec(sql)\n"}], "added": [{"line_no": 10, "char_start": 402, "char_end": 471, "line": "            sql = \"SELECT * FROM user_analyzed WHERE user='{user}';\"\n"}, {"line_no": 11, "char_start": 471, "char_end": 505, "line": "            args = {'user': user}\n"}, {"line_no": 12, "char_start": 505, "char_end": 551, "line": "            results = self.db.exec(sql, args)\n"}, {"line_no": 22, "char_start": 1248, "char_end": 1345, "line": "                    sql = \"SELECT * FROM user_analyzed WHERE url='{bracket}' AND user='{user}';\"\n"}, {"line_no": 23, "char_start": 1345, "char_end": 1407, "line": "                    args = {'bracket': bracket, 'user': user}\n"}, {"line_no": 24, "char_start": 1407, "char_end": 1461, "line": "                    results = self.db.exec(sql, args)\n"}, {"line_no": 38, "char_start": 2244, "char_end": 2363, "line": "                        sql = \"INSERT INTO user_analyzed (url, user, scene) VALUES ('{bracket}', '{user}', '{name}');\"\n"}, {"line_no": 39, "char_start": 2363, "char_end": 2441, "line": "                        args = {'bracket': bracket, 'user':user, 'name':name}\n"}, {"line_no": 40, "char_start": 2441, "char_end": 2489, "line": "                        self.db.exec(sql, args)\n"}, {"line_no": 61, "char_start": 3559, "char_end": 3670, "line": "                    sql = \"INSERT INTO user_analyzed (url, user, scene) VALUES ('{url}', '{user}', '{name}');\"\n"}, {"line_no": 62, "char_start": 3670, "char_end": 3736, "line": "                    args = {'url': url, 'user':user, 'name':name}\n"}, {"line_no": 63, "char_start": 3736, "char_end": 3780, "line": "                    self.db.exec(sql, args)\n"}, {"line_no": 72, "char_start": 4136, "char_end": 4217, "line": "            sql = \"SELECT first,last FROM valids WHERE base_url = '{base_url}';\"\n"}, {"line_no": 73, "char_start": 4217, "char_end": 4259, "line": "            args = {'base_url': base_url}\n"}, {"line_no": 74, "char_start": 4259, "char_end": 4304, "line": "            result = self.db.exec(sql, args)\n"}, {"line_no": 98, "char_start": 5332, "char_end": 5423, "line": "                    sql = \"UPDATE valids SET last={new_last} where base_url='{base_url}';\"\n"}, {"line_no": 99, "char_start": 5423, "char_end": 5495, "line": "                    args = {'new_last': new_last, 'base_url': base_url}\n"}, {"line_no": 100, "char_start": 5495, "char_end": 5539, "line": "                    self.db.exec(sql, args)\n"}, {"line_no": 123, "char_start": 6738, "char_end": 6866, "line": "                sql = \"INSERT INTO valids (base_url, first, last, scene) VALUES ('{base_url}', '{first}', '{last}', '{name}');\"\n"}, {"line_no": 124, "char_start": 6866, "char_end": 6956, "line": "                args = {'base_url': base_url, 'first': first, 'last': last, 'name': name}\n"}, {"line_no": 125, "char_start": 6956, "char_end": 6996, "line": "                self.db.exec(sql, args)\n"}]}, "char_changes": {"deleted": [{"char_start": 466, "char_end": 469, "chars": ".fo"}, {"char_start": 470, "char_end": 474, "chars": "mat("}, {"char_start": 478, "char_end": 479, "chars": ")"}, {"char_start": 1302, "char_end": 1305, "chars": ".fo"}, {"char_start": 1306, "char_end": 1307, "chars": "m"}, {"char_start": 1309, "char_end": 1310, "chars": "("}, {"char_start": 1323, "char_end": 1324, "chars": ")"}, {"char_start": 2259, "char_end": 2262, "chars": ".fo"}, {"char_start": 2263, "char_end": 2264, "chars": "m"}, {"char_start": 2266, "char_end": 2267, "chars": "("}, {"char_start": 2286, "char_end": 2287, "chars": ")"}, {"char_start": 3499, "char_end": 3502, "chars": ".fo"}, {"char_start": 3503, "char_end": 3507, "chars": "mat("}, {"char_start": 3522, "char_end": 3523, "chars": ")"}, {"char_start": 3987, "char_end": 3988, "chars": "+"}, {"char_start": 3990, "char_end": 3991, "chars": "t"}, {"char_start": 3992, "char_end": 3993, "chars": "("}, {"char_start": 4001, "char_end": 4009, "chars": ") + \"';\""}, {"char_start": 5127, "char_end": 5135, "chars": "\" + str("}, {"char_start": 5143, "char_end": 5148, "chars": ") + \""}, {"char_start": 5167, "char_end": 5169, "chars": "\"+"}, {"char_start": 5172, "char_end": 5173, "chars": "("}, {"char_start": 5181, "char_end": 5187, "chars": ")+\"';\""}, {"char_start": 6525, "char_end": 6527, "chars": "ql"}, {"char_start": 6528, "char_end": 6529, "chars": "+"}, {"char_start": 6531, "char_end": 6532, "chars": "\""}, {"char_start": 6533, "char_end": 6535, "chars": "\"+"}, {"char_start": 6536, "char_end": 6537, "chars": "t"}, {"char_start": 6538, "char_end": 6539, "chars": "("}, {"char_start": 6547, "char_end": 6551, "chars": ")+\"'"}, {"char_start": 6553, "char_end": 6555, "chars": "\"+"}, {"char_start": 6557, "char_end": 6559, "chars": "r("}, {"char_start": 6564, "char_end": 6568, "chars": ")+ \""}, {"char_start": 6570, "char_end": 6572, "chars": "\"+"}, {"char_start": 6574, "char_end": 6576, "chars": "r("}, {"char_start": 6580, "char_end": 6583, "chars": ")+\""}, {"char_start": 6586, "char_end": 6592, "chars": "\"+str("}, {"char_start": 6596, "char_end": 6599, "chars": ")+\""}, {"char_start": 6600, "char_end": 6603, "chars": ");\""}], "added": [{"char_start": 462, "char_end": 466, "chars": "user"}, {"char_start": 470, "char_end": 483, "chars": "\n            "}, {"char_start": 484, "char_end": 492, "chars": "rgs = {'"}, {"char_start": 496, "char_end": 504, "chars": "': user}"}, {"char_start": 543, "char_end": 549, "chars": ", args"}, {"char_start": 1315, "char_end": 1322, "chars": "bracket"}, {"char_start": 1336, "char_end": 1340, "chars": "user"}, {"char_start": 1344, "char_end": 1366, "chars": "\n                    a"}, {"char_start": 1367, "char_end": 1376, "chars": "gs = {'br"}, {"char_start": 1377, "char_end": 1380, "chars": "cke"}, {"char_start": 1381, "char_end": 1384, "chars": "': "}, {"char_start": 1393, "char_end": 1394, "chars": "'"}, {"char_start": 1398, "char_end": 1406, "chars": "': user}"}, {"char_start": 1453, "char_end": 1459, "chars": ", args"}, {"char_start": 2330, "char_end": 2337, "chars": "bracket"}, {"char_start": 2343, "char_end": 2347, "chars": "user"}, {"char_start": 2353, "char_end": 2357, "chars": "name"}, {"char_start": 2362, "char_end": 2388, "chars": "\n                        a"}, {"char_start": 2389, "char_end": 2398, "chars": "gs = {'br"}, {"char_start": 2399, "char_end": 2402, "chars": "cke"}, {"char_start": 2403, "char_end": 2406, "chars": "': "}, {"char_start": 2415, "char_end": 2422, "chars": "'user':"}, {"char_start": 2428, "char_end": 2429, "chars": "'"}, {"char_start": 2433, "char_end": 2440, "chars": "':name}"}, {"char_start": 2481, "char_end": 2487, "chars": ", args"}, {"char_start": 3641, "char_end": 3644, "chars": "url"}, {"char_start": 3650, "char_end": 3654, "chars": "user"}, {"char_start": 3660, "char_end": 3664, "chars": "name"}, {"char_start": 3669, "char_end": 3690, "chars": "\n                    "}, {"char_start": 3691, "char_end": 3705, "chars": "rgs = {'url': "}, {"char_start": 3710, "char_end": 3717, "chars": "'user':"}, {"char_start": 3723, "char_end": 3724, "chars": "'"}, {"char_start": 3728, "char_end": 3735, "chars": "':name}"}, {"char_start": 3772, "char_end": 3778, "chars": ", args"}, {"char_start": 4203, "char_end": 4215, "chars": "{base_url}';"}, {"char_start": 4216, "char_end": 4219, "chars": "\n  "}, {"char_start": 4220, "char_end": 4225, "chars": "     "}, {"char_start": 4226, "char_end": 4230, "chars": "   a"}, {"char_start": 4231, "char_end": 4238, "chars": "gs = {'"}, {"char_start": 4247, "char_end": 4258, "chars": ": base_url}"}, {"char_start": 4296, "char_end": 4302, "chars": ", args"}, {"char_start": 5382, "char_end": 5383, "chars": "{"}, {"char_start": 5391, "char_end": 5392, "chars": "}"}, {"char_start": 5407, "char_end": 5447, "chars": "='{base_url}';\"\n                    args"}, {"char_start": 5450, "char_end": 5451, "chars": "{"}, {"char_start": 5452, "char_end": 5469, "chars": "new_last': new_la"}, {"char_start": 5471, "char_end": 5474, "chars": ", '"}, {"char_start": 5483, "char_end": 5494, "chars": ": base_url}"}, {"char_start": 5531, "char_end": 5537, "chars": ", args"}, {"char_start": 6819, "char_end": 6864, "chars": "'{base_url}', '{first}', '{last}', '{name}');"}, {"char_start": 6882, "char_end": 6885, "chars": "arg"}, {"char_start": 6889, "char_end": 6890, "chars": "{"}, {"char_start": 6891, "char_end": 6893, "chars": "ba"}, {"char_start": 6894, "char_end": 6897, "chars": "e_u"}, {"char_start": 6898, "char_end": 6902, "chars": "l': "}, {"char_start": 6912, "char_end": 6916, "chars": "'fir"}, {"char_start": 6918, "char_end": 6921, "chars": "': "}, {"char_start": 6928, "char_end": 6931, "chars": "'la"}, {"char_start": 6933, "char_end": 6936, "chars": "': "}, {"char_start": 6948, "char_end": 6955, "chars": ": name}"}, {"char_start": 6988, "char_end": 6994, "chars": ", args"}]}}
{"func_name": "get_article", "func_src_before": "def get_article(index):\n    with conn.cursor(cursor_factory=DictCursor) as cur:\n        query = \"SELECT * FROM articles WHERE index=\"+str(index)\n        cur.execute(query)\n        article = cur.fetchone()\n        return article", "func_src_after": "def get_article(index):\n    with conn.cursor(cursor_factory=DictCursor) as cur:\n        query = \"SELECT * FROM articles WHERE index=%s\"\n        cur.execute(query, (index, ))\n        article = cur.fetchone()\n        return article", "commit_link": "github.com/sepehr125/arxiv-doc2vec-recommender/commit/f23a4c32e6192b145017f64734b0a9a384c9123a", "file_name": "app.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 3, "char_start": 80, "char_end": 145, "line": "        query = \"SELECT * FROM articles WHERE index=\"+str(index)\n"}, {"line_no": 4, "char_start": 145, "char_end": 172, "line": "        cur.execute(query)\n"}], "added": [{"line_no": 3, "char_start": 80, "char_end": 136, "line": "        query = \"SELECT * FROM articles WHERE index=%s\"\n"}, {"line_no": 4, "char_start": 136, "char_end": 174, "line": "        cur.execute(query, (index, ))\n"}]}, "char_changes": {"deleted": [{"char_start": 132, "char_end": 134, "chars": "\"+"}, {"char_start": 135, "char_end": 144, "chars": "tr(index)"}], "added": [{"char_start": 132, "char_end": 133, "chars": "%"}, {"char_start": 134, "char_end": 135, "chars": "\""}, {"char_start": 161, "char_end": 172, "chars": ", (index, )"}]}}
{"func_name": "create_cf_base", "func_src_before": "def create_cf_base():\n    url = 'http://codeforces.com/problemset/'\n    r = requests.get(url)\n    max_page = 0\n    soup = BeautifulSoup(r.text, \"lxml\")\n    base = sqlite3.connect(os.path.abspath(os.path.dirname(__file__)) + \"\\\\cf.db\")\n    conn = base.cursor()\n    conn.execute(\"create table problems (problem INTEGER, diff CHAR)\")\n    for i in available_tags:\n        conn.execute(\"create table \" + i + \" (problems INTEGER, diff CHAR)\")\n\n    for link in soup.find_all(attrs={\"class\" : \"page-index\"}):\n        s = link.find('a')\n        s2 = s.get(\"href\").split('/')\n        max_page = max(max_page, int(s2[3]))\n\n    a = 0\n    b = 0\n    f = False\n    for i in range(1, max_page + 1):\n        r = requests.get('http://codeforces.com/problemset/' + '/page/' + str(i))\n        soup = BeautifulSoup(r.text, \"lxml\")\n        old = ''\n        for link in soup.find_all('a'):\n            s = link.get('href')\n            if s != None and s.find('/problemset') != -1:\n                s = s.split('/')\n                if len(s) == 5 and old != s[3] + s[4]:\n                    a = s[3]\n                    b = s[4]\n                    old = s[3] + s[4]\n                    if not f:\n                        f = True\n                        last_update = old\n                    conn.execute(\"insert into problems values (?, ?)\", (a, b))\n                if len(s) == 4 and s[3] in available_tags:\n                    conn.execute(\"insert into \" + s[3] + \" values (?, ?)\", (a, b))\n\n    base.commit()\n    base.close()\n    settings = sqlite3.connect(os.path.abspath(os.path.dirname(__file__)) + \"\\\\settings.db\")\n    conn = settings.cursor()\n    conn.execute(\"create table users (chat_id INTEGER, username STRING, last_update STRING, last_problem STRING, state INTEGER)\")\n    conn.execute(\"create table last_update_problemset (problem STRING)\")\n    conn.execute(\"insert into last_update_problemset values (?)\", (last_update, ))\n    settings.commit()\n    settings.close()", "func_src_after": "def create_cf_base():\n    url = 'http://codeforces.com/problemset/'\n    r = requests.get(url)\n    max_page = 0\n    soup = BeautifulSoup(r.text, \"lxml\")\n    base = sqlite3.connect(os.path.abspath(os.path.dirname(__file__)) + \"\\\\cf.db\")\n    conn = base.cursor()\n    conn.execute(\"create table problems (problem INTEGER, diff CHAR)\")\n    for i in available_tags:\n        conn.execute(\"create table ? (problems INTEGER, diff CHAR)\", (i,))\n\n    for link in soup.find_all(attrs={\"class\" : \"page-index\"}):\n        s = link.find('a')\n        s2 = s.get(\"href\").split('/')\n        max_page = max(max_page, int(s2[3]))\n\n    a = 0\n    b = 0\n    f = False\n    for i in range(1, max_page + 1):\n        r = requests.get('http://codeforces.com/problemset/' + '/page/' + str(i))\n        soup = BeautifulSoup(r.text, \"lxml\")\n        old = ''\n        for link in soup.find_all('a'):\n            s = link.get('href')\n            if s != None and s.find('/problemset') != -1:\n                s = s.split('/')\n                if len(s) == 5 and old != s[3] + s[4]:\n                    a = s[3]\n                    b = s[4]\n                    old = s[3] + s[4]\n                    if not f:\n                        f = True\n                        last_update = old\n                    conn.execute(\"insert into problems values (?, ?)\", (a, b))\n                if len(s) == 4 and s[3] in available_tags:\n                    conn.execute(\"insert into ? values (?, ?)\", (s[3], a, b))\n\n    base.commit()\n    base.close()\n    settings = sqlite3.connect(os.path.abspath(os.path.dirname(__file__)) + \"\\\\settings.db\")\n    conn = settings.cursor()\n    conn.execute(\"create table users (chat_id INTEGER, username STRING, last_update STRING, last_problem STRING, state INTEGER)\")\n    conn.execute(\"create table last_update_problemset (problem STRING)\")\n    conn.execute(\"insert into last_update_problemset values (?)\", (last_update, ))\n    settings.commit()\n    settings.close()", "commit_link": "github.com/lissrbay/codeforces_bot/commit/cc7f5143445a0030b1149ac60a65b1b1b9c92a90", "file_name": "bases/createcfbase.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 10, "char_start": 360, "char_end": 437, "line": "        conn.execute(\"create table \" + i + \" (problems INTEGER, diff CHAR)\")\n"}, {"line_no": 37, "char_start": 1385, "char_end": 1468, "line": "                    conn.execute(\"insert into \" + s[3] + \" values (?, ?)\", (a, b))\n"}], "added": [{"line_no": 10, "char_start": 360, "char_end": 435, "line": "        conn.execute(\"create table ? (problems INTEGER, diff CHAR)\", (i,))\n"}, {"line_no": 37, "char_start": 1383, "char_end": 1461, "line": "                    conn.execute(\"insert into ? values (?, ?)\", (s[3], a, b))\n"}]}, "char_changes": {"deleted": [{"char_start": 395, "char_end": 404, "chars": "\" + i + \""}, {"char_start": 1431, "char_end": 1443, "chars": "\" + s[3] + \""}], "added": [{"char_start": 395, "char_end": 396, "chars": "?"}, {"char_start": 427, "char_end": 433, "chars": ", (i,)"}, {"char_start": 1429, "char_end": 1430, "chars": "?"}, {"char_start": 1448, "char_end": 1454, "chars": "s[3], "}]}}
{"func_name": "closeGame", "func_src_before": "def closeGame(ID):\n\tdb.execute(\"UPDATE games set Running = 'No' WHERE ID = %i\" % ID)\n\tdatabase.commit()", "func_src_after": "def closeGame(ID):\n\tdb.execute(\"UPDATE games set Running = 'No' WHERE ID = ?\", ID)\n\tdatabase.commit()", "commit_link": "github.com/iScrE4m/XLeague/commit/59cab6e5fd8bd5e47f2418a7c71cb1d4e3cad0d2", "file_name": "plugins/database.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 2, "char_start": 19, "char_end": 85, "line": "\tdb.execute(\"UPDATE games set Running = 'No' WHERE ID = %i\" % ID)\n"}], "added": [{"line_no": 2, "char_start": 19, "char_end": 83, "line": "\tdb.execute(\"UPDATE games set Running = 'No' WHERE ID = ?\", ID)\n"}]}, "char_changes": {"deleted": [{"char_start": 75, "char_end": 77, "chars": "%i"}, {"char_start": 78, "char_end": 80, "chars": " %"}], "added": [{"char_start": 75, "char_end": 76, "chars": "?"}, {"char_start": 77, "char_end": 78, "chars": ","}]}}
{"func_name": "cancelFollow", "func_src_before": "    def cancelFollow(self,userid,friendid):\n        sqlText=\"delete from friends where userid=%d and friendid=%d;\"%(userid,friendid)\n        result=sql.deleteDB(self.conn,sqlText)\n        return result;", "func_src_after": "    def cancelFollow(self,userid,friendid):\n        sqlText=\"delete from friends where userid=%d and friendid=%s;\"\n        params=[userid,friendid]\n        result=sql.deleteDB(self.conn,sqlText,params)\n        return result;", "commit_link": "github.com/ShaominLi/Twitter_project/commit/5329d91f9e569c95184053c8e7ef596949c33ce9", "file_name": "modules/users.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 2, "char_start": 44, "char_end": 133, "line": "        sqlText=\"delete from friends where userid=%d and friendid=%d;\"%(userid,friendid)\n"}, {"line_no": 3, "char_start": 133, "char_end": 180, "line": "        result=sql.deleteDB(self.conn,sqlText)\n"}], "added": [{"line_no": 2, "char_start": 44, "char_end": 115, "line": "        sqlText=\"delete from friends where userid=%d and friendid=%s;\"\n"}, {"line_no": 3, "char_start": 115, "char_end": 148, "line": "        params=[userid,friendid]\n"}, {"line_no": 4, "char_start": 148, "char_end": 202, "line": "        result=sql.deleteDB(self.conn,sqlText,params)\n"}]}, "char_changes": {"deleted": [{"char_start": 111, "char_end": 112, "chars": "d"}, {"char_start": 114, "char_end": 116, "chars": "%("}, {"char_start": 131, "char_end": 132, "chars": ")"}], "added": [{"char_start": 111, "char_end": 112, "chars": "s"}, {"char_start": 114, "char_end": 131, "chars": "\n        params=["}, {"char_start": 146, "char_end": 147, "chars": "]"}, {"char_start": 193, "char_end": 200, "chars": ",params"}]}}
{"func_name": "change_pass", "func_src_before": "    def change_pass(self, new_pass, logged_user):\n        update_sql = \"\"\"\n            UPDATE Clients\n            SET password = '{}'\n            WHERE client_id = '{}'\n        \"\"\".format(new_pass, logged_user.get_client_id())\n\n        cursor = self.__conn.cursor()\n\n        cursor.execute(update_sql)\n        self.__conn.commit()", "func_src_after": "    def change_pass(self, new_pass, logged_user):\n        update_sql = \"\"\"\n            UPDATE Clients\n            SET password = ?\n            WHERE client_id = ?\n        \"\"\"\n\n        cursor = self.__conn.cursor()\n\n        cursor.execute(update_sql, (new_pass, logged_user.get_client_id()))\n        self.__conn.commit()", "commit_link": "github.com/AnetaStoycheva/Programming101_HackBulgaria/commit/c0d6f4b8fe83a375832845a45952b5153e4c34f3", "file_name": "Week_9/sql_manager.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 4, "char_start": 102, "char_end": 134, "line": "            SET password = '{}'\n"}, {"line_no": 5, "char_start": 134, "char_end": 169, "line": "            WHERE client_id = '{}'\n"}, {"line_no": 6, "char_start": 169, "char_end": 227, "line": "        \"\"\".format(new_pass, logged_user.get_client_id())\n"}, {"line_no": 10, "char_start": 267, "char_end": 302, "line": "        cursor.execute(update_sql)\n"}], "added": [{"line_no": 4, "char_start": 102, "char_end": 131, "line": "            SET password = ?\n"}, {"line_no": 5, "char_start": 131, "char_end": 163, "line": "            WHERE client_id = ?\n"}, {"line_no": 6, "char_start": 163, "char_end": 175, "line": "        \"\"\"\n"}, {"line_no": 10, "char_start": 215, "char_end": 291, "line": "        cursor.execute(update_sql, (new_pass, logged_user.get_client_id()))\n"}]}, "char_changes": {"deleted": [{"char_start": 129, "char_end": 133, "chars": "'{}'"}, {"char_start": 164, "char_end": 168, "chars": "'{}'"}, {"char_start": 180, "char_end": 226, "chars": ".format(new_pass, logged_user.get_client_id())"}], "added": [{"char_start": 129, "char_end": 130, "chars": "?"}, {"char_start": 161, "char_end": 162, "chars": "?"}, {"char_start": 248, "char_end": 289, "chars": ", (new_pass, logged_user.get_client_id())"}]}}
{"func_name": "getCommentsByPostid", "func_src_before": "    def getCommentsByPostid(self,postid,userid):\n        sqlText=\"select (select Count(*) from comment_like where comments.commentid = comment_like.commentid) as like,(select Count(*) from comment_like where comments.commentid = comment_like.commentid and comment_like.userid=%d) as flag,commentid,name,comment from users,comments where users.userid=comments.userid and postid=%d order by date desc;\"%(userid,postid)\n        result=sql.queryDB(self.conn,sqlText)\n        return result;", "func_src_after": "    def getCommentsByPostid(self,postid,userid):\n        sqlText=\"select (select Count(*) from comment_like where \\\n        comments.commentid = comment_like.commentid) as like,(select Count(*) \\\n                from comment_like where comments.commentid = \\\n                comment_like.commentid and comment_like.userid=%s) as \\\n                flag,commentid,name,comment from users,comments where \\\n                users.userid=comments.userid and postid=%s order by date desc;\"\n        params=[userid,postid]\n        result=sql.queryDB(self.conn,sqlText,params)\n        return result;", "commit_link": "github.com/ShaominLi/Twitter_project/commit/5329d91f9e569c95184053c8e7ef596949c33ce9", "file_name": "modules/comment.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 2, "char_start": 49, "char_end": 417, "line": "        sqlText=\"select (select Count(*) from comment_like where comments.commentid = comment_like.commentid) as like,(select Count(*) from comment_like where comments.commentid = comment_like.commentid and comment_like.userid=%d) as flag,commentid,name,comment from users,comments where users.userid=comments.userid and postid=%d order by date desc;\"%(userid,postid)\n"}, {"line_no": 3, "char_start": 417, "char_end": 463, "line": "        result=sql.queryDB(self.conn,sqlText)\n"}], "added": [{"line_no": 2, "char_start": 49, "char_end": 116, "line": "        sqlText=\"select (select Count(*) from comment_like where \\\n"}, {"line_no": 3, "char_start": 116, "char_end": 196, "line": "        comments.commentid = comment_like.commentid) as like,(select Count(*) \\\n"}, {"line_no": 4, "char_start": 196, "char_end": 259, "line": "                from comment_like where comments.commentid = \\\n"}, {"line_no": 5, "char_start": 259, "char_end": 331, "line": "                comment_like.commentid and comment_like.userid=%s) as \\\n"}, {"line_no": 6, "char_start": 331, "char_end": 403, "line": "                flag,commentid,name,comment from users,comments where \\\n"}, {"line_no": 7, "char_start": 403, "char_end": 483, "line": "                users.userid=comments.userid and postid=%s order by date desc;\"\n"}, {"line_no": 8, "char_start": 483, "char_end": 514, "line": "        params=[userid,postid]\n"}, {"line_no": 9, "char_start": 514, "char_end": 567, "line": "        result=sql.queryDB(self.conn,sqlText,params)\n"}]}, "char_changes": {"deleted": [{"char_start": 277, "char_end": 278, "chars": "d"}, {"char_start": 378, "char_end": 379, "chars": "d"}, {"char_start": 400, "char_end": 402, "chars": "%("}, {"char_start": 415, "char_end": 416, "chars": ")"}], "added": [{"char_start": 114, "char_end": 124, "chars": "\\\n        "}, {"char_start": 194, "char_end": 212, "chars": "\\\n                "}, {"char_start": 257, "char_end": 275, "chars": "\\\n                "}, {"char_start": 323, "char_end": 324, "chars": "s"}, {"char_start": 329, "char_end": 347, "chars": "\\\n                "}, {"char_start": 401, "char_end": 419, "chars": "\\\n                "}, {"char_start": 460, "char_end": 461, "chars": "s"}, {"char_start": 482, "char_end": 499, "chars": "\n        params=["}, {"char_start": 512, "char_end": 513, "chars": "]"}, {"char_start": 558, "char_end": 565, "chars": ",params"}]}}
{"func_name": "__init__.callback", "func_src_before": "        def callback(recipeName):\n            menu.pack_forget()\n            viewRecipeFrame.pack(expand=True, fill='both')\n            groceryButton.pack_forget()\n            database_file = \"meal_planner.db\"\n            print(recipeName)\n            with sqlite3.connect(database_file) as conn:\n                cursor = conn.cursor()\n                selection = cursor.execute(\"\"\"SELECT * FROM recipe WHERE name = \"\"\" + \"\\\"\" + recipeName + \"\\\"\")\n                for result in [selection]:\n                    for row in result.fetchall():\n                        name = row[0]\n                        time = row[1]\n                        servings = row[2]\n                        ingredients = row[4]\n                        directions = row[5]\n\n                        string = (\"Name: {} \\n Cook time: {} \\n Number of Servings: {} \\n \".format(name, time, servings))\n                        secondString = (\"Ingredients: {}\".format(ingredients))\n                        thirdString = (\"Directions: {}\".format(directions))\n            Label(viewRecipeFrame, text=string, font=MEDIUM_FONT, bg=\"#f8f8f8\", fg=\"#000000\").pack(side=TOP)\n            Label(viewRecipeFrame, text=secondString, font=MEDIUM_FONT, bg=\"#f8f8f8\", fg=\"#000000\").pack(side=TOP)\n            Label(viewRecipeFrame, text=thirdString, font=MEDIUM_FONT, bg=\"#f8f8f8\", fg=\"#000000\").pack(side=TOP)\n            returnButton = Button(menuFrame, text = \"Return to Menu\", highlightbackground=\"#e7e7e7\", command=lambda: [viewRecipeFrame.pack_forget(),\n                                                                                     menu.pack(), returnButton.pack_forget(), label.configure(text=\"Meal Planer\"),\n                                                                                    groceryButton.pack(side=RIGHT)])\n            returnButton.pack(side=RIGHT)", "func_src_after": "        def callback(recipeName):\n            menu.pack_forget()\n            viewRecipeFrame.pack(expand=True, fill='both')\n            groceryButton.pack_forget()\n            database_file = \"meal_planner.db\"\n            print(recipeName)\n            with sqlite3.connect(database_file) as conn:\n                cursor = conn.cursor()\n                selection = cursor.execute(\"\"\"SELECT * FROM recipe WHERE name = ?;\"\"\", (recipeName, ))\n                for result in [selection]:\n                    for row in result.fetchall():\n                        name = row[0]\n                        time = row[1]\n                        servings = row[2]\n                        ingredients = row[4]\n                        directions = row[5]\n\n                        string = (\"Name: {} \\n Cook time: {} \\n Number of Servings: {} \\n \".format(name, time, servings))\n                        secondString = (\"Ingredients: {}\".format(ingredients))\n                        thirdString = (\"Directions: {}\".format(directions))\n            Label(viewRecipeFrame, text=string, font=MEDIUM_FONT, bg=\"#f8f8f8\", fg=\"#000000\").pack(side=TOP)\n            Label(viewRecipeFrame, text=secondString, font=MEDIUM_FONT, bg=\"#f8f8f8\", fg=\"#000000\").pack(side=TOP)\n            Label(viewRecipeFrame, text=thirdString, font=MEDIUM_FONT, bg=\"#f8f8f8\", fg=\"#000000\").pack(side=TOP)\n            returnButton = Button(menuFrame, text = \"Return to Menu\", highlightbackground=\"#e7e7e7\", command=lambda: [viewRecipeFrame.pack_forget(),\n                                                                                     menu.pack(), returnButton.pack_forget(), label.configure(text=\"Meal Planer\"),\n                                                                                    groceryButton.pack(side=RIGHT)])\n            returnButton.pack(side=RIGHT)", "commit_link": "github.com/trishamoyer/RecipePlanner-Python/commit/44d2ce370715d9344fad34b3b749322ab095a925", "file_name": "mealPlan.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 9, "char_start": 336, "char_end": 448, "line": "                selection = cursor.execute(\"\"\"SELECT * FROM recipe WHERE name = \"\"\" + \"\\\"\" + recipeName + \"\\\"\")\n"}], "added": [{"line_no": 9, "char_start": 336, "char_end": 439, "line": "                selection = cursor.execute(\"\"\"SELECT * FROM recipe WHERE name = ?;\"\"\", (recipeName, ))\n"}]}, "char_changes": {"deleted": [{"char_start": 419, "char_end": 421, "chars": " +"}, {"char_start": 422, "char_end": 429, "chars": "\"\\\"\" + "}, {"char_start": 439, "char_end": 441, "chars": " +"}, {"char_start": 442, "char_end": 446, "chars": "\"\\\"\""}], "added": [{"char_start": 416, "char_end": 418, "chars": "?;"}, {"char_start": 421, "char_end": 422, "chars": ","}, {"char_start": 423, "char_end": 424, "chars": "("}, {"char_start": 434, "char_end": 435, "chars": ","}, {"char_start": 436, "char_end": 437, "chars": ")"}]}}
{"func_name": "patch", "func_src_before": "    @jwt_required\n    def patch(self, user_id):\n        \"\"\" Replaces information of corresponding user_id with request body \"\"\"\n        query = f\"\"\"update users set user_id = %s \"\"\"\n        query += f\"\"\"where user_id = '{user_id}'\"\"\"\n        json_data = request.get_json()\n        parameters = (json_data['user_id'], )\n        database_utilities.execute_query(query, parameters)", "func_src_after": "    @jwt_required\n    def patch(self, user_id):\n        \"\"\" Replaces information of corresponding user_id with request body \"\"\"\n        query = f\"\"\"update users set user_id = %s \"\"\"\n        query += f\"\"\"where user_id = %s\"\"\"\n        json_data = request.get_json()\n        parameters = (json_data['user_id'], user_id)\n        database_utilities.execute_query(query, parameters)", "commit_link": "github.com/sgosal2/tiger-boards-backend/commit/4670109dd613df2f2fe7e8403ebd149df2b55485", "file_name": "apis/users.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 5, "char_start": 182, "char_end": 234, "line": "        query += f\"\"\"where user_id = '{user_id}'\"\"\"\n"}, {"line_no": 7, "char_start": 273, "char_end": 319, "line": "        parameters = (json_data['user_id'], )\n"}], "added": [{"line_no": 5, "char_start": 182, "char_end": 225, "line": "        query += f\"\"\"where user_id = %s\"\"\"\n"}, {"line_no": 7, "char_start": 264, "char_end": 317, "line": "        parameters = (json_data['user_id'], user_id)\n"}]}, "char_changes": {"deleted": [{"char_start": 219, "char_end": 222, "chars": "'{u"}, {"char_start": 223, "char_end": 230, "chars": "er_id}'"}], "added": [{"char_start": 219, "char_end": 220, "chars": "%"}, {"char_start": 308, "char_end": 315, "chars": "user_id"}]}}
{"func_name": "edit", "func_src_before": "@mod.route('/edit', methods=['GET', 'POST'])\ndef edit():\n    sql = \"SELECT * FROM users where email = '%s';\" % (session['logged_email'])\n    cursor.execute(sql)\n    u = cursor.fetchone()\n    if request.method == 'POST':\n        sql = \"UPDATE users SET nickname = '%s' where email = '%s'\" \\\n        % (request.form['nickname'], session['logged_email'])\n        cursor.execute(sql)\n        sql = \"SELECT * FROM users where email = '%s';\" \\\n            % (session['logged_email'])\n        cursor.execute(sql)\n        u = cursor.fetchone()\n        conn.commit()\n        flash('Edit Nickname Success!')\n    return render_template('users/edit.html', u=u)", "func_src_after": "@mod.route('/edit', methods=['GET', 'POST'])\ndef edit():\n    cursor.execute(\"SELECT * FROM users where email = %s;\", (session['logged_email'],))\n    u = cursor.fetchone()\n    if request.method == 'POST':\n        cursor.execute(\"UPDATE users SET nickname = %s where email = %s\", (request.form['nickname'], session['logged_email']))\n        cursor.execute(\"SELECT * FROM users where email = %s;\", (session['logged_email'],))\n        u = cursor.fetchone()\n        conn.commit()\n        flash('Edit Nickname Success!')\n    return render_template('users/edit.html', u=u)", "commit_link": "github.com/ulyssetsd/bjtu-sql/commit/17d7b21864b72ba5666f15236474a93268b32ec9", "file_name": "flaskr/flaskr/views/users.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 3, "char_start": 57, "char_end": 137, "line": "    sql = \"SELECT * FROM users where email = '%s';\" % (session['logged_email'])\n"}, {"line_no": 4, "char_start": 137, "char_end": 161, "line": "    cursor.execute(sql)\n"}, {"line_no": 7, "char_start": 220, "char_end": 290, "line": "        sql = \"UPDATE users SET nickname = '%s' where email = '%s'\" \\\n"}, {"line_no": 8, "char_start": 290, "char_end": 352, "line": "        % (request.form['nickname'], session['logged_email'])\n"}, {"line_no": 9, "char_start": 352, "char_end": 380, "line": "        cursor.execute(sql)\n"}, {"line_no": 10, "char_start": 380, "char_end": 438, "line": "        sql = \"SELECT * FROM users where email = '%s';\" \\\n"}, {"line_no": 11, "char_start": 438, "char_end": 478, "line": "            % (session['logged_email'])\n"}, {"line_no": 12, "char_start": 478, "char_end": 506, "line": "        cursor.execute(sql)\n"}], "added": [{"line_no": 3, "char_start": 57, "char_end": 145, "line": "    cursor.execute(\"SELECT * FROM users where email = %s;\", (session['logged_email'],))\n"}, {"line_no": 6, "char_start": 204, "char_end": 331, "line": "        cursor.execute(\"UPDATE users SET nickname = %s where email = %s\", (request.form['nickname'], session['logged_email']))\n"}, {"line_no": 7, "char_start": 331, "char_end": 423, "line": "        cursor.execute(\"SELECT * FROM users where email = %s;\", (session['logged_email'],))\n"}]}, "char_changes": {"deleted": [{"char_start": 62, "char_end": 67, "chars": "ql = "}, {"char_start": 102, "char_end": 103, "chars": "'"}, {"char_start": 105, "char_end": 106, "chars": "'"}, {"char_start": 108, "char_end": 110, "chars": " %"}, {"char_start": 136, "char_end": 159, "chars": "\n    cursor.execute(sql"}, {"char_start": 229, "char_end": 234, "chars": "ql = "}, {"char_start": 263, "char_end": 264, "chars": "'"}, {"char_start": 266, "char_end": 267, "chars": "'"}, {"char_start": 282, "char_end": 283, "chars": "'"}, {"char_start": 285, "char_end": 286, "chars": "'"}, {"char_start": 287, "char_end": 299, "chars": " \\\n        %"}, {"char_start": 375, "char_end": 394, "chars": "sql)\n        sql = "}, {"char_start": 429, "char_end": 430, "chars": "'"}, {"char_start": 432, "char_end": 433, "chars": "'"}, {"char_start": 435, "char_end": 451, "chars": " \\\n            %"}, {"char_start": 477, "char_end": 504, "chars": "\n        cursor.execute(sql"}], "added": [{"char_start": 61, "char_end": 64, "chars": "cur"}, {"char_start": 65, "char_end": 76, "chars": "or.execute("}, {"char_start": 115, "char_end": 116, "chars": ","}, {"char_start": 141, "char_end": 142, "chars": ","}, {"char_start": 212, "char_end": 215, "chars": "cur"}, {"char_start": 216, "char_end": 227, "chars": "or.execute("}, {"char_start": 276, "char_end": 277, "chars": ","}, {"char_start": 329, "char_end": 330, "chars": ")"}, {"char_start": 393, "char_end": 394, "chars": ","}, {"char_start": 419, "char_end": 420, "chars": ","}]}}
{"func_name": "shame_add", "func_src_before": "def shame_add(name):\n    shame = shame_ask(name)\n    db = db_connect()\n    cursor = db.cursor()\n    if shame is None:\n        try:\n            cursor.execute('''\n                INSERT INTO people(name,karma,shame) VALUES('{}',0,1)\n                '''.format(name))\n            db.commit()\n            logger.debug('Inserted into karmadb 1 shame for {}'.format(name))\n            db.close()\n            return 1\n        except Exception as e:\n            logger.error('Execution failed with error: {}'.format(e))\n            raise\n\n    else:\n        shame = shame + 1\n        try:\n            cursor.execute('''\n                UPDATE people SET shame = {0} WHERE name = '{1}'\n                '''.format(shame, name))\n            db.commit()\n            logger.debug('Inserted into karmadb {} shame for {}'.format(\n                shame, name))\n            db.close()\n            return shame\n        except Exception as e:\n            logger.error('Execution failed with error: {}'.format(e))\n            raise", "func_src_after": "def shame_add(name):\n    shame = shame_ask(name)\n    db = db_connect()\n    cursor = db.cursor()\n    if shame is None:\n        try:\n            cursor.execute('''\n                INSERT INTO people(name,karma,shame) VALUES(%(name)s,0,1)\n                ''', (name, ))\n            db.commit()\n            logger.debug('Inserted into karmadb 1 shame for {}'.format(name))\n            db.close()\n            return 1\n        except Exception as e:\n            logger.error('Execution failed with error: {}'.format(e))\n            raise\n\n    else:\n        shame = shame + 1\n        try:\n            cursor.execute('''\n                UPDATE people SET shame = %(karma)s WHERE name = %(name)s\n                ''' (\n                shame,\n                name,\n            ))\n            db.commit()\n            logger.debug('Inserted into karmadb {} shame for {}'.format(\n                shame, name))\n            db.close()\n            return shame\n        except Exception as e:\n            logger.error('Execution failed with error: {}'.format(e))\n            raise", "commit_link": "github.com/tylarb/KarmaBoi-PCF/commit/c1d00a27d7f6b7eb6f15a3dacd4269654a32c10a", "file_name": "KarmaBoi/dbopts.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 8, "char_start": 162, "char_end": 232, "line": "                INSERT INTO people(name,karma,shame) VALUES('{}',0,1)\n"}, {"line_no": 9, "char_start": 232, "char_end": 266, "line": "                '''.format(name))\n"}, {"line_no": 22, "char_start": 612, "char_end": 677, "line": "                UPDATE people SET shame = {0} WHERE name = '{1}'\n"}, {"line_no": 23, "char_start": 677, "char_end": 718, "line": "                '''.format(shame, name))\n"}], "added": [{"line_no": 8, "char_start": 162, "char_end": 236, "line": "                INSERT INTO people(name,karma,shame) VALUES(%(name)s,0,1)\n"}, {"line_no": 9, "char_start": 236, "char_end": 267, "line": "                ''', (name, ))\n"}, {"line_no": 22, "char_start": 613, "char_end": 687, "line": "                UPDATE people SET shame = %(karma)s WHERE name = %(name)s\n"}, {"line_no": 23, "char_start": 687, "char_end": 709, "line": "                ''' (\n"}, {"line_no": 24, "char_start": 709, "char_end": 732, "line": "                shame,\n"}, {"line_no": 25, "char_start": 732, "char_end": 754, "line": "                name,\n"}, {"line_no": 26, "char_start": 754, "char_end": 769, "line": "            ))\n"}]}, "char_changes": {"deleted": [{"char_start": 222, "char_end": 226, "chars": "'{}'"}, {"char_start": 251, "char_end": 258, "chars": ".format"}, {"char_start": 654, "char_end": 657, "chars": "{0}"}, {"char_start": 671, "char_end": 676, "chars": "'{1}'"}, {"char_start": 696, "char_end": 703, "chars": ".format"}], "added": [{"char_start": 222, "char_end": 230, "chars": "%(name)s"}, {"char_start": 255, "char_end": 257, "chars": ", "}, {"char_start": 262, "char_end": 264, "chars": ", "}, {"char_start": 655, "char_end": 664, "chars": "%(karma)s"}, {"char_start": 678, "char_end": 686, "chars": "%(name)s"}, {"char_start": 706, "char_end": 707, "chars": " "}, {"char_start": 708, "char_end": 725, "chars": "\n                "}, {"char_start": 731, "char_end": 747, "chars": "\n               "}, {"char_start": 752, "char_end": 766, "chars": ",\n            "}]}}
{"func_name": "can_user_pass_that_amount_of_money", "func_src_before": "    def can_user_pass_that_amount_of_money(self, user_id, money):\n        self.cursor.execute(\"SELECT count(id) FROM kickstarter.users where id = %s and money >= %s\" % (user_id, money))\n        return self.cursor.fetchall()[0][0]", "func_src_after": "    def can_user_pass_that_amount_of_money(self, user_id, money):\n        self.cursor.execute(\"SELECT count(id) FROM kickstarter.users where id = %s and money >= %s\", (user_id, money))\n        return self.cursor.fetchall()[0][0]", "commit_link": "github.com/JLucka/kickstarter-dev/commit/e2ffa062697e060fdfbd2eccbb89a8c53a569e0b", "file_name": "backend/transactions/TransactionConnector.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 2, "char_start": 66, "char_end": 186, "line": "        self.cursor.execute(\"SELECT count(id) FROM kickstarter.users where id = %s and money >= %s\" % (user_id, money))\n"}], "added": [{"line_no": 2, "char_start": 66, "char_end": 185, "line": "        self.cursor.execute(\"SELECT count(id) FROM kickstarter.users where id = %s and money >= %s\", (user_id, money))\n"}]}, "char_changes": {"deleted": [{"char_start": 165, "char_end": 167, "chars": " %"}], "added": [{"char_start": 165, "char_end": 166, "chars": ","}]}}
{"func_name": "placings", "func_src_before": "@endpoints.route(\"/placings\")\ndef placings():\n    if db == None:\n        init()\n\n    tag = request.args.get('tag', default='christmas mike')\n\n    # Get all the urls that this player has participated in\n    sql = \"SELECT * FROM placings WHERE player = '{}'\".format(tag)\n    results = list(db.exec(sql))\n    results.sort(key=lambda x: int(x[2]))\n\n    return json.dumps(results)", "func_src_after": "@endpoints.route(\"/placings\")\ndef placings():\n    if db == None:\n        init()\n\n    tag = request.args.get('tag', default='christmas mike')\n\n    # Get all the urls that this player has participated in\n    sql = \"SELECT * FROM placings WHERE player = '{tag}'\"\n    args = {'tag': tag}\n    results = list(db.exec(sql, args))\n    results.sort(key=lambda x: int(x[2]))\n\n    return json.dumps(results)", "commit_link": "github.com/DKelle/Smash_stats/commit/4bb83f3f6ce7d6bebbeb512cd015f9e72cf36d63", "file_name": "endpoints.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 9, "char_start": 202, "char_end": 269, "line": "    sql = \"SELECT * FROM placings WHERE player = '{}'\".format(tag)\n"}, {"line_no": 10, "char_start": 269, "char_end": 302, "line": "    results = list(db.exec(sql))\n"}], "added": [{"line_no": 9, "char_start": 202, "char_end": 260, "line": "    sql = \"SELECT * FROM placings WHERE player = '{tag}'\"\n"}, {"line_no": 10, "char_start": 260, "char_end": 284, "line": "    args = {'tag': tag}\n"}, {"line_no": 11, "char_start": 284, "char_end": 323, "line": "    results = list(db.exec(sql, args))\n"}]}, "char_changes": {"deleted": [{"char_start": 256, "char_end": 259, "chars": ".fo"}, {"char_start": 260, "char_end": 261, "chars": "m"}, {"char_start": 262, "char_end": 264, "chars": "t("}, {"char_start": 267, "char_end": 268, "chars": ")"}], "added": [{"char_start": 253, "char_end": 256, "chars": "tag"}, {"char_start": 259, "char_end": 265, "chars": "\n    a"}, {"char_start": 266, "char_end": 273, "chars": "gs = {'"}, {"char_start": 274, "char_end": 279, "chars": "ag': "}, {"char_start": 282, "char_end": 283, "chars": "}"}, {"char_start": 314, "char_end": 320, "chars": ", args"}]}}
{"func_name": "markTokenUsedExternal", "func_src_before": "def markTokenUsedExternal(token, optStr=\"\"):\n    conn, c = connectDB()\n    req = \"UPDATE {} SET \\\"options_selected\\\"='{}' WHERE token='{}'\".format(CFG(\"tokens_table_name\"), \\\n                    optStr, token)\n    c.execute(req)\n    closeDB(conn)", "func_src_after": "def markTokenUsedExternal(token, optStr=\"\"):\n    conn, c = connectDB()\n    req = \"UPDATE {} SET \\\"options_selected\\\"=? WHERE token=?\".format(CFG(\"tokens_table_name\"))\n    c.execute(req, (optStr, token,))\n    closeDB(conn)", "commit_link": "github.com/FAUSheppy/simple-python-poll/commit/186c5ff5cdf58272e253a1bb432419ee50d93109", "file_name": "database.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 3, "char_start": 71, "char_end": 175, "line": "    req = \"UPDATE {} SET \\\"options_selected\\\"='{}' WHERE token='{}'\".format(CFG(\"tokens_table_name\"), \\\n"}, {"line_no": 4, "char_start": 175, "char_end": 210, "line": "                    optStr, token)\n"}, {"line_no": 5, "char_start": 210, "char_end": 229, "line": "    c.execute(req)\n"}], "added": [{"line_no": 3, "char_start": 71, "char_end": 167, "line": "    req = \"UPDATE {} SET \\\"options_selected\\\"=? WHERE token=?\".format(CFG(\"tokens_table_name\"))\n"}, {"line_no": 4, "char_start": 167, "char_end": 204, "line": "    c.execute(req, (optStr, token,))\n"}]}, "char_changes": {"deleted": [{"char_start": 117, "char_end": 121, "chars": "'{}'"}, {"char_start": 134, "char_end": 138, "chars": "'{}'"}, {"char_start": 171, "char_end": 174, "chars": ", \\"}, {"char_start": 175, "char_end": 177, "chars": "  "}, {"char_start": 181, "char_end": 182, "chars": " "}, {"char_start": 183, "char_end": 195, "chars": "            "}, {"char_start": 209, "char_end": 227, "chars": "\n    c.execute(req"}], "added": [{"char_start": 117, "char_end": 118, "chars": "?"}, {"char_start": 131, "char_end": 132, "chars": "?"}, {"char_start": 165, "char_end": 166, "chars": ")"}, {"char_start": 171, "char_end": 185, "chars": "c.execute(req,"}, {"char_start": 186, "char_end": 187, "chars": "("}, {"char_start": 200, "char_end": 201, "chars": ","}]}}
{"func_name": "get_roster", "func_src_before": "    def get_roster(self, server_id):\n        sql = \"\"\"SELECT username, role\n                 FROM roles\n                 WHERE roles.server_id = {0};\n                 \"\"\".format(server_id)\n        self.cur.execute(sql)\n        return self.cur.fetchall()", "func_src_after": "    def get_roster(self, server_id):\n        sql = \"\"\"\n              SELECT username, role\n              FROM roles\n              WHERE roles.server_id = %s;\n              \"\"\"\n        self.cur.execute(sql, (server_id,))\n        return self.cur.fetchall()", "commit_link": "github.com/jgayfer/spirit/commit/01c846c534c8d3cf6763f8b7444a0efe2caa3799", "file_name": "db/dbase.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 2, "char_start": 37, "char_end": 76, "line": "        sql = \"\"\"SELECT username, role\n"}, {"line_no": 3, "char_start": 76, "char_end": 104, "line": "                 FROM roles\n"}, {"line_no": 4, "char_start": 104, "char_end": 150, "line": "                 WHERE roles.server_id = {0};\n"}, {"line_no": 5, "char_start": 150, "char_end": 189, "line": "                 \"\"\".format(server_id)\n"}, {"line_no": 6, "char_start": 189, "char_end": 219, "line": "        self.cur.execute(sql)\n"}], "added": [{"line_no": 2, "char_start": 37, "char_end": 55, "line": "        sql = \"\"\"\n"}, {"line_no": 3, "char_start": 55, "char_end": 91, "line": "              SELECT username, role\n"}, {"line_no": 4, "char_start": 91, "char_end": 116, "line": "              FROM roles\n"}, {"line_no": 5, "char_start": 116, "char_end": 158, "line": "              WHERE roles.server_id = %s;\n"}, {"line_no": 6, "char_start": 158, "char_end": 176, "line": "              \"\"\"\n"}, {"line_no": 7, "char_start": 176, "char_end": 220, "line": "        self.cur.execute(sql, (server_id,))\n"}]}, "char_changes": {"deleted": [{"char_start": 76, "char_end": 77, "chars": " "}, {"char_start": 91, "char_end": 93, "chars": "  "}, {"char_start": 104, "char_end": 107, "chars": "   "}, {"char_start": 145, "char_end": 148, "chars": "{0}"}, {"char_start": 150, "char_end": 153, "chars": "   "}, {"char_start": 170, "char_end": 188, "chars": ".format(server_id)"}], "added": [{"char_start": 54, "char_end": 69, "chars": "\n              "}, {"char_start": 154, "char_end": 156, "chars": "%s"}, {"char_start": 204, "char_end": 218, "chars": ", (server_id,)"}]}}
{"func_name": "retrieve_video", "func_src_before": "def retrieve_video(id, playlist_id, db):\n    db.execute(\"SELECT id, position from video WHERE id={id} and playlist_id={playlist_id};\".format(\n        id=id, playlist_id=playlist_id))\n    row = db.fetchone()\n    return row", "func_src_after": "def retrieve_video(id, playlist_id, db):\n    db.execute(\n        \"SELECT id, position from video WHERE id=%s and playlist_id=%s;\", (id, playlist_id))\n    row = db.fetchone()\n    return row", "commit_link": "github.com/Madmous/playlist/commit/666e52c5f0b8c1f4296e84471637033d9542a7a6", "file_name": "video/video_repository.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 2, "char_start": 41, "char_end": 142, "line": "    db.execute(\"SELECT id, position from video WHERE id={id} and playlist_id={playlist_id};\".format(\n"}, {"line_no": 3, "char_start": 142, "char_end": 183, "line": "        id=id, playlist_id=playlist_id))\n"}], "added": [{"line_no": 2, "char_start": 41, "char_end": 57, "line": "    db.execute(\n"}, {"line_no": 3, "char_start": 57, "char_end": 150, "line": "        \"SELECT id, position from video WHERE id=%s and playlist_id=%s;\", (id, playlist_id))\n"}]}, "char_changes": {"deleted": [{"char_start": 97, "char_end": 101, "chars": "{id}"}, {"char_start": 118, "char_end": 125, "chars": "{playli"}, {"char_start": 126, "char_end": 131, "chars": "t_id}"}, {"char_start": 133, "char_end": 140, "chars": ".format"}, {"char_start": 141, "char_end": 153, "chars": "\n        id="}, {"char_start": 157, "char_end": 169, "chars": "playlist_id="}], "added": [{"char_start": 56, "char_end": 65, "chars": "\n        "}, {"char_start": 106, "char_end": 108, "chars": "%s"}, {"char_start": 125, "char_end": 126, "chars": "%"}, {"char_start": 129, "char_end": 130, "chars": ","}, {"char_start": 131, "char_end": 132, "chars": "("}]}}
{"func_name": "followFriends", "func_src_before": "    def followFriends(self,userid,friendid):\n        sqlText=\"insert into friends values(%d,%d);\"%(friendid,userid)\n        result=sql.insertDB(self.conn,sqlText)\n        return result;", "func_src_after": "    def followFriends(self,userid,friendid):\n        sqlText=\"insert into friends values(%s,%s);\"\n        params=[friendid,userid]\n        result=sql.insertDB(self.conn,sqlText,params)\n        return result;", "commit_link": "github.com/ShaominLi/Twitter_project/commit/5329d91f9e569c95184053c8e7ef596949c33ce9", "file_name": "modules/users.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 2, "char_start": 45, "char_end": 116, "line": "        sqlText=\"insert into friends values(%d,%d);\"%(friendid,userid)\n"}, {"line_no": 3, "char_start": 116, "char_end": 163, "line": "        result=sql.insertDB(self.conn,sqlText)\n"}], "added": [{"line_no": 2, "char_start": 45, "char_end": 98, "line": "        sqlText=\"insert into friends values(%s,%s);\"\n"}, {"line_no": 3, "char_start": 98, "char_end": 131, "line": "        params=[friendid,userid]\n"}, {"line_no": 4, "char_start": 131, "char_end": 185, "line": "        result=sql.insertDB(self.conn,sqlText,params)\n"}]}, "char_changes": {"deleted": [{"char_start": 90, "char_end": 91, "chars": "d"}, {"char_start": 93, "char_end": 94, "chars": "d"}, {"char_start": 97, "char_end": 99, "chars": "%("}, {"char_start": 114, "char_end": 115, "chars": ")"}], "added": [{"char_start": 90, "char_end": 91, "chars": "s"}, {"char_start": 93, "char_end": 94, "chars": "s"}, {"char_start": 97, "char_end": 114, "chars": "\n        params=["}, {"char_start": 129, "char_end": 130, "chars": "]"}, {"char_start": 176, "char_end": 183, "chars": ",params"}]}}
{"func_name": "getGameID", "func_src_before": "def getGameID(ID):\n\tdb.execute(\"SELECT * FROM games WHERE ID = %i\" % ID)\n\tID = db.fetchone()\n\treturn ID", "func_src_after": "def getGameID(ID):\n\tdb.execute(\"SELECT * FROM games WHERE ID = ?\", ID)\n\tID = db.fetchone()\n\treturn ID", "commit_link": "github.com/iScrE4m/XLeague/commit/59cab6e5fd8bd5e47f2418a7c71cb1d4e3cad0d2", "file_name": "plugins/database.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 2, "char_start": 19, "char_end": 73, "line": "\tdb.execute(\"SELECT * FROM games WHERE ID = %i\" % ID)\n"}], "added": [{"line_no": 2, "char_start": 19, "char_end": 71, "line": "\tdb.execute(\"SELECT * FROM games WHERE ID = ?\", ID)\n"}]}, "char_changes": {"deleted": [{"char_start": 63, "char_end": 65, "chars": "%i"}, {"char_start": 66, "char_end": 68, "chars": " %"}], "added": [{"char_start": 63, "char_end": 64, "chars": "?"}, {"char_start": 65, "char_end": 66, "chars": ","}]}}
{"func_name": "top_proxies", "func_src_before": "@app.route('/top_proxies')\ndef top_proxies():\n    con = psycopg2.connect(**config.POSTGRES)\n    cur = con.cursor()\n\n    query = \"SELECT sum(amount) FROM holders\"\n    cur.execute(query)\n    total = cur.fetchone()\n    total_votes = total[0]\n\n    query = \"SELECT voting_as FROM holders WHERE voting_as<>'1.2.5' group by voting_as\"\n    cur.execute(query)\n    results = cur.fetchall()\n    #con.close()\n\n    proxies = []\n\n    for p in range(0, len(results)):\n\n        proxy_line = [0] * 5\n\n        proxy_id = results[p][0]\n        proxy_line[0] = proxy_id\n\n        query = \"SELECT account_name, amount FROM holders WHERE account_id='\"+proxy_id+\"' LIMIT 1\"\n        cur.execute(query)\n        proxy = cur.fetchone()\n\n        try:\n            proxy_name = proxy[0]\n            proxy_amount = proxy[1]\n        except:\n            proxy_name = \"unknown\"\n            proxy_amount = 0\n\n\n        proxy_line[1] = proxy_name\n\n        query = \"SELECT amount, account_id FROM holders WHERE voting_as='\"+proxy_id+\"'\"\n        cur.execute(query)\n        results2 = cur.fetchall()\n\n        proxy_line[2] = int(proxy_amount)\n\n        for p2 in range(0, len(results2)):\n            amount = results2[p2][0]\n            account_id = results2[p2][1]\n            proxy_line[2] = proxy_line[2] + int(amount)  # total proxy votes\n            proxy_line[3] = proxy_line[3] + 1       # followers\n\n        if proxy_line[3] > 2:\n            percentage = float(float(proxy_line[2]) * 100.0/ float(total_votes))\n            proxy_line[4] = percentage\n            proxies.append(proxy_line)\n\n    con.close()\n\n    proxies = sorted(proxies, key=lambda k: int(k[2]))\n    r_proxies = proxies[::-1]\n\n    return jsonify(filter(None, r_proxies))", "func_src_after": "@app.route('/top_proxies')\ndef top_proxies():\n    con = psycopg2.connect(**config.POSTGRES)\n    cur = con.cursor()\n\n    query = \"SELECT sum(amount) FROM holders\"\n    cur.execute(query)\n    total = cur.fetchone()\n    total_votes = total[0]\n\n    query = \"SELECT voting_as FROM holders WHERE voting_as<>'1.2.5' group by voting_as\"\n    cur.execute(query)\n    results = cur.fetchall()\n    #con.close()\n\n    proxies = []\n\n    for p in range(0, len(results)):\n\n        proxy_line = [0] * 5\n\n        proxy_id = results[p][0]\n        proxy_line[0] = proxy_id\n\n        query = \"SELECT account_name, amount FROM holders WHERE account_id=%s LIMIT 1\"\n        cur.execute(query, (proxy_id,))\n        proxy = cur.fetchone()\n\n        try:\n            proxy_name = proxy[0]\n            proxy_amount = proxy[1]\n        except:\n            proxy_name = \"unknown\"\n            proxy_amount = 0\n\n\n        proxy_line[1] = proxy_name\n\n        query = \"SELECT amount, account_id FROM holders WHERE voting_as=%s\"\n        cur.execute(query, (proxy_id,))\n        results2 = cur.fetchall()\n\n        proxy_line[2] = int(proxy_amount)\n\n        for p2 in range(0, len(results2)):\n            amount = results2[p2][0]\n            account_id = results2[p2][1]\n            proxy_line[2] = proxy_line[2] + int(amount)  # total proxy votes\n            proxy_line[3] = proxy_line[3] + 1       # followers\n\n        if proxy_line[3] > 2:\n            percentage = float(float(proxy_line[2]) * 100.0/ float(total_votes))\n            proxy_line[4] = percentage\n            proxies.append(proxy_line)\n\n    con.close()\n\n    proxies = sorted(proxies, key=lambda k: int(k[2]))\n    r_proxies = proxies[::-1]\n\n    return jsonify(filter(None, r_proxies))", "commit_link": "github.com/VinChain/vinchain-python-api-backend/commit/b78088a551fbb712121269c6eb7f43ede120ff60", "file_name": "api.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 25, "char_start": 551, "char_end": 650, "line": "        query = \"SELECT account_name, amount FROM holders WHERE account_id='\"+proxy_id+\"' LIMIT 1\"\n"}, {"line_no": 26, "char_start": 650, "char_end": 677, "line": "        cur.execute(query)\n"}, {"line_no": 39, "char_start": 910, "char_end": 998, "line": "        query = \"SELECT amount, account_id FROM holders WHERE voting_as='\"+proxy_id+\"'\"\n"}, {"line_no": 40, "char_start": 998, "char_end": 1025, "line": "        cur.execute(query)\n"}], "added": [{"line_no": 25, "char_start": 551, "char_end": 638, "line": "        query = \"SELECT account_name, amount FROM holders WHERE account_id=%s LIMIT 1\"\n"}, {"line_no": 26, "char_start": 638, "char_end": 678, "line": "        cur.execute(query, (proxy_id,))\n"}, {"line_no": 39, "char_start": 911, "char_end": 987, "line": "        query = \"SELECT amount, account_id FROM holders WHERE voting_as=%s\"\n"}, {"line_no": 40, "char_start": 987, "char_end": 1027, "line": "        cur.execute(query, (proxy_id,))\n"}]}, "char_changes": {"deleted": [{"char_start": 626, "char_end": 640, "chars": "'\"+proxy_id+\"'"}, {"char_start": 982, "char_end": 996, "chars": "'\"+proxy_id+\"'"}], "added": [{"char_start": 626, "char_end": 628, "chars": "%s"}, {"char_start": 663, "char_end": 676, "chars": ", (proxy_id,)"}, {"char_start": 983, "char_end": 985, "chars": "%s"}, {"char_start": 1012, "char_end": 1025, "chars": ", (proxy_id,)"}]}}
{"func_name": "userLogin", "func_src_before": "    def userLogin(self):\n\n        sqlName=\"select count(*) from users where name='%s' and \\\n                password='%s';\"%(self.name,self.password)\n        checkName=sql.queryDB(self.conn,sqlName)\n\n        result=checkName[0][0]\n        if result == 0:\n            self.clean()\n            return False\n        else:\n            return True", "func_src_after": "    def userLogin(self):\n\n        sqlName=\"select count(*) from users where name=%s and password=%s;\"\n        params = [self.name,self.password]\n        checkName=sql.queryDB(self.conn,sqlName,params)\n        result=checkName[0][0]\n        if result == 0:\n            self.clean()\n            return False\n        else:\n            return True", "commit_link": "github.com/ShaominLi/Twitter_project/commit/5329d91f9e569c95184053c8e7ef596949c33ce9", "file_name": "modules/users.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 3, "char_start": 26, "char_end": 92, "line": "        sqlName=\"select count(*) from users where name='%s' and \\\n"}, {"line_no": 4, "char_start": 92, "char_end": 150, "line": "                password='%s';\"%(self.name,self.password)\n"}, {"line_no": 5, "char_start": 150, "char_end": 199, "line": "        checkName=sql.queryDB(self.conn,sqlName)\n"}, {"line_no": 6, "char_start": 199, "char_end": 200, "line": "\n"}], "added": [{"line_no": 3, "char_start": 26, "char_end": 102, "line": "        sqlName=\"select count(*) from users where name=%s and password=%s;\"\n"}, {"line_no": 4, "char_start": 102, "char_end": 145, "line": "        params = [self.name,self.password]\n"}, {"line_no": 5, "char_start": 145, "char_end": 201, "line": "        checkName=sql.queryDB(self.conn,sqlName,params)\n"}]}, "char_changes": {"deleted": [{"char_start": 81, "char_end": 82, "chars": "'"}, {"char_start": 84, "char_end": 85, "chars": "'"}, {"char_start": 90, "char_end": 91, "chars": "\\"}, {"char_start": 92, "char_end": 100, "chars": "        "}, {"char_start": 111, "char_end": 116, "chars": "sword"}, {"char_start": 117, "char_end": 125, "chars": "'%s';\"%("}, {"char_start": 148, "char_end": 149, "chars": ")"}, {"char_start": 198, "char_end": 199, "chars": "\n"}], "added": [{"char_start": 101, "char_end": 120, "chars": "\n        params = ["}, {"char_start": 143, "char_end": 144, "chars": "]"}, {"char_start": 192, "char_end": 199, "chars": ",params"}]}}
{"func_name": "search_pages", "func_src_before": "@app.route(\"/search\", methods = [\"POST\"])\ndef search_pages():\n    search = request.form.get(\"search\")\n    page = db.query(\"select title from page where title = '%s'\" % search).namedresult()\n    if len(page) == 0:\n        return redirect(\"/%s\" % search)\n    else:\n        return place_holder(search)", "func_src_after": "@app.route(\"/search\", methods = [\"POST\"])\ndef search_pages():\n    search = request.form.get(\"search\")\n    page = db.query(\"select title from page where title = $1\", search).namedresult()\n    if len(page) == 0:\n        return redirect(\"/%s\" % search)\n    else:\n        return place_holder(search)", "commit_link": "github.com/jcortes0309/wiki_flask/commit/a6bf5316abe2eb528adf36c8241a013fd02c5ffa", "file_name": "server.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 4, "char_start": 102, "char_end": 190, "line": "    page = db.query(\"select title from page where title = '%s'\" % search).namedresult()\n"}], "added": [{"line_no": 4, "char_start": 102, "char_end": 187, "line": "    page = db.query(\"select title from page where title = $1\", search).namedresult()\n"}]}, "char_changes": {"deleted": [{"char_start": 160, "char_end": 164, "chars": "'%s'"}, {"char_start": 165, "char_end": 167, "chars": " %"}], "added": [{"char_start": 160, "char_end": 162, "chars": "$1"}, {"char_start": 163, "char_end": 164, "chars": ","}]}}
{"func_name": "get_articles_by_subject", "func_src_before": "def get_articles_by_subject(subject):\n    with conn.cursor(cursor_factory=DictCursor) as cur:\n        query = \"SELECT * FROM articles WHERE subject='\" + subject + \"' ORDER BY last_submitted DESC\"\n        cur.execute(query)\n        articles = cur.fetchall()\n        return articles", "func_src_after": "def get_articles_by_subject(subject):\n    with conn.cursor(cursor_factory=DictCursor) as cur:\n        query = \"SELECT * FROM articles WHERE subject=%s ORDER BY last_submitted DESC\"\n        cur.execute(query, (subject,))\n        articles = cur.fetchall()\n        return articles", "commit_link": "github.com/sepehr125/arxiv-doc2vec-recommender/commit/f23a4c32e6192b145017f64734b0a9a384c9123a", "file_name": "app.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 3, "char_start": 94, "char_end": 196, "line": "        query = \"SELECT * FROM articles WHERE subject='\" + subject + \"' ORDER BY last_submitted DESC\"\n"}, {"line_no": 4, "char_start": 196, "char_end": 223, "line": "        cur.execute(query)\n"}], "added": [{"line_no": 3, "char_start": 94, "char_end": 181, "line": "        query = \"SELECT * FROM articles WHERE subject=%s ORDER BY last_submitted DESC\"\n"}, {"line_no": 4, "char_start": 181, "char_end": 220, "line": "        cur.execute(query, (subject,))\n"}]}, "char_changes": {"deleted": [{"char_start": 148, "char_end": 153, "chars": "'\" + "}, {"char_start": 154, "char_end": 165, "chars": "ubject + \"'"}], "added": [{"char_start": 148, "char_end": 149, "chars": "%"}, {"char_start": 206, "char_end": 218, "chars": ", (subject,)"}]}}
{"func_name": "getQueue", "func_src_before": "    def getQueue(self, numberOfLinks=10):\n        self.cursor.execute(\"SELECT url FROM queue WHERE visited = '0' LIMIT {};\".format(numberOfLinks))\n        result = self.cursor.fetchall()\n        self.remove(result)\n        return result", "func_src_after": "    def getQueue(self, numberOfLinks=10):\n        self.cursor.execute(\"SELECT url FROM queue WHERE visited = '0' LIMIT ?;\", numberOfLinks)\n        result = self.cursor.fetchall()\n        self.remove(result)\n        return result", "commit_link": "github.com/jappe999/WebScraper/commit/46a4e0843aa44d903293637afad53dfcbc37b480", "file_name": "beta/database.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 2, "char_start": 42, "char_end": 147, "line": "        self.cursor.execute(\"SELECT url FROM queue WHERE visited = '0' LIMIT {};\".format(numberOfLinks))\n"}], "added": [{"line_no": 2, "char_start": 42, "char_end": 139, "line": "        self.cursor.execute(\"SELECT url FROM queue WHERE visited = '0' LIMIT ?;\", numberOfLinks)\n"}]}, "char_changes": {"deleted": [{"char_start": 119, "char_end": 121, "chars": "{}"}, {"char_start": 123, "char_end": 131, "chars": ".format("}, {"char_start": 144, "char_end": 145, "chars": ")"}], "added": [{"char_start": 119, "char_end": 120, "chars": "?"}, {"char_start": 122, "char_end": 124, "chars": ", "}]}}
{"func_name": "showPoll", "func_src_before": "@hook.command(autohelp=False)\ndef showPoll(pollID, db=None):\n    \"\"\"Shows the answers for a given poll.\"\"\"\n    if not db_ready: db_init(db)\n    if pollID == None:\n        poll = db.execute(\"SELECT pollID, question FROM polls WHERE active = 1\")\n        if len(poll) == 0:\n            reply(\"There's no poll open.\")\n            return\n    else:\n        poll = db.execute(\"SELECT pollID, question FROM polls WHERE pollID = '{}'\".format(pollID))\n        if len(poll) == 0:\n            reply(\"No such poll found.\")\n            return\n    pollID = poll[0][0]\n    question = poll[0][1]\n    reply(question)\n    for (index, answer, votes) in db.execute(\"SELECT 'index', answer, count(voteID) FROM answers LEFT JOIN votes ON votes.answerID = answers.answerID WHERE pollID = {} GROUP BY answers.answerID, 'index', answer ORDER BY 'index' ASC\".format(pollID, )):\n        reply(\"%s. %s (%s)\" % (index, answer, votes))", "func_src_after": "@hook.command(autohelp=False)\ndef showPoll(pollID, db=None):\n    \"\"\"Shows the answers for a given poll.\"\"\"\n    if not db_ready: db_init(db)\n    if pollID == None:\n        poll = db.execute(\"SELECT pollID, question FROM polls WHERE active = 1\")\n        if len(poll) == 0:\n            reply(\"There's no poll open.\")\n            return\n    else:\n        poll = db.execute(\"SELECT pollID, question FROM polls WHERE pollID = ?\", (pollID,))\n        if len(poll) == 0:\n            reply(\"No such poll found.\")\n            return\n    pollID = poll[0][0]\n    question = poll[0][1]\n    reply(question)\n    for (index, answer, votes) in db.execute(\"SELECT 'index', answer, count(voteID) FROM answers LEFT JOIN votes ON votes.answerID = answers.answerID WHERE pollID = ? GROUP BY answers.answerID, 'index', answer ORDER BY 'index' ASC\", (pollID, )):\n        reply(\"%s. %s (%s)\" % (index, answer, votes))", "commit_link": "github.com/FrozenPigs/Taigabot/commit/ea9b83a66ae1f0f38a1895f3e8dfa2833d77e3a6", "file_name": "plugins/poll.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 11, "char_start": 343, "char_end": 442, "line": "        poll = db.execute(\"SELECT pollID, question FROM polls WHERE pollID = '{}'\".format(pollID))\n"}, {"line_no": 18, "char_start": 599, "char_end": 851, "line": "    for (index, answer, votes) in db.execute(\"SELECT 'index', answer, count(voteID) FROM answers LEFT JOIN votes ON votes.answerID = answers.answerID WHERE pollID = {} GROUP BY answers.answerID, 'index', answer ORDER BY 'index' ASC\".format(pollID, )):\n"}], "added": [{"line_no": 11, "char_start": 343, "char_end": 435, "line": "        poll = db.execute(\"SELECT pollID, question FROM polls WHERE pollID = ?\", (pollID,))\n"}, {"line_no": 18, "char_start": 592, "char_end": 838, "line": "    for (index, answer, votes) in db.execute(\"SELECT 'index', answer, count(voteID) FROM answers LEFT JOIN votes ON votes.answerID = answers.answerID WHERE pollID = ? GROUP BY answers.answerID, 'index', answer ORDER BY 'index' ASC\", (pollID, )):\n"}]}, "char_changes": {"deleted": [{"char_start": 420, "char_end": 424, "chars": "'{}'"}, {"char_start": 425, "char_end": 432, "chars": ".format"}, {"char_start": 764, "char_end": 766, "chars": "{}"}, {"char_start": 831, "char_end": 838, "chars": ".format"}], "added": [{"char_start": 420, "char_end": 421, "chars": "?"}, {"char_start": 422, "char_end": 424, "chars": ", "}, {"char_start": 431, "char_end": 432, "chars": ","}, {"char_start": 757, "char_end": 758, "chars": "?"}, {"char_start": 823, "char_end": 825, "chars": ", "}]}}
{"func_name": "process_ranks", "func_src_before": "    def process_ranks(self, scene, urls, recent_date):\n        PLAYER1 = 0\n        PLAYER2 = 1\n        WINNER = 2\n        DATE = 3\n        SCENE = 4\n\n        # make sure if we already have calculated ranks for these players at this time, we do not do it again\n        sql = \"SELECT * FROM ranks WHERE scene = '{}' AND date='{}';\".format(str(scene), recent_date)\n        res = self.db.exec(sql)\n        if len(res) > 0:\n            LOG.info('We have already calculated ranks for {} on date {}. SKipping'.format(scene, recent_date))\n            return\n\n        matches = bracket_utils.get_matches_from_urls(self.db, urls)\n        LOG.info('About to start processing ranks for scene {} on {}'.format(scene, recent_date))\n\n        # Iterate through each match, and build up our dict\n        win_loss_dict = {}\n        for match in matches:\n            p1 = match[PLAYER1]\n            p2 = match[PLAYER2]\n            winner = match[WINNER]\n            date = match[DATE]\n\n            #Add p1 to the dict\n            if p1 not in win_loss_dict:\n                win_loss_dict[p1] = {}\n\n            if p2 not in win_loss_dict[p1]:\n                win_loss_dict[p1][p2] = []\n\n            # Add an entry to represent this match to p1\n            win_loss_dict[p1][p2].append((date, winner == p1))\n\n            # add p2 to the dict\n            if p2 not in win_loss_dict:\n                win_loss_dict[p2] = {}\n\n            if p1 not in win_loss_dict[p2]:\n                win_loss_dict[p2][p1] = []\n\n            win_loss_dict[p2][p1].append((date, winner == p2))\n\n        ranks = get_ranks(win_loss_dict)\n\n        tag_rank_map = {}\n        for i, x in enumerate(ranks):\n            points, player = x\n            rank = len(ranks) - i\n\n            sql = \"INSERT INTO ranks (scene, player, rank, points, date) VALUES ('{}', '{}', '{}', '{}', '{}');\"\\\n                    .format(str(scene), str(player), int(rank), str(points), str(recent_date))\n            self.db.exec(sql)\n\n            # Only count this player if this is the scene he/she belongs to\n            sql = \"SELECT scene FROM players WHERE tag='{}';\".format(player)\n            res = self.db.exec(sql)\n\n            if len(res) == 0 or res[0][0] == scene:\n                # Also create a list to update the player web\n                map = {'rank':rank, 'total_ranked':len(ranks)}\n                tag_rank_map[player] = map\n\n        player_web.update_ranks(tag_rank_map)", "func_src_after": "    def process_ranks(self, scene, urls, recent_date):\n        PLAYER1 = 0\n        PLAYER2 = 1\n        WINNER = 2\n        DATE = 3\n        SCENE = 4\n\n        # make sure if we already have calculated ranks for these players at this time, we do not do it again\n        sql = \"SELECT * FROM ranks WHERE scene = '{scene}' AND date='{date}';\"\n        args = {'scene': scene, 'date': recent_date}\n        res = self.db.exec(sql, args)\n        if len(res) > 0:\n            LOG.info('We have already calculated ranks for {} on date {}. SKipping'.format(scene, recent_date))\n            return\n\n        matches = bracket_utils.get_matches_from_urls(self.db, urls)\n        LOG.info('About to start processing ranks for scene {} on {}'.format(scene, recent_date))\n\n        # Iterate through each match, and build up our dict\n        win_loss_dict = {}\n        for match in matches:\n            p1 = match[PLAYER1]\n            p2 = match[PLAYER2]\n            winner = match[WINNER]\n            date = match[DATE]\n\n            #Add p1 to the dict\n            if p1 not in win_loss_dict:\n                win_loss_dict[p1] = {}\n\n            if p2 not in win_loss_dict[p1]:\n                win_loss_dict[p1][p2] = []\n\n            # Add an entry to represent this match to p1\n            win_loss_dict[p1][p2].append((date, winner == p1))\n\n            # add p2 to the dict\n            if p2 not in win_loss_dict:\n                win_loss_dict[p2] = {}\n\n            if p1 not in win_loss_dict[p2]:\n                win_loss_dict[p2][p1] = []\n\n            win_loss_dict[p2][p1].append((date, winner == p2))\n\n        ranks = get_ranks(win_loss_dict)\n\n        tag_rank_map = {}\n        for i, x in enumerate(ranks):\n            points, player = x\n            rank = len(ranks) - i\n\n            sql = \"INSERT INTO ranks (scene, player, rank, points, date) VALUES ('{scene}', '{player}', '{rank}', '{points}', '{recent_date}');\"\n            args = {'scene': scene, 'player': player, 'rank': rank, 'points': points, 'recent_date': recent_date}\n            self.db.exec(sql, args)\n\n            # Only count this player if this is the scene he/she belongs to\n            sql = \"SELECT scene FROM players WHERE tag='{player}';\"\n            args = {'player': player}\n            res = self.db.exec(sql, args)\n\n            if len(res) == 0 or res[0][0] == scene:\n                # Also create a list to update the player web\n                map = {'rank':rank, 'total_ranked':len(ranks)}\n                tag_rank_map[player] = map\n\n        player_web.update_ranks(tag_rank_map)", "commit_link": "github.com/DKelle/Smash_stats/commit/4bb83f3f6ce7d6bebbeb512cd015f9e72cf36d63", "file_name": "process_data.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 9, "char_start": 260, "char_end": 362, "line": "        sql = \"SELECT * FROM ranks WHERE scene = '{}' AND date='{}';\".format(str(scene), recent_date)\n"}, {"line_no": 10, "char_start": 362, "char_end": 394, "line": "        res = self.db.exec(sql)\n"}, {"line_no": 52, "char_start": 1725, "char_end": 1839, "line": "            sql = \"INSERT INTO ranks (scene, player, rank, points, date) VALUES ('{}', '{}', '{}', '{}', '{}');\"\\\n"}, {"line_no": 53, "char_start": 1839, "char_end": 1934, "line": "                    .format(str(scene), str(player), int(rank), str(points), str(recent_date))\n"}, {"line_no": 54, "char_start": 1934, "char_end": 1964, "line": "            self.db.exec(sql)\n"}, {"line_no": 57, "char_start": 2041, "char_end": 2118, "line": "            sql = \"SELECT scene FROM players WHERE tag='{}';\".format(player)\n"}, {"line_no": 58, "char_start": 2118, "char_end": 2154, "line": "            res = self.db.exec(sql)\n"}], "added": [{"line_no": 9, "char_start": 260, "char_end": 339, "line": "        sql = \"SELECT * FROM ranks WHERE scene = '{scene}' AND date='{date}';\"\n"}, {"line_no": 10, "char_start": 339, "char_end": 392, "line": "        args = {'scene': scene, 'date': recent_date}\n"}, {"line_no": 11, "char_start": 392, "char_end": 430, "line": "        res = self.db.exec(sql, args)\n"}, {"line_no": 53, "char_start": 1761, "char_end": 1906, "line": "            sql = \"INSERT INTO ranks (scene, player, rank, points, date) VALUES ('{scene}', '{player}', '{rank}', '{points}', '{recent_date}');\"\n"}, {"line_no": 54, "char_start": 1906, "char_end": 2020, "line": "            args = {'scene': scene, 'player': player, 'rank': rank, 'points': points, 'recent_date': recent_date}\n"}, {"line_no": 55, "char_start": 2020, "char_end": 2056, "line": "            self.db.exec(sql, args)\n"}, {"line_no": 58, "char_start": 2133, "char_end": 2201, "line": "            sql = \"SELECT scene FROM players WHERE tag='{player}';\"\n"}, {"line_no": 59, "char_start": 2201, "char_end": 2239, "line": "            args = {'player': player}\n"}, {"line_no": 60, "char_start": 2239, "char_end": 2281, "line": "            res = self.db.exec(sql, args)\n"}]}, "char_changes": {"deleted": [{"char_start": 329, "char_end": 334, "chars": ".form"}, {"char_start": 335, "char_end": 339, "chars": "t(st"}, {"char_start": 340, "char_end": 341, "chars": "("}, {"char_start": 346, "char_end": 347, "chars": ")"}, {"char_start": 360, "char_end": 361, "chars": ")"}, {"char_start": 1837, "char_end": 1838, "chars": "\\"}, {"char_start": 1853, "char_end": 1857, "chars": "    "}, {"char_start": 1858, "char_end": 1871, "chars": " .format(str("}, {"char_start": 1876, "char_end": 1877, "chars": ")"}, {"char_start": 1879, "char_end": 1881, "chars": "st"}, {"char_start": 1882, "char_end": 1883, "chars": "("}, {"char_start": 1889, "char_end": 1890, "chars": ")"}, {"char_start": 1892, "char_end": 1893, "chars": "i"}, {"char_start": 1894, "char_end": 1896, "chars": "t("}, {"char_start": 1900, "char_end": 1901, "chars": ")"}, {"char_start": 1903, "char_end": 1904, "chars": "s"}, {"char_start": 1905, "char_end": 1907, "chars": "r("}, {"char_start": 1913, "char_end": 1914, "chars": ")"}, {"char_start": 1916, "char_end": 1917, "chars": "s"}, {"char_start": 1918, "char_end": 1920, "chars": "r("}, {"char_start": 1931, "char_end": 1933, "chars": "))"}, {"char_start": 2102, "char_end": 2105, "chars": ".fo"}, {"char_start": 2106, "char_end": 2107, "chars": "m"}, {"char_start": 2108, "char_end": 2110, "chars": "t("}, {"char_start": 2116, "char_end": 2117, "chars": ")"}], "added": [{"char_start": 311, "char_end": 316, "chars": "scene"}, {"char_start": 330, "char_end": 334, "chars": "date"}, {"char_start": 338, "char_end": 348, "chars": "\n        a"}, {"char_start": 349, "char_end": 356, "chars": "gs = {'"}, {"char_start": 357, "char_end": 364, "chars": "cene': "}, {"char_start": 371, "char_end": 379, "chars": "'date': "}, {"char_start": 390, "char_end": 391, "chars": "}"}, {"char_start": 422, "char_end": 428, "chars": ", args"}, {"char_start": 1844, "char_end": 1849, "chars": "scene"}, {"char_start": 1855, "char_end": 1861, "chars": "player"}, {"char_start": 1867, "char_end": 1871, "chars": "rank"}, {"char_start": 1877, "char_end": 1883, "chars": "points"}, {"char_start": 1889, "char_end": 1900, "chars": "recent_date"}, {"char_start": 1918, "char_end": 1922, "chars": "args"}, {"char_start": 1923, "char_end": 1924, "chars": "="}, {"char_start": 1925, "char_end": 1927, "chars": "{'"}, {"char_start": 1928, "char_end": 1935, "chars": "cene': "}, {"char_start": 1942, "char_end": 1948, "chars": "'playe"}, {"char_start": 1949, "char_end": 1952, "chars": "': "}, {"char_start": 1960, "char_end": 1963, "chars": "'ra"}, {"char_start": 1964, "char_end": 1968, "chars": "k': "}, {"char_start": 1974, "char_end": 1980, "chars": "'point"}, {"char_start": 1981, "char_end": 1984, "chars": "': "}, {"char_start": 1992, "char_end": 1993, "chars": "'"}, {"char_start": 1994, "char_end": 2007, "chars": "ecent_date': "}, {"char_start": 2018, "char_end": 2019, "chars": "}"}, {"char_start": 2048, "char_end": 2054, "chars": ", args"}, {"char_start": 2190, "char_end": 2196, "chars": "player"}, {"char_start": 2200, "char_end": 2214, "chars": "\n            a"}, {"char_start": 2215, "char_end": 2224, "chars": "gs = {'pl"}, {"char_start": 2225, "char_end": 2231, "chars": "yer': "}, {"char_start": 2237, "char_end": 2238, "chars": "}"}, {"char_start": 2273, "char_end": 2279, "chars": ", args"}]}}
{"func_name": "analyze_smashgg", "func_src_before": "    def analyze_smashgg(self, urls, name):\n        LOG.info('we are about to analyze scene {} with {} brackets'.format(name, len(urls)))\n        for url in urls:\n            # Before we process this URL, check to see if we already have\n            sql = \"SELECT * FROM analyzed where base_url='{}'\".format(url)\n            res = self.db.exec(sql)\n            if len(res) == 0:\n\n                display_name = bracket_utils.get_display_base(url)\n\n                # We don't care about doubles tournaments\n                if 'doubles' in display_name.lower() or 'dubs' in display_name.lower():\n                    LOG.info('We are skipping the tournament {} because it is a doubles tournament'.format(display_name))\n                    continue\n\n                LOG.info('About to process pro bracket {}'.format(url))\n                self.data_processor.process(url, name, display_name)\n            else:\n                LOG.info(\"Skpping pro bracket because it has already been analyzed: {}\".format(url))", "func_src_after": "    def analyze_smashgg(self, urls, name):\n        LOG.info('we are about to analyze scene {} with {} brackets'.format(name, len(urls)))\n        for url in urls:\n            # Before we process this URL, check to see if we already have\n            sql = \"SELECT * FROM analyzed where base_url='{url}'\"\n            args = {'url':url}\n            res = self.db.exec(sql, args)\n            if len(res) == 0:\n\n                display_name = bracket_utils.get_display_base(url)\n\n                # We don't care about doubles tournaments\n                if 'doubles' in display_name.lower() or 'dubs' in display_name.lower():\n                    LOG.info('We are skipping the tournament {} because it is a doubles tournament'.format(display_name))\n                    continue\n\n                LOG.info('About to process pro bracket {}'.format(url))\n                self.data_processor.process(url, name, display_name)\n            else:\n                LOG.info(\"Skpping pro bracket because it has already been analyzed: {}\".format(url))", "commit_link": "github.com/DKelle/Smash_stats/commit/4bb83f3f6ce7d6bebbeb512cd015f9e72cf36d63", "file_name": "validURLs.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 5, "char_start": 236, "char_end": 311, "line": "            sql = \"SELECT * FROM analyzed where base_url='{}'\".format(url)\n"}, {"line_no": 6, "char_start": 311, "char_end": 347, "line": "            res = self.db.exec(sql)\n"}], "added": [{"line_no": 5, "char_start": 236, "char_end": 302, "line": "            sql = \"SELECT * FROM analyzed where base_url='{url}'\"\n"}, {"line_no": 6, "char_start": 302, "char_end": 333, "line": "            args = {'url':url}\n"}, {"line_no": 7, "char_start": 333, "char_end": 375, "line": "            res = self.db.exec(sql, args)\n"}]}, "char_changes": {"deleted": [{"char_start": 298, "char_end": 303, "chars": ".form"}, {"char_start": 304, "char_end": 306, "chars": "t("}, {"char_start": 309, "char_end": 310, "chars": ")"}], "added": [{"char_start": 295, "char_end": 298, "chars": "url"}, {"char_start": 301, "char_end": 324, "chars": "\n            args = {'u"}, {"char_start": 325, "char_end": 328, "chars": "l':"}, {"char_start": 331, "char_end": 332, "chars": "}"}, {"char_start": 367, "char_end": 373, "chars": ", args"}]}}
{"func_name": "test", "func_src_before": "@mod.route('/test', methods=['GET', 'POST'])\ndef test():\n    user_id = session['logged_id']\n    sql = 'SELECT * FROM message where user_id = %d ORDER BY c_time DESC' \\\n        % (user_id)\n    cursor.execute(sql)\n    m = cursor.fetchall()\n    print(m)", "func_src_after": "@mod.route('/test', methods=['GET', 'POST'])\ndef test():\n    user_id = session['logged_id']\n    cursor.execute('SELECT * FROM message where user_id = %s ORDER BY c_time DESC', (user_id,))\n    m = cursor.fetchall()\n    print(m)", "commit_link": "github.com/ulyssetsd/bjtu-sql/commit/17d7b21864b72ba5666f15236474a93268b32ec9", "file_name": "flaskr/flaskr/views/message.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 4, "char_start": 92, "char_end": 168, "line": "    sql = 'SELECT * FROM message where user_id = %d ORDER BY c_time DESC' \\\n"}, {"line_no": 5, "char_start": 168, "char_end": 188, "line": "        % (user_id)\n"}, {"line_no": 6, "char_start": 188, "char_end": 212, "line": "    cursor.execute(sql)\n"}], "added": [{"line_no": 4, "char_start": 92, "char_end": 188, "line": "    cursor.execute('SELECT * FROM message where user_id = %s ORDER BY c_time DESC', (user_id,))\n"}]}, "char_changes": {"deleted": [{"char_start": 97, "char_end": 102, "chars": "ql = "}, {"char_start": 142, "char_end": 143, "chars": "d"}, {"char_start": 165, "char_end": 177, "chars": " \\\n        %"}, {"char_start": 187, "char_end": 210, "chars": "\n    cursor.execute(sql"}], "added": [{"char_start": 96, "char_end": 99, "chars": "cur"}, {"char_start": 100, "char_end": 111, "chars": "or.execute("}, {"char_start": 151, "char_end": 152, "chars": "s"}, {"char_start": 174, "char_end": 175, "chars": ","}, {"char_start": 184, "char_end": 185, "chars": ","}]}}
{"func_name": "get_last_active_users", "func_src_before": "    @staticmethod\n    def get_last_active_users(limit):\n        \"\"\"\n        Get from the database a tuple of users who have been recently using\n        the bot\n        :param limit: integer that specifies how much users to get\n        :return: tuple of tuples with users info\n        \"\"\"\n        log.info('Evaluating last active users with date of '\n                 'last time when they used bot...')\n\n        # From photo_queries_table2 we take chat_id of the last\n        # active users and from 'users' table we take info about these\n        # users by chat_id which is a foreign key\n        query = ('SELECT p.chat_id, u.first_name, u.nickname, u.last_name, '\n                 'u.language '\n                 'FROM photo_queries_table2 p '\n                 'INNER JOIN users u '\n                 'ON p.chat_id = u.chat_id '\n                 'GROUP BY u.chat_id, u.first_name, u.nickname, u.last_name, '\n                 'u.language '\n                 'ORDER BY MAX(time)'\n                 f'DESC LIMIT {limit}')\n\n        try:\n            cursor = db.execute_query(query)\n        except DatabaseConnectionError:\n            log.error(\"Cannot get the last active users because of some \"\n                      \"problems with the database\")\n            raise\n\n        last_active_users = cursor.fetchall()\n        return last_active_users", "func_src_after": "    @staticmethod\n    def get_last_active_users(limit):\n        \"\"\"\n        Get from the database a tuple of users who have been recently using\n        the bot\n        :param limit: integer that specifies how much users to get\n        :return: tuple of tuples with users info\n        \"\"\"\n        log.info('Evaluating last active users with date of '\n                 'last time when they used bot...')\n\n        # From photo_queries_table2 we take chat_id of the last\n        # active users and from 'users' table we take info about these\n        # users by chat_id which is a foreign key\n        query = ('SELECT p.chat_id, u.first_name, u.nickname, u.last_name, '\n                 'u.language '\n                 'FROM photo_queries_table2 p '\n                 'INNER JOIN users u '\n                 'ON p.chat_id = u.chat_id '\n                 'GROUP BY u.chat_id, u.first_name, u.nickname, u.last_name, '\n                 'u.language '\n                 'ORDER BY MAX(time)'\n                 f'DESC LIMIT %s')\n\n        parameters = limit,\n\n        try:\n            cursor = db.execute_query(query, parameters)\n        except DatabaseConnectionError:\n            log.error(\"Cannot get the last active users because of some \"\n                      \"problems with the database\")\n            raise\n\n        last_active_users = cursor.fetchall()\n        return last_active_users", "commit_link": "github.com/RandyRomero/photoGPSbot/commit/0e9f57f13e61863b3672f5730e27f149da00786a", "file_name": "photogpsbot/users.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 23, "char_start": 976, "char_end": 1016, "line": "                 f'DESC LIMIT {limit}')\n"}, {"line_no": 26, "char_start": 1030, "char_end": 1075, "line": "            cursor = db.execute_query(query)\n"}], "added": [{"line_no": 23, "char_start": 976, "char_end": 1011, "line": "                 f'DESC LIMIT %s')\n"}, {"line_no": 24, "char_start": 1011, "char_end": 1012, "line": "\n"}, {"line_no": 25, "char_start": 1012, "char_end": 1040, "line": "        parameters = limit,\n"}, {"line_no": 28, "char_start": 1054, "char_end": 1111, "line": "            cursor = db.execute_query(query, parameters)\n"}]}, "char_changes": {"deleted": [{"char_start": 1006, "char_end": 1007, "chars": "{"}, {"char_start": 1012, "char_end": 1015, "chars": "}')"}], "added": [{"char_start": 1006, "char_end": 1033, "chars": "%s')\n\n        parameters = "}, {"char_start": 1038, "char_end": 1039, "chars": ","}, {"char_start": 1097, "char_end": 1109, "chars": ", parameters"}]}}
{"func_name": "on_save", "func_src_before": "    def on_save(self):\n        connection = get_connection()\n        cursor = connection.cursor()\n        cursor.execute(\n            f\"insert into visitors (ip_address, user_agent, referrer, full_path, visit_time) values ('{self.ip_address}', '{self.user_agent}', '{self.referrer}', '{self.full_path}', '{self.visit_time}');\")\n        connection.commit()\n        connection.close()\n        return 0", "func_src_after": "    def on_save(self):\n        connection = get_connection()\n        cursor = connection.cursor()\n        cursor.execute(\n            \"insert into visitors (ip_address, user_agent, referrer, full_path, visit_time) values (%s, %s, %s, %s, %s);\",\n            (str(self.ip_address), str(self.user_agent), str(self.referrer), str(self.full_path), self.visit_time))\n        connection.commit()\n        connection.close()\n        return 0", "commit_link": "github.com/onewyoming/onewyoming/commit/54fc7b076fda2de74eeb55e6b75b28e09ef231c2", "file_name": "experimental/python/buford/model/visitor.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 5, "char_start": 122, "char_end": 328, "line": "            f\"insert into visitors (ip_address, user_agent, referrer, full_path, visit_time) values ('{self.ip_address}', '{self.user_agent}', '{self.referrer}', '{self.full_path}', '{self.visit_time}');\")\n"}], "added": [{"line_no": 5, "char_start": 122, "char_end": 245, "line": "            \"insert into visitors (ip_address, user_agent, referrer, full_path, visit_time) values (%s, %s, %s, %s, %s);\",\n"}, {"line_no": 6, "char_start": 245, "char_end": 361, "line": "            (str(self.ip_address), str(self.user_agent), str(self.referrer), str(self.full_path), self.visit_time))\n"}]}, "char_changes": {"deleted": [{"char_start": 134, "char_end": 135, "chars": "f"}, {"char_start": 223, "char_end": 225, "chars": "'{"}, {"char_start": 240, "char_end": 242, "chars": "}'"}, {"char_start": 244, "char_end": 246, "chars": "'{"}, {"char_start": 261, "char_end": 263, "chars": "}'"}, {"char_start": 265, "char_end": 267, "chars": "'{"}, {"char_start": 280, "char_end": 282, "chars": "}'"}, {"char_start": 284, "char_end": 286, "chars": "'{"}, {"char_start": 300, "char_end": 302, "chars": "}'"}, {"char_start": 304, "char_end": 306, "chars": "'{"}, {"char_start": 321, "char_end": 323, "chars": "}'"}, {"char_start": 324, "char_end": 326, "chars": ";\""}], "added": [{"char_start": 222, "char_end": 262, "chars": "%s, %s, %s, %s, %s);\",\n            (str("}, {"char_start": 277, "char_end": 278, "chars": ")"}, {"char_start": 280, "char_end": 284, "chars": "str("}, {"char_start": 299, "char_end": 300, "chars": ")"}, {"char_start": 302, "char_end": 306, "chars": "str("}, {"char_start": 319, "char_end": 320, "chars": ")"}, {"char_start": 322, "char_end": 326, "chars": "str("}, {"char_start": 340, "char_end": 341, "chars": ")"}]}}
{"func_name": "update_institutions", "func_src_before": "def update_institutions(conn, sqlite, k10plus, ai):\n    \"\"\"\n    Update the institution table.\n    \"\"\"\n    current_institutions = get_all_current_institutions(k10plus, ai)\n    old_institutions = get_all_old_institutions(conn, sqlite)\n\n    # Check if the institution table is allready filled and this is not the first checkup\n    institution_table_is_filled = len(old_institutions) > 10\n\n    for old_institution in old_institutions:\n        if institution_table_is_filled and old_institution not in current_institutions:\n            message = \"Die ISIL %s ist im aktuellen Import nicht mehr vorhanden.\\nWenn dies beabsichtigt ist, bitte die Institution aus der Datenbank loeschen.\" % old_institution\n            send_message(message)\n\n    for current_institution in current_institutions:\n        if current_institution == \" \" or '\"' in current_institution:\n                continue\n        if current_institution not in old_institutions:\n            message = \"The institution %s is new in Solr.\" % current_institution\n            if institution_table_is_filled:\n                send_message(message)\n            else:\n                logging.info(message)\n            sql = \"INSERT INTO institution (institution) VALUES ('%s')\" % current_institution\n            sqlite.execute(sql)\n            conn.commit()", "func_src_after": "def update_institutions(conn, sqlite, k10plus, ai):\n    \"\"\"\n    Update the institution table.\n    \"\"\"\n    current_institutions = get_all_current_institutions(k10plus, ai)\n    old_institutions = get_all_old_institutions(conn, sqlite)\n\n    # Check if the institution table is allready filled and this is not the first checkup\n    institution_table_is_filled = len(old_institutions) > 10\n\n    for old_institution in old_institutions:\n        if institution_table_is_filled and old_institution not in current_institutions:\n            message = \"Die ISIL %s ist im aktuellen Import nicht mehr vorhanden.\\nWenn dies beabsichtigt ist, bitte die Institution aus der Datenbank loeschen.\" % old_institution\n            send_message(message)\n\n    for current_institution in current_institutions:\n        if current_institution == \" \" or '\"' in current_institution:\n                continue\n        if current_institution not in old_institutions:\n            message = \"The institution %s is new in Solr.\" % current_institution\n            if institution_table_is_filled:\n                send_message(message)\n            else:\n                logging.info(message)\n            sql = \"INSERT INTO institution (institution) VALUES (?)\"\n            sqlite.execute(sql, (current_institution,))\n            conn.commit()", "commit_link": "github.com/miku/siskin/commit/7fa398d2fea72bf2e8b4808f75df4b3d35ae959a", "file_name": "bin/solrcheckup.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 25, "char_start": 1155, "char_end": 1249, "line": "            sql = \"INSERT INTO institution (institution) VALUES ('%s')\" % current_institution\n"}, {"line_no": 26, "char_start": 1249, "char_end": 1281, "line": "            sqlite.execute(sql)\n"}], "added": [{"line_no": 25, "char_start": 1155, "char_end": 1224, "line": "            sql = \"INSERT INTO institution (institution) VALUES (?)\"\n"}, {"line_no": 26, "char_start": 1224, "char_end": 1280, "line": "            sqlite.execute(sql, (current_institution,))\n"}]}, "char_changes": {"deleted": [{"char_start": 1220, "char_end": 1224, "chars": "'%s'"}, {"char_start": 1226, "char_end": 1248, "chars": " % current_institution"}], "added": [{"char_start": 1220, "char_end": 1221, "chars": "?"}, {"char_start": 1254, "char_end": 1278, "chars": ", (current_institution,)"}]}}
{"func_name": "_add_to_db", "func_src_before": "    @staticmethod\n    def _add_to_db(user):\n        \"\"\"\n        Adds User object to the database\n        :param user: User object with info about user\n        :return: None\n        \"\"\"\n        query = (\"INSERT INTO users (chat_id, first_name, nickname, \"\n                 \"last_name, language) \"\n                 f\"VALUES ({user.chat_id}, '{user.first_name}', \"\n                 f\"'{user.nickname}', '{user.last_name}', '{user.language}')\")\n        try:\n            db.add(query)\n        except DatabaseError:\n            log.error(\"Cannot add user to the database\")\n        else:\n            log.info(f\"User {user} was successfully added to the users db\")", "func_src_after": "    @staticmethod\n    def _add_to_db(user):\n        \"\"\"\n        Adds User object to the database\n        :param user: User object with info about user\n        :return: None\n        \"\"\"\n        query = (\"INSERT INTO users (chat_id, first_name, nickname, \"\n                 \"last_name, language) \"\n                 f\"VALUES (%s, %s, %s, %s, %s)\")\n\n        parameters = (user.chat_id, user.first_name, user.nickname,\n                      user.last_name, user.language)\n\n        try:\n            db.add(query, parameters)\n        except DatabaseError:\n            log.error(\"Cannot add user to the database\")\n        else:\n            log.info(f\"User {user} was successfully added to the users db\")", "commit_link": "github.com/RandyRomero/photoGPSbot/commit/0e9f57f13e61863b3672f5730e27f149da00786a", "file_name": "photogpsbot/users.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 10, "char_start": 296, "char_end": 362, "line": "                 f\"VALUES ({user.chat_id}, '{user.first_name}', \"\n"}, {"line_no": 11, "char_start": 362, "char_end": 441, "line": "                 f\"'{user.nickname}', '{user.last_name}', '{user.language}')\")\n"}, {"line_no": 13, "char_start": 454, "char_end": 480, "line": "            db.add(query)\n"}], "added": [{"line_no": 10, "char_start": 296, "char_end": 345, "line": "                 f\"VALUES (%s, %s, %s, %s, %s)\")\n"}, {"line_no": 11, "char_start": 345, "char_end": 346, "line": "\n"}, {"line_no": 12, "char_start": 346, "char_end": 414, "line": "        parameters = (user.chat_id, user.first_name, user.nickname,\n"}, {"line_no": 13, "char_start": 414, "char_end": 467, "line": "                      user.last_name, user.language)\n"}, {"line_no": 14, "char_start": 467, "char_end": 468, "line": "\n"}, {"line_no": 16, "char_start": 481, "char_end": 519, "line": "            db.add(query, parameters)\n"}]}, "char_changes": {"deleted": [{"char_start": 323, "char_end": 324, "chars": "{"}, {"char_start": 336, "char_end": 337, "chars": "}"}, {"char_start": 339, "char_end": 341, "chars": "'{"}, {"char_start": 356, "char_end": 358, "chars": "}'"}, {"char_start": 360, "char_end": 361, "chars": "\""}, {"char_start": 379, "char_end": 399, "chars": "f\"'{user.nickname}',"}, {"char_start": 400, "char_end": 402, "chars": "'{"}, {"char_start": 416, "char_end": 418, "chars": "}'"}, {"char_start": 420, "char_end": 422, "chars": "'{"}, {"char_start": 435, "char_end": 437, "chars": "}'"}, {"char_start": 438, "char_end": 440, "chars": "\")"}], "added": [{"char_start": 323, "char_end": 368, "chars": "%s, %s, %s, %s, %s)\")\n\n        parameters = ("}, {"char_start": 399, "char_end": 413, "chars": "user.nickname,"}, {"char_start": 431, "char_end": 435, "chars": "    "}, {"char_start": 466, "char_end": 467, "chars": "\n"}, {"char_start": 505, "char_end": 517, "chars": ", parameters"}]}}
{"func_name": "deletePost", "func_src_before": "    def deletePost(self,postid):\n        sqlText=\"delete from post where post.postid=%d\"%(postid)\n        result=sql.deleteDB(self.conn,sqlText)\n        return result;", "func_src_after": "    def deletePost(self,postid):\n        sqlText=\"delete from post where post.postid=%s\"\n        params=[postid]\n        result=sql.deleteDB(self.conn,sqlText,params)\n        return result;", "commit_link": "github.com/ShaominLi/Twitter_project/commit/5329d91f9e569c95184053c8e7ef596949c33ce9", "file_name": "modules/post.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 2, "char_start": 33, "char_end": 98, "line": "        sqlText=\"delete from post where post.postid=%d\"%(postid)\n"}, {"line_no": 3, "char_start": 98, "char_end": 145, "line": "        result=sql.deleteDB(self.conn,sqlText)\n"}], "added": [{"line_no": 2, "char_start": 33, "char_end": 89, "line": "        sqlText=\"delete from post where post.postid=%s\"\n"}, {"line_no": 3, "char_start": 89, "char_end": 113, "line": "        params=[postid]\n"}, {"line_no": 4, "char_start": 113, "char_end": 167, "line": "        result=sql.deleteDB(self.conn,sqlText,params)\n"}]}, "char_changes": {"deleted": [{"char_start": 86, "char_end": 87, "chars": "d"}, {"char_start": 88, "char_end": 90, "chars": "%("}, {"char_start": 96, "char_end": 97, "chars": ")"}], "added": [{"char_start": 86, "char_end": 87, "chars": "s"}, {"char_start": 88, "char_end": 105, "chars": "\n        params=["}, {"char_start": 111, "char_end": 112, "chars": "]"}, {"char_start": 158, "char_end": 165, "chars": ",params"}]}}
{"func_name": "sloka", "func_src_before": "@app.route('/sloka')\ndef sloka():\n\n    sloka_number = request.args.get('sloka_number')\n\n    sloka_number_parts = sloka_number.split('.')\n\n    sloka_number_previous = \"%s.%s.%d\" % (sloka_number_parts[0], sloka_number_parts[1], int(sloka_number_parts[2])-1)\n    sloka_number_next = \"%s.%s.%d\" % (sloka_number_parts[0], sloka_number_parts[1], int(sloka_number_parts[2])+1)\n\n    try:\n        with sql.connect('amara.db') as con:\n            con.row_factory = sql.Row\n            cur = con.cursor()\n            cur.execute(\"select * from mula where sloka_number = '%s' order by sloka_line;\" % sloka_number)\n            mula = cur.fetchall();\n\n            cur.execute(\"select * from pada where sloka_number = '%s' order by id;\" % sloka_number)\n            pada = cur.fetchall();\n\n            varga = \"\"\n            if len(pada) > 0:\n                varga = pada[0][\"varga\"]\n\n            return render_template('sloka.html', mula=mula, pada=pada, varga=varga, sloka_number=sloka_number, sloka_number_previous=sloka_number_previous, sloka_number_next=sloka_number_next)\n    finally:\n        con.close()", "func_src_after": "@app.route('/sloka')\ndef sloka():\n\n    sloka_number = request.args.get('sloka_number')\n\n    sloka_number_parts = sloka_number.split('.')\n\n    sloka_number_previous = \"%s.%s.%d\" % (sloka_number_parts[0], sloka_number_parts[1], int(sloka_number_parts[2])-1)\n    sloka_number_next = \"%s.%s.%d\" % (sloka_number_parts[0], sloka_number_parts[1], int(sloka_number_parts[2])+1)\n\n    try:\n        with sql.connect('amara.db') as con:\n            con.row_factory = sql.Row\n            cur = con.cursor()\n            cur.execute(\"select * from mula where sloka_number = ? order by sloka_line;\", [sloka_number])\n            mula = cur.fetchall();\n\n            cur.execute(\"select * from pada where sloka_number = ? order by id;\", [sloka_number])\n            pada = cur.fetchall();\n\n            varga = \"\"\n            if len(pada) > 0:\n                varga = pada[0][\"varga\"]\n\n            return render_template('sloka.html', mula=mula, pada=pada, varga=varga, sloka_number=sloka_number, sloka_number_previous=sloka_number_previous, sloka_number_next=sloka_number_next)\n    finally:\n        con.close()", "commit_link": "github.com/aupasana/amara-quiz/commit/6ceb5dc8ec38b4a3f1399e578ab970f7e3354922", "file_name": "docker/app.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 15, "char_start": 494, "char_end": 602, "line": "            cur.execute(\"select * from mula where sloka_number = '%s' order by sloka_line;\" % sloka_number)\n"}, {"line_no": 18, "char_start": 638, "char_end": 738, "line": "            cur.execute(\"select * from pada where sloka_number = '%s' order by id;\" % sloka_number)\n"}], "added": [{"line_no": 15, "char_start": 494, "char_end": 600, "line": "            cur.execute(\"select * from mula where sloka_number = ? order by sloka_line;\", [sloka_number])\n"}, {"line_no": 18, "char_start": 636, "char_end": 734, "line": "            cur.execute(\"select * from pada where sloka_number = ? order by id;\", [sloka_number])\n"}]}, "char_changes": {"deleted": [{"char_start": 559, "char_end": 563, "chars": "'%s'"}, {"char_start": 585, "char_end": 587, "chars": " %"}, {"char_start": 703, "char_end": 707, "chars": "'%s'"}, {"char_start": 721, "char_end": 723, "chars": " %"}], "added": [{"char_start": 559, "char_end": 560, "chars": "?"}, {"char_start": 582, "char_end": 583, "chars": ","}, {"char_start": 584, "char_end": 585, "chars": "["}, {"char_start": 597, "char_end": 598, "chars": "]"}, {"char_start": 701, "char_end": 702, "chars": "?"}, {"char_start": 716, "char_end": 717, "chars": ","}, {"char_start": 718, "char_end": 719, "chars": "["}, {"char_start": 731, "char_end": 732, "chars": "]"}]}}
{"func_name": "update_title", "func_src_before": "  def update_title(self, title = None):\n    if (not self.title):\n      self.title = title\n\n    # This will fall to a sql injection \n    sql = \"UPDATE jdk_entries SET title = '\" + self.title + \"'\" + \\\n          \"WHERE jdk_entries.id = '\" + self.entry_id + \"';\" \n\n    db_execute(sql)\n    \n    self.update_date_modified()\n\n    return None", "func_src_after": "  def update_title(self, title = None):\n    if (not self.title):\n      self.title = title\n\n    quote_tuple = self.title, self.entry_id\n\n    # This will fall to a sql injection \n    sql = \"UPDATE jdk_entries SET title = ?\" + \\\n          \"WHERE jdk_entries.id = ?;\" \n\n    db_execute(sql, quote_tuple)\n    \n    self.update_date_modified()\n\n    return None", "commit_link": "github.com/peterlebrun/jdk/commit/000238566fbe55ba09676c3d57af04ae207235ae", "file_name": "entry.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 6, "char_start": 132, "char_end": 200, "line": "    sql = \"UPDATE jdk_entries SET title = '\" + self.title + \"'\" + \\\n"}, {"line_no": 7, "char_start": 200, "char_end": 261, "line": "          \"WHERE jdk_entries.id = '\" + self.entry_id + \"';\" \n"}, {"line_no": 9, "char_start": 262, "char_end": 282, "line": "    db_execute(sql)\n"}], "added": [{"line_no": 5, "char_start": 91, "char_end": 135, "line": "    quote_tuple = self.title, self.entry_id\n"}, {"line_no": 6, "char_start": 135, "char_end": 136, "line": "\n"}, {"line_no": 8, "char_start": 177, "char_end": 226, "line": "    sql = \"UPDATE jdk_entries SET title = ?\" + \\\n"}, {"line_no": 9, "char_start": 226, "char_end": 265, "line": "          \"WHERE jdk_entries.id = ?;\" \n"}, {"line_no": 11, "char_start": 266, "char_end": 299, "line": "    db_execute(sql, quote_tuple)\n"}]}, "char_changes": {"deleted": [{"char_start": 174, "char_end": 194, "chars": "'\" + self.title + \"'"}, {"char_start": 234, "char_end": 257, "chars": "'\" + self.entry_id + \"'"}], "added": [{"char_start": 95, "char_end": 140, "chars": "quote_tuple = self.title, self.entry_id\n\n    "}, {"char_start": 219, "char_end": 220, "chars": "?"}, {"char_start": 260, "char_end": 261, "chars": "?"}, {"char_start": 284, "char_end": 297, "chars": ", quote_tuple"}]}}
{"func_name": "add_language", "func_src_before": "    def add_language(self, language):\n        \"\"\"\"Add new language for item translations.\"\"\"\n        if self.connection:\n            self.cursor.execute('insert into itemlanguage (language) values (\"%s\")' % language[0])\n            self.connection.commit()", "func_src_after": "    def add_language(self, language):\n        \"\"\"\"Add new language for item translations.\"\"\"\n        if self.connection:\n            t = (language[0], )\n            self.cursor.execute('insert into itemlanguage (language) values (?)', t)\n            self.connection.commit()", "commit_link": "github.com/ecosl-developers/ecosl/commit/8af050a513338bf68ff2a243e4a2482d24e9aa3a", "file_name": "ecosldb/ecosldb.py", "vul_type": "cwe-089", "line_changes": {"deleted": [{"line_no": 4, "char_start": 121, "char_end": 220, "line": "            self.cursor.execute('insert into itemlanguage (language) values (\"%s\")' % language[0])\n"}], "added": [{"line_no": 4, "char_start": 121, "char_end": 153, "line": "            t = (language[0], )\n"}, {"line_no": 5, "char_start": 153, "char_end": 238, "line": "            self.cursor.execute('insert into itemlanguage (language) values (?)', t)\n"}]}, "char_changes": {"deleted": [{"char_start": 198, "char_end": 202, "chars": "\"%s\""}, {"char_start": 204, "char_end": 206, "chars": " %"}, {"char_start": 207, "char_end": 218, "chars": "language[0]"}], "added": [{"char_start": 133, "char_end": 165, "chars": "t = (language[0], )\n            "}, {"char_start": 230, "char_end": 231, "chars": "?"}, {"char_start": 233, "char_end": 234, "chars": ","}, {"char_start": 235, "char_end": 236, "chars": "t"}]}}
